MAP: Generated 2025-11-25 01:05:04
--app/Domains/Admin/Http/Controllers/ActivityLogController.php
<?php

namespace App\Domains\Admin\Http\Controllers;

use App\Http\Controllers\Controller;
use Spatie\Activitylog\Models\Activity;

class ActivityLogController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index()
    {
        $activities = Activity::latest()->paginate(20);

        return view('admin.activity-logs.index', compact('activities'));
    }
}
----
--app/Domains/Admin/Http/Controllers/DashboardController.php
<?php

namespace App\Domains\Admin\Http\Controllers;

use App\Domains\Admin\Services\DashboardService;
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class DashboardController extends Controller
{
    public function __construct(private DashboardService $dashboardService)
    {
    }

    /**
     * Display the admin dashboard.
     */
    public function index()
    {
        $stats = $this->dashboardService->getStats();
        $chartData = $this->dashboardService->getChartData();
        return view('admin.dashboard', compact('stats', 'chartData'));
    }
}
----
--app/Domains/Admin/Http/Controllers/ListingManagementController.php
<?php

namespace App\Domains\Admin\Http\Controllers;

use App\Domains\Listings\Models\Service;
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class ListingManagementController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index()
    {
        $services = Service::paginate(10);
        return view('admin.listings.index', compact('services'));
    }

    /**
     * Display the specified resource.
     */
    public function show(Service $service)
    {
        return view('admin.listings.show', compact('service'));
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit(Service $service)
    {
        return view('admin.listings.edit', compact('service'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, Service $service)
    {
        // Add validation and update logic later
        return redirect()->route('admin.listings.index')->with('success', 'Listing updated successfully.');
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy(Service $service)
    {
        $service->delete();
        return redirect()->route('admin.listings.index')->with('success', 'Listing deleted successfully.');
    }
}
----
--app/Domains/Admin/Http/Controllers/SettingsController.php
<?php

namespace App\Domains\Admin\Http\Controllers;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class SettingsController extends Controller
{
    /**
     * Display the settings page.
     */
    public function index()
    {
        // For now, return an empty view
        return view('admin.settings.index');
    }

    /**
     * Update the platform settings.
     */
    public function update(Request $request)
    {
        // Add validation and update logic later
        return redirect()->route('admin.settings.index')->with('success', 'Settings updated successfully.');
    }
}
----
--app/Domains/Admin/Http/Controllers/UserManagementController.php
<?php

namespace App\Domains\Admin\Http\Controllers;

use App\Domains\Users\Models\User;
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class UserManagementController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index()
    {
        $users = User::paginate(10);
        return view('admin.users.index', compact('users'));
    }

    /**
     * Display the specified resource.
     */
    public function show(User $user)
    {
        return view('admin.users.show', compact('user'));
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit(User $user)
    {
        return view('admin.users.edit', compact('user'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, User $user)
    {
        // Add validation and update logic later
        return redirect()->route('admin.users.index')->with('success', 'User updated successfully.');
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy(User $user)
    {
        $user->delete();
        return redirect()->route('admin.users.index')->with('success', 'User deleted successfully.');
    }
}
----
--app/Domains/Admin/Services/DashboardService.php
<?php

namespace App\Domains\Admin\Services;

use App\Domains\Users\Models\User;
use App\Domains\Orders\Models\Order;

class DashboardService
{
    /**
     * Get platform statistics.
     *
     * @return array
     */
    public function getStats(): array
    {
        return [
            'total_users' => $this->getTotalUsers(),
            'total_orders' => $this->getTotalOrders(),
            'total_revenue' => $this->getTotalRevenue(),
        ];
    }

    /**
     * Get the total number of users.
     *
     * @return int
     */
    protected function getTotalUsers(): int
    {
        return User::count();
    }

    /**
     * Get the total number of orders.
     *
     * @return int
     */
    protected function getTotalOrders(): int
    {
        return Order::count();
    }

    /**
     * Get the total revenue.
     *
     * @return float
     */
    protected function getTotalRevenue(): float
    {
        // Assuming 'total_amount' is the column that stores the order's total amount
        return Order::where('payment_status', 'paid')->sum('total_amount');
    }

    /**
     * Get data for charts.
     *
     * @return array
     */
    public function getChartData(): array
    {
        $days = 30;
        $labels = [];
        $usersData = [];
        $ordersData = [];

        for ($i = $days - 1; $i >= 0; $i--) {
            $date = now()->subDays($i);
            $labels[] = $date->format('M d');

            $usersData[] = User::whereDate('created_at', $date)->count();
            $ordersData[] = Order::whereDate('created_at', $date)->count();
        }

        return [
            'labels' => $labels,
            'datasets' => [
                [
                    'label' => 'New Users',
                    'data' => $usersData,
                    'backgroundColor' => 'rgba(54, 162, 235, 0.2)',
                    'borderColor' => 'rgba(54, 162, 235, 1)',
                    'borderWidth' => 1,
                ],
                [
                    'label' => 'New Orders',
                    'data' => $ordersData,
                    'backgroundColor' => 'rgba(75, 192, 192, 0.2)',
                    'borderColor' => 'rgba(75, 192, 192, 1)',
                    'borderWidth' => 1,
                ],
            ],
        ];
    }
}
----
--app/Domains/Common/Http/Controllers/AddressController.php
<?php

namespace App\Domains\Common\Http\Controllers;

use App\Domains\Common\Models\Address;
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class AddressController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index()
    {
        //
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        //
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        //
    }

    /**
     * Display the specified resource.
     */
    public function show(Address $address)
    {
        //
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit(Address $address)
    {
        //
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, Address $address)
    {
        //
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy(Address $address)
    {
        //
    }
}
----
--app/Domains/Common/Http/Controllers/MediaServeController.php
<?php

namespace App\Domains\Common\Http\Controllers;

use App\Domains\Common\Services\MediaService;
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Crypt;
use Illuminate\Support\Facades\Log;
use Symfony\Component\HttpFoundation\StreamedResponse;

class MediaServeController extends Controller
{
    protected $mediaService;

    public function __construct(MediaService $mediaService)
    {
        $this->mediaService = $mediaService;
    }

    /**
     * Handle the incoming request for media access.
     *
     * @param Request $request
     * @param string $payload
     * @return StreamedResponse
     */
    public function __invoke(Request $request, string $payload): StreamedResponse
    {
        try {
            $data = json_decode(Crypt::decryptString($payload), true, 512, JSON_THROW_ON_ERROR);
        } catch (\Exception $e) {
            Log::error('Failed to decrypt or decode media payload.', ['error' => $e->getMessage()]);
            abort(404, 'Invalid media link.');
        }

        if (!isset($data['media_id']) || !is_numeric($data['media_id'])) {
            Log::error('Invalid media payload structure. Missing or invalid media_id.', ['payload' => $data]);
            abort(404, 'Invalid media payload.');
        }

        $mediaId = (int) $data['media_id'];

        return $this->mediaService->streamById($request, $mediaId);
    }
}
----
--app/Domains/Common/Http/Controllers/Api/ApiController.php
<?php

namespace App\Domains\Common\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Traits\ApiResponses;

class ApiController extends Controller
{
    use ApiResponses;
}
----
--app/Domains/Common/Models/Address.php
<?php

namespace App\Domains\Common\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Address extends Model
{
    use HasFactory;

    protected $fillable = [
        'house_no',
        'street',
        'barangay',
        'town',
        'province',
        'country',
        'lat',
        'lng',
    ];

    protected static function newFactory()
    {
        return \Database\Factories\AddressFactory::new();
    }
}
----
--app/Domains/Common/Models/UserAddress.php
<?php

namespace App\Domains\Common\Models;

use Illuminate\Database\Eloquent\Model;
use \App\Domains\Users\Models\User;
use \App\Domains\Common\Models\Address;

class UserAddress extends Model
{
     protected $fillable = [
        'user_id',
        'address_id',
        'is_primary',
    ];

    public function address()
    {
        return $this->belongsTo(Address::class);
    }

    public function user()
    {
        return $this->belongsTo(User::class);
    }

}
----
--app/Domains/Common/Services/AddressService.php
<?php

namespace App\Domains\Common\Services;

use App\Domains\Common\Models\Address;
use App\Domains\Users\Models\User;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\DB;
use Illuminate\Database\Eloquent\Collection;

class AddressService
{
    /**
     * Get all addresses for the currently authenticated user.
     *
     * @return Collection
     */
    public function getAddressesForUser(): Collection
    {
        /** @var \App\Domains\Users\Models\User $user */
        $user = Auth::user();
        return $user->addresses()->withPivot('is_primary')->get();
    }

    public function getAddress(int $addressId): ?Address
    {
        return Address::find($addressId);
    }

    /**
     * Create a new address for the authenticated user.
     *
     * @param array $data
     * @return Address
     */
    public function createAddressForUser(array $data): Address
    {
        /** @var User $user */
        $user = Auth::user();

        // Extract is_primary from data
        $isPrimary = isset($data['is_primary']) ? (bool) $data['is_primary'] : false;
        
        // Remove is_primary and id from address data since they're not address fields
        // Don't filter empty strings as they might be intentional
        $addressData = collect($data)
            ->except(['is_primary', 'id'])
            ->toArray();

        return DB::transaction(function () use ($user, $addressData, $isPrimary) {
            // If the new address is primary, unset other primary addresses
            if ($isPrimary) {
                $this->unsetAllPrimaryAddresses($user);
            }

            // Create the address
            $address = Address::create($addressData);

            // Attach to user with pivot data
            $user->addresses()->attach($address->id, [
                'is_primary' => $isPrimary,
            ]);

            return $address->fresh();
        });
    }

    /**
     * Update an existing address for a user.
     *
     * @param int $addressId
     * @param array $data
     * @return Address
     * @throws \Illuminate\Database\Eloquent\ModelNotFoundException
     */
    public function updateUserAddress(int $addressId, array $data): Address
    {
        /** @var User $user */
        $user = Auth::user();
        
        // Verify the address belongs to the user
        $address = $user->addresses()->findOrFail($addressId);

        // Extract is_primary from data
        $isPrimary = isset($data['is_primary']) ? (bool) $data['is_primary'] : false;
        
        // Remove is_primary and id from address data since they're not address fields
        $addressData = collect($data)
            ->except(['is_primary', 'id', 'addressId'])
            ->filter(fn($value) => $value !== null && $value !== '')
            ->toArray();

        return DB::transaction(function () use ($user, $address, $addressId, $addressData, $isPrimary) {
            // If the address is being set as primary, unset others
            if ($isPrimary) {
                $this->unsetAllPrimaryAddresses($user);
            }

            // Update the address attributes
            $address->update($addressData);

            // Update the pivot table
            $user->addresses()->updateExistingPivot($addressId, [
                'is_primary' => $isPrimary,
            ]);

            return $address->fresh();
        });
    }

    /**
     * Delete an address for a user.
     *
     * @param int $addressId
     * @return void
     * @throws \Illuminate\Database\Eloquent\ModelNotFoundException
     */
    public function deleteUserAddress(int $addressId): void
    {
        /** @var User $user */
        $user = Auth::user();
        
        // Verify the address belongs to the user
        $user->addresses()->findOrFail($addressId);

        DB::transaction(function () use ($user, $addressId) {
            // Detach the address from the user
            $user->addresses()->detach($addressId);

            // Check if the address is now orphaned and delete it
            $relatedUsersCount = DB::table('user_addresses')
                ->where('address_id', $addressId)
                ->count();
                
            if ($relatedUsersCount === 0) {
                Address::destroy($addressId);
            }
        });
    }

    /**
     * Set a specific address as the primary one for the user.
     *
     * @param int $addressId
     * @return void
     * @throws \Illuminate\Database\Eloquent\ModelNotFoundException
     */
    public function setPrimaryAddress(int $addressId): void
    {
        /** @var User $user */
        $user = Auth::user();
        
        // Verify the address belongs to the user
        $user->addresses()->findOrFail($addressId);

        DB::transaction(function () use ($user, $addressId) {
            // Unset all primary addresses
            $this->unsetAllPrimaryAddresses($user);
            
            // Set the specified address as primary
            $user->addresses()->updateExistingPivot($addressId, [
                'is_primary' => true,
            ]);
        });
    }

    /**
     * Unset all primary addresses for a user.
     *
     * @param User $user
     * @return void
     */
    private function unsetAllPrimaryAddresses(User $user): void
    {
        // Get all address IDs for this user that are currently primary
        $primaryAddressIds = $user->addresses()
            ->wherePivot('is_primary', true)
            ->pluck('addresses.id');

        // Update each one individually
        foreach ($primaryAddressIds as $addressId) {
            $user->addresses()->updateExistingPivot($addressId, [
                'is_primary' => false,
            ]);
        }
    }
}
----
--app/Domains/Common/Services/MediaService.php
<?php

namespace App\Domains\Common\Services;

use Illuminate\Contracts\Auth\Access\Gate;
use Illuminate\Contracts\Config\Repository as Config;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Log;
use Plank\Mediable\Media;
use Symfony\Component\HttpFoundation\StreamedResponse;
use Illuminate\Support\Facades\DB;

class MediaService
{
    protected $gate;
    protected $config;

    public function __construct(Gate $gate, Config $config)
    {
        $this->gate = $gate;
        $this->config = $config;
    }

    /**
     * Find, authorize, and stream a media file by its ID.
     *
     * @param Request $request
     * @param int $mediaId
     * @return StreamedResponse
     */
    public function streamById(Request $request, int $mediaId): StreamedResponse
    {
        $media = Media::find($mediaId);

        if (!$media) {
            Log::warning('Media not found in database for ID.', ['media_id' => $mediaId]);
            abort(404, 'Media not found.');
        }

        $mediable = DB::table('mediables')->where('media_id', $mediaId)->first();

        if (!$mediable) {
            Log::error('Could not find parent model for media.', ['media_id' => $mediaId]);
            abort(404, 'Media source not found.');
        }

        $modelClass = $mediable->mediable_type;
        $model = $modelClass::find($mediable->mediable_id);

        if (!$model) {
            Log::error('Could not find parent model instance for media.', ['media_id' => $mediaId, 'mediable_type' => $mediable->mediable_type, 'mediable_id' => $mediable->mediable_id]);
            abort(404, 'Media source not found.');
        }

        // Check privacy setting for the model from config/media-privacy.php
        $privacy = $this->config->get('media-privacy.models.' . get_class($model), $this->config->get('media-privacy.default', 'private'));

        if ($privacy === 'private') {
            // Authorize using the policy defined for the parent model.
            if ($this->gate->denies('viewMedia', $model)) {
                Log::warning('Authorization denied by parent model policy.', [
                    'user_id' => $request->user()->id,
                    'model' => get_class($model),
                    'model_id' => $model->id
                ]);
                abort(403, 'You do not have permission to view this file.');
            }
        }

        return $this->streamPrivateMedia($media);
    }

    /**
     * Stream the media to the client.
     *
     * @param  \Plank\Mediable\Media $media
     * @return StreamedResponse
     */
    private function streamPrivateMedia(Media $media): StreamedResponse
    {
        return response()->streamDownload(
            function () use ($media) {
                $stream = $media->stream();
                while ($bytes = $stream->read(1024)) {
                    echo $bytes;
                }
            },
            $media->basename,
            [
                'Content-Type' => $media->mime_type,
                'Content-Length' => $media->size,
                'Content-Disposition' => 'inline; filename="' . $media->basename . '"',
            ]
        );
    }
}
----
--app/Domains/Listings/Http/Controllers/CategoryController.php
<?php

namespace App\Domains\Listings\Http\Controllers;

use App\Domains\Listings\Models\Category;
use App\Domains\Listings\Services\CategoryService;
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class CategoryController extends Controller
{
    public function __construct(
        private CategoryService $categoryService
    ) {}

    /**
     * Display a listing of categories with filters
     */
    public function index(Request $request)
    {
        $filters = [
            'search' => $request->input('search'),
            'per_page' => $request->input('per_page', 15),
        ];

        // Handle status filter
        $status = $request->input('status', 'active');
        if ($status === 'all') {
            $filters['include_deleted'] = true;
        } elseif ($status === 'deleted') {
            $filters['only_deleted'] = true;
        } else {
            $filters['only_active'] = true;
        }

        try {
            $categories = $this->categoryService->getAllCategories($filters);
            return view('creator.categories.index', compact('categories'));
        } catch (\Exception $e) {
            return view('creator.categories.index', [
                'categories' => new \Illuminate\Pagination\LengthAwarePaginator([], 0, 15)
            ]);
        }
    }

    /**
     * Store a newly created category
     */
    public function store(Request $request)
    {
        $validated = $request->validate([
            'name' => 'required|string|max:255|unique:categories,name',
            'description' => 'nullable|string|max:500',
        ]);

        try {
            $this->categoryService->createCategory($validated);
            return redirect()
                ->route('creator.categories.index')
                ->with('success', 'Category created successfully!');
        } catch (\Exception $e) {
            return back()
                ->withInput()
                ->with('error', 'Failed to create category: ' . $e->getMessage());
        }
    }

    /**
     * Update the specified category
     */
    public function update(Request $request, Category $category)
    {
        $validated = $request->validate([
            'name' => 'required|string|max:255|unique:categories,name,' . $category->id,
            'description' => 'nullable|string|max:500',
        ]);

        try {
            $this->categoryService->updateCategory($category->id, $validated);
            return redirect()
                ->route('creator.categories.index')
                ->with('success', 'Category updated successfully!');
        } catch (\Exception $e) {
            return back()
                ->withInput()
                ->with('error', 'Failed to update category: ' . $e->getMessage());
        }
    }

    /**
     * Remove the specified category (soft or force delete)
     */
    public function destroy(Request $request, $id)
    {
        $deleteType = $request->input('delete_type', 'soft');

        try {
            if ($deleteType === 'force') {
                // Force delete (permanent)
                $category = Category::withTrashed()->findOrFail($id);
                $category->forceDelete();
                $message = 'Category permanently deleted!';
            } else {
                // Soft delete
                $category = Category::findOrFail($id);
                $category->delete();
                $message = 'Category deleted successfully! You can restore it later.';
            }

            return redirect()
                ->route('creator.categories.index')
                ->with('success', $message)
                ->withInput([
                    'status' => $request->input('status', $request->query('status', 'all')),
                ]);
        } catch (\Exception $e) {
            return back()
                ->with('error', 'Failed to delete category: ' . $e->getMessage());
        }
    }

    /**
     * Restore a soft-deleted category
     */
    public function restore( Request $request, $id)
    {
        try {
            $category = Category::withTrashed()->findOrFail($id);
            $category->restore();

            return redirect()
                ->route('creator.categories.index')
                ->with('success', 'Category restored successfully!')
                ->withInput(['status' => $request->input('status', $request->query('status', 'active'))]);
        } catch (\Exception $e) {
            return back()
                ->with('error', 'Failed to restore category: ' . $e->getMessage());
        }
    }
}
----
--app/Domains/Listings/Http/Controllers/ListingController.php
<?php

namespace App\Domains\Listings\Http\Controllers;

use App\Http\Controllers\Controller;
use App\Domains\Listings\Services\ServiceService;
use App\Domains\Listings\Services\OpenOfferService;
use App\Domains\Listings\Services\CategoryService;
use Illuminate\Http\Request;
use Illuminate\Pagination\LengthAwarePaginator;

class ListingController extends Controller
{
    public function __construct(
        private readonly ServiceService $serviceService,
        private readonly OpenOfferService $openOfferService,
        private readonly CategoryService $categoryService
    ) {}

    public function index(Request $request)
    {
        $filters = $request->all();
        $type = $request->input('type', 'all');

        $perPage = 10;
        $currentPage = $request->input('page', 1);

        $services = collect();
        $offers = collect();

        // Get services only if applicable
        if ($type === 'all' || $type === 'service') {
            $services = $this->serviceService->getFilteredServices($filters)
                ->map(fn($service) => $this->attachThumbnail($service));
        }

        // Get offers only if applicable
        if ($type === 'all' || $type === 'offer') {
            $offers = $this->openOfferService->getFilteredOffers($filters)
                ->map(fn($offer) => $this->attachThumbnail($offer));
        }

        // Merge and sort by created_at descending
        $merged = $services->concat($offers)
            ->sortByDesc(fn($item) => $item->created_at)
            ->values();

        // Manual pagination
        $paginated = new LengthAwarePaginator(
            $merged->forPage($currentPage, $perPage),
            $merged->count(),
            $perPage,
            $currentPage,
            [
                'path' => $request->url(),
                'query' => $request->query(),
            ]
        );

        $categories = $this->categoryService->listAllCategories();

        return view('browse', [
            'listings' => $paginated,
            'categories' => $categories,
        ]);
    }

    // Attach first media thumbnail safely
    private function attachThumbnail($model)
    {
        $model->thumbnail = $model->getMedia('thumbnail')->first();
        return $model;
    }
}
----
--app/Domains/Listings/Http/Controllers/ServiceController.php
<?php

namespace App\Domains\Listings\Http\Controllers;

use App\Domains\Listings\Models\Service;
use App\Domains\Listings\Services\CategoryService;
use App\Domains\Common\Services\AddressService;
use App\Domains\Listings\Services\ServiceService;
use App\Domains\Listings\Services\WorkflowTemplateService;
use App\Http\Controllers\Controller;
use App\Domains\Listings\Http\Requests\StoreServiceRequest;
use Illuminate\Foundation\Auth\Access\AuthorizesRequests;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;

class ServiceController extends Controller
{
    use AuthorizesRequests;


    public function __construct(
        private ServiceService $serviceService,
        private CategoryService $categoryService,
        private WorkflowTemplateService $workflowTemplateService,
        private AddressService $addressService
    ) {}

    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $services = $this->serviceService->getPaginatedServices($request->all());
        $categories = $this->categoryService->listAllCategories();
        return view('creator.services.index', compact('services', 'categories'));
    }   

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = $this->categoryService->listAllCategories();
        $workflowTemplates = $this->workflowTemplateService->getWorkflowTemplatesByCreator(auth()->id());
        $addresses = $this->addressService->getAddressesForUser();
        
        return view('creator.services.create', compact('categories', 'workflowTemplates', 'addresses'));
    }

    /**
     * Display the specified resource.
     */
    public function show(Service $service)
    {
        $this->authorize('view', $service);
        return view('listings.services.show', compact('service'));
    }


    public function manage(Service $service) {
        $this->authorize('update', $service);
        // Placeholder data as per the guide
            $analytics = [
                'total_revenue' => 0,
                'today_clicks' => 0,
                'wishlist_count' => 0,
            ];
            $orders = [];
            $reviews = [];
        return view('creator.services.show', compact('service', 'analytics', 'orders', 'reviews'));
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit(Service $service)
    {
        $this->authorize('update', $service);

        $categories = $this->categoryService->listAllCategories();
        $workflowTemplates = $this->workflowTemplateService->getWorkflowTemplatesByCreator(auth()->id());
        $addresses = $this->addressService->getAddressesForUser();

        return view('creator.services.edit', compact('service', 'categories', 'workflowTemplates', 'addresses'));
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy(Service $service)
    {
        $this->authorize('delete', $service);

        try {
            $this->serviceService->deleteService($service);
            return redirect()->route('creator.services.index')->with('success', 'Service deleted successfully.');
        } catch (\Exception $e) {
            return back()->with('error', 'Failed to delete service: ' . $e->getMessage());
        }
    }
}
----
--app/Domains/Listings/Http/Controllers/WorkCatalogController.php
<?php

namespace App\Domains\Listings\Http\Controllers;

use App\Domains\Listings\Services\WorkCatalogService;
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class WorkCatalogController extends Controller
{
    public function __construct(private readonly WorkCatalogService $workCatalogService)
    {
    }

    /**
     * Display a listing of the resource.
     */
    public function index()
    {
        $workCatalogs = $this->workCatalogService->getAllWorkCatalogs();

        return response()->json($workCatalogs);
    }
}
----
--app/Domains/Listings/Http/Controllers/WorkTemplateController.php
<?php

namespace App\Domains\Listings\Http\Controllers;

use App\Domains\Listings\Http\Requests\StoreWorkTemplateRequest;
use App\Domains\Listings\Http\Requests\UpdateWorkTemplateRequest;
use App\Domains\Listings\Models\WorkflowTemplate;
use App\Domains\Listings\Models\WorkTemplate;
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class WorkTemplateController extends Controller
{
    /**
     * Store a newly created resource in storage.
     */
    public function store(StoreWorkTemplateRequest $request, WorkflowTemplate $workflowTemplate)
    {
        //
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(UpdateWorkTemplateRequest $request, WorkTemplate $workTemplate)
    {
        //
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy(WorkTemplate $workTemplate)
    {
        //
    }

    /**
     * Reorder the resources in storage.
     */
    public function reorder(Request $request, WorkflowTemplate $workflowTemplate)
    {
        //
    }
}
----
--app/Domains/Listings/Http/Controllers/WorkflowTemplateController.php
<?php

namespace App\Domains\Listings\Http\Controllers;

use App\Domains\Listings\Models\WorkflowTemplate;
use App\Domains\Listings\Services\WorkflowTemplateService;
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;

class WorkflowTemplateController extends Controller
{
    public function __construct(private readonly WorkflowTemplateService $workflowTemplateService)
    {
    }

    /**
     * Display a listing of the resource.
     */
    public function index()
    {
        $workflowTemplates = $this->workflowTemplateService->getWorkflowTemplatesByCreator(Auth::id());
        return view('creator.workflows.index', compact('workflowTemplates'));
    }

    /**
     * Show the form for creating a new workflow.
     * Creates an unsaved model instance.
     */
    public function create()
    {
        // Create a NEW unsaved model instance
        $workflowTemplate = new WorkflowTemplate([
            'name' => 'Untitled Workflow',
            'description' => '',
            'creator_id' => Auth::id(),
            'is_public' => false,
        ]);

        // IMPORTANT: Model exists in memory but NOT in database
        // $workflowTemplate->exists === false
        
        return view('creator.workflows.builder', ['workflowTemplate' => $workflowTemplate]);
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit(WorkflowTemplate $workflow)
    {
        $this->authorize('update', $workflow);   
        return view('creator.workflows.builder', ['workflowTemplate' => $workflow]);
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, WorkflowTemplate $workflow)
    {
        $this->authorize('update', $workflow);
        $this->workflowTemplateService->updateWorkflowTemplate($workflow, $request->all());
        return redirect()->route('creator.workflows.index')->with('success', 'Workflow updated successfully.');
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy(WorkflowTemplate $workflow)
    {
        $this->authorize('delete', $workflow);
        $this->workflowTemplateService->deleteWorkflowTemplate($workflow);
        return redirect()->route('creator.workflows.index')->with('success', 'Workflow deleted successfully.');
    }

    /**
     * Duplicate the specified resource.
     */
    public function duplicate(WorkflowTemplate $workflow)
    {
        $this->authorize('duplicate', $workflow);
        $newWorkflow = $this->workflowTemplateService->duplicateWorkflowTemplate($workflow);
        return redirect()->route('creator.workflows.edit', $newWorkflow)->with('success', 'Workflow duplicated successfully.');
    }
}
----
--app/Domains/Listings/Http/Requests/StoreServiceRequest.php
<?php

namespace App\Domains\Listings\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class StoreServiceRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'title' => 'required|string|max:255',
            'description' => 'nullable|string',
            'price' => 'required|numeric|min:0',
            'category_id' => 'required|integer|exists:categories,id',
            'workflow_template_id' => 'required|integer|exists:workflow_templates,id',
            'new_images' => 'nullable|array',
            'new_images.*' => 'string',
            'images_to_remove' => 'nullable|array',
            'images_to_remove.*' => 'integer',
            'is_active' => 'nullable|boolean',
        ];
    }

    public function messages(): array
    {
        return [
            'new_images.*.string' => 'Invalid image data provided.',
            'images_to_remove.*.integer' => 'Invalid image ID provided.',
        ];
    }
}
----
--app/Domains/Listings/Http/Resources/CategoryCollection.php
<?php

namespace App\Domains\Listings\Http\Resources;

use Illuminate\Http\Resources\Json\ResourceCollection;

class CategoryCollection extends ResourceCollection
{
    /**
     * Transform the resource collection into an array.
     *
     * @param  \Illuminate\Http\Request  $request
     * @return array
     */
    public function toArray($request)
    {
        return [
            'data' => $this->collection,
        ];
    }
}
----
--app/Domains/Listings/Http/Resources/CategoryResource.php
<?php

namespace App\Domains\Listings\Http\Resources;

use Illuminate\Http\Resources\Json\JsonResource;

class CategoryResource extends JsonResource
{
    /**
     * Transform the resource into an array.
     *
     * @param  \Illuminate\Http\Request  $request
     * @return array
     */
    public function toArray($request)
    {
        return [
            'id' => $this->id,
            'name' => $this->name,
            'description' => $this->description,
            'created_at' => $this->created_at,
            'updated_at' => $this->updated_at,
        ];
    }
}
----
--app/Domains/Listings/Models/Category.php
<?php

namespace App\Domains\Listings\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\SoftDeletes;
use App\Domains\Listings\Models\Service;


class Category extends Model
{
    use hasFactory, SoftDeletes;

    protected $table = 'categories';
    protected $fillable = ['name', 'description'];

    public function services()
    {
        return $this->belongsToMany(Service::class);
    }

    public function openOffers()
    {
        return $this->belongsToMany(OpenOffer::class);
    }

    protected static function newFactory()
    {
        return \Database\Factories\CategoryFactory::new();
    }
}
----
--app/Domains/Listings/Models/OpenOffer.php
<?php

namespace App\Domains\Listings\Models;

use Illuminate\Database\Eloquent\Model;
use App\Domains\Users\Models\User;
use App\Domains\Listings\Models\Category;
use App\Domains\Listings\Models\WorkflowTemplate;
use App\Domains\Common\Models\Address;
use Plank\Mediable\Mediable;
use Plank\Mediable\MediableInterface;
use Plank\Mediable\Media;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\SoftDeletes;
use Laravel\Scout\Searchable;

class OpenOffer extends Model implements MediableInterface
{
    use HasFactory;
    use SoftDeletes;
    use Mediable;
    use Searchable;

    protected $table = 'open_offers';
    
    protected $fillable = ['title', 'description', 'budget', 'pay_first', 'fulfilled' ,'category_id', 'creator_id', 'workflow_template_id', 'address_id'];

    /**
     * Get the indexable data array for the model.
     *
     * @return array
     */
    public function toSearchableArray()
    {
        return [
            'id' => $this->id,
            'title' => $this->title,
            'description' => $this->description,
        ];
    }

    // casts
    protected $casts = [
        'fulfilled' => 'boolean',
    ];


    public function thumbnail()
    {
        return $this->belongsTo(Media::class, 'thumbnail_id');
    }

    public function category()
    {
        return $this->belongsTo(Category::class);
    }


    public function creator()
    {
        return $this->belongsTo(User::class);
    }
    

    public function workflowTemplate()
    {
        return $this->belongsTo(WorkflowTemplate::class);
    }

    public function bids()
    
    {
        return $this->hasMany(OpenOfferBid::class);
    }


    protected static function newFactory()
    {
        return \Database\Factories\OpenOfferFactory::new();
    }

    public function address()
    {
        return $this->belongsTo(Address::class);
    }
}
----
--app/Domains/Listings/Models/OpenOfferBid.php
<?php

namespace App\Domains\Listings\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\SoftDeletes;
use App\Domains\Listings\Models\Service;


class OpenOfferBid extends Model
{
    use hasFactory, SoftDeletes;

    protected $table = 'open_offer_bids';
    protected $fillable = [
        'open_offer_id',
        'bidder_id',
        'service_id',
        'proposed_price',
        'accepted'
    ];
    

    public function service()
    {
        return $this->belongsToOne(Service::class);
    }

    public function openOffer()
    {
        return $this->belongsToOne(OpenOffer::class);
    }

    protected static function newFactory()
    {
        return \Database\Factories\OpenOfferBidFactory::new();
    }
}
----
--app/Domains/Listings/Models/Service.php
<?php

namespace App\Domains\Listings\Models;

use Illuminate\Database\Eloquent\Model;
use App\Domains\Users\Models\User;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\SoftDeletes;
use App\Domains\Common\Models\Address;
use App\Domains\Listings\Models\ListingReview;
use Plank\Mediable\Mediable;
use Plank\Mediable\MediableInterface;
use Laravel\Scout\Searchable;

use App\Domains\Common\Models\Image;

class Service extends Model implements MediableInterface
{
    use HasFactory;
    use SoftDeletes;
    use Mediable;
    use Searchable;

    protected $table = 'services';
    protected $fillable = ['title', 'description', 'price', 'pay_first', 'category_id', 'creator_id', 'workflow_template_id', 'address_id'];
    protected $casts = [
        'pay_first' => 'boolean',
    ];

    /**
     * Get the indexable data array for the model.
     *
     * @return array
     */
    public function toSearchableArray()
    {
        return [
            'id' => $this->id,
            'title' => $this->title,
            'description' => $this->description,
        ];
    }

    public function getGalleryImagesAttribute()
    {
        // Returns a Collection of Media objects tagged 'gallery'
        return $this->getMedia('gallery');
    }

    public function getThumbnailAttribute()
    {
        // Returns the first media tagged 'gallery'
        return $this->getMedia('gallery')->first();
    }

    public function category()
    {
        return $this->belongsTo(Category::class);
    }

    public function creator()
    {
        return $this->belongsTo(User::class);
    }

    public function workflowTemplate()
    {
        return $this->belongsTo(WorkflowTemplate::class);
    }

    public function address()
    {
        return $this->belongsTo(Address::class);
    }

    public function reviews()
    {
        return $this->morphMany(ListingReview::class, 'listing');
    }

    public function getThumbnailUrlAttribute()
    {
        return $this->getFirstMediaUrl('gallery');
    }

    protected static function newFactory()
    {
        return \Database\Factories\ServiceFactory::new();
    }
}
----
--app/Domains/Listings/Models/WorkCatalog.php
<?php

namespace App\Domains\Listings\Models;

use Database\Factories\WorkCatalogFactory; // Import the factory
use App\Domains\Listings\Models\WorkTemplate;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Factories\HasFactory;

class WorkCatalog extends Model
{
    use HasFactory;

    /**
     * Create a new factory instance for the model.
     */
    protected static function newFactory(): WorkCatalogFactory
    {
        return WorkCatalogFactory::new();
    }

    protected $fillable = [
        'name', 'description', 'default_config', 'price', 'duration_minutes'
    ];

    protected $casts = [
        'default_config' => 'array',
    ];

    public function workTemplates()
    {
        return $this->hasMany(WorkTemplate::class);
    }
}
----
--app/Domains/Listings/Models/WorkTemplate.php
<?php

namespace App\Domains\Listings\Models;

use Database\Factories\WorkTemplateFactory; // Import the factory
use Illuminate\Database\Eloquent\Model;
use App\Domains\Listings\Models\WorkflowTemplate;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use App\Domains\Listings\Models\WorkCatalog;

class WorkTemplate extends Model
{
    use HasFactory;

    /**
     * Create a new factory instance for the model.
     */
    protected static function newFactory(): WorkTemplateFactory
    {
        return WorkTemplateFactory::new();
    }

    protected $fillable = [
            'workflow_template_id',
            'work_catalog_id',
            'name',
            'description',
            'price',
            'duration_minutes',
            'order',
        ];

    protected $casts = [
        'custom_config' => 'array',
    ];

    public function workflowTemplate()
    {
        return $this->belongsTo(WorkflowTemplate::class);
    }
    public function workCatalog()
    {
        return $this->belongsTo(WorkCatalog::class);
    }
}
----
--app/Domains/Listings/Models/WorkflowTemplate.php
<?php

namespace App\Domains\Listings\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\SoftDeletes;
use App\Domains\Users\Models\User;

class WorkflowTemplate extends Model
{
    use hasFactory, SoftDeletes;

    protected $fillable = ['name', 'description', 'creator_id', 'is_public'];

    // casts
    protected $casts = [
        'is_public' => 'boolean',
    ];

    public function creator()
    {
        return $this->belongsTo(User::class);
    }


    public function services()
    {
        return $this->belongsToMany(Service::class);
    }

    public function workTemplates()
    {
        return $this->hasMany(WorkTemplate::class);
    }

    protected static function newFactory()
    {
        return \Database\Factories\WorkflowTemplateFactory::new();
    }

}
----
--app/Domains/Listings/Policies/CategoryPolicy.php
<?php

namespace App\Domains\Listings\Policies;

use App\Domains\Users\Models\User;
use App\Domains\Listings\Models\Category;
use Illuminate\Auth\Access\HandlesAuthorization;

class CategoryPolicy
{
    use HandlesAuthorization;

    /**
     * Determine whether the user can view any models.
     *
     * @param  \App\Models\User  $user
     * @return \Illuminate\Auth\Access\Response|bool
     */
    public function viewAny(User $user)
    {
        return true;
    }

    /**
     * Determine whether the user can view the model.
     *
     * @param  \App\Models\User  $user
     * @param  \App\Models\Category  $category
     * @return \Illuminate\Auth\Access\Response|bool
     */
    public function view(User $user, Category $category)
    {
        return true;
    }

    /**
     * Determine whether the user can create models.
     *
     * @param  \App\Models\User  $user
     * @return \Illuminate\Auth\Access\Response|bool
     */
    public function create(User $user)
    {
        return $user->isAdmin(); // Assuming you have an isAdmin method on your User model
    }

    /**
     * Determine whether the user can update the model.
     *
     * @param  \App\Models\User  $user
     * @param  \App\Models\Category  $category
     * @return \Illuminate\Auth\Access\Response|bool
     */
    public function update(User $user, Category $category)
    {
        return $user->isAdmin();
    }

    /**
     * Determine whether the user can delete the model.
     *
     * @param  \App\Models\User  $user
     * @param  \App\Models\Category  $category
     * @return \Illuminate\Auth\Access\Response|bool
     */
    public function delete(User $user, Category $category)
    {
        return $user->isAdmin();
    }

    /**
     * Determine whether the user can restore the model.
     *
     * @param  \App\Models\User  $user
     * @param  \App\Models\Category  $category
     * @return \Illuminate\Auth\Access\Response|bool
     */
    public function restore(User $user, Category $category)
    {
        return $user->isAdmin();
    }

    /**
     * Determine whether the user can permanently delete the model.
     *
     * @param  \App\Models\User  $user
     * @param  \App\Models\Category  $category
     * @return \Illuminate\Auth\Access\Response|bool
     */
    public function forceDelete(User $user, Category $category)
    {
        return $user->isAdmin();
    }
}
----
--app/Domains/Listings/Policies/ServicePolicy.php
<?php

namespace App\Domains\Listings\Policies;

use App\Domains\Listings\Models\Service;
use App\Domains\Users\Models\User;
use Illuminate\Auth\Access\Response;

class ServicePolicy
{
    /**
     * Determine whether the user can view any models.
     */
    public function viewAny(User $user): bool
    {
        return false;
    }

    /**
     * Determine whether the user can view the model.
     */
    public function view(User $user, Service $service): bool
    {
        return true;
    }

    /**
     * Determine whether the user can create models.
     */
    public function create(User $user): bool
    {
        return false;
    }

    /**
     * Determine whether the user can update the model.
     */
    public function update(User $user, Service $service): bool
    {
        return $user->id === $service->creator_id;
    }

    /**
     * Determine whether the user can delete the model.
     */
    public function delete(User $user, Service $service): bool
    {
        return $user->id === $service->creator_id;
    }

    /**
     * Determine whether the user can restore the model.
     */
    public function restore(User $user, Service $service): bool
    {
        return false;
    }

    /**
     * Determine whether the user can permanently delete the model.
     */
    public function forceDelete(User $user, Service $service): bool
    {
        return false;
    }
}
----
--app/Domains/Listings/Policies/WorkflowPolicy.php
<?php

namespace App\Domains\Listings\Policies;

use App\Domains\Listings\Models\WorkflowTemplate;
use App\Domains\Users\Models\User;
use Illuminate\Auth\Access\Response;

class WorkflowPolicy
{
    /**
     * Determine whether the user can view any models.
     */
    public function viewAny(User $user): bool
    {
        return true;
    }

    /**
     * Determine whether the user can view the model.
     */
    public function view(User $user, WorkflowTemplate $workflowTemplate): bool
    {
        return $user->id === $workflowTemplate->creator_id;
    }

    /**
     * Determine whether the user can create models.
     */
    public function create(User $user): bool
    {
        return true;
    }

    /**
     * Determine whether the user can update the model.
     */
    public function update(User $user, WorkflowTemplate $workflowTemplate): bool
    {
        return $user->id === $workflowTemplate->creator_id;
    }

    /**
     * Determine whether the user can delete the model.
     */
    public function delete(User $user, WorkflowTemplate $workflowTemplate): bool
    {
        return $user->id === $workflowTemplate->creator_id;
    }

    /**
     * Determine whether the user can duplicate the model.
     */
    public function duplicate(User $user, WorkflowTemplate $workflowTemplate): bool
    {
        return $user->id === $workflowTemplate->creator_id;
    }

    /**
     * Determine whether the user can restore the model.
     */
    public function restore(User $user, WorkflowTemplate $workflowTemplate): bool
    {
        return false;
    }

    /**
     * Determine whether the user can permanently delete the model.
     */
    public function forceDelete(User $user, WorkflowTemplate $workflowTemplate): bool
    {
        return false;
    }
}
----
--app/Domains/Listings/Services/CategoryService.php
<?php

namespace App\Domains\Listings\Services;

use App\Domains\Listings\Models\Category;
use App\Exceptions\ResourceNotFoundException;
use App\Exceptions\AuthorizationException;
use Illuminate\Database\Eloquent\Collection;
use Illuminate\Pagination\LengthAwarePaginator;

class CategoryService
{
    public function getAllCategories(array $filters = [])
    {
        $query = Category::query();

        if (!empty($filters['search'])) {
            $query->where('name', 'like', '%' . $filters['search'] . '%');
        }

        // include soft-deleted categories if specified or maybe just have the options of all or only deleted or only active.
        if (!empty($filters['include_deleted']) && $filters['include_deleted'] == true) {
            $query->withTrashed();
        }

        if (!empty($filters['only_deleted']) && $filters['only_deleted'] == true) {
            $query->onlyTrashed();
        }

        if (!empty($filters['only_active']) && $filters['only_active'] == true) {
            $query->whereNull('deleted_at');
        }

        $perPage = $filters['per_page'] ?? 15;
        $categories = $query->paginate($perPage);

        if ($categories->isEmpty()) {
            throw new ResourceNotFoundException('No categories found matching the criteria.');
        }

        return $categories;
    }

    public function getCategory(int $id)
    {
        $category = Category::find($id);

        if ($category == null) {
            throw new ResourceNotFoundException('Category not found');
        }
        if($category->trashed())
        {
            throw new ResourceNotFoundException('Category does not exist.');
        }
        return $category;
    }

    public function createCategory(array $data): Category
    {
        return Category::create($data);
    }

    public function updateCategory(int $id, array $data): ?Category
    {
        $category = $this->getCategory($id);
        $category->update($data);
        return $category;
    }

    public function deleteCategory(int $id): bool
    {
        $category = $this->getCategory($id);
        // options for soft delete or hard delete can be implemented here
        return $category->forceDelete();
        // return $category->delete();
    }

    public function listAllCategories(): Collection
    {
        return Category::orderBy('name')->get();
    }
}
----
--app/Domains/Listings/Services/OpenOfferBidService.php
<?php
namespace App\Domains\Listings\Services;

use App\Domains\Users\Services\UserService;
use App\Domains\Listings\Models\OpenOfferBid;
use App\Exceptions\AuthorizationException;
use App\Exceptions\BusinessRuleException;
use App\Exceptions\ResourceNotFoundException;
use Illuminate\Database\Eloquent\Collection;

class OpenOfferBidService
{


    public function __construct(
        private UserService $userService,
        private OpenOfferService $openOfferService,
        private ServiceService $serviceService
    ){}



    public function placeBid($data) : OpenOfferBid {

        $this->openOfferService->getOpenOffer($data['open_offer_id']);
        $this->userService->getUser($data['bidder_id']);
        $service = $this->serviceService->getService($data['service_id']);

        if($service -> creator_id != $data['bidder_id']) {
            throw new AuthorizationException('Bidder must be the creator of the service.');
        }

        if ($data['proposed_price'] <= 0) {
            throw new BusinessRuleException('Price must be greater than 0.');
        }

        return OpenOfferBid::create($data);
    }

    public function getOpenOfferBid($id) : OpenOfferBid {
        $bid = OpenOfferBid::where('open_offer_id', $id)->get();

        if ($bid == null) {
            throw new ResourceNotFoundException('Bid does not exist.');
        }

        if ($bid->trashed()) {
            throw new ResourceNotFoundException('Bid has been deleted.');
        }

        return $bid;
    }

    // all open offerse
    public function getAllOpenOfferBids() : Collection {

        $bids = OpenOfferBid::all();

        if ($bids->isEmpty()) {
            throw new ResourceNotFoundException('No bids found.');
        }

        if ($bids->every->trashed()) {
            throw new ResourceNotFoundException('Bids have all been deleted.');
        }
        
        return $bids;
    }

    public function rejectBid($id) : OpenOfferBid 
    {
        $bid = $this->getOpenOfferBid($id);
        return $bid; 
    }

    
}
----
--app/Domains/Listings/Services/OpenOfferService.php
<?php
namespace App\Domains\Listings\Services;

use App\Domains\Listings\Models\OpenOffer;
use App\Domains\Listings\Services\WorkflowTemplateService;
use App\Domains\Listings\Services\CategoryService;
use App\Domains\Users\Services\UserService;
use App\Domains\Common\Services\AddressService;

use App\Exceptions\AuthorizationException;
use App\Exceptions\BusinessRuleException;
use App\Exceptions\ResourceNotFoundException;
use Illuminate\Database\Eloquent\Collection;

class OpenOfferService
{

    public function __construct(
        private UserService $userService,
        private CategoryService $categoryService,
        private WorkflowTemplateService $workflowTemplateService
    ){}


        /**
         * Creates a new OpenOffer.
         *
         * @param array $data The data to be used when creating the OpenOffer.
         * @return OpenOffer The newly created OpenOffer.
         * @throws BusinessRuleException If the price is less than or equal to 0.
         * @throws AuthorizationException If the workflow does not belong to the creator or the user is not a creator.
         * @throws ResourceNotFoundException If the category or workflow template does not exist or has been deleted.
         */
    // public function createOpenOffer($data): OpenOffer
    // {
    //     if ($data['price'] <= 0) {
    //         throw new BusinessRuleException('Price must be greater than 0.');
    //     }

    //     $this->categoryService->getCategory($data['category_id']);
        
    //     if (!empty($data['workflow_template_id'])) {
    //         $workflow = $this->workflowTemplateService->getWorkflowTemplate($data['workflow_template_id']);            

    //         if (!$workflow->is_public && $workflow->creator_id != $data['creator_id']) 
    //         {
    //             throw new AuthorizationException('Workflow does not belong to creator.');
    //         }
    //     }

    //     // set address if not set then get fro mthe address of the user
    //     $creator = $this->userService->getUser($data['creator_id']);
    //     if ($creator == null) {
    //         throw new ResourceNotFoundException('Creator does not exist.');
    //     }
    //     if ($creator->trashed()) {
    //         throw new ResourceNotFoundException('Creator has been deleted.');
    //     }

    //     if ($data['address_id']) {
    //         $address = app(AddressService::class)->getAddress($data['address_id']);
    //         if ($address == null) {
    //             throw new ResourceNotFoundException('Address does not exist.');
    //         }
    //     } else {
    //         $address = $creator->addresses()->where('is_primary', true)->first();
    //         if ($address == null) {
    //             throw new ResourceNotFoundException('Creator does not have a primary address.');
    //         }
    //         $data['address_id'] = $address->id;
    //     }

    //     return OpenOffer::create($data);
    // }

    /**
     * Retrieves an OpenOffer by its ID.
     *
     * @param int $id The ID of the OpenOffer to retrieve.
     * @return OpenOffer The retrieved OpenOffer.
     * @throws ResourceNotFoundException If the OpenOffer does not exist or has been deleted.
     */
    public function getOpenOffer($id): OpenOffer
    {
        // get an open offer
        $openOffer = OpenOffer::find($id)->with('creator', 'category', 'workflowTemplate.workTemplates', 'address', 'images');
        if ($openOffer == null) {
            throw new ResourceNotFoundException('Open Offer does not exist.');
        }
        
        if ($openOffer->trashed()) {
            throw new ResourceNotFoundException('Open Offer has been deleted.');
        }

        return $openOffer;
    }


/**
 * Retrieves all OpenOffers.
 *
 * @return Collection A collection of all OpenOffers.
 * @throws ResourceNotFoundException If no openOffers are found or if all openOffers have been deleted.
 */
    public function getAllOpenOffers(): Collection
    {
        $openOffers = OpenOffer::with('creator', 'category', 'workflowTemplate.workTemplates', 'address')->get();

        if ($openOffers->isEmpty()) {
            throw new ResourceNotFoundException('No openOffers found.');
        }

        if ($openOffers->every->trashed()) {
            throw new ResourceNotFoundException('Open offers have all been deleted.');
        }

        $openOffers->each(function ($offer) {
            $offer->thumbnail = $offer->getMedia('thumbnail')->first();
        });

        return $openOffers;
}


    public function getFilteredOffers(array $filters = [])
    {
        $query = OpenOffer::with(['creator.media', 'address', 'media']);

        if (!empty($filters['search'])) {
            $search = $filters['search'];
            $query->where(fn($q) => $q
                ->where('title', 'like', "%{$search}%")
                ->orWhere('description', 'like', "%{$search}%")
            );
        }

        if (!empty($filters['category'])) {
            $query->where('category_id', $filters['category']);
        }

        $sortable = ['created_at', 'budget', 'title'];
        $sortBy = $filters['sort_by'] ?? 'created_at';
        $sortDir = $filters['sort_direction'] ?? 'desc';

        if (in_array($sortBy, $sortable)) {
            $query->orderBy($sortBy, $sortDir);
        }

        return $query->get(); // return collection, pagination handled in controller
    }




    public function getAllOpenOffersFiltered(array $filters = [])
    {
        $query = OpenOffer::with('creator', 'category', 'address', 'thumbnail');

        // Apply search filter
        if (!empty($filters['search'])) {
            $searchTerm = $filters['search'];
            $query->where(function ($q) use ($searchTerm) {
                $q->where('title', 'like', "%{$searchTerm}%")
                    ->orWhere('description', 'like', "%{$searchTerm}%");
            });
        }

        // Apply category filter
        if (!empty($filters['category'])) {
            $query->where('category_id', $filters['category']);
        }

        // Apply sorting
        $sortBy = $filters['sort_by'] ?? 'created_at';
        $sortDirection = $filters['sort_direction'] ?? 'desc';

        // Validate sort_by to prevent arbitrary column sorting
        $sortableColumns = ['created_at', 'price', 'title'];
        if (in_array($sortBy, $sortableColumns)) {
            $query->orderBy($sortBy, $sortDirection);
        }

        return $query->get();
    }

    public function createOpenOffer(array $data, MediaUploader $uploader): OpenOffer
    {
        return DB::transaction(function () use ($data, $uploader) {

            // Step 1  Create the offer record
            $offer = OpenOffer::create([
                'title' => $data['title'],
                'description' => $data['description'] ?? null,
                'budget' => $data['budget'],
                'category_id' => $data['category_id'],
                'workflow_template_id' => $data['workflow_template_id'] ?? null,
                'pay_first' => $data['pay_first'] ?? false,
                'address_id' => $data['address_id'] ?? null,
                'creator_id' => $data['creator_id'],
            ]);

            // Step 2  Handle newly uploaded images from FormWithMedia
            if (!empty($data['newFiles'])) {
                $this->attachMedia($offer, $data['newFiles'], $uploader);
            }

            return $offer;
        });
    }

    public function updateOpenOffer(OpenOffer $offer, array $data, MediaUploader $uploader): OpenOffer
    {
        return DB::transaction(function () use ($offer, $data, $uploader) {

            // Step 1  Update attributes
            $offer->update([
                'title' => $data['title'],
                'description' => $data['description'] ?? null,
                'budget' => $data['budget'],
                'category_id' => $data['category_id'],
                'workflow_template_id' => $data['workflow_template_id'] ?? null,
                'pay_first' => $data['pay_first'] ?? false,
                'address_id' => $data['address_id'] ?? null,
            ]);

            // Step 2  Remove any existing images the user marked
            if (!empty($data['images_to_remove'])) {
                $this->detachMedia($offer, $data['images_to_remove']);
            }

            // Step 3  Add new uploaded images
            if (!empty($data['newFiles'])) {
                $this->attachMedia($offer, $data['newFiles'], $uploader);
            }

            return $offer;
        });
    }

    private function attachMedia(OpenOffer $offer, array $filePaths, MediaUploader $uploader): void
    {
        foreach ($filePaths as $path) {
            try {
                $media = 
                    $uploader->fromSource(storage_path('app/' . $path))
                             ->toDirectory('offers/gallery')
                             ->upload();

                $offer->attachMedia($media, 'gallery');

            } catch (\Throwable $e) {
                Log::error("OpenOfferService attachMedia failed: " . $e->getMessage());
            }
        }
    }

    private function detachMedia(OpenOffer $offer, array $mediaIds): void
    {
        foreach ($mediaIds as $id) {
            try {
                $media = $offer->media()->where('id', $id)->first();
                if ($media) {
                    $offer->detachMedia($media);
                }
            } catch (\Throwable $e) {
                Log::error("OpenOfferService detachMedia failed: " . $e->getMessage());
            }
        }
    }
    
}
----
--app/Domains/Listings/Services/ServiceService.php
<?php

namespace App\Domains\Listings\Services;

use App\Domains\Listings\Models\Service;
use App\Exceptions\ResourceNotFoundException;
use App\Domains\Users\Services\UserService;
use App\Domains\Listings\Services\CategoryService;
use App\Domains\Listings\Services\WorkflowTemplateService;
use App\Domains\Common\Services\AddressService;
use Barryvdh\Debugbar\Facades\Debugbar;
use Illuminate\Support\Facades\Log;
use Illuminate\Http\UploadedFile;
use Plank\Mediable\MediaUploader;
use Illuminate\Database\Eloquent\Collection;
use Livewire\Features\SupportFileUploads\TemporaryUploadedFile;
use Symfony\Component\ErrorHandler\Debug;

class ServiceService
{
    public function __construct(
        private UserService $userService,
        private CategoryService $categoryService,
        private WorkflowTemplateService $workflowTemplateService,
        private AddressService $addressService
    ) {}

    /**
     * Create a new service with optional images
     */
   /**
     * Create a new service with optional uploaded images
     */
    public function createService(array $data, array $uploadedFiles = []): Service
    {
        Log::info('Creating service', ['data_keys' => array_keys($data)]);

        // Remove any image removal keys
        $serviceData = collect($data)->except(['images_to_remove'])->toArray();

        // Create service
        $service = Service::create($serviceData);

        // Handle uploads
        $this->handleUploadedFiles($service, $uploadedFiles);

        return $service->loadMedia('gallery');
    }

    /**
     * Update an existing service and manage images
     */
    public function updateService(Service $service, array $data, array $uploadedFiles = []): Service
    {
        // Update service info
        $service->update(collect($data)->except(['images_to_remove'])->toArray());

        // Remove images if requested
        if (!empty($data['images_to_remove'])) {
            foreach ($data['images_to_remove'] as $mediaId) {
                try {
                    $service->detachMedia($mediaId);
                    Log::info("Detached media ID: $mediaId");
                } catch (\Exception $e) {
                    Log::warning('Failed to detach media: ' . $e->getMessage());
                }
            }
        }

        // Handle newly uploaded files
        $this->handleUploadedFiles($service, $uploadedFiles);

        return $service->loadMedia('gallery');
    }

    protected function handleUploadedFiles(Service $service, array $files): void
    {
        Debugbar::info('handleUploadedFiles called', ['files_count' => count($files)]);

        $uploader = app(MediaUploader::class);

        foreach ($files as $file) {
            Debugbar::info('Processing file', ['file' => $file]);

            if ($file instanceof TemporaryUploadedFile) {
                try {
                    // Use getRealPath() directly - it's already stored by Livewire
                    $sourcePath = $file->getRealPath();
                    
                    Debugbar::info('Source path', ['path' => $sourcePath, 'exists' => file_exists($sourcePath)]);

                    $media = $uploader->fromSource($sourcePath)
                        ->toDestination('public', 'services')
                        ->upload();

                    $service->attachMedia($media, 'gallery');

                    Debugbar::info('Attached media', ['media_id' => $media->id]);

                } catch (\Exception $e) {
                    Debugbar::error('Failed to upload media: ' . $e->getMessage());
                    Log::error('Media upload failed', [
                        'error' => $e->getMessage(),
                        'trace' => $e->getTraceAsString()
                    ]);
                }
            } else {
                Debugbar::warning('Skipped invalid file', ['file' => $file]);
            }
        }
}

    /**
     * Delete a service
     */
    public function deleteService(Service $service): bool
    {
        return $service->delete();
    }

    /**
     * Retrieve a single service
     */
    public function getService($id): Service
    {
        $service = Service::with(['creator', 'category', 'workflowTemplate', 'address', 'media'])->withTrashed()->find($id);

        if (!$service) {
            throw new ResourceNotFoundException('Service does not exist.');
        }

        if ($service->trashed()) {
            throw new ResourceNotFoundException('Service has been deleted.');
        }

        return $service;
    }

    /**
     * Retrieve all services
     */
    public function getAllServices(): Collection
    {
        $services = Service::withMedia()->get();

        if ($services->isEmpty()) {
            throw new ResourceNotFoundException('No services found.');
        }



        return $services;
    }

    /**
     * Paginated services with filters
     */
    public function getPaginatedServices(array $filters = [], bool $withTrashed = false)
    {
        $query = Service::with(['creator.media', 'address', 'media']);

        if ($withTrashed) {
            $query->withTrashed();
        }

        if (!empty($filters['search'])) {
            $search = $filters['search'];
            $query->where(fn($q) => $q
                ->where('title', 'like', "%{$search}%")
                ->orWhere('description', 'like', "%{$search}%")
            );
        }

        if (!empty($filters['category'])) {
            $query->where('category_id', $filters['category']);
        }

        $sortable = ['created_at', 'price', 'title'];
        $sortBy = $filters['sort_by'] ?? 'created_at';
        $sortDir = $filters['sort_direction'] ?? 'desc';

        if (in_array($sortBy, $sortable)) {
            $query->orderBy($sortBy, $sortDir);
        }

        return $query->paginate(10);
    }

    /**
     * Get services by creator
     */
    public function getServicesForCreator(int $creatorId, array $filters = [], bool $withTrashed = false)
    {
        $query = Service::where('creator_id', $creatorId)
            ->with(['creator.media', 'address', 'media']);

        if ($withTrashed) {
            $query->withTrashed();
        }

        if (!empty($filters['search'])) {
            $search = $filters['search'];
            $query->where(fn($q) => $q
                ->where('title', 'like', "%{$search}%")
                ->orWhere('description', 'like', "%{$search}%")
            );
        }

        if (!empty($filters['category'])) {
            $query->where('category_id', $filters['category']);
        }

        $sortable = ['created_at', 'price', 'title'];
        $sortBy = $filters['sort_by'] ?? 'created_at';
        $sortDir = $filters['sort_direction'] ?? 'desc';

        if (in_array($sortBy, $sortable)) {
            $query->orderBy($sortBy, $sortDir);
        }

        return $query->paginate(10);
    }

    /**
     * Get filtered services (collection)
     */
    public function getFilteredServices(array $filters = [])
    {
        $query = Service::with(['creator.media', 'address', 'media']);

        if (!empty($filters['search'])) {
            $search = $filters['search'];
            $query->where(fn($q) => $q
                ->where('title', 'like', "%{$search}%")
                ->orWhere('description', 'like', "%{$search}%")
            );
        }

        if (!empty($filters['category'])) {
            $query->where('category_id', $filters['category']);
        }

        $sortable = ['created_at', 'price', 'title'];
        $sortBy = $filters['sort_by'] ?? 'created_at';
        $sortDir = $filters['sort_direction'] ?? 'desc';

        if (in_array($sortBy, $sortable)) {
            $query->orderBy($sortBy, $sortDir);
        }

        return $query->get();
    }

    /**
     * Helper: upload a single file to the service gallery
     */
    private function handleFileUpload(Service $service, $file): void
    {
        if ($file instanceof UploadedFile && $file->isValid()) {
            try {
                $uploader = app(MediaUploader::class); 
                $media = $uploader->fromSource($file->getRealPath())
                    ->toDestination('media', 'services')
                    ->upload();

                $service->attachMedia($media, 'gallery');
                Log::info('Attached media: ' . $file->getClientOriginalName());
            } catch (\Exception $e) {
                Log::error('Failed to upload media: ' . $e->getMessage());
            }
        } else {
            Log::warning('Invalid file skipped', ['file' => $file]);
        }
    }
}
----
--app/Domains/Listings/Services/WorkCatalogService.php
<?php

namespace App\Domains\Listings\Services;

use App\Domains\Listings\Models\WorkflowTemplate;
use App\Domains\Listings\Models\WorkTemplate;
use App\Domains\Listings\Models\WorkCatalog;
use App\Domains\Users\Services\UserService;
use App\Exceptions\ResourceNotFoundException;
use App\Exceptions\AuthorizationException;
use App\Exceptions\BusinessRuleException;
use Illuminate\Database\Eloquent\Collection;

class WorkCatalogService
{
    public function __construct(
        private CategoryService $categoryService,
        private WorkflowTemplateService $workflowTemplateService
    )
    {

    }
    public function createWorkCatalog(array $data): WorkCatalog
    {
        // check if already exists
        $existingCatalog = WorkCatalog::where('name', $data['name'])->first();
        if ($existingCatalog) {
            throw new BusinessRuleException('Work catalog already exists.');
        }
        return WorkCatalog::create($data);
    }

    public function getWorkCatalog($id): WorkCatalog
    {
        // get a work catalog
        $workCatalog = WorkCatalog::find($id);
        if ($workCatalog == null) {
            throw new ResourceNotFoundException('Work catalog does not exist.');
        }
        return $workCatalog;
    }

    public function getAllWorkCatalogs(): Collection
    {
        $workCatalogs = WorkCatalog::all();

        if ($workCatalogs->isEmpty()) {
            throw new ResourceNotFoundException('No work catalogs found.');
        }
        
        return $workCatalogs;
    }
}   


?>
----
--app/Domains/Listings/Services/WorkTemplateService.php
<?php

namespace App\Domains\Listings\Services;

use App\Domains\Listings\Models\WorkflowTemplate;
use App\Domains\Listings\Models\WorkTemplate;
use App\Domains\Listings\Models\WorkCatalog;
use App\Exceptions\ResourceNotFoundException;
use App\Exceptions\AuthorizationException;
use Illuminate\Database\Eloquent\Collection;
use Illuminate\Support\Facades\DB;

class WorkTemplateService
{
    public function getWorkTemplate(int $id): WorkTemplate
    {
        $workTemplate = WorkTemplate::find($id);
        if ($workTemplate == null) {
            throw new ResourceNotFoundException('Work template does not exist.');
        }
        return $workTemplate;
    }

    public function getAllWorkTemplates(): Collection
    {
        return WorkTemplate::all();
    }

    public function createWorkTemplate(array $data): WorkTemplate
    {
        return WorkTemplate::create($data);
    }

    public function createWorkTemplateFromCatalog(WorkflowTemplate $workflow, WorkCatalog $catalogItem): WorkTemplate
    {
        $lastStep = $workflow->workTemplates()->orderBy('order', 'desc')->first();

        return WorkTemplate::create([
            'workflow_template_id' => $workflow->id,
            'work_catalog_id' => $catalogItem->id,
            'name' => $catalogItem->name,
            'description' => $catalogItem->description,
            'price' => $catalogItem->price,
            'duration_minutes' => $catalogItem->duration_minutes,
            'order' => $lastStep ? $lastStep->order + 1 : 0,
        ]);
    }

    public function updateWorkTemplate(WorkTemplate $workTemplate, array $data): WorkTemplate
    {
        $workTemplate->update($data);
        return $workTemplate;
    }

    public function deleteWorkTemplate(WorkTemplate $workTemplate): void
    {
        $workTemplate->delete();
    }

    public function reorderWorkTemplates(WorkflowTemplate $workflow, array $steps): void
    {
        DB::transaction(function () use ($workflow, $steps) {
            foreach ($steps as $step) {
                $workflow->workTemplates()
                    ->where('id', $step['id'])
                    ->update(['order' => $step['order']]);
            }
        });
    }
}
----
--app/Domains/Listings/Services/WorkflowTemplateService.php
<?php

namespace App\Domains\Listings\Services;

use App\Domains\Listings\Models\WorkflowTemplate;
use App\Exceptions\ResourceNotFoundException;
use Illuminate\Database\Eloquent\Collection;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\DB;

class WorkflowTemplateService
{
    public function getWorkflowTemplate(int $id): WorkflowTemplate
    {
        $workflowTemplate = WorkflowTemplate::with('workTemplates')->find($id);
        if ($workflowTemplate == null) {
            throw new ResourceNotFoundException('Workflow template does not exist.');
        }
        return $workflowTemplate;
    }

    public function getWorkflowTemplatesByCreator(int $creatorId, array $filters = []): Collection
    {
        $query = WorkflowTemplate::where('creator_id', $creatorId)
            ->orWhere('is_public', true)
            ->orderBy('name');

        if (isset($filters['search'])) {
            $query->where('name', 'like', '%' . $filters['search'] . '%');
        }

        return $query->get();
    }

    public function createWorkflowTemplate(array $data): WorkflowTemplate
    {
        return WorkflowTemplate::create($data);
    }

    public function updateWorkflowTemplate(WorkflowTemplate $workflowTemplate, array $data): WorkflowTemplate
    {
        $workflowTemplate->update($data);
        return $workflowTemplate;
    }

    public function deleteWorkflowTemplate(WorkflowTemplate $workflowTemplate): void
    {
        DB::transaction(function () use ($workflowTemplate) {
            $workflowTemplate->workTemplates()->delete();
            $workflowTemplate->delete();
        });
    }

    public function duplicateWorkflowTemplate(WorkflowTemplate $workflowTemplate): WorkflowTemplate
    {
        return DB::transaction(function () use ($workflowTemplate) {
            $newWorkflowTemplate = $workflowTemplate->replicate([
                'name' // You might want to adjust the name of the duplicate
            ]);
            $newWorkflowTemplate->name = $workflowTemplate->name . ' (Copy)';
            $newWorkflowTemplate->save();

            foreach ($workflowTemplate->workTemplates as $workTemplate) {
                $newWorkTemplate = $workTemplate->replicate();
                $newWorkflowTemplate->workTemplates()->save($newWorkTemplate);
            }

            return $newWorkflowTemplate;
        });
    }
}
----
--app/Domains/Messaging/Http/Controllers/MessageController.php
<?php

namespace App\Domains\Messaging\Http\Controllers;

use App\Domains\Messaging\Models\Message;
use App\Domains\Messaging\Models\MessageThread;
use App\Domains\Messaging\Models\MessageAttachment;
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\DB;

class MessageController extends Controller
{
    /**
     * Create a new message thread.
     */
    public function createThread(Request $request)
    {
        $request->validate([
            'title' => 'nullable|string|max:255',
            'parent_type' => 'required|string',
            'parent_id' => 'required|integer',
        ]);

        $thread = MessageThread::create([
            'creator_id' => Auth::id(),
            'title' => $request->title,
            'parent_type' => $request->parent_type,
            'parent_id' => $request->parent_id,
        ]);

        return response()->json($thread, 201);
    }

    /**
     * Send a message within a thread.
     */
    public function sendMessage(Request $request, MessageThread $thread)
    {
        $request->validate([
            'content' => 'required|string',
            'attachments.*' => 'file|max:10240', // Max 10MB per file
        ]);

        $message = DB::transaction(function () use ($request, $thread) {
            $message = $thread->messages()->create([
                'sender_id' => Auth::id(),
                'content' => $request->content,
            ]);

            if ($request->hasFile('attachments')) {
                foreach ($request->file('attachments') as $file) {
                    $path = $file->store('message_attachments', 'public');
                    $message->attachments()->create([
                        'file_path' => $path,
                        'file_type' => $file->getMimeType(),
                    ]);
                }
            }
            return $message;
        });

        // TODO: Broadcast MessageSent event
        // event(new MessageSent($message));

        return response()->json($message->load('attachments'), 201);
    }

    /**
     * Mark messages in a thread as read for the authenticated user.
     */
    public function markAsRead(MessageThread $thread)
    {
        $thread->messages()
            ->where('read_at', null)
            ->where('sender_id', '!=', Auth::id())
            ->update(['read_at' => now()]);

        return response()->json(['message' => 'Messages marked as read']);
    }

    /**
     * List messages for a given thread with pagination.
     */
    public function listMessages(MessageThread $thread)
    {
        $messages = $thread->messages()->with('sender', 'attachments')->latest()->paginate(20);
        return response()->json($messages);
    }

    /**
     * Display a specific message thread.
     */
    public function show(MessageThread $thread)
    {
        return view('messages.show', compact('thread'));
    }
}
----
--app/Domains/Messaging/Models/Message.php
<?php

namespace App\Domains\Messaging\Models;

use App\Domains\Users\Models\User;
use Illuminate\Database\Eloquent\Model;

class Message extends Model
{
    protected $fillable = [
        'thread_id',
        'sender_id',
        'content',
        'read_at',
    ];

    protected $casts = [
        'read_at' => 'datetime',
    ];

    public function thread()
    {
        return $this->belongsTo(MessageThread::class);
    }

    public function sender()
    {
        return $this->belongsTo(User::class, 'sender_id');
    }

    public function attachments()
    {
        return $this->hasMany(MessageAttachment::class);
    }
}
----
--app/Domains/Messaging/Models/MessageAttachment.php
<?php

namespace App\Domains\Messaging\Models;

use Illuminate\Database\Eloquent\Model;

class MessageAttachment extends Model
{
    protected $fillable = [
        'message_id',
        'file_path',
        'file_type',
    ];

    public function message()
    {
        return $this->belongsTo(Message::class);
    }
}
----
--app/Domains/Messaging/Models/MessageThread.php
<?php

namespace App\Domains\Messaging\Models;

use App\Domains\Users\Models\User;
use Illuminate\Database\Eloquent\Model;

class MessageThread extends Model
{
    protected $fillable = [
        'creator_id',
        'title',
        'parent_type',
        'parent_id',
    ];

    public function creator()
    {
        return $this->belongsTo(User::class, 'creator_id');
    }

    public function messages()
    {
        return $this->hasMany(Message::class);
    }

    public function parent()
    {
        return $this->morphTo();
    }
}
----
--app/Domains/Orders/Http/Controllers/OrderController.php
<?php

namespace App\Domains\Orders\Http\Controllers;

use App\Domains\Orders\Models\Order;
use App\Domains\Orders\Services\OrderService;
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;

class OrderController extends Controller
{
    protected $orderService;

    public function __construct(OrderService $orderService)
    {
        $this->orderService = $orderService;
    }

    /**
     * Display a listing of the resource.
     */
    public function index()
    {
        $user = Auth::user();
        // Get orders where user is either buyer or seller
        $orders = Order::where('buyer_id', $user->id)
            ->orWhere('seller_id', $user->id)
            ->with('service', 'buyer', 'seller')
            ->orderByDesc('created_at')
            ->get();
        return view('orders.index', compact('orders'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        //
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        $request->validate([
            'service_id' => 'required|exists:services,id',
        ]);

        $order = $this->orderService->createOrderFromService($request->service_id, Auth::user());

        return redirect()->route('orders.show', $order);
    }

    /**
     * Display the specified resource.
     */
    public function show(string $id)
    {
        $order = Order::with(['buyer', 'seller', 'service'])->findOrFail($id);
        $this->authorize('view', $order);
        return view('orders.show', compact('order'));
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit(string $id)
    {
        $order = Order::findOrFail($id);
        $this->authorize('update', $order);
        return view('orders.edit', compact('order'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, string $id)
    {
        $order = Order::findOrFail($id);
        $this->authorize('update', $order);

        $validated = $request->validate([
            'cancellation_reason' => 'nullable|string|max:500',
        ]);

        if ($request->has('cancellation_reason')) {
            $order->cancellation_reason = $validated['cancellation_reason'];
            $order->save();
        }

        return redirect()->route('orders.show', $order)->with('success', 'Order updated successfully');
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy(string $id)
    {
        $order = Order::findOrFail($id);
        $this->authorize('delete', $order);

        $order->delete();

        return redirect()->route('orders.index')->with('success', 'Order deleted successfully');
    }

    public function createFromBid(string $bid)
    {
        $order = $this->orderService->createOrderFromBid($bid);
        return redirect()->route('orders.show', $order);
    }

    public function cancel(string $order)
    {
        $order = Order::findOrFail($order);
        $this->authorize('delete', $order);
        
        $this->orderService->cancelOrder($order);
        return redirect()->route('orders.show', $order)->with('success', 'Order cancelled successfully');
    }
}
----
--app/Domains/Orders/Models/Order.php
<?php

namespace App\Domains\Orders\Models;

use App\Domains\Users\Models\User;
use App\Domains\Listings\Models\Service;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Spatie\Activitylog\Traits\LogsActivity;
use Spatie\Activitylog\LogOptions;

class Order extends Model
{
    use HasFactory, LogsActivity;

    protected $fillable = [
        'buyer_id',
        'seller_id',
        'service_id',
        'open_offer_id',
        'open_offer_bid_id',
        'price',
        'platform_fee',
        'total_amount',
        'status',
        'payment_status',
        'cancelled_at',
        'cancellation_reason',
    ];

    public function getActivitylogOptions(): LogOptions
    {
        return LogOptions::defaults()
            ->logOnly(['status', 'payment_status'])
            ->setDescriptionForEvent(fn(string $eventName) => "Order has been {$eventName}");
    }

    public function buyer()
    {
        return $this->belongsTo(User::class, 'buyer_id');
    }

    public function seller()
    {
        return $this->belongsTo(User::class, 'seller_id');
    }

    public function service()
    {
        return $this->belongsTo(Service::class);
    }

    public function workInstance()
    {
        return $this->hasOne(\App\Domains\Work\Models\WorkInstance::class);
    }

    protected static function newFactory()
    {
        return \Database\Factories\OrderFactory::new();
    }
}
----
--app/Domains/Orders/Policies/OrderPolicy.php
<?php

namespace App\Domains\Orders\Policies;

use App\Domains\Orders\Models\Order;
use App\Domains\Users\Models\User;
use Illuminate\Auth\Access\Response;

class OrderPolicy
{
    /**
     * Determine whether the user can view any models.
     */
    public function viewAny(User $user): bool
    {
        return $user->id !== null;
    }

    /**
     * Determine whether the user can view the model.
     */
    public function view(User $user, Order $order): bool
    {
        return $user->id === $order->buyer_id || $user->id === $order->seller_id;
    }

    /**
     * Determine whether the user can create models.
     */
    public function create(User $user): bool
    {
        return $user->id !== null;
    }

    /**
     * Determine whether the user can update the model.
     */
    public function update(User $user, Order $order): bool
    {
        return $user->id === $order->buyer_id || $user->id === $order->seller_id;
    }

    /**
     * Determine whether the user can delete the model.
     */
    public function delete(User $user, Order $order): bool
    {
        return $user->id === $order->buyer_id || $user->id === $order->seller_id;
    }
}
----
--app/Domains/Orders/Services/OrderService.php
<?php

namespace App\Domains\Orders\Services;

use App\Domains\Listings\Models\OpenOfferBid;
use App\Domains\Orders\Models\Order;
use App\Enums\OrderStatus;
use App\Mail\OrderCreated;
use Illuminate\Support\Facades\Mail;
use Illuminate\Support\Facades\Log;
use App\Domains\Listings\Models\Service;
use App\Domains\Listings\Models\WorkflowTemplate;
use App\Domains\Work\Models\WorkInstance;
use App\Domains\Work\Models\WorkInstanceStep;

class OrderService
{
    public function createOrderFromBid(string $bidId): Order
    {
        $bid = OpenOfferBid::with('openOffer', 'service')->findOrFail($bidId);
        $offer = $bid->openOffer;

        // Set the bid as accepted
        $bid->accepted = true;
        $bid->save();

        $order = new Order([
            'buyer_id' => $offer->buyer_id,
            'seller_id' => $bid->service->creator_id,
            'service_id' => $bid->service_id,
            'open_offer_id' => $bid->open_offer_id,
            'open_offer_bid_id' => $bidId,
            'price' => $bid->proposed_price,
            'platform_fee' => $bid->proposed_price * 0.05, // Assuming a 5% platform fee
            'total_amount' => $bid->proposed_price * 1.05,
            'status' => OrderStatus::PENDING->value,
            'payment_status' => 'pending',
        ]);
        $order->save();

        // Workflow Cloning Logic
        $service = $bid->service;
        if ($service && $service->workflowTemplate) {
            $workflowTemplate = $service->workflowTemplate;

            $workInstance = WorkInstance::create([
                'order_id' => $order->id,
                'workflow_template_id' => $workflowTemplate->id,
                'current_step_index' => 0,
                'status' => 'pending', // Initial status for work instance
                'started_at' => null,
                'completed_at' => null,
            ]);

            foreach ($workflowTemplate->workTemplates as $index => $workTemplate) {
                WorkInstanceStep::create([
                    'work_instance_id' => $workInstance->id,
                    'work_template_id' => $workTemplate->id,
                    'step_index' => $index,
                    'status' => 'pending', // Initial status for each step
                    'started_at' => null,
                    'completed_at' => null,
                ]);
            }
        }


        try {
            Mail::to($order->buyer->email)->send(new OrderCreated($order)); // Send email to buyer
        } catch (\Exception $e) {
            // Log the error but don't break the order creation
            Log::warning('Failed to send order created email', ['order_id' => $order->id, 'error' => $e->getMessage()]);
        }

        return $order;
    }

    public function createOrderFromService(string $serviceId, $buyer): Order
    {
        $service = Service::findOrFail($serviceId);

        $order = new Order([
            'buyer_id' => $buyer->id,
            'seller_id' => $service->creator_id,
            'service_id' => $service->id,
            'price' => $service->price,
            'platform_fee' => $service->price * 0.05, // Assuming a 5% platform fee
            'total_amount' => $service->price * 1.05,
            'status' => OrderStatus::PENDING->value,
            'payment_status' => 'pending',
        ]);
        $order->save();

        // Workflow Cloning Logic
        if ($service && $service->workflowTemplate) {
            $workflowTemplate = $service->workflowTemplate;

            $workInstance = WorkInstance::create([
                'order_id' => $order->id,
                'workflow_template_id' => $workflowTemplate->id,
                'current_step_index' => 0,
                'status' => 'pending', // Initial status for work instance
                'started_at' => null,
                'completed_at' => null,
            ]);

            foreach ($workflowTemplate->workTemplates as $index => $workTemplate) {
                WorkInstanceStep::create([
                    'work_instance_id' => $workInstance->id,
                    'work_template_id' => $workTemplate->id,
                    'step_index' => $index,
                    'status' => 'pending', // Initial status for each step
                    'started_at' => null,
                    'completed_at' => null,
                ]);
            }
        }


        Mail::to($order->buyer->email)->send(new OrderCreated($order)); // Send email to buyer

        return $order;
    }

    public function cancelOrder(Order $order): Order
    {
        if ($order->status !== OrderStatus::PENDING->value) {
            // Or throw an exception
            return $order;
        }

        $order->status = OrderStatus::CANCELLED->value;
        $order->save();

        // TODO: Send OrderCancelled email
        // Mail::to($order->buyer->email)->send(new OrderCancelled($order));

        return $order;
    }
}
----
--app/Domains/Payments/Http/Controllers/.dummy
--app/Domains/Payments/Http/Controllers/PaymentController.php
<?php

namespace App\Domains\Payments\Http\Controllers;

use App\Domains\Orders\Models\Order;
use App\Domains\Payments\Services\PaymentService;
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class PaymentController extends Controller
{
    protected $paymentService;

    public function __construct(PaymentService $paymentService)
    {
        $this->paymentService = $paymentService;
    }

    public function checkout(Order $order)
    {
        return view('payments.checkout', compact('order'));
    }

    public function pay(Request $request, Order $order)
    {
        try {
            $invoiceUrl = $this->paymentService->createInvoice($order);
            return redirect()->away($invoiceUrl);
        } catch (\Exception $e) {
            return back()->with('error', $e->getMessage());
        }
    }

    public function success()
    {
        return view('payments.success');
    }

    public function failed()
    {
        return view('payments.failed');
    }
}
----
--app/Domains/Payments/Http/Controllers/PaymentWebhookController.php
<?php

namespace App\Domains\Payments\Http\Controllers;

use App\Domains\Payments\Models\Payment;
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Config;

class PaymentWebhookController extends Controller
{
    public function handle(Request $request)
    {
        $webhookToken = Config::get('payment.xendit.webhook_token');
        $requestToken = $request->header('x-callback-token');

        if ($webhookToken !== $requestToken) {
            return response()->json(['message' => 'Unauthorized'], 401);
        }

        $payload = $request->all();

        $payment = Payment::where('id', $payload['external_id'])->first();

        if ($payment) {
            if ($payload['status'] === 'PAID') {
                $payment->status = 'paid';
                $payment->paid_at = now();
                $payment->metadata = $payload;
                $payment->save();

                // Update order status
                $order = $payment->order;
                $order->payment_status = 'paid';
                $order->save();
            } else {
                $payment->status = 'failed';
                $payment->metadata = $payload;
                $payment->save();

                // Update order status
                $order = $payment->order;
                $order->payment_status = 'failed';
                $order->save();
            }
        }

        return response()->json(['message' => 'Webhook received']);
    }
}
----
--app/Domains/Payments/Models/Payment.php
<?php

namespace App\Domains\Payments\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use App\Domains\Users\Models\User;
use App\Domains\Orders\Models\Order;
use Spatie\Activitylog\Traits\LogsActivity;
use Spatie\Activitylog\LogOptions;

class Payment extends Model
{
    use HasFactory, LogsActivity;

    protected $fillable = [
        'order_id',
        'user_id',
        'amount',
        'platform_fee',
        'total_amount',
        'payment_method',
        'provider_reference',
        'status',
        'paid_at',
        'metadata',
    ];

    public function getActivitylogOptions(): LogOptions
    {
        return LogOptions::defaults()
            ->logOnly(['status'])
            ->setDescriptionForEvent(fn(string $eventName) => "Payment has been {$eventName}");
    }

    protected $casts = [
        'paid_at' => 'datetime',
        'metadata' => 'array',
    ];

    public function user()
    {
        return $this->belongsTo(User::class);
    }

    public function order()
    {
        return $this->belongsTo(Order::class);
    }
}
----
--app/Domains/Payments/Services/PaymentService.php
<?php

namespace App\Domains\Payments\Services;

use App\Domains\Orders\Models\Order;
use App\Domains\Payments\Models\Payment;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Config;
use Xendit\Configuration;
use Xendit\Invoice\InvoiceApi;

class PaymentService
{
    protected $invoiceApi;

    public function __construct()
    {
        $apiKey = Config::get('payment.xendit.api_key');
        Configuration::setApiKey($apiKey);
        $this->invoiceApi = new InvoiceApi();
    }

    public function createInvoice(Order $order)
    {
        $platformFeePercentage = Config::get('payment.platform_fee.percentage');
        $platformFee = ($order->price * $platformFeePercentage) / 100;
        $totalAmount = $order->price + $platformFee;

        $payment = Payment::create([
            'order_id' => $order->id,
            'user_id' => Auth::id(),
            'amount' => $order->price,
            'platform_fee' => $platformFee,
            'total_amount' => $totalAmount,
        ]);

        $params = [
            'external_id' => (string) $payment->id,
            'payer_email' => Auth::user()->email,
            'description' => 'Payment for Order #' . $order->id,
            'amount' => $totalAmount,
            'success_redirect_url' => route('payments.success'),
            'failure_redirect_url' => route('payments.failed'),
        ];

        $invoice = $this->invoiceApi->createInvoice($params);

        $payment->provider_reference = $invoice['id'];
        $payment->save();

        return $invoice['invoice_url'];
    }
}
----
--app/Domains/Search/Http/Controllers/SearchController.php
<?php

namespace App\Domains\Search\Http\Controllers;

use App\Domains\Listings\Models\Service;
use App\Domains\Listings\Services\CategoryService;
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class SearchController extends Controller
{
    public function __construct(private CategoryService $categoryService)
    {
    }

    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = $request->input('query');
        $addressId = $request->input('address_id');
        $categoryId = $request->input('category_id');
        $minPrice = $request->input('min_price');
        $maxPrice = $request->input('max_price');
        $sortBy = $request->input('sort_by', 'created_at');
        $sortDirection = $request->input('sort_direction', 'desc');

        $services = Service::search($query)->with(['category', 'media']);

        if ($addressId) {
            $services->where('address_id', $addressId);
        }

        if ($categoryId) {
            $services->where('category_id', $categoryId);
        }

        if ($minPrice) {
            $services->where('price', '>=', $minPrice);
        }

        if ($maxPrice) {
            $services->where('price', '<=', $maxPrice);
        }

        $services->orderBy($sortBy, $sortDirection);

        $services = $services->paginate(10);
        $categories = $this->categoryService->listAllCategories();

        return view('search.index', compact('services', 'query', 'addressId', 'categoryId', 'minPrice', 'maxPrice', 'sortBy', 'sortDirection', 'categories'));
    }

    public function suggestions(Request $request)
    {
        $query = $request->input('query');
        $suggestions = Service::search($query)->take(5)->get()->pluck('title');

        return response()->json($suggestions);
    }
}
----
--app/Domains/Users/Http/Controllers/ProfileController.php
<?php

namespace App\Domains\Users\Http\Controllers;

use App\Http\Controllers\Controller;
use App\Domains\Users\Http\Requests\ProfileUpdateRequest;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Redirect;
use Illuminate\View\View;

class ProfileController extends Controller
{
    /**
     * Display the user's profile form.
     */
    public function edit(Request $request): View
    {
        return view('profile.edit', [
            'user' => $request->user(),
        ]);
    }

    /**
     * Update the user's profile information.
     */
    public function update(ProfileUpdateRequest $request): RedirectResponse
    {
        $user = $request->user();
        $validated = $request->validated();

        $emailChanged = isset($validated['email']) && $validated['email'] !== $user->email;
        $user->fill($validated);
        if ($emailChanged) {
            $user->email_verified_at = null;
        }

        $user->save();

        return Redirect::route('profile.edit')->with('status', 'profile-updated');
    }



    /**
     * Delete the user's account.
     */
    public function destroy(Request $request): RedirectResponse
    {
        $request->validateWithBag('userDeletion', [
            'password' => ['required', 'current_password'],
        ]);

        $user = $request->user();

        Auth::logout();

        $user->delete();

        $request->session()->invalidate();
        $request->session()->regenerateToken();

        return Redirect::to('/');
    }
}
----
--app/Domains/Users/Http/Controllers/UserVerificationController.php
<?php

namespace App\Domains\Users\Http\Controllers;

use App\Domains\Users\Models\UserVerification;
use App\Http\Controllers\Controller;
use Barryvdh\Debugbar\Facades\Debugbar;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Plank\Mediable\MediaUploader;

class UserVerificationController extends Controller
{
    public function create()
    {
        $existingVerification = UserVerification::where('user_id', Auth::id())->first();

        if ($existingVerification && in_array($existingVerification->status, ['pending', 'approved'])) {
            return redirect()->route('verification.status');
        }

        return view('verification.submit');
    }

    public function store(Request $request, MediaUploader $uploader)
    {
        $request->validate([
            'id_type' => ['required', 'string', 'in:national_id,drivers_license,passport'],
            'id_front' => ['required', 'image', 'max:2048'],
            'id_back' => ['required', 'image', 'max:2048'],
        ]);

        $user = Auth::user();

        // Prevent re-submission if already pending or approved
        $existingVerification = UserVerification::where('user_id', $user->id)->first();
        if ($existingVerification && in_array($existingVerification->status, ['pending', 'approved'])) {
             return redirect()->route('verification.status')->with('error', 'You already have a pending or approved verification request.');
        }

        // Create or update the verification record first
        $verification = UserVerification::updateOrCreate(
            ['user_id' => $user->id],
            [
                'id_type' => $request->id_type,
                'status' => 'pending',
                'rejection_reason' => null,
                'reviewed_at' => null,
                'reviewed_by' => null,
            ]
        );

        // Upload the front ID and attach to the verification record
        if ($request->hasFile('id_front')) {
            $media = $uploader->fromSource($request->file('id_front'))
                ->toDestination('local', $user->id) // Use user ID as directory
                ->upload();
            $verification->attachMedia($media, 'verification-id-front');
        }

        // Upload the back ID and attach to the verification record
        if ($request->hasFile('id_back')) {
            $media = $uploader->fromSource($request->file('id_back'))
                ->toDestination('local', $user->id) // Use user ID as directory
                ->upload();
            $verification->attachMedia($media, 'verification-id-back');
        }

        return redirect()->route('verification.status')->with('success', 'Your verification documents have been submitted successfully.');
    }

    public function status()
    {
        $user = Auth::user();
        $verification = UserVerification::where('user_id', $user->id)->first();
        $idFrontMedia = $verification ? $verification->getMedia('verification-id-front')->first() : null;
        // debugger
        $idBackMedia = $verification ? $verification->getMedia('verification-id-back')->first() : null;

        return view('verification.status', [
            'verification' => $verification,
            'idFrontMedia' => $idFrontMedia,
            'idBackMedia' => $idBackMedia,
        ]);
    }
}
----
--app/Domains/Users/Http/Controllers/Admin/UserVerificationController.php
<?php

namespace App\Domains\Users\Http\Controllers\Admin;

use App\Domains\Users\Models\UserVerification;
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Storage;
use Illuminate\Support\Facades\Response;

class UserVerificationController extends Controller
{
    public function index()
    {
        $verifications = UserVerification::where('status', 'pending')->with('user')->paginate(10);

        return view('admin.verifications.index', ['verifications' => $verifications]);
    }

    public function show(UserVerification $verification)
    {
        // Get media directly from the verification model
        $idFrontMedia = $verification->getMedia('verification-id-front')->first();
        $idBackMedia = $verification->getMedia('verification-id-back')->first();

        return view('admin.verifications.show', [
            'verification' => $verification,
            'idFrontMedia' => $idFrontMedia,
            'idBackMedia' => $idBackMedia,
        ]);
    }

    public function approve(UserVerification $verification)
    {
        $verification->status = 'approved';
        $verification->reviewed_at = now();
        $verification->reviewed_by = Auth::id();
        $verification->rejection_reason = null;
        $verification->save();

        $verification->user->is_verified = true;
        $verification->user->verified_at = now();
        $verification->user->save();

        // TODO: Send notification to user

        return redirect()->route('admin.verifications.index')->with('success', 'User verification approved.');
    }

    public function reject(Request $request, UserVerification $verification)
    {
        $request->validate(['rejection_reason' => 'required|string|max:500']);

        $verification->status = 'rejected';
        $verification->reviewed_at = now();
        $verification->reviewed_by = Auth::id();
        $verification->rejection_reason = $request->rejection_reason;
        $verification->save();

        // Ensure user is not marked as verified
        $verification->user->is_verified = false;
        $verification->user->save();

        // TODO: Send notification to user

        return redirect()->route('admin.verifications.index')->with('success', 'User verification rejected.');
    }


}
----
--app/Domains/Users/Http/Controllers/Auth/AuthenticatedSessionController.php
<?php

namespace App\Domains\Users\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use App\Domains\Users\Http\Requests\Auth\LoginRequest;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\View\View;

class AuthenticatedSessionController extends Controller
{
    /**
     * Display the login view.
     */
    public function create(): View
    {
        return view('auth.signin');
    }

    /**
     * Handle an incoming authentication request.
     */
    public function store(LoginRequest $request): RedirectResponse
    {
        $request->authenticate();

        $request->session()->regenerate();

        return redirect()->intended(route('creator.dashboard', absolute: false));
    }

    /**
     * Destroy an authenticated session.
     */
    public function destroy(Request $request): RedirectResponse
    {
        Auth::guard('web')->logout();

        $request->session()->invalidate();

        $request->session()->regenerateToken();

        return redirect('/');
    }
}
----
--app/Domains/Users/Http/Controllers/Auth/ConfirmablePasswordController.php
<?php

namespace App\Domains\Users\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Validation\ValidationException;
use Illuminate\View\View;

class ConfirmablePasswordController extends Controller
{
    /**
     * Show the confirm password view.
     */
    public function show(): View
    {
        return view('auth.confirm-password');
    }

    /**
     * Confirm the user's password.
     */
    public function store(Request $request): RedirectResponse
    {
        if (! Auth::guard('web')->validate([
            'email' => $request->user()->email,
            'password' => $request->password,
        ])) {
            throw ValidationException::withMessages([
                'password' => __('auth.password'),
            ]);
        }

        $request->session()->put('auth.password_confirmed_at', time());

        return redirect()->intended(route('creator.dashboard', absolute: false));
    }
}
----
--app/Domains/Users/Http/Controllers/Auth/EmailVerificationNotificationController.php
<?php

namespace App\Domains\Users\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;

class EmailVerificationNotificationController extends Controller
{
    /**
     * Send a new email verification notification.
     */
    public function store(Request $request): RedirectResponse
    {
        if ($request->user()->hasVerifiedEmail()) {
            return redirect()->intended(route('creator.dashboard', absolute: false));
        }

        $request->user()->sendEmailVerificationNotification();

        return back()->with('status', 'verification-link-sent');
    }
}
----
--app/Domains/Users/Http/Controllers/Auth/EmailVerificationPromptController.php
<?php

namespace App\Domains\Users\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\View\View;

class EmailVerificationPromptController extends Controller
{
    /**
     * Display the email verification prompt.
     */
    public function __invoke(Request $request): RedirectResponse|View
    {
        return $request->user()->hasVerifiedEmail()
                    ? redirect()->intended(route('creator.dashboard', absolute: false))
                    : view('auth.verify-email');
    }
}
----
--app/Domains/Users/Http/Controllers/Auth/NewPasswordController.php
<?php

namespace App\Domains\Users\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use App\Domains\Users\Models\User;
use Illuminate\Auth\Events\PasswordReset;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Facades\Password;
use Illuminate\Support\Str;
use Illuminate\Validation\Rules;
use Illuminate\View\View;

class NewPasswordController extends Controller
{
    /**
     * Display the password reset view.
     */
    public function create(Request $request): View
    {
        return view('auth.reset-password', ['request' => $request]);
    }

    /**
     * Handle an incoming new password request.
     *
     * @throws \Illuminate\Validation\ValidationException
     */
    public function store(Request $request): RedirectResponse
    {
        $request->validate([
            'token' => ['required'],
            'email' => ['required', 'email'],
            'password' => ['required', 'confirmed', Rules\Password::defaults()],
        ]);

        // Here we will attempt to reset the user's password. If it is successful we
        // will update the password on an actual user model and persist it to the
        // database. Otherwise we will parse the error and return the response.
        $status = Password::reset(
            $request->only('email', 'password', 'password_confirmation', 'token'),
            function (User $user) use ($request) {
                $user->forceFill([
                    'password' => Hash::make($request->password),
                    'remember_token' => Str::random(60),
                ])->save();

                event(new PasswordReset($user));
            }
        );

        // If the password was successfully reset, we will redirect the user back to
        // the application's home authenticated view. If there is an error we can
        // redirect them back to where they came from with their error message.
        return $status == Password::PASSWORD_RESET
                    ? redirect()->route('auth.signin')->with('status', __($status))
                    : back()->withInput($request->only('email'))
                        ->withErrors(['email' => __($status)]);
    }
}
----
--app/Domains/Users/Http/Controllers/Auth/PasswordController.php
<?php

namespace App\Domains\Users\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Hash;
use Illuminate\Validation\Rules\Password;

class PasswordController extends Controller
{
    /**
     * Update the user's password.
     */
    public function update(Request $request): RedirectResponse
    {
        $validated = $request->validateWithBag('updatePassword', [
            'current_password' => ['required', 'current_password'],
            'password' => ['required', Password::defaults(), 'confirmed'],
        ]);

        $request->user()->update([
            'password' => Hash::make($validated['password']),
        ]);

        return back()->with('status', 'password-updated');
    }
}
----
--app/Domains/Users/Http/Controllers/Auth/PasswordResetLinkController.php
<?php

namespace App\Domains\Users\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Password;
use Illuminate\View\View;

class PasswordResetLinkController extends Controller
{
    /**
     * Display the password reset link request view.
     */
    public function create(): View
    {
        return view('auth.forgot-password');
    }

    /**
     * Handle an incoming password reset link request.
     *
     * @throws \Illuminate\Validation\ValidationException
     */
    public function store(Request $request): RedirectResponse
    {
        $request->validate([
            'email' => ['required', 'email'],
        ]);

        // We will send the password reset link to this user. Once we have attempted
        // to send the link, we will examine the response then see the message we
        // need to show to the user. Finally, we'll send out a proper response.
        $status = Password::sendResetLink(
            $request->only('email')
        );

        return $status == Password::RESET_LINK_SENT
                    ? back()->with('status', __($status))
                    : back()->withInput($request->only('email'))
                        ->withErrors(['email' => __($status)]);
    }
}
----
--app/Domains/Users/Http/Controllers/Auth/RegisteredUserController.php
<?php

namespace App\Domains\Users\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use App\Domains\Users\Models\User;
use Illuminate\Auth\Events\Registered;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Hash;
use Illuminate\Validation\Rules;
use Illuminate\View\View;

class RegisteredUserController extends Controller
{
    /**
     * Display the registration view.
     */
    public function create(): View
    {
        return view('auth.join');
    }

    /**
     * Handle an incoming registration request.
     *
     * @throws \Illuminate\Validation\ValidationException
     */
    public function store(Request $request): RedirectResponse
    {
        $request->validate([
            'firstname' => ['required', 'string', 'max:255'],
            'lastname' => ['required', 'string', 'max:255'],
            'email' => ['required', 'string', 'lowercase', 'email', 'max:255', 'unique:'.User::class],
            'password' => ['required', 'confirmed', Rules\Password::defaults()],
        ]);

        $user = User::create([
            'firstname' => $request->firstname,
            'lastname' => $request->lastname,
            'email' => $request->email,
            'password' => Hash::make($request->password),
        ]);

        event(new Registered($user));

        Auth::login($user);

        return redirect(route('creator.dashboard', absolute: false));
    }
}
----
--app/Domains/Users/Http/Controllers/Auth/VerifyEmailController.php
<?php

namespace App\Domains\Users\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Auth\Events\Verified;
use Illuminate\Foundation\Auth\EmailVerificationRequest;
use Illuminate\Http\RedirectResponse;

class VerifyEmailController extends Controller
{
    /**
     * Mark the authenticated user's email address as verified.
     */
    public function __invoke(EmailVerificationRequest $request): RedirectResponse
    {
        if ($request->user()->hasVerifiedEmail()) {
            return redirect()->intended(route('creator.dashboard', absolute: false).'?verified=1');
        }

        if ($request->user()->markEmailAsVerified()) {
            event(new Verified($request->user()));
        }

        return redirect()->intended(route('creator.dashboard', absolute: false).'?verified=1');
    }
}
----
--app/Domains/Users/Http/Requests/ProfileUpdateRequest.php
<?php

namespace App\Domains\Users\Http\Requests;

use App\Domains\Users\Models\User;
use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Validation\Rule;

class ProfileUpdateRequest extends FormRequest
{
    /**
     * Determine if the user is authorized to make this request.
     */
   public function authorize(): bool
    {
        // The authorization is handled by the fact that we are getting the user from the request in the controller.
        return true;
    }

    /**
     * Get the validation rules that apply to the request.
     *
     * @return array<string, \Illuminate\Contracts\Validation\ValidationRule|array|string>
     */
    public function rules(): array
    {
        return [
            'firstname' => ['sometimes', 'required', 'string', 'max:255'], // Only validate if present
            'lastname' => ['sometimes', 'required', 'string', 'max:255'],  // Ditto
            'email' => [
                'sometimes', // Optional: omit if not changing
                'required',
                'string',
                'lowercase',
                'email',
                'max:255',
                Rule::unique(User::class)->ignore($this->user()?->id),
            ],
        ];
    }

    /**
     * Prepare the data for validation.
     */
    protected function prepareForValidation(): void
    {
        $this->merge([
            'email' => strtolower(trim($this->email ?? '')),
            // Add similar for names if needed: 'first_name' => trim($this->first_name ?? ''),
        ]);
    }

    /**
     * Get custom validation messages.
     */
    public function messages(): array
    {
        return [
            'email.unique' => 'This email is already taken.',
            // Add more as needed
        ];
    }
}
----
--app/Domains/Users/Http/Requests/Auth/LoginRequest.php
<?php

namespace App\Domains\Users\Http\Requests\Auth;

use Illuminate\Auth\Events\Lockout;
use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\RateLimiter;
use Illuminate\Support\Str;
use Illuminate\Validation\ValidationException;

class LoginRequest extends FormRequest
{
    /**
     * Determine if the user is authorized to make this request.
     */
    public function authorize(): bool
    {
        return true;
    }

    /**
     * Get the validation rules that apply to the request.
     *
     * @return array<string, \Illuminate\Contracts\Validation\ValidationRule|array<mixed>|string>
     */
    public function rules(): array
    {
        return [
            'email' => ['required', 'string', 'email'],
            'password' => ['required', 'string'],
        ];
    }

    /**
     * Attempt to authenticate the request's credentials.
     *
     * @throws \Illuminate\Validation\ValidationException
     */
    public function authenticate(): void
    {
        $this->ensureIsNotRateLimited();

        if (! Auth::attempt($this->only('email', 'password'), $this->boolean('remember'))) {
            RateLimiter::hit($this->throttleKey());

            throw ValidationException::withMessages([
                'email' => trans('auth.failed'),
            ]);
        }

        RateLimiter::clear($this->throttleKey());
    }

    /**
     * Ensure the login request is not rate limited.
     *
     * @throws \Illuminate\Validation\ValidationException
     */
    public function ensureIsNotRateLimited(): void
    {
        if (! RateLimiter::tooManyAttempts($this->throttleKey(), 5)) {
            return;
        }

        event(new Lockout($this));

        $seconds = RateLimiter::availableIn($this->throttleKey());

        throw ValidationException::withMessages([
            'email' => trans('auth.throttle', [
                'seconds' => $seconds,
                'minutes' => ceil($seconds / 60),
            ]),
        ]);
    }

    /**
     * Get the rate limiting throttle key for the request.
     */
    public function throttleKey(): string
    {
        return Str::transliterate(Str::lower($this->string('email')).'|'.$this->ip());
    }
}
----
--app/Domains/Users/Models/User.php
<?php

namespace App\Domains\Users\Models;

use Illuminate\Contracts\Auth\MustVerifyEmail;
use App\Domains\Common\Models\Address;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Spatie\Permission\Traits\HasRoles;
use App\Domains\Common\Models\UserAddress;
use Plank\Mediable\Mediable;
use Plank\Mediable\MediableInterface;
use Plank\Mediable\Media;

use App\Domains\Common\Models\Image;

class User extends Authenticatable implements MustVerifyEmail, MediableInterface
{
    /** @use HasFactory<\Database\Factories\UserFactory> */
    use HasFactory, Notifiable, HasRoles, Mediable;

    protected $guard_name = 'web';

    /**
     * The attributes that are mass assignable.
     *
     * @var list<string>
     */
    protected $fillable = [
        'firstname',
        'lastname',
        'username',
        'phone',
        'address_id',
        'email',
        'password',
    ];

    /**
     * The attributes that should be hidden for serialization.
     *
     * @var list<string>
     */
    protected $hidden = [
        'password',
        'remember_token',
    ];

    /**
     * The addresses that belong to the user.
     */
    public function addresses()
    {
        return $this->belongsToMany(Address::class, 'user_addresses')
                    ->withPivot('is_primary')
                    ->withTimestamps();
    }

    /**
     * Get the attributes that should be cast.
     *
     * @return array<string, string>
     */
    protected function casts(): array
    {
        return [
            'email_verified_at' => 'datetime',
            'password' => 'hashed',
        ];
    }

    // Convenience method
    /**
     * Get the user's profile image (latest with tag 'profile_image')
     */

    public function getProfileImageAttribute()
    {
        return $this->media->where('tag', 'profile_image')->first();
    }
    protected static function newFactory()
    {
        return \Database\Factories\UserFactory::new();
    }

    public function isAdmin(): bool
    {
        return $this->hasRole('admin');
    }

    public function verification()
    {
        return $this->hasOne(UserVerification::class);
    }

    public function orders()
    {
        return $this->hasMany(\App\Domains\Orders\Models\Order::class, 'buyer_id');
    }
}
----
--app/Domains/Users/Models/UserVerification.php
<?php

namespace App\Domains\Users\Models;

use Database\Factories\Domains\Users\Models\UserVerificationFactory;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Plank\Mediable\Mediable;

class UserVerification extends Model
{
    use HasFactory, Mediable;

    protected $guarded = [];

    /**
     * Create a new factory instance for the model.
     *
     * @return \Illuminate\Database\Eloquent\Factories\Factory
     */
    protected static function newFactory()
    {
        return UserVerificationFactory::new();
    }

    public function user(): BelongsTo
    {
        return $this->belongsTo(User::class);
    }

    public function reviewer(): BelongsTo
    {
        return $this->belongsTo(User::class, 'reviewed_by');
    }
}
----
--app/Domains/Users/Policies/UserVerificationPolicy.php
<?php

namespace App\Domains\Users\Policies;

use App\Domains\Users\Models\User;
use App\Domains\Users\Models\UserVerification;
use Illuminate\Auth\Access\HandlesAuthorization;

class UserVerificationPolicy
{
    use HandlesAuthorization;

    /**
     * Determine whether the user can view the model.
     *
     * @param  \App\Domains\Users\Models\User  $user
     * @param  \App\Domains\Users\Models\UserVerification  $userVerification
     * @return \Illuminate\Auth\Access\Response|bool
     */
    public function view(User $user, UserVerification $userVerification)
    {
        // Only the user who owns the verification or an admin can view it.
        return $user->id === $userVerification->user_id || $user->hasRole('admin') || $user->hasRole('moderator');
    }

    /**
     * Determine whether the user can view media attached to the model.
     *
     * @param  \App\Domains\Users\Models\User  $user
     * @param  \App\Domains\Users\Models\UserVerification  $userVerification
     * @return \Illuminate\Auth\Access\Response|bool
     */
    public function viewMedia(User $user, UserVerification $userVerification)
    {
        // The logic is the same as viewing the parent model itself.
        return $this->view($user, $userVerification);
    }

    /**
     * Determine whether the user can create models.
     *
     * @param  \App\Domains\Users\Models\User  $user
     * @return \Illuminate\Auth\Access\Response|bool
     */
    public function create(User $user)
    {
        // Any authenticated user can create a verification request.
        return true;
    }

    /**
     * Determine whether an admin can approve or reject models.
     *
     * @param  \App\Domains\Users\Models\User  $user
     * @return \Illuminate\Auth\Access\Response|bool
     */
    public function manage(User $user)
    {
        return $user->hasRole('admin');
    }
}
----
--app/Domains/Users/Services/UserService.php
<?php

namespace App\Domains\Users\Services;

use App\Domains\Users\Models\User;
use App\Exceptions\ResourceNotFoundException;
use App\Exceptions\AuthorizationException;
use Illuminate\Database\Eloquent\Collection;

class UserService
{
    public function getAllUsers(): Collection
    {
        $users = User::all();

        if($users->isEmpty()) {
            throw new ResourceNotFoundException('No users found.');
        }

        if($users->every->trashed()) {
            throw new ResourceNotFoundException('Users have all been deleted.');
        }

        return $users;
    }

    public function getUser(int $id): User
    {
        $user = User::find($id);

        if(is_null($user)) {
            throw new ResourceNotFoundException('User not found.');
        }

        if($user->trashed()) {
            throw new ResourceNotFoundException('User does not exist.');
        }

        return $user;
    }
}
----
--app/Domains/Work/Http/Controllers/ActivityController.php
<?php

namespace App\Domains\Work\Http\Controllers;

use App\Domains\Work\Models\ActivityMessage;
use App\Domains\Work\Models\ActivityAttachment;
use App\Domains\Work\Models\ActivityThread;
use App\Notifications\ActivityMessageCreated;
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Storage;
use Illuminate\Support\Facades\Notification;
use Illuminate\Support\Facades\Auth;

class ActivityController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index()
    {
        //
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        //
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        $request->validate([
            'content' => 'required|string',
            'attachments.*' => 'file|max:10240', // Max 10MB per file
        ]);

        $activityMessage = ActivityMessage::create([
            'activity_thread_id' => $request->activity_thread_id, // Assuming this is passed
            'user_id' => Auth::id(),
            'content' => $request->content,
        ]);

        if ($request->hasFile('attachments')) {
            foreach ($request->file('attachments') as $file) {
                $path = $file->store('activity_attachments', 'public'); // Placeholder for storage logic
                ActivityAttachment::create([
                    'activity_message_id' => $activityMessage->id,
                    'file_path' => $path,
                    'file_type' => $file->getClientMimeType(),
                ]);
            }
        }

        // Send notification
        $activityThread = ActivityThread::find($request->activity_thread_id);
        if ($activityThread) {
            $workInstance = $activityThread->workInstanceStep->workInstance;
            $order = $workInstance->order;

            $recipients = collect([$order->buyer, $order->seller])->unique('id');
            Notification::send($recipients, new ActivityMessageCreated($activityMessage));
        }

        return back()->with('success', 'Activity message created successfully.');
    }

    /**
     * Display the specified resource.
     */
    public function show(string $id)
    {
        //
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit(string $id)
    {
        //
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, string $id)
    {
        $request->validate([
            'content' => 'required|string',
            'attachments.*' => 'file|max:10240', // Max 10MB per file
        ]);

        $activityMessage = ActivityMessage::findOrFail($id);
        $activityMessage->update([
            'content' => $request->content,
        ]);

        if ($request->hasFile('attachments')) {
            foreach ($request->file('attachments') as $file) {
                $path = $file->store('activity_attachments', 'public'); // Placeholder for storage logic
                ActivityAttachment::create([
                    'activity_message_id' => $activityMessage->id,
                    'file_path' => $path,
                    'file_type' => $file->getClientMimeType(),
                ]);
            }
        }

        return back()->with('success', 'Activity message updated successfully.');
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy(string $id)
    {
        $activityMessage = ActivityMessage::findOrFail($id);

        // Authorization: Only message creator can delete
        if ($activityMessage->user_id !== Auth::id()) {
            abort(403, 'Unauthorized to delete this message.');
        }

        // Delete attachments
        if ($activityMessage->attachments()->exists()) {
            foreach ($activityMessage->attachments as $attachment) {
                Storage::disk('public')->delete($attachment->file_path);
                $attachment->delete();
            }
        }

        $activityMessage->delete();

        return back()->with('success', 'Message deleted successfully.');
    }
}
----
--app/Domains/Work/Http/Controllers/WorkInstanceController.php
<?php

namespace App\Domains\Work\Http\Controllers;

use App\Http\Controllers\Controller;
use App\Notifications\WorkStepCompleted;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Notification;

use App\Domains\Work\Models\WorkInstance;
use App\Domains\Work\Models\WorkInstanceStep;

class WorkInstanceController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index()
    {
        $workInstances = WorkInstance::whereHas('order', function ($query) {
            $query->where('seller_id', Auth::id());
        })->with('order')->get();

        return view('creator.work-dashboard', compact('workInstances'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        //
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        //
    }

    /**
     * Display the specified resource.
     */
    public function show(WorkInstance $workInstance)
    {
        $this->authorize('view', $workInstance);
        $workInstance->load('workInstanceSteps.activityThread.messages');
        return view('work.show', compact('workInstance'));
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit(string $id)
    {
        //
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, string $id)
    {
        //
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy(string $id)
    {
        //
    }

    public function startStep(WorkInstance $workInstance, WorkInstanceStep $workInstanceStep)
    {
        // Authorize using policy
        $this->authorize('completeStep', $workInstance);

        $workInstanceStep->status = 'in_progress';
        $workInstanceStep->started_at = now();
        $workInstanceStep->save();

        // Mark work instance as started if not already
        if (!$workInstance->hasStarted()) {
            $workInstance->started_at = now();
            $workInstance->status = 'in_progress';
            $workInstance->save();
        }

        return back()->with('success', 'Step started.');
    }

    public function completeStep(WorkInstance $workInstance, WorkInstanceStep $workInstanceStep)
    {
        // Authorize using policy
        $this->authorize('completeStep', $workInstance);

        $workInstanceStep->status = 'completed';
        $workInstanceStep->completed_at = now();
        $workInstanceStep->save();

        // Update parent work instance
        $workInstance->current_step_index = $workInstance->current_step_index + 1;
        
        $allStepsCompleted = $workInstance->workInstanceSteps()->where('status', '!=', 'completed')->doesntExist();

        if ($allStepsCompleted) {
            $workInstance->status = 'completed';
            $workInstance->completed_at = now();
        }

        $workInstance->save();

        // Send notifications to both buyer and seller
        $notifyUsers = collect([$workInstance->order->buyer, $workInstance->order->seller])->unique('id');
        Notification::send($notifyUsers, new WorkStepCompleted($workInstanceStep));

        return back()->with('success', 'Step completed. Notifications sent to buyer and seller.');
    }
}
----
--app/Domains/Work/Models/ActivityAttachment.php
<?php

namespace App\Domains\Work\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Facades\Storage;

class ActivityAttachment extends Model
{
    protected $fillable = [
        'activity_message_id',
        'file_path',
        'file_type',
    ];

    protected $casts = [
        'created_at' => 'datetime',
        'updated_at' => 'datetime',
    ];

    public function activityMessage()
    {
        return $this->belongsTo(ActivityMessage::class);
    }

    /**
     * Get file URL
     */
    public function getUrl()
    {
        return asset('storage/' . $this->file_path);
    }

    /**
     * Get file size in bytes
     */
    public function getSize()
    {
        if (Storage::disk('public')->exists($this->file_path)) {
            return Storage::disk('public')->size($this->file_path);
        }
        return 0;
    }

    /**
     * Get formatted file size
     */
    public function getFormattedSize()
    {
        $size = $this->getSize();
        $units = ['B', 'KB', 'MB', 'GB'];
        $size = max($size, 0);
        $pow = floor(($size ? log($size) : 0) / log(1024));
        $pow = min($pow, count($units) - 1);
        $size /= (1 << (10 * $pow));
        return round($size, 2) . ' ' . $units[$pow];
    }

    /**
     * Get file name from path
     */
    public function getFileName()
    {
        return basename($this->file_path);
    }

    /**
     * Check if file is image
     */
    public function isImage(): bool
    {
        $imageTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'image/svg+xml'];
        return in_array($this->file_type, $imageTypes);
    }

    /**
     * Check if file is video
     */
    public function isVideo(): bool
    {
        $videoTypes = ['video/mp4', 'video/webm', 'video/ogg', 'video/quicktime'];
        return in_array($this->file_type, $videoTypes);
    }

    /**
     * Delete file from storage
     */
    public function deleteFile()
    {
        if (Storage::disk('public')->exists($this->file_path)) {
            Storage::disk('public')->delete($this->file_path);
        }
    }
}
----
--app/Domains/Work/Models/ActivityMessage.php
<?php

namespace App\Domains\Work\Models;

use App\Domains\Users\Models\User;
use Illuminate\Database\Eloquent\Model;

class ActivityMessage extends Model
{
    protected $fillable = [
        'activity_thread_id',
        'user_id',
        'content',
        'read_at',
    ];

    protected $casts = [
        'read_at' => 'datetime',
        'created_at' => 'datetime',
        'updated_at' => 'datetime',
    ];

    public function activityThread()
    {
        return $this->belongsTo(ActivityThread::class);
    }

    public function user()
    {
        return $this->belongsTo(User::class);
    }

    public function attachments()
    {
        return $this->hasMany(ActivityAttachment::class)->orderBy('created_at', 'asc');
    }

    /**
     * Mark message as read
     */
    public function markAsRead()
    {
        if ($this->read_at === null) {
            $this->update(['read_at' => now()]);
        }
    }

    /**
     * Check if message has attachments
     */
    public function hasAttachments(): bool
    {
        return $this->attachments()->exists();
    }

    /**
     * Get attachment count
     */
    public function getAttachmentCount()
    {
        return $this->attachments()->count();
    }
}
----
--app/Domains/Work/Models/ActivityThread.php
<?php

namespace App\Domains\Work\Models;

use Illuminate\Database\Eloquent\Model;

class ActivityThread extends Model
{
    protected $fillable = [
        'work_instance_step_id',
        'title',
        'description',
    ];

    public function workInstanceStep()
    {
        return $this->belongsTo(WorkInstanceStep::class);
    }

    public function messages()
    {
        return $this->hasMany(ActivityMessage::class)->orderBy('created_at', 'asc');
    }

    /**
     * Get unread messages count for a specific user
     */
    public function getUnreadCount($userId)
    {
        return $this->messages()
            ->where('user_id', '!=', $userId)
            ->whereNull('read_at')
            ->count();
    }

    /**
     * Get latest message
     */
    public function getLatestMessage()
    {
        return $this->messages()->latest('created_at')->first();
    }

    /**
     * Get file attachments from all messages
     */
    public function getAttachments()
    {
        return ActivityAttachment::whereIn(
            'activity_message_id',
            $this->messages()->pluck('id')
        )->get();
    }

    /**
     * Get message count
     */
    public function getMessageCount()
    {
        return $this->messages()->count();
    }
}
----
--app/Domains/Work/Models/WorkInstance.php
<?php

namespace App\Domains\Work\Models;

use App\Domains\Orders\Models\Order;
use App\Domains\Listings\Models\WorkflowTemplate;
use Illuminate\Database\Eloquent\Model;

class WorkInstance extends Model
{
    protected $fillable = [
        'order_id',
        'workflow_template_id',
        'current_step_index',
        'status',
        'started_at',
        'completed_at',
    ];

    protected $casts = [
        'started_at' => 'datetime',
        'completed_at' => 'datetime',
        'current_step_index' => 'integer',
    ];

    public function order()
    {
        return $this->belongsTo(Order::class);
    }

    public function workflowTemplate()
    {
        return $this->belongsTo(WorkflowTemplate::class);
    }

    public function workInstanceSteps()
    {
        return $this->hasMany(WorkInstanceStep::class)->orderBy('step_index', 'asc');
    }

    /**
     * Get the current step being executed
     */
    public function getCurrentStep()
    {
        return $this->workInstanceSteps()->where('step_index', $this->current_step_index)->first();
    }

    /**
     * Get the next step to be executed
     */
    public function getNextStep()
    {
        return $this->workInstanceSteps()->where('step_index', '>', $this->current_step_index)->first();
    }

    /**
     * Get all completed steps
     */
    public function getCompletedSteps()
    {
        return $this->workInstanceSteps()->where('status', 'completed')->get();
    }

    /**
     * Get the progress percentage
     */
    public function getProgressPercentage()
    {
        $total = $this->workInstanceSteps()->count();
        if ($total === 0) {
            return 0;
        }
        $completed = $this->workInstanceSteps()->where('status', 'completed')->count();
        return round(($completed / $total) * 100);
    }

    /**
     * Check if work instance is completed
     */
    public function isCompleted(): bool
    {
        return $this->status === 'completed' || $this->workInstanceSteps()->where('status', '!=', 'completed')->doesntExist();
    }

    /**
     * Check if work instance has started
     */
    public function hasStarted(): bool
    {
        return $this->started_at !== null;
    }

    /**
     * Get activity threads for all steps
     */
    public function getActivityThreads()
    {
        return ActivityThread::whereIn('work_instance_step_id', $this->workInstanceSteps()->pluck('id'))->get();
    }
}
----
--app/Domains/Work/Models/WorkInstanceStep.php
<?php

namespace App\Domains\Work\Models;

use App\Domains\Listings\Models\WorkTemplate;
use Illuminate\Database\Eloquent\Model;

class WorkInstanceStep extends Model
{
    protected $fillable = [
        'work_instance_id',
        'work_template_id',
        'step_index',
        'status',
        'started_at',
        'completed_at',
    ];

    protected $casts = [
        'started_at' => 'datetime',
        'completed_at' => 'datetime',
        'step_index' => 'integer',
    ];

    public function workInstance()
    {
        return $this->belongsTo(WorkInstance::class);
    }

    public function workTemplate()
    {
        return $this->belongsTo(WorkTemplate::class);
    }

    public function activityThread()
    {
        return $this->hasOne(ActivityThread::class);
    }

    /**
     * Check if this step is the current step
     */
    public function isCurrent(): bool
    {
        return $this->workInstance->current_step_index === $this->step_index;
    }

    /**
     * Check if this step is completed
     */
    public function isCompleted(): bool
    {
        return $this->status === 'completed';
    }

    /**
     * Check if this step is in progress
     */
    public function isInProgress(): bool
    {
        return $this->status === 'in_progress';
    }

    /**
     * Get duration in minutes
     */
    public function getDurationMinutes()
    {
        return $this->workTemplate?->duration_minutes ?? 0;
    }
}
----
--app/Domains/Work/Policies/WorkInstancePolicy.php
<?php

namespace App\Domains\Work\Policies;

use App\Domains\Users\Models\User;
use App\Domains\Work\Models\WorkInstance;
use Illuminate\Auth\Access\Response;

class WorkInstancePolicy
{
    /**
     * Determine whether the user can view any models.
     */
    public function viewAny(User $user): bool
    {
        return true;
    }

    /**
     * Determine whether the user can view the model.
     * Both buyer and seller can view the work instance
     */
    public function view(User $user, WorkInstance $workInstance): bool
    {
        return $user->id === $workInstance->order->buyer_id || 
               $user->id === $workInstance->order->seller_id;
    }

    /**
     * Determine whether the user can create models.
     */
    public function create(User $user): bool
    {
        return false; // Created automatically with orders
    }

    /**
     * Determine whether the user can update the model.
     * Only seller can update via step transitions
     */
    public function update(User $user, WorkInstance $workInstance): bool
    {
        return $user->id === $workInstance->order->seller_id;
    }

    /**
     * Determine whether the user can delete the model.
     */
    public function delete(User $user, WorkInstance $workInstance): bool
    {
        return false; // Work instances should not be deleted
    }

    /**
     * Determine whether the user can restore the model.
     */
    public function restore(User $user, WorkInstance $workInstance): bool
    {
        return false;
    }

    /**
     * Determine whether the user can permanently delete the model.
     */
    public function forceDelete(User $user, WorkInstance $workInstance): bool
    {
        return false;
    }

    /**
     * Determine whether the user can start a step
     */
    public function startStep(User $user, WorkInstance $workInstance): bool
    {
        return $user->id === $workInstance->order->seller_id && $workInstance->hasStarted() === false;
    }

    /**
     * Determine whether the user can complete a step
     */
    public function completeStep(User $user, WorkInstance $workInstance): bool
    {
        return $user->id === $workInstance->order->seller_id && $workInstance->status !== 'completed';
    }

    /**
     * Determine whether the user can add activity messages
     */
    public function addActivity(User $user, WorkInstance $workInstance): bool
    {
        return $user->id === $workInstance->order->buyer_id || 
               $user->id === $workInstance->order->seller_id;
    }
}
----
--app/DTO/Dto.php
<?php

namespace App\DTO;
interface Dto
{
    public function toArray();
    public function toJSON();

}
----
--app/DTO/ServiceResponseDto.php
<?php

namespace App\DTO;

use App\DTO\Dto;

class ServiceResponseDto implements Dto
{
    public function __construct(
        protected bool $success = true,
        protected $errors = [],
        protected $warnings = [],
        protected $data = [],
    )
    {}


    public function isSuccess(): bool
    {
        return $this->success;
    }

    public function addErrors(array $errors): void
    {
        $this->errors = array_merge($this->errors, $errors);
    }

    public function getErrors(): array
    {
        return $this->errors;
    }

    public function addWarnings(array $warnings): void
    {
        $this->warnings = array_merge($this->warnings, $warnings);
    }

    public function getWarnings(): array
    {
        return $this->warnings;
    }

    public function toArray(): array
    {
        return [
            'success' => $this->success,
            'errors' => $this->errors,
            'warnings' => $this->warnings,
            'data' => $this->data
        ];
    }


    public function toJSON(): string
    {
        return json_encode($this->toArray());
    }

    // Static factory method
    public static function success($data = []): ServiceResponseDto
    {
        return new static(true, [], [], $data);
    }

    public static function error($errors): ServiceResponseDto
    {
        if (!is_array($errors)) {
            $errors = [$errors];
        }

        return new static(false, $errors);

    }

    public static function warning($warnings): ServiceResponseDto
    {
        if (!is_array($warnings)) {
            $warnings = [$warnings];
        }
        return new static(true, [], $warnings);
    }
    
}
----
--app/Enums/OrderStatus.php
<?php

namespace App\Enums;

enum OrderStatus: string
{
    case PENDING = 'pending';
    case IN_PROGRESS = 'in_progress';
    case COMPLETED = 'completed';
    case CANCELLED = 'cancelled';
    case DISPUTED = 'disputed';
}
----
--app/Exceptions/AuthorizationException.php
<?php

namespace App\Exceptions;

class AuthorizationException extends DomainException
{
    public function __construct(string $message = "You are not authorized to perform this action.")
    {
        parent::__construct($message, 403); // 403 Forbidden
    }
}
----
--app/Exceptions/BusinessRuleException.php
<?php

namespace App\Exceptions;

class BusinessRuleException extends DomainException
{
    public function __construct(string $message = "Business rule violated")
    {
        parent::__construct($message, 422);
    }
}
----
--app/Exceptions/ConflictException.php
<?php

namespace App\Exceptions;

class ConflictException extends DomainException
{
    public function __construct(string $message = "Conflict with existing resource.")
    {
        parent::__construct($message, 409); // 409 Conflict
    }
}
----
--app/Exceptions/DomainException.php
<?php

namespace App\Exceptions;

use Exception;

abstract class DomainException extends Exception
{
    protected int $status;

    public function __construct(string $message = "", int $status = 400)
    {
        parent::__construct($message);
        $this->status = $status;
    }


    public function getStatus(): int
    {
        return $this->status;
    }
}
----
--app/Exceptions/ExternalServiceException.php
<?php

namespace App\Exceptions;

class ExternalServiceException extends DomainException
{
    public function __construct(string $message = "External service error.")
    {
        parent::__construct($message, 502); // 502 Bad Gateway
    }
}
----
--app/Exceptions/Handler.php
<?php

namespace App\Exceptions;

use Illuminate\Foundation\Exceptions\Handler as ExceptionHandler;
use Throwable;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;
use App\Traits\ApiResponses;
use Illuminate\Auth\AuthenticationException;

class Handler extends ExceptionHandler
{
    use ApiResponses;

    /**
     * A list of the exception types that are not reported.
     *
     * @var array<int, class-string<Throwable>>
     */
    protected $dontReport = [
        //
    ];

    /**
     * A list of the inputs that are never flashed for validation exceptions.
     *
     * @var array<int, string>
     */
    protected $dontFlash = [
        'current_password',
        'password',
        'password_confirmation',
    ];

    /**
     * Register the exception handling callbacks for the application.
     *
     * @return void
     */
    public function register()
    {
        $this->reportable(function (Throwable $e) {
            //
        });
    }

    /**
     * Render an exception into an HTTP response.
     *
     * @param  \Illuminate\Http\Request  $request
     * @param  \Throwable  $exception
     * @return \Symfony\Component\HttpFoundation\Response
     *
     * @throws \Throwable
     */
    public function render($request, Throwable $exception)
    {
        if ($request->wantsJson() || $request->is('api/*')) {
            return $this->handleApiException($request, $exception);
        }

        return parent::render($request, $exception);
    }

    protected function unauthenticated($request, AuthenticationException $exception)
    {
        return response()->json(['message' => 'Unauthenticated.'], 401);
    }

    private function handleApiException($request, Throwable $exception)
    { 
        $exception = $this->prepareException($exception);

        if ($exception instanceof \Illuminate\Validation\ValidationException) {
            return $this->validationErrorResponse($exception->errors());
        }

        if ($exception instanceof \Illuminate\Auth\AuthenticationException) {
            return $this->unauthorizedResponse($exception->getMessage());
        }

        if ($exception instanceof \Illuminate\Auth\Access\AuthorizationException) {
            return $this->forbiddenResponse($exception->getMessage());
        }

        if ($exception instanceof \Symfony\Component\HttpKernel\Exception\NotFoundHttpException) {
            return $this->notFoundResponse('The requested resource was not found.');
        }

        if ($exception instanceof \Symfony\Component\HttpKernel\Exception\MethodNotAllowedHttpException) {
            return $this->errorResponse($exception->getMessage(), Response::HTTP_METHOD_NOT_ALLOWED);
        }

        if ($exception instanceof \App\Exceptions\DomainException) {
            return $this->errorResponse($exception->getMessage(), $exception->getCode() ?: Response::HTTP_BAD_REQUEST);
        }

        $statusCode = $this->isHttpException($exception) ? $exception->getStatusCode() : 500;
        $message = config('app.debug') ? $exception->getMessage() : 'Server Error';

        return $this->errorResponse($message, $statusCode);
    }
}
----
--app/Exceptions/ResourceNotFoundException.php
<?php

namespace App\Exceptions;

class ResourceNotFoundException extends DomainException
{
    public function __construct(string $message = "The requested resource was not found.")
    {
        parent::__construct($message, 404); // 404 Not Found
    }
}
----
--app/Exceptions/ValidationException.php
<?php

namespace App\Exceptions;

class ValidationException extends DomainException
{
    protected array $errors;

    public function __construct(array $errors, string $message = "Validation failed")
    {
        parent::__construct($message, 422);
        $this->errors = $errors;
    }

    /**
     * Returns the validation errors.
     *
     * @return array
     */
    public function getErrors(): array
    {
        return $this->errors;
    }
}
----
--app/Http/Kernel.php
<?php

namespace App\Http;

use Illuminate\Foundation\Http\Kernel as HttpKernel;

class Kernel extends HttpKernel
{
    /**
     * The application's global HTTP middleware stack.
     *
     * These middleware are run during every request to your application.
     *
     * @var array<int, class-string|string>
     */
    protected $middleware = [
        // \App\Http\Middleware\TrustHosts::class,
        \App\Http\Middleware\TrustProxies::class,
        \Illuminate\Http\Middleware\HandleCors::class,
        \App\Http\Middleware\PreventRequestsDuringMaintenance::class,
        \Illuminate\Foundation\Http\Middleware\ValidatePostSize::class,
        \App\Http\Middleware\TrimStrings::class,
        \Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull::class,
    ];

    /**
     * The application's route middleware groups.
     *
     * @var array<string, array<int, class-string|string>>
     */
    protected $middlewareGroups = [
        'web' => [
            \App\Http\Middleware\EncryptCookies::class,
            \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,
            \Illuminate\Session\Middleware\StartSession::class,
            \Illuminate\View\Middleware\ShareErrorsFromSession::class,
            \App\Http\Middleware\VerifyCsrfToken::class,
            \Illuminate\Routing\Middleware\SubstituteBindings::class,
        ],

        'api' => [
            \App\Http\Middleware\ForceJsonResponse::class,
            \App\Http\Middleware\EncryptCookies::class,
            \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,
            \Illuminate\Session\Middleware\StartSession::class,
            \App\Http\Middleware\VerifyCsrfToken::class,
            // \Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful::class,
            'throttle:api',
            \Illuminate\Routing\Middleware\SubstituteBindings::class,
        ],
    ];

    /**
     * The application's route middleware.
     *
     * These middleware may be assigned to groups or used individually.
     *
     * @var array<string, class-string|string>
     */
    protected $routeMiddleware = [
        'auth' => \App\Http\Middleware\Authenticate::class,
        'auth.basic' => \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class,
        'cache.headers' => \Illuminate\Http\Middleware\SetCacheHeaders::class,
        'can' => \Illuminate\Auth\Middleware\Authorize::class,
        'guest' => \App\Http\Middleware\RedirectIfAuthenticated::class,
        'signed' => \Illuminate\Routing\Middleware\ValidateSignature::class,
        'throttle' => \Illuminate\Routing\Middleware\ThrottleRequests::class,
        'verified' => \Illuminate\Auth\Middleware\EnsureEmailIsVerified::class,
        'admin' => \App\Http\Middleware\EnsureUserIsAdmin::class,
    ];
}
----
--app/Http/Controllers/Controller.php
<?php

namespace App\Http\Controllers;

use Illuminate\Foundation\Auth\Access\AuthorizesRequests;
use Illuminate\Routing\Controller as BaseController;

abstract class Controller extends BaseController
{
    use AuthorizesRequests;
}
----
--app/Http/Controllers/MediaServeController.php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Crypt;
use Plank\Mediable\Media;
use Symfony\Component\HttpFoundation\StreamedResponse;

class MediaServeController extends Controller
{
    /**
     * Handle the incoming request.
     */
    public function __invoke(Request $request, string $encryptedPath): StreamedResponse
    {
        try {
            $path = Crypt::decryptString($encryptedPath);
        } catch (\Illuminate\Contracts\Encryption\DecryptException $e) {
            abort(404);
        }

        $media = Media::where('disk', 'local')->where('directory', dirname($path))->where('filename', basename($path))->firstOrFail();

        // Ensure the user is authorized to view this media
        // For now, we'll assume if it's a verification document, only the owner or admin can view it.
        // This needs to be expanded with proper authorization logic (e.g., policies).
        if ($media->getDisk() === 'local' && $media->getDiskPath() === $path) {
            // Example: Check if the authenticated user is the owner of the media's associated model
            // Or if the user has an 'admin' role.
            // For now, we'll just serve it if it's a local file and the path matches.
            // TODO: Implement proper authorization here.
        } else {
            abort(403, 'Unauthorized to access this media.');
        }

        return response()->streamDownload(
            function () use ($media) {
                $stream = $media->stream();
                while ($bytes = $stream->read(1024)) {
                    echo $bytes;
                }
            },
            $media->basename,
            [
                'Content-Type' => $media->mime_type,
                'Content-Length' => $media->size,
                'Content-Disposition' => 'inline; filename="' . $media->basename . '"', // Display in browser
            ]
        );
    }
}
----
--app/Http/Controllers/Api/.gitkeep
--app/Http/Controllers/Api/ApiController.php
<?php

namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Traits\ApiResponses;
use Illuminate\Http\Request;

class ApiController extends Controller
{
    use ApiResponses;
}
----
--app/Http/Controllers/Domains/Orders/Http/Controllers/OrderController.php
<?php

namespace App\Http\Controllers\Domains\Orders\Http\Controllers;

use App\Domains\Orders\Models\Order;
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class OrderController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index()
    {
        //
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        //
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        //
    }

    /**
     * Display the specified resource.
     */
    public function show(Order $order)
    {
        //
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit(Order $order)
    {
        //
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, Order $order)
    {
        //
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy(Order $order)
    {
        //
    }
}
----
--app/Http/Middleware/EnsureUserIsAdmin.php
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class EnsureUserIsAdmin
{
    /**
     * Handle an incoming request.
     *
     * @param  \Illuminate\Http\Request  $request
     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
     * @return \Symfony\Component\HttpFoundation\Response
     */
    public function handle(Request $request, Closure $next): Response
    {
        if (!auth()->check() || !auth()->user()->hasRole('admin')) {
            abort(403, 'Unauthorized action.');
        }

        return $next($request);
    }
}
----
--app/Http/Middleware/ForceJsonResponse.php
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class ForceJsonResponse
{
    /**
     * Handle an incoming request.
     *
     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
     */
    public function handle(Request $request, Closure $next): Response
    {
        $request->headers->set('Accept', 'application/json');
        return $next($request);
    }
}
----
--app/Http/Middleware/VerifyCsrfToken.php
<?php

namespace App\Http\Middleware;

use Illuminate\Foundation\Http\Middleware\VerifyCsrfToken as Middleware;

class VerifyCsrfToken extends Middleware
{
    /**
     * The URIs that should be excluded from CSRF verification.
     *
     * @var array<int, string>
     */
    protected $except = [
        'payments/webhook',
    ];
}
----
--app/Http/Resources/OrderResource.php
<?php

namespace App\Http\Resources;

use Illuminate\Http\Request;
use Illuminate\Http\Resources\Json\JsonResource;

class OrderResource extends JsonResource
{
    /**
     * Transform the resource into an array.
     *
     * @return array<string, mixed>
     */
    public function toArray(Request $request): array
    {
        return [
            'id' => $this->id,
            'buyer' => [
                'id' => $this->buyer->id,
                'name' => $this->buyer->name,
                'email' => $this->buyer->email,
            ],
            'seller' => [
                'id' => $this->seller->id,
                'name' => $this->seller->name,
                'email' => $this->seller->email,
            ],
            'service' => [
                'id' => $this->service->id,
                'name' => $this->service->name,
                'description' => $this->service->description,
                'price' => $this->service->price,
            ],
            'price' => (float) $this->price,
            'platform_fee' => (float) $this->platform_fee,
            'total_amount' => (float) $this->total_amount,
            'status' => $this->status,
            'payment_status' => $this->payment_status,
            'cancelled_at' => $this->cancelled_at,
            'cancellation_reason' => $this->cancellation_reason,
            'open_offer_id' => $this->open_offer_id,
            'open_offer_bid_id' => $this->open_offer_bid_id,
            'created_at' => $this->created_at,
            'updated_at' => $this->updated_at,
        ];
    }
}
----
--app/Http/Resources/WorkInstanceResource.php
<?php

namespace App\Http\Resources;

use Illuminate\Http\Request;
use Illuminate\Http\Resources\Json\JsonResource;

class WorkInstanceResource extends JsonResource
{
    /**
     * Transform the resource into an array.
     *
     * @return array<string, mixed>
     */
    public function toArray(Request $request): array
    {
        return [
            'id' => $this->id,
            'order_id' => $this->order_id,
            'workflow_template_id' => $this->workflow_template_id,
            'status' => $this->status,
            'current_step_index' => $this->current_step_index,
            'progress_percentage' => $this->getProgressPercentage(),
            'is_completed' => $this->isCompleted(),
            'has_started' => $this->hasStarted(),
            'started_at' => $this->started_at?->toIso8601String(),
            'completed_at' => $this->completed_at?->toIso8601String(),
            
            // Relationships
            'order' => new OrderResource($this->whenLoaded('order')),
            'workflow_template' => $this->whenLoaded('workflowTemplate', function () {
                return [
                    'id' => $this->workflowTemplate->id,
                    'name' => $this->workflowTemplate->name,
                    'description' => $this->workflowTemplate->description,
                ];
            }),
            
            // Steps information
            'steps' => $this->whenLoaded('workInstanceSteps', function () {
                return $this->workInstanceSteps->map(function ($step) {
                    return [
                        'id' => $step->id,
                        'step_index' => $step->step_index,
                        'name' => $step->workTemplate?->name ?? 'Step ' . ($step->step_index + 1),
                        'description' => $step->workTemplate?->description,
                        'status' => $step->status,
                        'is_current' => $step->isCurrent(),
                        'is_completed' => $step->isCompleted(),
                        'is_in_progress' => $step->isInProgress(),
                        'duration_minutes' => $step->getDurationMinutes(),
                        'started_at' => $step->started_at?->toIso8601String(),
                        'completed_at' => $step->completed_at?->toIso8601String(),
                        'activity_thread' => $step->activityThread ? [
                            'id' => $step->activityThread->id,
                            'title' => $step->activityThread->title,
                            'description' => $step->activityThread->description,
                            'message_count' => $step->activityThread->getMessageCount(),
                            'latest_message' => $step->activityThread->getLatestMessage() ? [
                                'id' => $step->activityThread->getLatestMessage()->id,
                                'content' => $step->activityThread->getLatestMessage()->content,
                                'user_name' => $step->activityThread->getLatestMessage()->user->name,
                                'created_at' => $step->activityThread->getLatestMessage()->created_at?->toIso8601String(),
                            ] : null,
                        ] : null,
                    ];
                });
            }),

            'created_at' => $this->created_at?->toIso8601String(),
            'updated_at' => $this->updated_at?->toIso8601String(),
        ];
    }
}
----
--app/Livewire/ActivityThread.php
<?php

namespace App\Livewire;

use App\Domains\Work\Models\ActivityThread as ActivityThreadModel;
use App\Domains\Work\Models\ActivityMessage;
use App\Domains\Work\Models\ActivityAttachment;
use Livewire\Component;
use Livewire\WithFileUploads;
use Illuminate\Support\Facades\Auth;

class ActivityThread extends Component
{
    use WithFileUploads;

    public ?ActivityThreadModel $activityThread = null;
    public $newMessage = '';
    public $attachments = [];

    public function getMessagesProperty()
    {
        if (!$this->activityThread) {
            return collect();
        }
        return $this->activityThread->messages()->with('user', 'attachments')->latest()->get();
    }

    public function sendMessage()
    {
        if (!$this->activityThread) {
            return;
        }

        $this->validate([
            'newMessage' => 'required|string|max:255',
            'attachments.*' => 'file|max:10240', // Max 10MB per file
        ]);

        $activityMessage = $this->activityThread->messages()->create([
            'user_id' => Auth::id(),
            'content' => $this->newMessage,
        ]);

        foreach ($this->attachments as $file) {
            $path = $file->store('activity_attachments', 'public');
            ActivityAttachment::create([
                'activity_message_id' => $activityMessage->id,
                'file_path' => $path,
                'file_type' => $file->getMimeType(),
            ]);
        }

        $this->newMessage = '';
        $this->attachments = [];
    }

    public function render()
    {
        return view('livewire.activity-thread');
    }
}
----
--app/Livewire/AddressManager.php
<?php

namespace App\Livewire;

use App\Domains\Common\Services\AddressService;
use App\Domains\Common\Models\Address;
use Illuminate\Support\Collection;
use Livewire\Component;
use Illuminate\Validation\Rule;

class AddressManager extends Component
{
    public Collection $addresses;
    public bool $isOpen = false;
    public bool $isDeleteModalOpen = false;

    // Form fields
    public ?int $addressId = null;
    public string $house_no = '';
    public string $street = '';
    public string $barangay = '';
    public string $town = '';
    public string $province = '';
    public string $country = '';
    public bool $is_primary = false;

    protected AddressService $addressService;

    public function boot(AddressService $addressService)
    {
        $this->addressService = $addressService;
    }

    public function mount()
    {
        $this->loadAddresses();
    }

    public function loadAddresses()
    {
        $this->addresses = $this->addressService->getAddressesForUser();
    }

    protected function rules(): array
    {
        return [
            'house_no' => 'nullable|string|max:255',
            'street' => 'nullable|string|max:255',
            'barangay' => 'nullable|string|max:255',
            'town' => 'required|string|max:255',
            'province' => 'required|string|max:255',
            'country' => 'required|string|max:255',
            'is_primary' => 'boolean',
        ];
    }

    public function render()
    {
        return view('livewire.address-manager');
    }

    public function addAddress()
    {
        $this->resetForm();
        $this->isOpen = true;
    }

    public function openModal()
    {
        $this->isOpen = true;
    }

    public function closeModal()
    {
        $this->isOpen = false;
    }

    public function openDeleteModal()
    {
        $this->isDeleteModalOpen = true;
    }

    public function closeDeleteModal()
    {
        $this->isDeleteModalOpen = false;
    }

    private function resetForm()
    {
        $this->addressId = null;
        $this->house_no = '';
        $this->street = '';
        $this->barangay = '';
        $this->town = '';
        $this->province = '';
        $this->country = '';
        $this->is_primary = false;
        $this->resetErrorBag();
    }

    public function save()
    {
        $validatedData = $this->validate();

        try {
            if ($this->addressId) {
                // Update
                $this->addressService->updateUserAddress($this->addressId, $validatedData);
                session()->flash('success', 'Address updated successfully.');
            } else {
                // Create
                $this->addressService->createAddressForUser($validatedData);
                session()->flash('success', 'Address added successfully.');
            }

            $this->closeModal();
            $this->loadAddresses();
        } catch (\Exception $e) {
            session()->flash('error', 'An error occurred: ' . $e->getMessage());
        }
    }

    public function edit(int $id)
    {
        /** @var \App\Domains\Users\Models\User $user */
        $user = auth()->user();
        $address = $user->addresses()->withPivot('is_primary')->findOrFail($id);

        if ($address) {
            $this->addressId = $address->id;
            $this->house_no = $address->house_no ?? '';
            $this->street = $address->street ?? '';
            $this->barangay = $address->barangay ?? '';
            $this->town = $address->town;
            $this->province = $address->province;
            $this->country = $address->country;
            $this->is_primary = (bool) $address->pivot->is_primary;
            $this->openModal();
        }
    }

    public function confirmDelete(int $id)
    {
        $this->addressId = $id;
        $this->openDeleteModal();
    }

    public function delete()
    {
        if ($this->addressId) {
            try {
                $this->addressService->deleteUserAddress($this->addressId);
                session()->flash('success', 'Address deleted successfully.');
                $this->loadAddresses();
            } catch (\Exception $e) {
                session()->flash('error', 'An error occurred: ' . $e->getMessage());
            }
        }
        $this->closeDeleteModal();
        $this->resetForm();
    }

    public function setPrimary(int $id)
    {
        try {
            $this->addressService->setPrimaryAddress($id);
            session()->flash('success', 'Primary address updated.');
            $this->loadAddresses();
        } catch (\Exception $e) {
            session()->flash('error', 'An error occurred: ' . $e->getMessage());
        }
    }
}
----
--app/Livewire/ChatInterface.php
<?php

namespace App\Livewire;

use App\Domains\Messaging\Models\MessageThread;
use App\Domains\Messaging\Models\Message;
use App\Domains\Messaging\Models\MessageAttachment;
use Livewire\Component;
use Livewire\WithFileUploads;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\DB;

class ChatInterface extends Component
{
    use WithFileUploads;

    public MessageThread $thread;
    public $newMessage = '';
    public $attachments = [];
    public $messages;

    protected $listeners = ['echo:message-thread.{thread.id},MessageSent' => 'mount'];

    public function mount()
    {
        $this->messages = $this->thread->messages()->with('sender', 'attachments')->latest()->get();
        // Mark messages as read when mounting the component
        $this->markMessagesAsRead();
    }

    public function sendMessage()
    {
        $this->validate([
            'newMessage' => 'required|string|max:255',
            'attachments.*' => 'file|max:10240', // Max 10MB per file
        ]);

        $message = DB::transaction(function () {
            $message = $this->thread->messages()->create([
                'sender_id' => Auth::id(),
                'content' => $this->newMessage,
            ]);

            if (!empty($this->attachments)) {
                foreach ($this->attachments as $file) {
                    $path = $file->store('message_attachments', 'public');
                    $message->attachments()->create([
                        'file_path' => $path,
                        'file_type' => $file->getMimeType(),
                    ]);
                }
            }
            return $message;
        });

        // Broadcast MessageSent event
        // event(new MessageSent($message)); // Will implement this later in broadcasting setup

        $this->reset(['newMessage', 'attachments']);
        $this->messages = $this->thread->messages()->with('sender', 'attachments')->latest()->get(); // Refresh messages
    }

    public function markMessagesAsRead()
    {
        $this->thread->messages()
            ->where('read_at', null)
            ->where('sender_id', '!=', Auth::id())
            ->update(['read_at' => now()]);
    }

    public function render()
    {
        return view('livewire.chat-interface', [
            'messages' => $this->messages,
        ]);
    }
}
----
--app/Livewire/FormWithMedia.php
<?php

namespace App\Livewire;

use Livewire\Component;
use Livewire\WithFileUploads;
use Livewire\Features\SupportFileUploads\TemporaryUploadedFile;

abstract class FormWithMedia extends Component
{
    use WithFileUploads;

    public array $newFiles = [];
    public array $imagesToRemove = [];
    public array $existingImages = [];
    public array $selectedImages = [];

    /**
     * Update new files from input
     */
    public function updatedNewFiles()
    {
        $this->validate([
            'newFiles.*' => 'image|max:2048', // max 2MB
        ]);
    }

    /**
     * Remove a newly added file
     */
    public function removeNewFile(int $index)
    {
        if (isset($this->newFiles[$index])) {
            array_splice($this->newFiles, $index, 1);
        }
    }

    /**
     * Remove an existing image
     */
    public function removeExistingImage(int $id)
    {
        if (!in_array($id, $this->imagesToRemove)) {
            $this->imagesToRemove[] = $id;
        }

        $this->existingImages = array_values(
            array_filter($this->existingImages, fn($img) => $img['id'] !== $id)
        );
    }

    /**
     * Select all images for batch operations.
     */
    public function selectAllImages()
    {
        $this->selectedImages = array_merge(
            collect($this->existingImages)->pluck('id')->all(),
            array_keys($this->newFiles)
        );
        // In a real UI, you would bind checkboxes to this array.
        // For now, this method simulates selecting all.
        session()->flash('info', 'All images selected. (Backend only)');
    }

    /**
     * Delete all selected images.
     */
    public function deleteSelected()
    {
        if (empty($this->selectedImages)) {
            session()->flash('error', 'No images selected to delete.');
            return;
        }

        // This is a placeholder implementation.
        // A real implementation would require checkboxes in the UI
        // bound to the $selectedImages property.
        session()->flash('info', 'Delete selected functionality not fully implemented.');

        // Reset selection
        $this->selectedImages = [];
    }


    /**
     * Return TemporaryUploadedFiles for processing
     */
    protected function getUploadedFiles(): array
    {
        // Add debug
        \Illuminate\Support\Facades\Log::info('getUploadedFiles called', [
            'newFiles_count' => count($this->newFiles),
            'newFiles' => $this->newFiles,
        ]);
        
        // Check each file
        $filtered = [];
        foreach ($this->newFiles as $file) {
            \Illuminate\Support\Facades\Log::info('Checking file', [
                'file' => $file,
                'is_temp' => $file instanceof \Livewire\Features\SupportFileUploads\TemporaryUploadedFile,
                'class' => get_class($file),
            ]);
            
            if ($file instanceof \Livewire\Features\SupportFileUploads\TemporaryUploadedFile) {
                $filtered[] = $file;
            }
        }
        
        \Illuminate\Support\Facades\Log::info('Filtered files', ['count' => count($filtered)]);
        
        return $filtered;
}
}
----
--app/Livewire/ImageUploader.php
<?php
namespace App\Livewire;

use Livewire\Component;
use Livewire\WithFileUploads;

class ImageUploader extends Component
{
    use WithFileUploads;

    public $newFiles = [];
    public $imagesToRemove = [];
    public $existingImages = [];

    public function mount(array $existingImages = [])
    {
        $this->existingImages = $existingImages;
    }

    public function removeNewFile($index)
    {
        array_splice($this->newFiles, $index, 1);
    }

    public function removeExistingImage($id)
    {
        $this->imagesToRemove[] = $id;
        $this->existingImages = array_values(
            array_filter($this->existingImages, fn($img) => $img['id'] !== $id)
        );
    }

    public function render()
    {
        return view('livewire.image-uploader');
    }
}
----
--app/Livewire/OpenOfferForm.php
<?php

namespace App\Livewire;

use App\Domains\Listings\Models\OpenOffer;
use Livewire\Component;
use Livewire\WithFileUploads;
use Illuminate\Support\Facades\Storage;
use Plank\Mediable\MediaUploader;
use Illuminate\Http\UploadedFile;

class OpenOfferForm extends FormWithMedia
{
    use WithFileUploads;

    public ?OpenOffer $offer = null;

    public string $title = '';
    public ?string $description = null;
    public ?float $budget = null;
    public ?int $category_id = null;
    public ?int $workflow_template_id = null;
    public bool $pay_first = false;
    public ?int $address_id = null;

    /** @var array|UploadedFile[] */
    public array $new_images = [];

    /** @var int[] IDs of media to remove (when editing) */
    public array $images_to_remove = [];

    // For lists (categories, workflows) loaded for select inputs
    public array $categories = [];
    public array $workflowTemplates = [];

    protected function rules(): array
    {
        return [
            'title' => 'required|string|max:255',
            'description' => 'nullable|string',
            'budget' => 'required|numeric|min:1',
            'category_id' => 'required|integer|exists:categories,id',
            'workflow_template_id' => 'nullable|integer|exists:workflow_templates,id',
            'pay_first' => 'nullable|boolean',
            'address_id' => 'nullable|integer',
            'new_images' => 'nullable|array',
            'new_images.*' => 'file|max:5120', // 5MB per file guard; adjust as needed
            'images_to_remove' => 'nullable|array',
            'images_to_remove.*' => 'integer',
        ];
    }

    protected $listeners = [
        // you can listen to custom events if needed
    ];

    public function mount(?OpenOffer $offer = null)
    {
        $this->offer = $offer;

        // Load selects (you can replace with services or inject them)
        $this->categories = app(\App\Domains\Listings\Services\CategoryService::class)->listAllCategories()->map(fn($c) => ['id' => $c->id, 'name' => $c->name])->toArray();

        $this->workflowTemplates = app(\App\Domains\Listings\Services\WorkflowTemplateService::class)
            ->getWorkflowTemplatesByCreator(auth()->id())
            ->map(fn($w) => ['id' => $w->id, 'name' => $w->name])->toArray();

        if ($this->offer) {
            $this->title = $this->offer->title;
            $this->description = $this->offer->description;
            $this->budget = $this->offer->budget;
            $this->category_id = $this->offer->category_id;
            $this->workflow_template_id = $this->offer->workflow_template_id;
            $this->pay_first = (bool)$this->offer->pay_first;
            $this->address_id = $this->offer->address_id;
            // existing media loaded for display in blade via $offer->getMedia('gallery') or ->loadMedia('gallery')
        }
    }

    public function updatedNewImages()
    {
        // Optional: limit number of files, validate individually, etc.
        $this->validateOnly('new_images');
    }

    public function save()
    {
        $this->validate();

        $openOfferService = app(\App\Domains\Listings\Services\OpenOfferService::class);
        $uploader = app(MediaUploader::class);

        $data = [
            'title' => $this->title,
            'description' => $this->description,
            'budget' => $this->budget,
            'category_id' => $this->category_id,
            'workflow_template_id' => $this->workflow_template_id,
            'pay_first' => $this->pay_first,
            'address_id' => $this->address_id,
            'creator_id' => auth()->id(),
            'images_to_remove' => $this->images_to_remove,
        ];

        // Prepare new_images as local disk paths (service expects strings to locate files)
        $tempPaths = [];
        if (!empty($this->new_images)) {
            foreach ($this->new_images as $file) {
                if ($file instanceof UploadedFile) {
                    // store to local disk - folder "livewire-temp/offers"
                    $path = $file->store('livewire-temp/offers', 'local');
                    $tempPaths[] = $path;
                }
            }
            $data['new_images'] = $tempPaths;
        }

        try {
            if ($this->offer) {
                $updated = $openOfferService->updateOpenOffer($this->offer, $data, $uploader);
                $this->emit('openOfferSaved', $updated->id);
                session()->flash('success', 'Open offer updated successfully.');
                return redirect()->route('creator.offers.index');
            } else {
                $created = $openOfferService->createOpenOffer($data, $uploader);
                $this->emit('openOfferSaved', $created->id);
                session()->flash('success', 'Open offer created successfully.');
                return redirect()->route('creator.offers.index');
            }
        } catch (\Throwable $e) {
            // Clean up temp files on failure
            foreach ($tempPaths as $p) {
                Storage::disk('local')->delete($p);
            }

            // Log and show generic error
            \Log::error('OpenOfferForm save failed: ' . $e->getMessage(), ['exception' => $e]);
            $this->addError('save', 'Failed to save open offer: ' . $e->getMessage());
        }
    }

    public function removeExistingMedia(int $mediaId)
    {
        // Mark for removal - frontend can call this to add to images_to_remove
        if (!in_array($mediaId, $this->images_to_remove)) {
            $this->images_to_remove[] = $mediaId;
        }
    }

    public function render()
    {
        return view('livewire.open-offer-form');
    }
}
----
--app/Livewire/ServiceForm.php
<?php

namespace App\Livewire;

use App\Domains\Listings\Models\Service;
use App\Domains\Listings\Services\ServiceService;
use Barryvdh\Debugbar\Facades\Debugbar;
use Barryvdh\Debugbar\Twig\Extension\Debug;
use Livewire\Attributes\On;

class ServiceForm extends FormWithMedia
{
    public ?Service $service = null;

    // Livewire properties
    public ?string $title = null;
    public ?string $description = null;
    public float|string|null $price = null;
    public int|string|null $category_id = null;
    public int|string|null $workflow_template_id = null;
    public ?bool $pay_first = null;
    public ?int $address_id = null;

    public $categories;
    public $workflowTemplates;
    public $addresses;

    protected $rules = [
        'title' => 'required|string|min:3|max:255',
        'description' => 'nullable|string|min:10',
        'price' => 'required|numeric|min:0.01',
        'category_id' => 'required|exists:categories,id',
        'workflow_template_id' => 'required|integer|exists:workflow_templates,id',
        'address_id' => 'required|exists:addresses,id',
        'pay_first' => 'boolean',
        'newFiles.*' => 'nullable|image|max:2048',
    ];

    public function updatedWorkflowTemplateId($value)
    {
        Debugbar::info('updatedWorkflowTemplateId called', [
            'value' => $value,
            'type' => gettype($value)
        ]);
        
        // Cast to integer if it's a numeric string
        if (is_string($value) && is_numeric($value)) {
            $this->workflow_template_id = (int) $value;
            Debugbar::info('Casted to integer', ['new_value' => $this->workflow_template_id]);
        }
    }

    public function mount(
        ?Service $service = null,
        $categories = [],
        $workflowTemplates = [],
        $addresses = []
    ) {
        $this->service = $service;
        $this->categories = collect($categories);
        $this->workflowTemplates = collect($workflowTemplates);
        $this->addresses = collect($addresses)->map(function ($address) {
            $address->is_primary = $address->pivot->is_primary ?? false;
            return $address;
        });

        Debugbar::info('Addresses', ['addresses' => $this->addresses]);

        // Default values
        $this->title = '';
        $this->description = '';
        $this->price = '';
        $this->category_id = '';
        $this->workflow_template_id = null; // Changed from ''
        $this->pay_first = false;
        $this->address_id = $this->addresses->firstWhere('pivot.is_primary', true)->id ?? null;
        $this->existingImages = [];
        $this->newFiles = [];
        $this->imagesToRemove = [];

        if ($service->exists) {
            // Edit mode  overwrite defaults
            $this->title = $service->title;
            $this->description = $service->description;
            $this->price = $service->price;
            $this->category_id = $service->category_id;
            $this->workflow_template_id = $service->workflow_template_id;
            $this->pay_first = $service->pay_first ?? false;
            $this->address_id = $service->address_id;

            $this->existingImages = $service->media->map(fn($m) => [
                'id' => $m->id,
                'url' => $m->getUrl()
            ])->toArray();
        } else {
            // Create mode  set default primary address if exists
            $primary = $this->addresses->firstWhere('pivot.is_primary', true);
            $this->address_id = $primary?->id ?? null;
        }
        
        Debugbar::info('Mount completed', [
            'service_exists' => $service->exists,
            'workflow_template_id' => $this->workflow_template_id,
            'workflowTemplates_count' => $this->workflowTemplates->count(),
            'workflowTemplates_ids' => $this->workflowTemplates->pluck('id')->toArray()
        ]);
    }

    public function save(ServiceService $serviceService)
    {
        Debugbar::info('=== SAVE METHOD CALLED ===');
        Debugbar::info('workflow_template_id value and type', [
            'value' => $this->workflow_template_id,
            'type' => gettype($this->workflow_template_id),
            'empty' => empty($this->workflow_template_id)
        ]);
        
        Debugbar::info('BEFORE validate - newFiles', ['count' => count($this->newFiles)]);

        try {
            $this->validate();
            Debugbar::info('Validation passed');
        } catch (\Illuminate\Validation\ValidationException $e) {
            Debugbar::error('Validation failed', $e->errors());
            throw $e; // rethrow so Livewire handles displaying errors
        }

        Debugbar::info('AFTER validate - newFiles', ['count' => count($this->newFiles)]);

        $uploadedFiles = $this->getUploadedFiles();

        $data = [
            'title' => $this->title,
            'description' => $this->description,
            'price' => $this->price,
            'category_id' => $this->category_id,
            'workflow_template_id' => $this->workflow_template_id,
            'address_id' => $this->address_id,
            'pay_first' => $this->pay_first,
            'creator_id' => auth()->id(),
            'images_to_remove' => $this->imagesToRemove,
        ];

        Debugbar::info('Data to save', $data);

        if ($this->service->exists) {
            $serviceService->updateService($this->service, $data, $uploadedFiles);
        } else {
            $serviceService->createService($data, $uploadedFiles);
        }

        session()->flash('success', 'Service saved successfully!');
        return redirect()->route('creator.services.index');
    }

     public function testLivewire()
    {
        Debugbar::info('TEST METHOD CALLED - Livewire is working!');
        session()->flash('message', 'Livewire is working!');
    }

    public function render()
    {
        return view('livewire.service-form');
    }
}
----
--app/Livewire/WorkProgress.php
<?php

namespace App\Livewire;

use App\Domains\Work\Models\WorkInstance;
use App\Domains\Work\Models\WorkInstanceStep;
use Livewire\Component;

class WorkProgress extends Component
{
    public WorkInstance $workInstance;

    public function startStep(WorkInstanceStep $step)
    {
        // Logic to start the step
        $step->status = 'in_progress';
        $step->started_at = now();
        $step->save();

        $this->dispatch('work-step-started', $step->id);
    }

    public function completeStep(WorkInstanceStep $step)
    {
        // Logic to complete the step
        $step->status = 'completed';
        $step->completed_at = now();
        $step->save();

        $this->dispatch('work-step-completed', $step->id);
    }

    public function render()
    {
        return view('livewire.work-progress');
    }
}
----
--app/Livewire/WorkflowBuilder.php
<?php

namespace App\Livewire;

use App\Domains\Listings\Models\WorkflowTemplate;
use App\Domains\Listings\Models\WorkTemplate;
use App\Domains\Listings\Models\WorkCatalog;
use App\Domains\Listings\Services\WorkCatalogService;
use App\Domains\Listings\Services\WorkTemplateService;
use App\Domains\Listings\Services\WorkflowTemplateService;
use DebugBar\DebugBar;
use Livewire\Component;
use Illuminate\Support\Collection;
use Illuminate\Support\Facades\Auth;
use Illuminate\Foundation\Auth\Access\AuthorizesRequests;

class WorkflowBuilder extends Component 
{
    use AuthorizesRequests;

    public WorkflowTemplate $workflowTemplate;
    
    /**
     * Define the context: 'page' (default) or 'modal'.
     * This will determine the save behavior.
     */
    public $context = 'page';
    // Use public property without type hint for Livewire compatibility
    
    // Memory-based collections (not saved to DB yet)
    public $workTemplates = [];
    public $pendingDeletes = []; // Track steps to delete on save
    
    public $showCatalogModal = false;
    public $workCatalogs = [];
    public $showEditStepModal = false;
    public $editingStep = null;

    public $name = '';
    public $description = '';
    public $is_public = false;

    // Track if changes have been saved
    public $hasSavedChanges = false;
    private $tempIdCounter = -1; // Negative IDs for new items

    public function mount(WorkflowTemplate $workflowTemplate)
    {
        $this->workflowTemplate = $workflowTemplate;
        
        // Load existing steps into memory
        $this->workTemplates = $workflowTemplate->workTemplates()
            ->orderBy('order')
            ->get()
            ->map(function ($step) {
                // Convert to array for easier manipulation
                return [
                    'id' => $step->id,
                    'workflow_template_id' => $step->workflow_template_id,
                    'name' => $step->name,
                    'description' => $step->description,
                    'order' => $step->order,
                    'work_catalog_id' => $step->work_catalog_id,
                    'is_persisted' => true, // Track if it exists in DB
                ];
            })
            ->toArray();

        $this->name = $workflowTemplate->name ?? '';
        $this->description = $workflowTemplate->description ?? '';
        $this->is_public = $workflowTemplate->is_public ?? false;
        $this->hasSavedChanges = true;
    }

    /**
     * Check if there are unsaved changes
     */
    public function hasUnsavedChanges(): bool
    {
        if ($this->hasSavedChanges) {
            return false;
        }

        // Reload the model to get fresh data from DB
        $original = WorkflowTemplate::find($this->workflowTemplate->id);

        // Check if workflow template properties have changed
        $workflowChanged = $this->name !== $original->name ||
                          $this->description !== ($original->description ?? '') ||
                          $this->is_public !== $original->is_public;

        // Check if there are pending changes to steps
        $stepsChanged = collect($this->workTemplates)->contains('is_persisted', false) || 
                       !empty($this->pendingDeletes) ||
                       $this->stepsOrderChanged($original);

        return $workflowChanged || $stepsChanged;
    }

    /**
     * Check if step order has changed
     */
    private function stepsOrderChanged($original): bool
    {
        $originalSteps = $original->workTemplates()
            ->orderBy('order')
            ->pluck('order', 'id')
            ->toArray();

        foreach ($this->workTemplates as $step) {
            if ($step['is_persisted'] && isset($originalSteps[$step['id']])) {
                if ($originalSteps[$step['id']] !== $step['order']) {
                    return true;
                }
            }
        }

        return false;
    }

    public function openCatalog(WorkCatalogService $workCatalogService)
    {
        $this->workCatalogs = $workCatalogService->getAllWorkCatalogs();
        $this->showCatalogModal = true;
    }

    public function closeCatalog()
    {
        $this->showCatalogModal = false;
    }

    public function addStepFromCatalog($catalogId, WorkCatalogService $workCatalogService)
    {
        $catalogItem = $workCatalogService->getWorkCatalog($catalogId);
        
        // Add to memory, not DB
        $lastOrder = collect($this->workTemplates)->max('order') ?? -1;
        
        $this->workTemplates[] = [
            'id' => $this->tempIdCounter--,
            'workflow_template_id' => $this->workflowTemplate->id,
            'name' => $catalogItem->name,
            'description' => $catalogItem->description,
            'order' => $lastOrder + 1,
            'work_catalog_id' => $catalogItem->id,
            'is_persisted' => false,
        ];
        
        $this->hasSavedChanges = false;
        $this->closeCatalog();
    }

    public function save(WorkflowTemplateService $workflowTemplateService, WorkTemplateService $workTemplateService)
    {
        if (!$this->workflowTemplate->exists) {
            // This is a new template, check 'create' permission
            $this->authorize('create', WorkflowTemplate::class);
        } else {
            // This is an existing template, check 'update'
            $this->authorize('update', $this->workflowTemplate);
        }
        
        // Check if the model is NEW before saving
        $isNew = !$this->workflowTemplate->exists;
        
        // Check if the model is new (doesn't exist in the DB yet)
        $isCreating = !$this->workflowTemplate->exists;

        $data = [
            'name' => $this->name,
            'description' => $this->description ?: null,
            'is_public' => $this->is_public,
            'creator_id' => auth()->id(), // You may need to add this!
        ];

        if ($isCreating) {
            \Barryvdh\Debugbar\Facades\Debugbar::info('Creating new workflow template', $data);
            
            // --- THIS IS THE NEW LOGIC YOU'RE MISSING ---
            // We are CREATING. Call the create method on your service.
            // (Assuming you have a createWorkflowTemplate method in your service)
            $this->workflowTemplate = $workflowTemplateService->createWorkflowTemplate($data);
            \Barryvdh\Debugbar\Facades\Debugbar::info('Created workflow template', $this->workflowTemplate);
            
        } else {
            // We are UPDATING. Your old logic was fine for this.
            // (I'll add the findOrFail fix we discussed)
            $this->workflowTemplate = WorkflowTemplate::findOrFail($this->workflowTemplate->id);
            $workflowTemplateService->updateWorkflowTemplate($this->workflowTemplate, $data);
        }

        // Delete pending deletions
        foreach ($this->pendingDeletes as $stepId) {
            $step = WorkTemplate::find($stepId);
            if ($step) {
                $workTemplateService->deleteWorkTemplate($step);
            }
        }
        $this->pendingDeletes = [];

        // Save or update steps
        foreach ($this->workTemplates as $index => $stepData) {
            if (!$stepData['is_persisted']) {
                // Create new step
                $step = $workTemplateService->createWorkTemplate([
                    'workflow_template_id' => $this->workflowTemplate->id,
                    'name' => $stepData['name'],
                    'description' => $stepData['description'],
                    'order' => $stepData['order'],
                    'work_catalog_id' => $stepData['work_catalog_id'] ?? null,
                ]);
                
                // Update collection with real ID
                $this->workTemplates[$index]['id'] = $step->id;
                $this->workTemplates[$index]['is_persisted'] = true;
            } else {
                // Update existing step
                $step = WorkTemplate::find($stepData['id']);
                if ($step) {
                    $workTemplateService->updateWorkTemplate($step, $stepData);
                }
            }
        }

        $this->workflowTemplate->refresh();
        
        // Mark as saved
        $this->hasSavedChanges = true;

        if ($this->context === 'modal') {
            // --- MODAL CONTEXT ---
            // We are in the ServiceForm modal.
            // Dispatch the event with the new ID for the parent to catch.
            $this->dispatch('workflowCreated', workflowId: $this->workflowTemplate->id);
            
            // No redirect. The parent component will close the modal.

        } else {
            // --- PAGE CONTEXT ---
            // We are on the standalone workflow page.
            // Redirect to the index page with a success message.
            // This mimics the behavior of the controller[cite: 30].
            session()->flash('success', 'Workflow saved successfully.');
            return $this->redirect(route('creator.workflows.index'), navigate: true);
        }
    }

    public function addStep()
    {
        $lastOrder = collect($this->workTemplates)->max('order') ?? -1;
        
        // Add to memory only
        $this->workTemplates[] = [
            'id' => $this->tempIdCounter--,
            'workflow_template_id' => $this->workflowTemplate->id,
            'name' => 'New Step',
            'description' => 'Step description',
            'order' => $lastOrder + 1,
            'work_catalog_id' => null,
            'is_persisted' => false,
        ];
        
        $this->hasSavedChanges = false;
    }

    public function deleteStep($stepId)
    {
        $steps = collect($this->workTemplates);
        
        // Find step in memory
        $step = $steps->firstWhere('id', $stepId);

        if ($step) {
            // If persisted, add to pending deletes
            if ($step['is_persisted']) {
                $this->pendingDeletes[] = $stepId;
            }
            
            // Remove from memory
            $this->workTemplates = $steps->filter(function ($s) use ($stepId) {
                return $s['id'] !== $stepId;
            })->values()->toArray();
            
            $this->hasSavedChanges = false;
        }
    }

    public function editStep($stepId)
    {
        $this->editingStep = collect($this->workTemplates)->firstWhere('id', $stepId);
        $this->showEditStepModal = true;
    }

    public function closeEditStepModal()
    {
        $this->showEditStepModal = false;
        $this->editingStep = null;
    }

    public function updateStep()
    {
        // Update in memory only
        $steps = collect($this->workTemplates);
        $stepIndex = $steps->search(function ($step) {
            return $step['id'] === $this->editingStep['id'];
        });

        if ($stepIndex !== false) {
            $this->workTemplates[$stepIndex] = $this->editingStep;
            $this->hasSavedChanges = false;
        }
        
        $this->closeEditStepModal();
    }

    public function updateStepOrder($orderedIds)
    {
        // Update order in memory
        $steps = collect($this->workTemplates);
        
        foreach ($orderedIds as $item) {
            $stepId = $item['value'];
            $newOrder = $item['order'];
            
            $stepIndex = $steps->search(function ($step) use ($stepId) {
                return $step['id'] == $stepId;
            });
            
            if ($stepIndex !== false) {
                $this->workTemplates[$stepIndex]['order'] = $newOrder;
            }
        }
        
        // Re-sort by order
        $this->workTemplates = collect($this->workTemplates)
            ->sortBy('order')
            ->values()
            ->toArray();
            
        $this->hasSavedChanges = false;
    }

    // Discard changes and reload from DB
    public function discardChanges()
    {
        $fresh = WorkflowTemplate::find($this->workflowTemplate->id);
        $this->mount($fresh);
        $this->hasSavedChanges = true; // Prevent navigation warning
        session()->flash('info', 'Changes discarded.');
    }

    public function render()
    {
        return view('livewire.workflow-builder');
    }
}
----
--app/Mail/BidAcceptedEmail.php
<?php

namespace App\Mail;

use Illuminate\Bus\Queueable;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Mail\Mailable;
use Illuminate\Mail\Mailables\Content;
use Illuminate\Mail\Mailables\Envelope;
use Illuminate\Queue\SerializesModels;

class BidAcceptedEmail extends Mailable
{
    use Queueable, SerializesModels;

    /**
     * Create a new message instance.
     */
    public function __construct()
    {
        //
    }

    /**
     * Get the message envelope.
     */
    public function envelope(): Envelope
    {
        return new Envelope(
            subject: 'Bid Accepted Email',
        );
    }

    /**
     * Get the message content definition.
     */
    public function content(): Content
    {
        return new Content(
            view: 'view.name',
        );
    }

    /**
     * Get the attachments for the message.
     *
     * @return array<int, \Illuminate\Mail\Mailables\Attachment>
     */
    public function attachments(): array
    {
        return [];
    }
}
----
--app/Mail/BidPlacedEmail.php
<?php

namespace App\Mail;

use Illuminate\Bus\Queueable;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Mail\Mailable;
use Illuminate\Mail\Mailables\Content;
use Illuminate\Mail\Mailables\Envelope;
use Illuminate\Queue\SerializesModels;

class BidPlacedEmail extends Mailable
{
    use Queueable, SerializesModels;

    /**
     * Create a new message instance.
     */
    public function __construct()
    {
        //
    }

    /**
     * Get the message envelope.
     */
    public function envelope(): Envelope
    {
        return new Envelope(
            subject: 'Bid Placed Email',
        );
    }

    /**
     * Get the message content definition.
     */
    public function content(): Content
    {
        return new Content(
            view: 'view.name',
        );
    }

    /**
     * Get the attachments for the message.
     *
     * @return array<int, \Illuminate\Mail\Mailables\Attachment>
     */
    public function attachments(): array
    {
        return [];
    }
}
----
--app/Mail/OrderCompletedEmail.php
<?php

namespace App\Mail;

use Illuminate\Bus\Queueable;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Mail\Mailable;
use Illuminate\Mail\Mailables\Content;
use Illuminate\Mail\Mailables\Envelope;
use Illuminate\Queue\SerializesModels;

class OrderCompletedEmail extends Mailable
{
    use Queueable, SerializesModels;

    /**
     * Create a new message instance.
     */
    public function __construct()
    {
        //
    }

    /**
     * Get the message envelope.
     */
    public function envelope(): Envelope
    {
        return new Envelope(
            subject: 'Order Completed Email',
        );
    }

    /**
     * Get the message content definition.
     */
    public function content(): Content
    {
        return new Content(
            view: 'view.name',
        );
    }

    /**
     * Get the attachments for the message.
     *
     * @return array<int, \Illuminate\Mail\Mailables\Attachment>
     */
    public function attachments(): array
    {
        return [];
    }
}
----
--app/Mail/OrderCreated.php
<?php

namespace App\Mail;

use App\Domains\Orders\Models\Order;
use Illuminate\Bus\Queueable;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Mail\Mailable;
use Illuminate\Mail\Mailables\Content;
use Illuminate\Mail\Mailables\Envelope;
use Illuminate\Queue\SerializesModels;

class OrderCreated extends Mailable
{
    use Queueable, SerializesModels;

    public Order $order;

    /**
     * Create a new message instance.
     */
    public function __construct(Order $order)
    {
        $this->order = $order;
    }

    /**
     * Get the message envelope.
     */
    public function envelope(): Envelope
    {
        return new Envelope(
            subject: 'Order Created',
        );
    }

    /**
     * Get the message content definition.
     */
    public function content(): Content
    {
        return new Content(
            view: 'emails.orders.created',
        );
    }

    /**
     * Get the attachments for the message.
     *
     * @return array<int, \Illuminate\Mail\Mailables\Attachment>
     */
    public function attachments(): array
    {
        return [];
    }
}
----
--app/Mail/OrderCreatedEmail.php
<?php

namespace App\Mail;

use Illuminate\Bus\Queueable;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Mail\Mailable;
use Illuminate\Mail\Mailables\Content;
use Illuminate\Mail\Mailables\Envelope;
use Illuminate\Queue\SerializesModels;

class OrderCreatedEmail extends Mailable
{
    use Queueable, SerializesModels;

    /**
     * Create a new message instance.
     */
    public function __construct()
    {
        //
    }

    /**
     * Get the message envelope.
     */
    public function envelope(): Envelope
    {
        return new Envelope(
            subject: 'Order Created Email',
        );
    }

    /**
     * Get the message content definition.
     */
    public function content(): Content
    {
        return new Content(
            view: 'view.name',
        );
    }

    /**
     * Get the attachments for the message.
     *
     * @return array<int, \Illuminate\Mail\Mailables\Attachment>
     */
    public function attachments(): array
    {
        return [];
    }
}
----
--app/Mail/PaymentReceivedEmail.php
<?php

namespace App\Mail;

use Illuminate\Bus\Queueable;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Mail\Mailable;
use Illuminate\Mail\Mailables\Content;
use Illuminate\Mail\Mailables\Envelope;
use Illuminate\Queue\SerializesModels;

class PaymentReceivedEmail extends Mailable
{
    use Queueable, SerializesModels;

    /**
     * Create a new message instance.
     */
    public function __construct()
    {
        //
    }

    /**
     * Get the message envelope.
     */
    public function envelope(): Envelope
    {
        return new Envelope(
            subject: 'Payment Received Email',
        );
    }

    /**
     * Get the message content definition.
     */
    public function content(): Content
    {
        return new Content(
            view: 'view.name',
        );
    }

    /**
     * Get the attachments for the message.
     *
     * @return array<int, \Illuminate\Mail\Mailables\Attachment>
     */
    public function attachments(): array
    {
        return [];
    }
}
----
--app/Mail/WelcomeEmail.php
<?php

namespace App\Mail;

use Illuminate\Bus\Queueable;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Mail\Mailable;
use Illuminate\Mail\Mailables\Content;
use Illuminate\Mail\Mailables\Envelope;
use Illuminate\Queue\SerializesModels;

class WelcomeEmail extends Mailable
{
    use Queueable, SerializesModels;

    /**
     * Create a new message instance.
     */
    public function __construct()
    {
        //
    }

    /**
     * Get the message envelope.
     */
    public function envelope(): Envelope
    {
        return new Envelope(
            subject: 'Welcome Email',
        );
    }

    /**
     * Get the message content definition.
     */
    public function content(): Content
    {
        return new Content(
            view: 'view.name',
        );
    }

    /**
     * Get the attachments for the message.
     *
     * @return array<int, \Illuminate\Mail\Mailables\Attachment>
     */
    public function attachments(): array
    {
        return [];
    }
}
----
--app/Notifications/ActivityMessageCreated.php
<?php

namespace App\Notifications;

use App\Domains\Work\Models\ActivityMessage;
use Illuminate\Bus\Queueable;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Notifications\Messages\MailMessage;
use Illuminate\Notifications\Notification;

class ActivityMessageCreated extends Notification
{
    use Queueable;

    public ActivityMessage $activityMessage;

    /**
     * Create a new notification instance.
     */
    public function __construct(ActivityMessage $activityMessage)
    {
        $this->activityMessage = $activityMessage;
    }

    /**
     * Get the notification's delivery channels.
     *
     * @return array<int, string>
     */
    public function via(object $notifiable): array
    {
        return ['mail'];
    }

    /**
     * Get the mail representation of the notification.
     */
    public function toMail(object $notifiable): MailMessage
    {
        return (new MailMessage)
            ->subject('New Activity Message')
            ->line('A new activity message has been posted:')
            ->line($this->activityMessage->content)
            ->action('View Activity', url('/work-instances/' . $this->activityMessage->activityThread->workInstanceStep->workInstance->id . '/steps/' . $this->activityMessage->activityThread->workInstanceStep->id));
    }

    /**
     * Get the array representation of the notification.
     *
     * @return array<string, mixed>
     */
    public function toArray(object $notifiable): array
    {
        return [
            'activity_message_id' => $this->activityMessage->id,
            'activity_thread_id' => $this->activityMessage->activity_thread_id,
            'content' => $this->activityMessage->content,
        ];
    }
}
----
--app/Notifications/WorkStepCompleted.php
<?php

namespace App\Notifications;

use App\Domains\Work\Models\WorkInstanceStep;
use Illuminate\Bus\Queueable;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Notifications\Messages\DatabaseMessage;
use Illuminate\Notifications\Messages\MailMessage;
use Illuminate\Notifications\Notification;

class WorkStepCompleted extends Notification implements ShouldQueue
{
    use Queueable;

    /**
     * Create a new notification instance.
     */
    public function __construct(
        public WorkInstanceStep $workInstanceStep
    ) {
    }

    /**
     * Get the notification's delivery channels.
     *
     * @return array<int, string>
     */
    public function via(object $notifiable): array
    {
        return ['database', 'mail'];
    }

    /**
     * Get the mail representation of the notification.
     */
    public function toMail(object $notifiable): MailMessage
    {
        $workInstance = $this->workInstanceStep->workInstance;
        $order = $workInstance->order;
        $service = $order->service;

        return (new MailMessage)
            ->subject('Work Step Completed: ' . ($service?->title ?? 'Your Order'))
            ->greeting('Hi ' . $notifiable->name . ',')
            ->line('A work step has been completed for your order.')
            ->line('**Service:** ' . ($service?->title ?? 'N/A'))
            ->line('**Step:** ' . ($this->workInstanceStep->workTemplate?->name ?? 'Step ' . ($this->workInstanceStep->step_index + 1)))
            ->line('**Progress:** ' . $workInstance->getProgressPercentage() . '% complete')
            ->action('View Order', route('orders.show', $order))
            ->line('Thank you for using Serbizyu!');
    }

    /**
     * Get the array representation of the notification.
     */
    public function toArray(object $notifiable): array
    {
        $workInstance = $this->workInstanceStep->workInstance;
        $order = $workInstance->order;
        $service = $order->service;

        return [
            'title' => 'Work Step Completed',
            'message' => 'Step "' . ($this->workInstanceStep->workTemplate?->name ?? 'Step ' . ($this->workInstanceStep->step_index + 1)) . '" completed for order #' . $order->id,
            'order_id' => $order->id,
            'work_instance_id' => $workInstance->id,
            'work_instance_step_id' => $this->workInstanceStep->id,
            'progress_percentage' => $workInstance->getProgressPercentage(),
            'service_title' => $service?->title ?? 'Service',
            'seller_name' => $order->seller->name,
            'buyer_name' => $order->buyer->name,
        ];
    }
}
----
--app/Policies/Domains/Orders/Policies/OrderPolicy.php
<?php

namespace App\Policies\Domains\Orders\Policies;

use App\Domains\Orders\Models\Order;
use App\Domains\Users\Models\User;
use Illuminate\Auth\Access\Response;

class OrderPolicy
{
    /**
     * Determine whether the user can view any models.
     */
    public function viewAny(User $user): bool
    {
        return false;
    }

    /**
     * Determine whether the user can view the model.
     */
    public function view(User $user, Order $order): bool
    {
        return false;
    }

    /**
     * Determine whether the user can create models.
     */
    public function create(User $user): bool
    {
        return false;
    }

    /**
     * Determine whether the user can update the model.
     */
    public function update(User $user, Order $order): bool
    {
        return false;
    }

    /**
     * Determine whether the user can delete the model.
     */
    public function delete(User $user, Order $order): bool
    {
        return false;
    }

    /**
     * Determine whether the user can restore the model.
     */
    public function restore(User $user, Order $order): bool
    {
        return false;
    }

    /**
     * Determine whether the user can permanently delete the model.
     */
    public function forceDelete(User $user, Order $order): bool
    {
        return false;
    }
}
----
--app/Providers/AppServiceProvider.php
<?php

namespace App\Providers;

use Illuminate\Support\ServiceProvider;
use Illuminate\Support\Facades\View;
use Illuminate\Auth\Middleware\Authenticate;
use Illuminate\Support\Facades\RateLimiter;
use Illuminate\Cache\RateLimiting\Limit;
use Illuminate\Http\Request;

// Listings Domain Services
use App\Domains\Listings\Services\ServiceService;
use App\Domains\Listings\Services\CategoryService;
use App\Domains\Listings\Services\WorkflowTemplateService;
use App\Domains\Common\Services\ImageService;
use App\Domains\Listings\Services\OpenOfferService;
use App\Domains\Listings\Services\OpenOfferBidService;
use App\Domains\Listings\Services\WorkCatalogService;
use App\Domains\Listings\Services\WorkTemplateService;

// Users Domain Services
use App\Domains\Users\Services\UserService;

// Common Domain Services
use App\Domains\Common\Services\AddressService;

class AppServiceProvider extends ServiceProvider
{
    /**
     * Register any application services.
     */
    public function register(): void
    {
        // Register CategoryService
        $this->app->singleton(CategoryService::class);

        // Register UserService
        $this->app->singleton(UserService::class);

        // Register AddressService
        $this->app->singleton(AddressService::class);

        // Register WorkflowTemplateService
        $this->app->singleton(WorkflowTemplateService::class);

        // Register WorkCatalogService with dependencies
        $this->app->bind(WorkCatalogService::class, function ($app) {
            return new WorkCatalogService(
                $app->make(CategoryService::class),
                $app->make(WorkflowTemplateService::class)
            );
        });

        // Register WorkTemplateService
        $this->app->singleton(WorkTemplateService::class);

        // Register ServiceService with all dependencies
        $this->app->bind(ServiceService::class, function ($app) {
            return new ServiceService(
                $app->make(UserService::class),
                $app->make(CategoryService::class),
                $app->make(WorkflowTemplateService::class),
                $app->make(AddressService::class),
            );
        });

        // Register OpenOfferService with dependencies
        $this->app->bind(OpenOfferService::class, function ($app) {
            return new OpenOfferService(
                $app->make(UserService::class),
                $app->make(CategoryService::class),
                $app->make(WorkflowTemplateService::class)
            );
        });

        // Register OpenOfferBidService with dependencies
        $this->app->bind(OpenOfferBidService::class, function ($app) {
            return new OpenOfferBidService(
                $app->make(UserService::class),
                $app->make(OpenOfferService::class),
                $app->make(ServiceService::class)
            );
        });
    }

    /**
     * Bootstrap any application services.
     */
    public function boot(): void
    {
        // Set custom unauthenticated redirect globally
        Authenticate::redirectUsing(function ($request) {
            return route('auth.signin');
        });

        // Share authenticat    ion data with navbar across all views
        View::composer('layouts.navbar', function ($view) {
            $authProfileData = [
                'greeting' => null,
                'email' => null,
                'img_path' => null,
            ];

            if (auth()->check()) {
                $user = auth()->user();
                $authProfileData = [
                    'greeting' => 'Hi, ' . ($user->firstname ?? 'User') . '!',
                    'email' => $user->email,
                    'img_path' => $user->profileImage?->path ?? null, // Use the new relationship
                ];
            }

            $view->with('authProfileData', $authProfileData);
        });

        // Optional: Share common data with all views
        View::composer('*', function ($view) {
            // You can share global data here if needed
            // For example, site settings, notifications count, etc.
        });

        RateLimiter::for('api', function (Request $request) {
            return Limit::perMinute(60)->by($request->user()?->id ?: $request->ip());
        });
    }
}
----
--app/Providers/AuthServiceProvider.php
<?php

namespace App\Providers;

use App\Domains\Listings\Models\Category;
use App\Domains\Listings\Models\Service;
use App\Domains\Listings\Models\WorkflowTemplate;
use App\Domains\Listings\Policies\CategoryPolicy;
use App\Domains\Listings\Policies\ServicePolicy;
use App\Domains\Listings\Policies\WorkflowPolicy;
use App\Domains\Work\Models\WorkInstance;
use App\Domains\Work\Policies\WorkInstancePolicy;
use Illuminate\Foundation\Support\Providers\AuthServiceProvider as ServiceProvider;
use Plank\Mediable\Media;

class AuthServiceProvider extends ServiceProvider
{
    /**
     * The model to policy mappings for the application.
     *
     * @var array<class-string, class-string>
     */
    protected $policies = [
        Category::class => CategoryPolicy::class,
        Service::class => ServicePolicy::class,
        WorkflowTemplate::class => WorkflowPolicy::class,
        \App\Domains\Orders\Models\Order::class => \App\Domains\Orders\Policies\OrderPolicy::class,
        WorkInstance::class => WorkInstancePolicy::class,
    ];

    /**
     * Register any authentication / authorization services.
     */
    public function boot(): void
    {
        //
    }
}
----
--app/View/Components/AppLayout.php
<?php

namespace App\View\Components;

use Illuminate\View\Component;
use Illuminate\View\View;

class AppLayout extends Component
{
    /**
     * Get the view / contents that represents the component.
     */
    public function render(): View
    {
        return view('layouts.app');
    }
}
----
--app/View/Components/Navbar.php
<?php

namespace App\View\Components;

use Illuminate\View\Component;
use Illuminate\View\View;
use App\Domains\Users\Models\User;
use Illuminate\Support\Facades\Auth;

class Navbar extends Component
{
    public array $authProfileData = [];

    public function __construct()
    {
        /** @var User|null $user */
        $user = Auth::user();

        $firstname = $user?->firstname;
        $email     = $user?->email;
        $img_path = $user?->img_path;

        $this->authProfileData = [
            'email'     => $email,
            'greeting'  => $this->makeGreeting($firstname),
            'img_path' => $img_path
        ];
    }

    private function makeGreeting(?string $user_name = null): string
    {
        $startPhrases = collect(['Hi', 'Hello', 'Welcome']);
        $phrase = $startPhrases->random();

        return $phrase . ', ' . ($user_name ?: 'Guest');
    }

    public function render(): View
    {
        return view('layouts.navbar');
    }
}
----
--config/activitylog.php
<?php

return [

    /*
     * If set to false, no activities will be saved to the database.
     */
    'enabled' => env('ACTIVITY_LOGGER_ENABLED', true),

    /*
     * When the clean-command is executed, all recording activities older than
     * the number of days specified here will be deleted.
     */
    'delete_records_older_than_days' => 365,

    /*
     * If no log name is passed to the activity() helper
     * we use this default log name.
     */
    'default_log_name' => 'default',

    /*
     * You can specify an auth driver here that gets user models.
     * If this is null we'll use the current Laravel auth driver.
     */
    'default_auth_driver' => null,

    /*
     * If set to true, the subject returns soft deleted models.
     */
    'subject_returns_soft_deleted_models' => false,

    /*
     * This model will be used to log activity.
     * It should implement the Spatie\Activitylog\Contracts\Activity interface
     * and extend Illuminate\Database\Eloquent\Model.
     */
    'activity_model' => \Spatie\Activitylog\Models\Activity::class,

    /*
     * This is the name of the table that will be created by the migration and
     * used by the Activity model shipped with this package.
     */
    'table_name' => env('ACTIVITY_LOGGER_TABLE_NAME', 'activity_log'),

    /*
     * This is the database connection that will be used by the migration and
     * the Activity model shipped with this package. In case it's not set
     * Laravel's database.default will be used instead.
     */
    'database_connection' => env('ACTIVITY_LOGGER_DB_CONNECTION'),
];
----
--config/app.php
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Application Name
    |--------------------------------------------------------------------------
    |
    | This value is the name of your application, which will be used when the
    | framework needs to place the application's name in a notification or
    | other UI elements where an application name needs to be displayed.
    |
    */

    'name' => env('APP_NAME', 'Laravel'),

    /*
    |--------------------------------------------------------------------------
    | Application Environment
    |--------------------------------------------------------------------------
    |
    | This value determines the "environment" your application is currently
    | running in. This may determine how you prefer to configure various
    | services the application utilizes. Set this in your ".env" file.
    |
    */

    'env' => env('APP_ENV', 'production'),

    /*
    |--------------------------------------------------------------------------
    | Application Debug Mode
    |--------------------------------------------------------------------------
    |
    | When your application is in debug mode, detailed error messages with
    | stack traces will be shown on every error that occurs within your
    | application. If disabled, a simple generic error page is shown.
    |
    */

    'debug' => (bool) env('APP_DEBUG', false),

    /*
    |--------------------------------------------------------------------------
    | Application URL
    |--------------------------------------------------------------------------
    |
    | This URL is used by the console to properly generate URLs when using
    | the Artisan command line tool. You should set this to the root of
    | the application so that it's available within Artisan commands.
    |
    */

    'url' => env('APP_URL', 'http://localhost'),

    /*
    |--------------------------------------------------------------------------
    | Application Timezone
    |--------------------------------------------------------------------------
    |
    | Here you may specify the default timezone for your application, which
    | will be used by the PHP date and date-time functions. The timezone
    | is set to "UTC" by default as it is suitable for most use cases.
    |
    */

    'timezone' => 'UTC',

    /*
    |--------------------------------------------------------------------------
    | Application Locale Configuration
    |--------------------------------------------------------------------------
    |
    | The application locale determines the default locale that will be used
    | by Laravel's translation / localization methods. This option can be
    | set to any locale for which you plan to have translation strings.
    |
    */

    'locale' => env('APP_LOCALE', 'en'),

    'fallback_locale' => env('APP_FALLBACK_LOCALE', 'en'),

    'faker_locale' => env('APP_FAKER_LOCALE', 'en_US'),

    /*
    |--------------------------------------------------------------------------
    | Encryption Key
    |--------------------------------------------------------------------------
    |
    | This key is utilized by Laravel's encryption services and should be set
    | to a random, 32 character string to ensure that all encrypted values
    | are secure. You should do this prior to deploying the application.
    |
    */

    'cipher' => 'AES-256-CBC',

    'key' => env('APP_KEY'),

    'previous_keys' => [
        ...array_filter(
            explode(',', (string) env('APP_PREVIOUS_KEYS', ''))
        ),
    ],

    /*
    |--------------------------------------------------------------------------
    | Maintenance Mode Driver
    |--------------------------------------------------------------------------
    |
    | These configuration options determine the driver used to determine and
    | manage Laravel's "maintenance mode" status. The "cache" driver will
    | allow maintenance mode to be controlled across multiple machines.
    |
    | Supported drivers: "file", "cache"
    |
    */

    'maintenance' => [
        'driver' => env('APP_MAINTENANCE_DRIVER', 'file'),
        'store' => env('APP_MAINTENANCE_STORE', 'database'),
    ],

];
----
--config/auth.php
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Authentication Defaults
    |--------------------------------------------------------------------------
    |
    | This option defines the default authentication "guard" and password
    | reset "broker" for your application. You may change these values
    | as required, but they're a perfect start for most applications.
    |
    */

    'defaults' => [
        'guard' => env('AUTH_GUARD', 'web'),
        'passwords' => env('AUTH_PASSWORD_BROKER', 'users'),
    ],

    /*
    |--------------------------------------------------------------------------
    | Authentication Guards
    |--------------------------------------------------------------------------
    |
    | Next, you may define every authentication guard for your application.
    | Of course, a great default configuration has been defined for you
    | which utilizes session storage plus the Eloquent user provider.
    |
    | All authentication guards have a user provider, which defines how the
    | users are actually retrieved out of your database or other storage
    | system used by the application. Typically, Eloquent is utilized.
    |
    | Supported: "session"
    |
    */

    'guards' => [
        'web' => [
            'driver' => 'session',
            'provider' => 'users',
        ],
    ],

    /*
    |--------------------------------------------------------------------------
    | User Providers
    |--------------------------------------------------------------------------
    |
    | All authentication guards have a user provider, which defines how the
    | users are actually retrieved out of your database or other storage
    | system used by the application. Typically, Eloquent is utilized.
    |
    | If you have multiple user tables or models you may configure multiple
    | providers to represent the model / table. These providers may then
    | be assigned to any extra authentication guards you have defined.
    |
    | Supported: "database", "eloquent"
    |
    */

    'providers' => [
        'users' => [
            'driver' => 'eloquent',
            'model' => env('AUTH_MODEL', App\Domains\Users\Models\User::class),
        ],

        // 'users' => [
        //     'driver' => 'database',
        //     'table' => 'users',
        // ],
    ],

    /*
    |--------------------------------------------------------------------------
    | Resetting Passwords
    |--------------------------------------------------------------------------
    |
    | These configuration options specify the behavior of Laravel's password
    | reset functionality, including the table utilized for token storage
    | and the user provider that is invoked to actually retrieve users.
    |
    | The expiry time is the number of minutes that each reset token will be
    | considered valid. This security feature keeps tokens short-lived so
    | they have less time to be guessed. You may change this as needed.
    |
    | The throttle setting is the number of seconds a user must wait before
    | generating more password reset tokens. This prevents the user from
    | quickly generating a very large amount of password reset tokens.
    |
    */

    'passwords' => [
        'users' => [
            'provider' => 'users',
            'table' => env('AUTH_PASSWORD_RESET_TOKEN_TABLE', 'password_reset_tokens'),
            'expire' => 60,
            'throttle' => 60,
        ],
    ],

    /*
    |--------------------------------------------------------------------------
    | Password Confirmation Timeout
    |--------------------------------------------------------------------------
    |
    | Here you may define the number of seconds before a password confirmation
    | window expires and users are asked to re-enter their password via the
    | confirmation screen. By default, the timeout lasts for three hours.
    |
    */

    'password_timeout' => env('AUTH_PASSWORD_TIMEOUT', 10800),

];
----
--config/broadcasting.php
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Default Broadcaster
    |--------------------------------------------------------------------------
    |
    | This option controls the default broadcaster that will be used by the
    | framework when an event needs to be broadcast. You may set this to
    | any of the connections defined in the "connections" array below.
    |
    | Supported: "reverb", "pusher", "ably", "redis", "log", "null"
    |
    */

    'default' => env('BROADCAST_CONNECTION', 'null'),

    /*
    |--------------------------------------------------------------------------
    | Broadcast Connections
    |--------------------------------------------------------------------------
    |
    | Here you may define all of the broadcast connections that will be used
    | to broadcast events to other systems or over WebSockets. Samples of
    | each available type of connection are provided inside this array.
    |
    */

    'connections' => [

        'reverb' => [
            'driver' => 'reverb',
            'key' => env('REVERB_APP_KEY'),
            'secret' => env('REVERB_APP_SECRET'),
            'app_id' => env('REVERB_APP_ID'),
            'options' => [
                'host' => env('REVERB_HOST'),
                'port' => env('REVERB_PORT', 443),
                'scheme' => env('REVERB_SCHEME', 'https'),
                'useTLS' => env('REVERB_SCHEME', 'https') === 'https',
            ],
            'client_options' => [
                // Guzzle client options: https://docs.guzzlephp.org/en/stable/request-options.html
            ],
        ],

        'pusher' => [
            'driver' => 'pusher',
            'key' => env('PUSHER_APP_KEY'),
            'secret' => env('PUSHER_APP_SECRET'),
            'app_id' => env('PUSHER_APP_ID'),
            'options' => [
                'cluster' => env('PUSHER_APP_CLUSTER'),
                'host' => env('PUSHER_HOST') ?: 'api-'.env('PUSHER_APP_CLUSTER', 'mt1').'.pusher.com',
                'port' => env('PUSHER_PORT', 443),
                'scheme' => env('PUSHER_SCHEME', 'https'),
                'encrypted' => true,
                'useTLS' => env('PUSHER_SCHEME', 'https') === 'https',
            ],
            'client_options' => [
                // Guzzle client options: https://docs.guzzlephp.org/en/stable/request-options.html
            ],
        ],

        'ably' => [
            'driver' => 'ably',
            'key' => env('ABLY_KEY'),
        ],

        'log' => [
            'driver' => 'log',
        ],

        'null' => [
            'driver' => 'null',
        ],

    ],

];
----
--config/cache.php
<?php

use Illuminate\Support\Str;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Cache Store
    |--------------------------------------------------------------------------
    |
    | This option controls the default cache store that will be used by the
    | framework. This connection is utilized if another isn't explicitly
    | specified when running a cache operation inside the application.
    |
    */

    'default' => env('CACHE_DRIVER', 'database'),

    /*
    |--------------------------------------------------------------------------
    | Cache Stores
    |--------------------------------------------------------------------------
    |
    | Here you may define all of the cache "stores" for your application as
    | well as their drivers. You may even define multiple stores for the
    | same cache driver to group types of items stored in your caches.
    |
    | Supported drivers: "array", "database", "file", "memcached",
    |                    "redis", "dynamodb", "octane", "null"
    |
    */

    'stores' => [

        'array' => [
            'driver' => 'array',
            'serialize' => false,
        ],

        'database' => [
            'driver' => 'database',
            'connection' => env('DB_CACHE_CONNECTION'),
            'table' => env('DB_CACHE_TABLE', 'cache'),
            'lock_connection' => env('DB_CACHE_LOCK_CONNECTION'),
            'lock_table' => env('DB_CACHE_LOCK_TABLE'),
        ],

        'file' => [
            'driver' => 'file',
            'path' => storage_path('framework/cache/data'),
            'lock_path' => storage_path('framework/cache/data'),
        ],

        'memcached' => [
            'driver' => 'memcached',
            'persistent_id' => env('MEMCACHED_PERSISTENT_ID'),
            'sasl' => [
                env('MEMCACHED_USERNAME'),
                env('MEMCACHED_PASSWORD'),
            ],
            'options' => [
                // Memcached::OPT_CONNECT_TIMEOUT => 2000,
            ],
            'servers' => [
                [
                    'host' => env('MEMCACHED_HOST', '127.0.0.1'),
                    'port' => env('MEMCACHED_PORT', 11211),
                    'weight' => 100,
                ],
            ],
        ],

        'redis' => [
            'driver' => 'redis',
            'connection' => env('REDIS_CACHE_CONNECTION', 'cache'),
            'lock_connection' => env('REDIS_CACHE_LOCK_CONNECTION', 'default'),
        ],

        'dynamodb' => [
            'driver' => 'dynamodb',
            'key' => env('AWS_ACCESS_KEY_ID'),
            'secret' => env('AWS_SECRET_ACCESS_KEY'),
            'region' => env('AWS_DEFAULT_REGION', 'us-east-1'),
            'table' => env('DYNAMODB_CACHE_TABLE', 'cache'),
            'endpoint' => env('DYNAMODB_ENDPOINT'),
        ],

        'octane' => [
            'driver' => 'octane',
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Cache Key Prefix
    |--------------------------------------------------------------------------
    |
    | When utilizing the APC, database, memcached, Redis, and DynamoDB cache
    | stores, there might be other applications using the same cache. For
    | that reason, you may prefix every cache key to avoid collisions.
    |
    */

    'prefix' => env('CACHE_PREFIX', Str::slug((string) env('APP_NAME', 'laravel')).'-cache-'),

];
----
--config/cors.php
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | CORS Paths
    |--------------------------------------------------------------------------
    |
    | Here you may configure your settings for cross-origin resource sharing
    | or "CORS". This determines what cross-origin operations may execute
    | in web browsers. You are free to adjust these settings as needed.
    |
    | To learn more: https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS
    |
    */

    'paths' => ['api/*'],

    'allowed_methods' => ['*'],

    'allowed_origins' => [env('FRONTEND_URL', 'http://localhost:5173')],

    'allowed_origins_patterns' => [],

    'allowed_headers' => ['*'],

    'exposed_headers' => [],

    'max_age' => 0,

    'supports_credentials' => true,

];
----
--config/database.php
<?php

use Illuminate\Support\Str;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Database Connection Name
    |--------------------------------------------------------------------------
    |
    | Here you may specify which of the database connections below you wish
    | to use as your default connection for database operations. This is
    | the connection which will be utilized unless another connection
    | is explicitly specified when you execute a query / statement.
    |
    */

    'default' => env('APP_ENV') === 'testing' ? 'testing' : env('DB_CONNECTION', 'mysql'),

    /*
    |--------------------------------------------------------------------------
    | Database Connections
    |--------------------------------------------------------------------------
    |
    | Below are all of the database connections defined for your application.
    | An example configuration is provided for each database system which
    | is supported by Laravel. You're free to add / remove connections.
    |
    */

    'connections' => [

        'testing' => [
            'driver' => env('DB_CONNECTION', 'sqlite'),
            'database' => env('DB_DATABASE', database_path('database.sqlite')),
            'prefix' => '',
            'foreign_key_constraints' => true,
        ],


        'sqlite' => [
            'driver' => 'sqlite',
            'url' => env('DB_URL'),
            'database' => env('DB_DATABASE', database_path('database.sqlite')),
            'prefix' => '',
            'foreign_key_constraints' => env('DB_FOREIGN_KEYS', true),
            'busy_timeout' => null,
            'journal_mode' => null,
            'synchronous' => null,
            'transaction_mode' => 'DEFERRED',
        ],

        'mysql' => [
            'driver' => 'mysql',
            'url' => env('DB_URL'),
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '3306'),
            'database' => env('DB_DATABASE', 'laravel'),
            'username' => env('DB_USERNAME', 'root'),
            'password' => env('DB_PASSWORD', ''),
            'unix_socket' => env('DB_SOCKET', ''),
            'charset' => env('DB_CHARSET', 'utf8mb4'),
            'collation' => env('DB_COLLATION', 'utf8mb4_unicode_ci'),
            'prefix' => '',
            'prefix_indexes' => true,
            'strict' => true,
            'engine' => null,
            'options' => extension_loaded('pdo_mysql') ? array_filter([
                PDO::MYSQL_ATTR_SSL_CA => env('MYSQL_ATTR_SSL_CA'),
            ]) : [],
        ],

        'mariadb' => [
            'driver' => 'mariadb',
            'url' => env('DB_URL'),
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '3306'),
            'database' => env('DB_DATABASE', 'laravel'),
            'username' => env('DB_USERNAME', 'root'),
            'password' => env('DB_PASSWORD', ''),
            'unix_socket' => env('DB_SOCKET', ''),
            'charset' => env('DB_CHARSET', 'utf8mb4'),
            'collation' => env('DB_COLLATION', 'utf8mb4_unicode_ci'),
            'prefix' => '',
            'prefix_indexes' => true,
            'strict' => true,
            'engine' => null,
            'options' => extension_loaded('pdo_mysql') ? array_filter([
                PDO::MYSQL_ATTR_SSL_CA => env('MYSQL_ATTR_SSL_CA'),
            ]) : [],
        ],

        'pgsql' => [
            'driver' => 'pgsql',
            'url' => env('DB_URL'),
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '5432'),
            'database' => env('DB_DATABASE', 'laravel'),
            'username' => env('DB_USERNAME', 'root'),
            'password' => env('DB_PASSWORD', ''),
            'charset' => env('DB_CHARSET', 'utf8'),
            'prefix' => '',
            'prefix_indexes' => true,
            'search_path' => 'public',
            'sslmode' => 'prefer',
        ],

        'sqlsrv' => [
            'driver' => 'sqlsrv',
            'url' => env('DB_URL'),
            'host' => env('DB_HOST', 'localhost'),
            'port' => env('DB_PORT', '1433'),
            'database' => env('DB_DATABASE', 'laravel'),
            'username' => env('DB_USERNAME', 'root'),
            'password' => env('DB_PASSWORD', ''),
            'charset' => env('DB_CHARSET', 'utf8'),
            'prefix' => '',
            'prefix_indexes' => true,
            // 'encrypt' => env('DB_ENCRYPT', 'yes'),
            // 'trust_server_certificate' => env('DB_TRUST_SERVER_CERTIFICATE', 'false'),
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Migration Repository Table
    |--------------------------------------------------------------------------
    |
    | This table keeps track of all the migrations that have already run for
    | your application. Using this information, we can determine which of
    | the migrations on disk haven't actually been run on the database.
    |
    */

    'migrations' => [
        'table' => 'migrations',
        'update_date_on_publish' => true,
    ],

    /*
    |------------------------------------------------.--------------------------
    | Redis Databases
    |--------------------------------------------------------------------------
    |
    | Redis is an open source, fast, and advanced key-value store that also
    | provides a richer body of commands than a typical key-value system
    | such as Memcached. You may define your connection settings here.
    |
    */

    'redis' => [

        'client' => env('REDIS_CLIENT', 'phpredis'),

        'options' => [
            'cluster' => env('REDIS_CLUSTER', 'redis'),
            'prefix' => env('REDIS_PREFIX', Str::slug((string) env('APP_NAME', 'laravel')).'-database-'),
            'persistent' => env('REDIS_PERSISTENT', false),
        ],

        'default' => [
            'url' => env('REDIS_URL'),
            'host' => env('REDIS_HOST', '127.0.0.1'),
            'username' => env('REDIS_USERNAME'),
            'password' => env('REDIS_PASSWORD'),
            'port' => env('REDIS_PORT', '6379'),
            'database' => env('REDIS_DB', '0'),
            'max_retries' => env('REDIS_MAX_RETRIES', 3),
            'backoff_algorithm' => env('REDIS_BACKOFF_ALGORITHM', 'decorrelated_jitter'),
            'backoff_base' => env('REDIS_BACKOFF_BASE', 100),
            'backoff_cap' => env('REDIS_BACKOFF_CAP', 1000),
        ],

        'cache' => [
            'url' => env('REDIS_URL'),
            'host' => env('REDIS_HOST', '127.0.0.1'),
            'username' => env('REDIS_USERNAME'),
            'password' => env('REDIS_PASSWORD'),
            'port' => env('REDIS_PORT', '6379'),
            'database' => env('REDIS_CACHE_DB', '1'),
            'max_retries' => env('REDIS_MAX_RETRIES', 3),
            'backoff_algorithm' => env('REDIS_BACKOFF_ALGORITHM', 'decorrelated_jitter'),
            'backoff_base' => env('REDIS_BACKOFF_BASE', 100),
            'backoff_cap' => env('REDIS_BACKOFF_CAP', 1000),
        ],

    ],

];
----
--config/filesystems.php
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Default Filesystem Disk
    |--------------------------------------------------------------------------
    */

    'default' => env('FILESYSTEM_DISK', 'public'),

    /*
    |--------------------------------------------------------------------------
    | Filesystem Disks
    |--------------------------------------------------------------------------
    |
    | Supported drivers: "local", "ftp", "sftp", "s3"
    |
    */

    'disks' => [

        // PRIVATE storage (not public)
        'local' => [
            'driver' => 'local',
            'root'  => storage_path('app/private'),
            'throw' => false,
        ],

        // STANDARD PUBLIC storage (Laravel's default)
        'public' => [
            'driver'     => 'local',
            'root'       => storage_path('app/public'),
            'url'        => env('APP_URL') . '/storage',
            'visibility' => 'public',
            'throw'      => false,
        ],

        // AWS S3 (if you use later)
        's3' => [
            'driver'                  => 's3',
            'key'                     => env('AWS_ACCESS_KEY_ID'),
            'secret'                  => env('AWS_SECRET_ACCESS_KEY'),
            'region'                  => env('AWS_DEFAULT_REGION'),
            'bucket'                  => env('AWS_BUCKET'),
            'url'                     => env('AWS_URL'),
            'endpoint'                => env('AWS_ENDPOINT'),
            'use_path_style_endpoint' => env('AWS_USE_PATH_STYLE_ENDPOINT', false),
            'throw'                   => false,
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Storage Symlinks
    |--------------------------------------------------------------------------
    */

    'links' => [
        public_path('storage') => storage_path('app/public'),
    ],
];
----
--config/logging.php
<?php

use Monolog\Handler\NullHandler;
use Monolog\Handler\StreamHandler;
use Monolog\Handler\SyslogUdpHandler;
use Monolog\Processor\PsrLogMessageProcessor;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Log Channel
    |--------------------------------------------------------------------------
    |
    | This option defines the default log channel that is utilized to write
    | messages to your logs. The value provided here should match one of
    | the channels present in the list of "channels" configured below.
    |
    */

    'default' => env('LOG_CHANNEL', 'stack'),

    /*
    |--------------------------------------------------------------------------
    | Deprecations Log Channel
    |--------------------------------------------------------------------------
    |
    | This option controls the log channel that should be used to log warnings
    | regarding deprecated PHP and library features. This allows you to get
    | your application ready for upcoming major versions of dependencies.
    |
    */

    'deprecations' => [
        'channel' => env('LOG_DEPRECATIONS_CHANNEL', 'null'),
        'trace' => env('LOG_DEPRECATIONS_TRACE', false),
    ],

    /*
    |--------------------------------------------------------------------------
    | Log Channels
    |--------------------------------------------------------------------------
    |
    | Here you may configure the log channels for your application. Laravel
    | utilizes the Monolog PHP logging library, which includes a variety
    | of powerful log handlers and formatters that you're free to use.
    |
    | Available drivers: "single", "daily", "slack", "syslog",
    |                    "errorlog", "monolog", "custom", "stack"
    |
    */

    'channels' => [

        'stack' => [
            'driver' => 'stack',
            'channels' => explode(',', (string) env('LOG_STACK', 'single')),
            'ignore_exceptions' => false,
        ],

        'single' => [
            'driver' => 'single',
            'path' => storage_path('logs/laravel.log'),
            'level' => env('LOG_LEVEL', 'debug'),
            'replace_placeholders' => true,
        ],

        'daily' => [
            'driver' => 'daily',
            'path' => storage_path('logs/laravel.log'),
            'level' => env('LOG_LEVEL', 'debug'),
            'days' => env('LOG_DAILY_DAYS', 14),
            'replace_placeholders' => true,
        ],

        'slack' => [
            'driver' => 'slack',
            'url' => env('LOG_SLACK_WEBHOOK_URL'),
            'username' => env('LOG_SLACK_USERNAME', 'Laravel Log'),
            'emoji' => env('LOG_SLACK_EMOJI', ':boom:'),
            'level' => env('LOG_LEVEL', 'critical'),
            'replace_placeholders' => true,
        ],

        'papertrail' => [
            'driver' => 'monolog',
            'level' => env('LOG_LEVEL', 'debug'),
            'handler' => env('LOG_PAPERTRAIL_HANDLER', SyslogUdpHandler::class),
            'handler_with' => [
                'host' => env('PAPERTRAIL_URL'),
                'port' => env('PAPERTRAIL_PORT'),
                'connectionString' => 'tls://'.env('PAPERTRAIL_URL').':'.env('PAPERTRAIL_PORT'),
            ],
            'processors' => [PsrLogMessageProcessor::class],
        ],

        'stderr' => [
            'driver' => 'monolog',
            'level' => env('LOG_LEVEL', 'debug'),
            'handler' => StreamHandler::class,
            'handler_with' => [
                'stream' => 'php://stderr',
            ],
            'formatter' => env('LOG_STDERR_FORMATTER'),
            'processors' => [PsrLogMessageProcessor::class],
        ],

        'syslog' => [
            'driver' => 'syslog',
            'level' => env('LOG_LEVEL', 'debug'),
            'facility' => env('LOG_SYSLOG_FACILITY', LOG_USER),
            'replace_placeholders' => true,
        ],

        'errorlog' => [
            'driver' => 'errorlog',
            'level' => env('LOG_LEVEL', 'debug'),
            'replace_placeholders' => true,
        ],

        'null' => [
            'driver' => 'monolog',
            'handler' => NullHandler::class,
        ],

        'emergency' => [
            'path' => storage_path('logs/laravel.log'),
        ],

    ],

];
----
--config/mail.php
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Default Mailer
    |--------------------------------------------------------------------------
    |
    | This option controls the default mailer that is used to send all email
    | messages unless another mailer is explicitly specified when sending
    | the message. All additional mailers can be configured within the
    | "mailers" array. Examples of each type of mailer are provided.
    |
    */

    'default' => env('MAIL_MAILER', 'log'),

    /*
    |--------------------------------------------------------------------------
    | Mailer Configurations
    |--------------------------------------------------------------------------
    |
    | Here you may configure all of the mailers used by your application plus
    | their respective settings. Several examples have been configured for
    | you and you are free to add your own as your application requires.
    |
    | Laravel supports a variety of mail "transport" drivers that can be used
    | when delivering an email. You may specify which one you're using for
    | your mailers below. You may also add additional mailers if needed.
    |
    | Supported: "smtp", "sendmail", "mailgun", "ses", "ses-v2",
    |            "postmark", "resend", "log", "array",
    |            "failover", "roundrobin"
    |
    */

    'mailers' => [

        'smtp' => [
            'transport' => 'smtp',
            'scheme' => env('MAIL_SCHEME'),
            'url' => env('MAIL_URL'),
            'host' => env('MAIL_HOST', '127.0.0.1'),
            'port' => env('MAIL_PORT', 2525),
            'username' => env('MAIL_USERNAME'),
            'password' => env('MAIL_PASSWORD'),
            'timeout' => null,
            'local_domain' => env('MAIL_EHLO_DOMAIN', parse_url((string) env('APP_URL', 'http://localhost'), PHP_URL_HOST)),
        ],

        'ses' => [
            'transport' => 'ses',
        ],

        'postmark' => [
            'transport' => 'postmark',
            // 'message_stream_id' => env('POSTMARK_MESSAGE_STREAM_ID'),
            // 'client' => [
            //     'timeout' => 5,
            // ],
        ],

        'resend' => [
            'transport' => 'resend',
        ],

        'sendmail' => [
            'transport' => 'sendmail',
            'path' => env('MAIL_SENDMAIL_PATH', '/usr/sbin/sendmail -bs -i'),
        ],

        'log' => [
            'transport' => 'log',
            'channel' => env('MAIL_LOG_CHANNEL'),
        ],

        'array' => [
            'transport' => 'array',
        ],

        'failover' => [
            'transport' => 'failover',
            'mailers' => [
                'smtp',
                'log',
            ],
            'retry_after' => 60,
        ],

        'roundrobin' => [
            'transport' => 'roundrobin',
            'mailers' => [
                'ses',
                'postmark',
            ],
            'retry_after' => 60,
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Global "From" Address
    |--------------------------------------------------------------------------
    |
    | You may wish for all emails sent by your application to be sent from
    | the same address. Here you may specify a name and address that is
    | used globally for all emails that are sent by your application.
    |
    */

    'from' => [
        'address' => env('MAIL_FROM_ADDRESS', 'hello@example.com'),
        'name' => env('MAIL_FROM_NAME', 'Example'),
    ],

];
----
--config/media-privacy.php
<?php

use App\Domains\Users\Models\UserVerification;

return [
    /*
    |--------------------------------------------------------------------------
    | Media Privacy Settings
    |--------------------------------------------------------------------------
    |
    | This array maps models to their default media privacy.
    | Supported values: 'public', 'private'.
    |
    | - 'public': Media can be viewed by anyone. No authorization checks.
    | - 'private': Media can only be viewed by authorized users.
    |              This requires a policy to be defined for the Media model.
    |
    */

    'default' => 'private',

    'models' => [
        UserVerification::class => 'private',
        // Example of a public model
        // \App\Domains\Listings\Models\Service::class => 'public',
    ],
];
----
--config/mediable.php
<?php

return [
    /*
     * The database connection name to use
     *
     * Set to `null` in order to use the default database connection
     */
    'connection_name' => null,

    /*
     * FQCN of the model to use for media
     *
     * Should extend `Plank\Mediable\Media`
     */
    'model' => Plank\Mediable\Media::class,

    /*
     * Name to be used for mediables joining table
     */
    'mediables_table' => 'mediables',

    /*
     * Filesystem disk to use if none is specified
     */
    'default_disk' => 'public',

    /*
     * Filesystems that can be used for media storage
     *
     * Uploader will throw an exception if a disk not in this list is selected
     */
    'allowed_disks' => [
        'public',
        'local',
    ],

    /*
     * The maximum file size in bytes for a single uploaded file
     */
    'max_size' => 1024 * 1024 * 10,

    /*
     * What to do if a duplicate file is uploaded.
     *
     * Options include:
     *
     * * `'increment'`: the new file's name is given an incrementing suffix
     * * `'replace'` : the old file and media model is deleted
     * * `'error'`: an Exception is thrown
     */
    'on_duplicate' => Plank\Mediable\MediaUploader::ON_DUPLICATE_INCREMENT,

    /*
     * Reject files unless both their mime and extension are recognized and both match a single aggregate type
     */
    'strict_type_checking' => false,

    /*
     * Reject files whose mime type or extension is not recognized
     * if true, files will be given a type of `'other'`
     */
    'allow_unrecognized_types' => false,

    /**
     * Prefer the client-provided MIME type over the one inferred from the file contents, if provided
     * May be slightly faster to compute, but is not guaranteed to be accurate if the source is untrusted
     */
    'prefer_client_mime_type' => false,

    /*
     * Only allow files with specific MIME type(s) to be uploaded
     */
    'allowed_mime_types' => [],

    /*
     * Only allow files with specific file extension(s) to be uploaded
     */
    'allowed_extensions' => [],

    /*
     * Only allow files matching specific aggregate type(s) to be uploaded
     */
    'allowed_aggregate_types' => [],

    /*
     * List of aggregate types recognized by the application
     *
     * Each type should list the MIME types and extensions
     * that should be recognized for the type
     */
    'aggregate_types' => [
        Plank\Mediable\Media::TYPE_IMAGE => [
            'mime_types' => [
                'image/jpeg',
                'image/png',
                'image/gif',
                'image/heic',
            ],
            'extensions' => [
                'jpg',
                'jpeg',
                'png',
                'gif',
                'heic',
            ]
        ],
        Plank\Mediable\Media::TYPE_IMAGE_VECTOR => [
            'mime_types' => [
                'image/svg+xml',
            ],
            'extensions' => [
                'svg',
            ]
        ],
        Plank\Mediable\Media::TYPE_PDF => [
            'mime_types' => [
                'application/pdf',
            ],
            'extensions' => [
                'pdf',
            ]
        ],
        Plank\Mediable\Media::TYPE_AUDIO => [
            'mime_types' => [
                'audio/aac',
                'audio/ogg',
                'audio/mpeg',
                'audio/mp3',
                'audio/mpeg',
                'audio/wav'
            ],
            'extensions' => [
                'aac',
                'ogg',
                'oga',
                'mp3',
                'wav',
            ]
        ],
        Plank\Mediable\Media::TYPE_VIDEO => [
            'mime_types' => [
                'video/mp4',
                'video/mpeg',
                'video/ogg',
                'video/webm'
            ],
            'extensions' => [
                'mp4',
                'm4v',
                'mov',
                'ogv',
                'webm'
            ]
        ],
        Plank\Mediable\Media::TYPE_ARCHIVE => [
            'mime_types' => [
                'application/zip',
                'application/x-compressed-zip',
                'multipart/x-zip',
            ],
            'extensions' => [
                'zip',
            ]
        ],
        Plank\Mediable\Media::TYPE_DOCUMENT => [
            'mime_types' => [
                'text/plain',
                'application/plain',
                'text/xml',
                'text/json',
                'application/json',
                'application/msword',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
            ],
            'extensions' => [
                'doc',
                'docx',
                'txt',
                'text',
                'xml',
                'json',
            ]
        ],
        Plank\Mediable\Media::TYPE_SPREADSHEET => [
            'mime_types' => [
                'application/vnd.ms-excel',
                'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
            ],
            'extensions' => [
                'xls',
                'xlsx',
            ]
        ],
        Plank\Mediable\Media::TYPE_PRESENTATION => [
            'mime_types' =>
                [
                    'application/vnd.ms-powerpoint',
                    'application/vnd.openxmlformats-officedocument.presentationml.presentation',
                    'application/vnd.openxmlformats-officedocument.presentationml.slideshow'
                ],
            'extensions' =>
                [
                    'ppt',
                    'pptx',
                    'ppsx',
                ]
        ],
    ],

    /*
     * List of adapters to use for various source inputs
     *
     * Adapters can map either to a class or a pattern (regex)
     */
    'source_adapters' => [
        'class' => [
            Symfony\Component\HttpFoundation\File\UploadedFile::class => Plank\Mediable\SourceAdapters\UploadedFileAdapter::class,
            Symfony\Component\HttpFoundation\File\File::class => Plank\Mediable\SourceAdapters\FileAdapter::class,
            Psr\Http\Message\StreamInterface::class => Plank\Mediable\SourceAdapters\StreamAdapter::class,
        ],
        'pattern' => [
            '^https?://' => Plank\Mediable\SourceAdapters\RemoteUrlAdapter::class,
            '^/' => Plank\Mediable\SourceAdapters\LocalPathAdapter::class,
            '^[a-zA-Z]:\\\\' => Plank\Mediable\SourceAdapters\LocalPathAdapter::class,
            '^data:/?/?[^,]*,' => Plank\Mediable\SourceAdapters\DataUrlAdapter::class,
        ],
    ],

    /*
     * List of URL Generators to use for handling various filesystem drivers
     *
     */
    'url_generators' => [
        'local' => Plank\Mediable\UrlGenerators\LocalUrlGenerator::class,
        's3' => Plank\Mediable\UrlGenerators\S3UrlGenerator::class,
    ],

    /**
     * Should mediable instances automatically reload their media relationships after modification are made to a tag.
     *
     * If true, will automatically reload media the next time `getMedia()`, `getMediaMatchAll()` or `getAllMediaByTag()` are called.
     */
    'rehydrate_media' => true,

    /**
     * Detach associated media when mediable model is soft deleted.
     */
    'detach_on_soft_delete' => false,

    /**
     * Prevents loading migrations from the package.
     *
     * Use this if you are renaming the published migrations and want to prevent them from being loaded twice.
     */
    'ignore_migrations' => false,

    /**
     * Configuration for image optimization
     */
    'image_optimization' => [
        /**
         * Whether to apply image optimization after performing image manipulations by default
         */
        'enabled' => true,
        /**
         * array of optimizers to use, which should implement \Spatie\ImageOptimizer\Optimizer
         * Each can be passed an array of command line arguments to be passed to the optimizer
         */
        'optimizers' => [
            \Spatie\ImageOptimizer\Optimizers\Jpegoptim::class => [
                '--max=85',
                '--strip-all',
                '--all-progressive',
            ],
            \Spatie\ImageOptimizer\Optimizers\Pngquant::class => [
                '--quality=85',
                '--force',
                '--skip-if-larger',
            ],
            \Spatie\ImageOptimizer\Optimizers\Optipng::class => [
                '-i0',
                '-o2',
                '-quiet',
            ],
            \Spatie\ImageOptimizer\Optimizers\Gifsicle::class => [
                '-b',
                '-O3',
            ],
            \Spatie\ImageOptimizer\Optimizers\Cwebp::class => [
                '-q 80',
                '-m 6',
                '-pass 10',
                '-mt',
            ],
            \Spatie\ImageOptimizer\Optimizers\Avifenc::class => [
                '-a cq-level=23',
                '-j all',
                '--min 0',
                '--max 63',
                '--minalpha 0',
                '--maxalpha 63',
                '-a end-usage=q',
                '-a tune=ssim',
            ],
        ],
    ]
];
----
--config/payment.php
<?php

return [
    'xendit' => [
        'api_key' => env('XENDIT_API_KEY'),
        'webhook_token' => env('XENDIT_WEBHOOK_TOKEN'),
    ],
    'platform_fee' => [
        'percentage' => 5, // 5%
    ],
];
----
--config/permission.php
<?php

return [

    'models' => [

        /*
         * When using the "HasPermissions" trait from this package, we need to know which
         * Eloquent model should be used to retrieve your permissions. Of course, it
         * is often just the "Permission" model but you may use whatever you like.
         *
         * The model you want to use as a Permission model needs to implement the
         * `Spatie\Permission\Contracts\Permission` contract.
         */

        'permission' => Spatie\Permission\Models\Permission::class,

        /*
         * When using the "HasRoles" trait from this package, we need to know which
         * Eloquent model should be used to retrieve your roles. Of course, it
         * is often just the "Role" model but you may use whatever you like.
         *
         * The model you want to use as a Role model needs to implement the
         * `Spatie\Permission\Contracts\Role` contract.
         */

        'role' => Spatie\Permission\Models\Role::class,

    ],

    'table_names' => [

        /*
         * When using the "HasRoles" trait from this package, we need to know which
         * table should be used to retrieve your roles. We have chosen a basic
         * default value but you may easily change it to any table you like.
         */

        'roles' => 'roles',

        /*
         * When using the "HasPermissions" trait from this package, we need to know which
         * table should be used to retrieve your permissions. We have chosen a basic
         * default value but you may easily change it to any table you like.
         */

        'permissions' => 'permissions',

        /*
         * When using the "HasPermissions" trait from this package, we need to know which
         * table should be used to retrieve your models permissions. We have chosen a
         * basic default value but you may easily change it to any table you like.
         */

        'model_has_permissions' => 'model_has_permissions',

        /*
         * When using the "HasRoles" trait from this package, we need to know which
         * table should be used to retrieve your models roles. We have chosen a
         * basic default value but you may easily change it to any table you like.
         */

        'model_has_roles' => 'model_has_roles',

        /*
         * When using the "HasRoles" trait from this package, we need to know which
         * table should be used to retrieve your roles permissions. We have chosen a
         * basic default value but you may easily change it to any table you like.
         */

        'role_has_permissions' => 'role_has_permissions',
    ],

    'column_names' => [
        /*
         * Change this if you want to name the related pivots other than defaults
         */
        'role_pivot_key' => null, // default 'role_id',
        'permission_pivot_key' => null, // default 'permission_id',

        /*
         * Change this if you want to name the related model primary key other than
         * `model_id`.
         *
         * For example, this would be nice if your primary keys are all UUIDs. In
         * that case, name this `model_uuid`.
         */

        'model_morph_key' => 'model_id',

        /*
         * Change this if you want to use the teams feature and your related model's
         * foreign key is other than `team_id`.
         */

        'team_foreign_key' => 'team_id',
    ],

    /*
     * When set to true, the method for checking permissions will be registered on the gate.
     * Set this to false if you want to implement custom logic for checking permissions.
     */

    'register_permission_check_method' => true,

    /*
     * When set to true, Laravel\Octane\Events\OperationTerminated event listener will be registered
     * this will refresh permissions on every TickTerminated, TaskTerminated and RequestTerminated
     * NOTE: This should not be needed in most cases, but an Octane/Vapor combination benefited from it.
     */
    'register_octane_reset_listener' => false,

    /*
     * Events will fire when a role or permission is assigned/unassigned:
     * \Spatie\Permission\Events\RoleAttached
     * \Spatie\Permission\Events\RoleDetached
     * \Spatie\Permission\Events\PermissionAttached
     * \Spatie\Permission\Events\PermissionDetached
     *
     * To enable, set to true, and then create listeners to watch these events.
     */
    'events_enabled' => false,

    /*
     * Teams Feature.
     * When set to true the package implements teams using the 'team_foreign_key'.
     * If you want the migrations to register the 'team_foreign_key', you must
     * set this to true before doing the migration.
     * If you already did the migration then you must make a new migration to also
     * add 'team_foreign_key' to 'roles', 'model_has_roles', and 'model_has_permissions'
     * (view the latest version of this package's migration file)
     */

    'teams' => false,

    /*
     * The class to use to resolve the permissions team id
     */
    'team_resolver' => \Spatie\Permission\DefaultTeamResolver::class,

    /*
     * Passport Client Credentials Grant
     * When set to true the package will use Passports Client to check permissions
     */

    'use_passport_client_credentials' => false,

    /*
     * When set to true, the required permission names are added to exception messages.
     * This could be considered an information leak in some contexts, so the default
     * setting is false here for optimum safety.
     */

    'display_permission_in_exception' => false,

    /*
     * When set to true, the required role names are added to exception messages.
     * This could be considered an information leak in some contexts, so the default
     * setting is false here for optimum safety.
     */

    'display_role_in_exception' => false,

    /*
     * By default wildcard permission lookups are disabled.
     * See documentation to understand supported syntax.
     */

    'enable_wildcard_permission' => false,

    /*
     * The class to use for interpreting wildcard permissions.
     * If you need to modify delimiters, override the class and specify its name here.
     */
    // 'wildcard_permission' => Spatie\Permission\WildcardPermission::class,

    /* Cache-specific settings */

    'cache' => [

        /*
         * By default all permissions are cached for 24 hours to speed up performance.
         * When permissions or roles are updated the cache is flushed automatically.
         */

        'expiration_time' => \DateInterval::createFromDateString('24 hours'),

        /*
         * The cache key used to store all permissions.
         */

        'key' => 'spatie.permission.cache',

        /*
         * You may optionally indicate a specific cache driver to use for permission and
         * role caching using any of the `store` drivers listed in the cache.php config
         * file. Using 'default' here means to use the `default` set in cache.php.
         */

        'store' => 'default',
    ],
];
----
--config/queue.php
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Default Queue Connection Name
    |--------------------------------------------------------------------------
    |
    | Laravel's queue supports a variety of backends via a single, unified
    | API, giving you convenient access to each backend using identical
    | syntax for each. The default queue connection is defined below.
    |
    */

    'default' => env('QUEUE_CONNECTION', 'database'),

    /*
    |--------------------------------------------------------------------------
    | Queue Connections
    |--------------------------------------------------------------------------
    |
    | Here you may configure the connection options for every queue backend
    | used by your application. An example configuration is provided for
    | each backend supported by Laravel. You're also free to add more.
    |
    | Drivers: "sync", "database", "beanstalkd", "sqs", "redis", "null"
    |
    */

    'connections' => [

        'sync' => [
            'driver' => 'sync',
        ],

        'database' => [
            'driver' => 'database',
            'connection' => env('DB_QUEUE_CONNECTION'),
            'table' => env('DB_QUEUE_TABLE', 'jobs'),
            'queue' => env('DB_QUEUE', 'default'),
            'retry_after' => (int) env('DB_QUEUE_RETRY_AFTER', 90),
            'after_commit' => false,
        ],

        'beanstalkd' => [
            'driver' => 'beanstalkd',
            'host' => env('BEANSTALKD_QUEUE_HOST', 'localhost'),
            'queue' => env('BEANSTALKD_QUEUE', 'default'),
            'retry_after' => (int) env('BEANSTALKD_QUEUE_RETRY_AFTER', 90),
            'block_for' => 0,
            'after_commit' => false,
        ],

        'sqs' => [
            'driver' => 'sqs',
            'key' => env('AWS_ACCESS_KEY_ID'),
            'secret' => env('AWS_SECRET_ACCESS_KEY'),
            'prefix' => env('SQS_PREFIX', 'https://sqs.us-east-1.amazonaws.com/your-account-id'),
            'queue' => env('SQS_QUEUE', 'default'),
            'suffix' => env('SQS_SUFFIX'),
            'region' => env('AWS_DEFAULT_REGION', 'us-east-1'),
            'after_commit' => false,
        ],

        'redis' => [
            'driver' => 'redis',
            'connection' => env('REDIS_QUEUE_CONNECTION', 'default'),
            'queue' => env('REDIS_QUEUE', 'default'),
            'retry_after' => (int) env('REDIS_QUEUE_RETRY_AFTER', 90),
            'block_for' => null,
            'after_commit' => false,
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Job Batching
    |--------------------------------------------------------------------------
    |
    | The following options configure the database and table that store job
    | batching information. These options can be updated to any database
    | connection and table which has been defined by your application.
    |
    */

    'batching' => [
        'database' => env('DB_CONNECTION', 'sqlite'),
        'table' => 'job_batches',
    ],

    /*
    |--------------------------------------------------------------------------
    | Failed Queue Jobs
    |--------------------------------------------------------------------------
    |
    | These options configure the behavior of failed queue job logging so you
    | can control how and where failed jobs are stored. Laravel ships with
    | support for storing failed jobs in a simple file or in a database.
    |
    | Supported drivers: "database-uuids", "dynamodb", "file", "null"
    |
    */

    'failed' => [
        'driver' => env('QUEUE_FAILED_DRIVER', 'database-uuids'),
        'database' => env('DB_CONNECTION', 'sqlite'),
        'table' => 'failed_jobs',
    ],

];
----
--config/scout.php
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Default Search Engine
    |--------------------------------------------------------------------------
    |
    | This option controls the default search connection that gets used while
    | using Laravel Scout. This connection is used when syncing all models
    | to the search service. You should adjust this based on your needs.
    |
    | Supported: "algolia", "meilisearch", "typesense",
    |            "database", "collection", "null"
    |
    */

    'driver' => env('SCOUT_DRIVER', 'database'),

    /*
    |--------------------------------------------------------------------------
    | Index Prefix
    |--------------------------------------------------------------------------
    |
    | Here you may specify a prefix that will be applied to all search index
    | names used by Scout. This prefix may be useful if you have multiple
    | "tenants" or applications sharing the same search infrastructure.
    |
    */

    'prefix' => env('SCOUT_PREFIX', ''),

    /*
    |--------------------------------------------------------------------------
    | Queue Data Syncing
    |--------------------------------------------------------------------------
    |
    | This option allows you to control if the operations that sync your data
    | with your search engines are queued. When this is set to "true" then
    | all automatic data syncing will get queued for better performance.
    |
    */

    'queue' => env('SCOUT_QUEUE', false),

    /*
    |--------------------------------------------------------------------------
    | Database Transactions
    |--------------------------------------------------------------------------
    |
    | This configuration option determines if your data will only be synced
    | with your search indexes after every open database transaction has
    | been committed, thus preventing any discarded data from syncing.
    |
    */

    'after_commit' => false,

    /*
    |--------------------------------------------------------------------------
    | Chunk Sizes
    |--------------------------------------------------------------------------
    |
    | These options allow you to control the maximum chunk size when you are
    | mass importing data into the search engine. This allows you to fine
    | tune each of these chunk sizes based on the power of the servers.
    |
    */

    'chunk' => [
        'searchable' => 500,
        'unsearchable' => 500,
    ],

    /*
    |--------------------------------------------------------------------------
    | Soft Deletes
    |--------------------------------------------------------------------------
    |
    | This option allows to control whether to keep soft deleted records in
    | the search indexes. Maintaining soft deleted records can be useful
    | if your application still needs to search for the records later.
    |
    */

    'soft_delete' => false,

    /*
    |--------------------------------------------------------------------------
    | Identify User
    |--------------------------------------------------------------------------
    |
    | This option allows you to control whether to notify the search engine
    | of the user performing the search. This is sometimes useful if the
    | engine supports any analytics based on this application's users.
    |
    | Supported engines: "algolia"
    |
    */

    'identify' => env('SCOUT_IDENTIFY', false),

    /*
    |--------------------------------------------------------------------------
    | Algolia Configuration
    |--------------------------------------------------------------------------
    |
    | Here you may configure your Algolia settings. Algolia is a cloud hosted
    | search engine which works great with Scout out of the box. Just plug
    | in your application ID and admin API key to get started searching.
    |
    */

    'algolia' => [
        'id' => env('ALGOLIA_APP_ID', ''),
        'secret' => env('ALGOLIA_SECRET', ''),
        'index-settings' => [
            // 'users' => [
            //     'searchableAttributes' => ['id', 'name', 'email'],
            //     'attributesForFaceting'=> ['filterOnly(email)'],
            // ],
        ],
    ],

    /*
    |--------------------------------------------------------------------------
    | Meilisearch Configuration
    |--------------------------------------------------------------------------
    |
    | Here you may configure your Meilisearch settings. Meilisearch is an open
    | source search engine with minimal configuration. Below, you can state
    | the host and key information for your own Meilisearch installation.
    |
    | See: https://www.meilisearch.com/docs/learn/configuration/instance_options#all-instance-options
    |
    */

    'meilisearch' => [
        'host' => env('MEILISEARCH_HOST', 'http://localhost:7700'),
        'key' => env('MEILISEARCH_KEY'),
        'index-settings' => [
            // 'users' => [
            //     'filterableAttributes'=> ['id', 'name', 'email'],
            // ],
        ],
    ],

    /*
    |--------------------------------------------------------------------------
    | Typesense Configuration
    |--------------------------------------------------------------------------
    |
    | Here you may configure your Typesense settings. Typesense is an open
    | source search engine using minimal configuration. Below, you will
    | state the host, key, and schema configuration for the instance.
    |
    */

    'typesense' => [
        'client-settings' => [
            'api_key' => env('TYPESENSE_API_KEY', 'xyz'),
            'nodes' => [
                [
                    'host' => env('TYPESENSE_HOST', 'localhost'),
                    'port' => env('TYPESENSE_PORT', '8108'),
                    'path' => env('TYPESENSE_PATH', ''),
                    'protocol' => env('TYPESENSE_PROTOCOL', 'http'),
                ],
            ],
            'nearest_node' => [
                'host' => env('TYPESENSE_HOST', 'localhost'),
                'port' => env('TYPESENSE_PORT', '8108'),
                'path' => env('TYPESENSE_PATH', ''),
                'protocol' => env('TYPESENSE_PROTOCOL', 'http'),
            ],
            'connection_timeout_seconds' => env('TYPESENSE_CONNECTION_TIMEOUT_SECONDS', 2),
            'healthcheck_interval_seconds' => env('TYPESENSE_HEALTHCHECK_INTERVAL_SECONDS', 30),
            'num_retries' => env('TYPESENSE_NUM_RETRIES', 3),
            'retry_interval_seconds' => env('TYPESENSE_RETRY_INTERVAL_SECONDS', 1),
        ],
        // 'max_total_results' => env('TYPESENSE_MAX_TOTAL_RESULTS', 1000),
        'model-settings' => [
            // User::class => [
            //     'collection-schema' => [
            //         'fields' => [
            //             [
            //                 'name' => 'id',
            //                 'type' => 'string',
            //             ],
            //             [
            //                 'name' => 'name',
            //                 'type' => 'string',
            //             ],
            //             [
            //                 'name' => 'created_at',
            //                 'type' => 'int64',
            //             ],
            //         ],
            //         'default_sorting_field' => 'created_at',
            //     ],
            //     'search-parameters' => [
            //         'query_by' => 'name'
            //     ],
            // ],
        ],
    ],

];
----
--config/services.php
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Third Party Services
    |--------------------------------------------------------------------------
    |
    | This file is for storing the credentials for third party services such
    | as Mailgun, Postmark, AWS and more. This file provides the de facto
    | location for this type of information, allowing packages to have
    | a conventional file to locate the various service credentials.
    |
    */

    'postmark' => [
        'token' => env('POSTMARK_TOKEN'),
    ],

    'resend' => [
        'key' => env('RESEND_KEY'),
    ],

    'ses' => [
        'key' => env('AWS_ACCESS_KEY_ID'),
        'secret' => env('AWS_SECRET_ACCESS_KEY'),
        'region' => env('AWS_DEFAULT_REGION', 'us-east-1'),
    ],

    'slack' => [
        'notifications' => [
            'bot_user_oauth_token' => env('SLACK_BOT_USER_OAUTH_TOKEN'),
            'channel' => env('SLACK_BOT_USER_DEFAULT_CHANNEL'),
        ],
    ],

];
----
--config/session.php
<?php

use Illuminate\Support\Str;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Session Driver
    |--------------------------------------------------------------------------
    |
    | This option determines the default session driver that is utilized for
    | incoming requests. Laravel supports a variety of storage options to
    | persist session data. Database storage is a great default choice.
    |
    | Supported: "file", "cookie", "database", "memcached",
    |            "redis", "dynamodb", "array"
    |
    */

    'driver' => env('SESSION_DRIVER', 'database'),

    /*
    |--------------------------------------------------------------------------
    | Session Lifetime
    |--------------------------------------------------------------------------
    |
    | Here you may specify the number of minutes that you wish the session
    | to be allowed to remain idle before it expires. If you want them
    | to expire immediately when the browser is closed then you may
    | indicate that via the expire_on_close configuration option.
    |
    */

    'lifetime' => (int) env('SESSION_LIFETIME', 120),

    'expire_on_close' => env('SESSION_EXPIRE_ON_CLOSE', false),

    /*
    |--------------------------------------------------------------------------
    | Session Encryption
    |--------------------------------------------------------------------------
    |
    | This option allows you to easily specify that all of your session data
    | should be encrypted before it's stored. All encryption is performed
    | automatically by Laravel and you may use the session like normal.
    |
    */

    'encrypt' => env('SESSION_ENCRYPT', false),

    /*
    |--------------------------------------------------------------------------
    | Session File Location
    |--------------------------------------------------------------------------
    |
    | When utilizing the "file" session driver, the session files are placed
    | on disk. The default storage location is defined here; however, you
    | are free to provide another location where they should be stored.
    |
    */

    'files' => storage_path('framework/sessions'),

    /*
    |--------------------------------------------------------------------------
    | Session Database Connection
    |--------------------------------------------------------------------------
    |
    | When using the "database" or "redis" session drivers, you may specify a
    | connection that should be used to manage these sessions. This should
    | correspond to a connection in your database configuration options.
    |
    */

    'connection' => env('SESSION_CONNECTION'),

    /*
    |--------------------------------------------------------------------------
    | Session Database Table
    |--------------------------------------------------------------------------
    |
    | When using the "database" session driver, you may specify the table to
    | be used to store sessions. Of course, a sensible default is defined
    | for you; however, you're welcome to change this to another table.
    |
    */

    'table' => env('SESSION_TABLE', 'sessions'),

    /*
    |--------------------------------------------------------------------------
    | Session Cache Store
    |--------------------------------------------------------------------------
    |
    | When using one of the framework's cache driven session backends, you may
    | define the cache store which should be used to store the session data
    | between requests. This must match one of your defined cache stores.
    |
    | Affects: "dynamodb", "memcached", "redis"
    |
    */

    'store' => env('SESSION_STORE'),

    /*
    |--------------------------------------------------------------------------
    | Session Sweeping Lottery
    |--------------------------------------------------------------------------
    |
    | Some session drivers must manually sweep their storage location to get
    | rid of old sessions from storage. Here are the chances that it will
    | happen on a given request. By default, the odds are 2 out of 100.
    |
    */

    'lottery' => [2, 100],

    /*
    |--------------------------------------------------------------------------
    | Session Cookie Name
    |--------------------------------------------------------------------------
    |
    | Here you may change the name of the session cookie that is created by
    | the framework. Typically, you should not need to change this value
    | since doing so does not grant a meaningful security improvement.
    |
    */

    'cookie' => env(
        'SESSION_COOKIE',
        Str::slug(env('APP_NAME', 'laravel')).'-session'
    ),

    /*
    |--------------------------------------------------------------------------
    | Session Cookie Path
    |--------------------------------------------------------------------------
    |
    | The session cookie path determines the path for which the cookie will
    | be regarded as available. Typically, this will be the root path of
    | your application, but you're free to change this when necessary.
    |
    */

    'path' => env('SESSION_PATH', '/'),

    /*
    |--------------------------------------------------------------------------
    | Session Cookie Domain
    |--------------------------------------------------------------------------
    |
    | This value determines the domain and subdomains the session cookie is
    | available to. By default, the cookie will be available to the root
    | domain and all subdomains. Typically, this shouldn't be changed.
    |
    */

    'domain' => env('SESSION_DOMAIN'),

    /*
    |--------------------------------------------------------------------------
    | HTTPS Only Cookies
    |--------------------------------------------------------------------------
    |
    | By setting this option to true, session cookies will only be sent back
    | to the server if the browser has a HTTPS connection. This will keep
    | the cookie from being sent to you when it can't be done securely.
    |
    */

    'secure' => env('SESSION_SECURE_COOKIE'),

    /*
    |--------------------------------------------------------------------------
    | HTTP Access Only
    |--------------------------------------------------------------------------
    |
    | Setting this value to true will prevent JavaScript from accessing the
    | value of the cookie and the cookie will only be accessible through
    | the HTTP protocol. It's unlikely you should disable this option.
    |
    */

    'http_only' => env('SESSION_HTTP_ONLY', true),

    /*
    |--------------------------------------------------------------------------
    | Same-Site Cookies
    |--------------------------------------------------------------------------
    |
    | This option determines how your cookies behave when cross-site requests
    | take place, and can be used to mitigate CSRF attacks. By default, we
    | will set this value to "lax" to permit secure cross-site requests.
    |
    | See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#samesitesamesite-value
    |
    | Supported: "lax", "strict", "none", null
    |
    */

    'same_site' => env('SESSION_SAME_SITE', 'lax'),

    /*
    |--------------------------------------------------------------------------
    | Partitioned Cookies
    |--------------------------------------------------------------------------
    |
    | Setting this value to true will tie the cookie to the top-level site for
    | a cross-site context. Partitioned cookies are accepted by the browser
    | when flagged "secure" and the Same-Site attribute is set to "none".
    |
    */

    'partitioned' => env('SESSION_PARTITIONED_COOKIE', false),

];
----
--database/.gitignore
--database/database.sqlite
--database/factories/AddressFactory.php
<?php

namespace Database\Factories;

use App\Domains\Common\Models\Address;
use Illuminate\Database\Eloquent\Factories\Factory;

class AddressFactory extends Factory
{
    /**
     * The name of the factory's corresponding model.
     *
     * @var string
     */
    protected $model = Address::class;

    /**
     * Define the model's default state.
     *
     * @return array
     */
    public function definition()
    {
        return [
            'house_no' => $this->faker->buildingNumber,
            'street' => $this->faker->streetName,
            'barangay' => $this->faker->citySuffix, // Using citySuffix as a proxy for barangay
            'town' => $this->faker->city,
            'province' => $this->faker->state,
            'country' => $this->faker->country,
            'lat' => $this->faker->latitude,
            'lng' => $this->faker->longitude,
        ];
    }
}
----
--database/factories/CategoryFactory.php
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use App\Domains\Listings\Models\Category;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Category>
 */
class CategoryFactory extends Factory
{

    protected $model = Category::class;

    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        return [
            'name' => $this->faker->unique()->randomElement([
                'Web Development',
                'Graphic Design',
                'Marketing',
                'Consulting',
                'Content Writing',
                'Photography',
            ]),
        ];
    }
}
----
--database/factories/OpenOfferBidFactory.php
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use App\Domains\Listings\Models\OpenOffer;
use App\Domains\Users\Models\User;
use App\Domains\Listings\Models\Category;
use App\Domains\Listings\Models\Service;


class OpenOfferBidFactory extends Factory
{

    protected $model = OpenOffer::class;    

    /**
     * Define the model's default state.
     *
     * @return array
     */
    public function definition()
    {
        return [
            'open_offer_id' => $this->faker->randomElement(OpenOffer::all())->id,
            'bidder_id' => $this->faker->randomElement(User::all())->id,
            'service_id' => $this->faker->randomElement(Service::all())->id,
            'proposed_price' => $this->faker->randomFloat(2, 0, 1000),
        ];
    }
}
----
--database/factories/OpenOfferFactory.php
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use App\Domains\Listings\Models\OpenOffer;
use App\Domains\Users\Models\User;
use App\Domains\Listings\Models\Category;
use App\Domains\Listings\Models\WorkflowTemplate;

class OpenOfferFactory extends Factory
{

    protected $model = OpenOffer::class;    

    /**
     * Define the model's default state.
     *
     * @return array
     */
    public function definition()
    {
        return [
            'title' => $this->faker->sentence(3),
            'description' => $this->faker->paragraph(),
            'budget' => $this->faker->randomFloat(2, 10, 100),
            'fulfilled' => $this->faker->boolean(30),
            'pay_first' => $this->faker->boolean(30),
            'category_id' => Category::inRandomOrder()->first()->id,
            'creator_id' => User::inRandomOrder()->first()->id,
            'workflow_template_id' => WorkflowTemplate::inRandomOrder()->first()->id,
        ];
    }
}
----
--database/factories/OrderFactory.php
<?php

namespace Database\Factories;

use App\Domains\Users\Models\User;
use App\Domains\Listings\Models\Service;
use Illuminate\Database\Eloquent\Factories\Factory;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Domains\Orders\Models\Order>
 */
class OrderFactory extends Factory
{
    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        return [
            'buyer_id' => User::factory(),
            'seller_id' => User::factory(),
            'service_id' => Service::factory(),
            'price' => $this->faker->randomFloat(2, 10, 1000),
            'total_amount' => $this->faker->randomFloat(2, 10, 1000),
            'status' => 'pending',
            'payment_status' => 'pending',
        ];
    }
}
----
--database/factories/ServiceFactory.php
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use App\Domains\Users\Models\User;
use App\Domains\Listings\Models\Service;
use App\Domains\Listings\Models\Category;
use App\Domains\Listings\Models\WorkflowTemplate;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Service>
 */
class ServiceFactory extends Factory

{

    protected $model = Service::class;

    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        return [
            'title' => $this->faker->sentence(3),
            'description' => $this->faker->paragraph(),
            'price' => $this->faker->randomFloat(2, 10, 100),
            'pay_first' => $this->faker->boolean(30),
            'category_id' => Category::inRandomOrder()->first()->id,
            'creator_id' => User::inRandomOrder()->first()->id,
            'workflow_template_id' => WorkflowTemplate::inRandomOrder()->first()->id,
        ];
    }
}
----
--database/factories/UserFactory.php
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Str;
use App\Domains\Users\Models\User;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Models\User>
 */
class UserFactory extends Factory
{

    // Current model
    protected $model = User::class;

    /**
     * The current password being used by the factory.
     */
    protected static ?string $password;

    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {   
        $firstName = fake()->firstName();
        $lastName = fake()->lastName();
        return [
            'firstname' => $firstName,
            'lastname' => $lastName,
            'email' => Str::lower($firstName . '_' . $lastName . '@example.com'),
            'email_verified_at' => now(),
            'password' => static::$password ??= Hash::make('password123'),
            'remember_token' => Str::random(10),
        ];
    }

    /**
     * Indicate that the model's email address should be unverified.
     */
    public function unverified(): static
    {
        return $this->state(fn (array $attributes) => [
            'email_verified_at' => null,
        ]);
    }
}
----
--database/factories/WorkCatalogFactory.php
<?php

namespace Database\Factories;

use App\Domains\Listings\Models\WorkCatalog;
use Illuminate\Database\Eloquent\Factories\Factory;

class WorkCatalogFactory extends Factory
{
    protected $model = WorkCatalog::class;

    public function definition(): array
    {
        return [
            'name' => $this->faker->sentence,
            'description' => $this->faker->paragraph,
            'price' => $this->faker->randomFloat(2, 10, 1000),
            'duration_minutes' => $this->faker->numberBetween(15, 240),
        ];
    }
}
----
--database/factories/WorkTemplateFactory.php
<?php

namespace Database\Factories;

use App\Domains\Listings\Models\WorkTemplate;
use App\Domains\Listings\Models\WorkflowTemplate;
use Illuminate\Database\Eloquent\Factories\Factory;

class WorkTemplateFactory extends Factory
{
    protected $model = WorkTemplate::class;

    public function definition(): array
    {
        return [
            'workflow_template_id' => WorkflowTemplate::factory(),
            'name' => $this->faker->sentence,
            'description' => $this->faker->paragraph,
            'price' => $this->faker->randomFloat(2, 10, 1000),
            'duration_minutes' => $this->faker->numberBetween(15, 240),
            'order' => $this->faker->numberBetween(0, 10),
        ];
    }
}
----
--database/factories/WorkflowTemplateFactory.php
<?php

namespace Database\Factories;

use App\Domains\Listings\Models\WorkflowTemplate;
use Illuminate\Database\Eloquent\Factories\Factory;
use App\Domains\Users\Models\User;


/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\WorkflowTemplate>
 */
class WorkflowTemplateFactory extends Factory
{

    protected $model = WorkflowTemplate::class;


    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        return [
            'name' => $this->faker->randomElement(['Basic Approval Flow', 'Advanced Approval Flow', 'Intermediate Approval Flow']),  // e.g. "Basic Approval Flow"
            'description' => $this->faker->paragraph(),
            'creator_id' =>  User::factory(), // links to users
            'is_public' => $this->faker->boolean(30), // 30% chance public
        ];
    }
}
----
--database/factories/Domains/Users/Models/UserVerificationFactory.php
<?php

namespace Database\Factories\Domains\Users\Models;

use App\Domains\Users\Models\User;
use Illuminate\Database\Eloquent\Factories\Factory;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Domains\Users\Models\UserVerification>
 */
class UserVerificationFactory extends Factory
{
    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        return [
            'user_id' => User::factory(),
            'id_type' => $this->faker->randomElement(['national_id', 'drivers_license', 'passport']),
            'id_front_path' => 'verifications/fake_front.jpg',
            'id_back_path' => 'verifications/fake_back.jpg',
            'status' => 'pending',
            'rejection_reason' => null,
            'reviewed_at' => null,
            'reviewed_by' => null,
        ];
    }
}
----
--database/migrations/0001_01_01_000000_create_users_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('users', function (Blueprint $table) {
            $table->id();
            $table->string('firstname');
            $table->string('lastname');
            $table->string('email')->unique();
            $table->timestamp('email_verified_at')->nullable();
            $table->string('password');
            $table->boolean('is_verified')->default(false);
            $table->timestamp('verified_at')->nullable();
            $table->rememberToken();
            $table->timestamps();
            $table->softDeletes();
        });

        Schema::create('password_reset_tokens', function (Blueprint $table) {
            $table->string('email')->primary();
            $table->string('token');
            $table->timestamp('created_at')->nullable();
        });

        Schema::create('sessions', function (Blueprint $table) {
            $table->string('id')->primary();
            $table->foreignId('user_id')->nullable()->index();
            $table->string('ip_address', 45)->nullable();
            $table->text('user_agent')->nullable();
            $table->longText('payload');
            $table->integer('last_activity')->index();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('users');
        Schema::dropIfExists('password_reset_tokens');
        Schema::dropIfExists('sessions');
    }
};
----
--database/migrations/0001_01_01_000001_create_cache_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('cache', function (Blueprint $table) {
            $table->string('key')->primary();
            $table->mediumText('value');
            $table->integer('expiration');
        });

        Schema::create('cache_locks', function (Blueprint $table) {
            $table->string('key')->primary();
            $table->string('owner');
            $table->integer('expiration');
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('cache');
        Schema::dropIfExists('cache_locks');
    }
};
----
--database/migrations/0001_01_01_000002_create_jobs_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('jobs', function (Blueprint $table) {
            $table->id();
            $table->string('queue')->index();
            $table->longText('payload');
            $table->unsignedTinyInteger('attempts');
            $table->unsignedInteger('reserved_at')->nullable();
            $table->unsignedInteger('available_at');
            $table->unsignedInteger('created_at');
        });

        Schema::create('job_batches', function (Blueprint $table) {
            $table->string('id')->primary();
            $table->string('name');
            $table->integer('total_jobs');
            $table->integer('pending_jobs');
            $table->integer('failed_jobs');
            $table->longText('failed_job_ids');
            $table->mediumText('options')->nullable();
            $table->integer('cancelled_at')->nullable();
            $table->integer('created_at');
            $table->integer('finished_at')->nullable();
        });

        Schema::create('failed_jobs', function (Blueprint $table) {
            $table->id();
            $table->string('uuid')->unique();
            $table->text('connection');
            $table->text('queue');
            $table->longText('payload');
            $table->longText('exception');
            $table->timestamp('failed_at')->useCurrent();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('jobs');
        Schema::dropIfExists('job_batches');
        Schema::dropIfExists('failed_jobs');
    }
};
----
--database/migrations/2025_09_13_015642_create_addresses_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('addresses', function (Blueprint $table) {
            $table->id();
            $table->string('house_no')->nullable();
            $table->string('street')->nullable();
            $table->string('barangay')->nullable();
            $table->string('town')->nullable();
            $table->string('province')->nullable();
            $table->string('country')->nullable();
            $table->decimal('lat', 10, 6)->nullable();
            $table->decimal('lng', 10, 6)->nullable();
            
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('addresses');
    }
};
----
--database/migrations/2025_09_13_025308_create_permission_tables.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        $teams = config('permission.teams');
        $tableNames = config('permission.table_names');
        $columnNames = config('permission.column_names');
        $pivotRole = $columnNames['role_pivot_key'] ?? 'role_id';
        $pivotPermission = $columnNames['permission_pivot_key'] ?? 'permission_id';

        throw_if(empty($tableNames), new Exception('Error: config/permission.php not loaded. Run [php artisan config:clear] and try again.'));
        throw_if($teams && empty($columnNames['team_foreign_key'] ?? null), new Exception('Error: team_foreign_key on config/permission.php not loaded. Run [php artisan config:clear] and try again.'));

        Schema::create($tableNames['permissions'], static function (Blueprint $table) {
            // $table->engine('InnoDB');
            $table->bigIncrements('id'); // permission id
            $table->string('name');       // For MyISAM use string('name', 225); // (or 166 for InnoDB with Redundant/Compact row format)
            $table->string('guard_name'); // For MyISAM use string('guard_name', 25);
            $table->timestamps();

            $table->unique(['name', 'guard_name']);
        });

        Schema::create($tableNames['roles'], static function (Blueprint $table) use ($teams, $columnNames) {
            // $table->engine('InnoDB');
            $table->bigIncrements('id'); // role id
            if ($teams || config('permission.testing')) { // permission.testing is a fix for sqlite testing
                $table->unsignedBigInteger($columnNames['team_foreign_key'])->nullable();
                $table->index($columnNames['team_foreign_key'], 'roles_team_foreign_key_index');
            }
            $table->string('name');       // For MyISAM use string('name', 225); // (or 166 for InnoDB with Redundant/Compact row format)
            $table->string('guard_name'); // For MyISAM use string('guard_name', 25);
            $table->timestamps();
            if ($teams || config('permission.testing')) {
                $table->unique([$columnNames['team_foreign_key'], 'name', 'guard_name']);
            } else {
                $table->unique(['name', 'guard_name']);
            }
        });

        Schema::create($tableNames['model_has_permissions'], static function (Blueprint $table) use ($tableNames, $columnNames, $pivotPermission, $teams) {
            $table->unsignedBigInteger($pivotPermission);

            $table->string('model_type');
            $table->unsignedBigInteger($columnNames['model_morph_key']);
            $table->index([$columnNames['model_morph_key'], 'model_type'], 'model_has_permissions_model_id_model_type_index');

            $table->foreign($pivotPermission)
                ->references('id') // permission id
                ->on($tableNames['permissions'])
                ->onDelete('cascade');
            if ($teams) {
                $table->unsignedBigInteger($columnNames['team_foreign_key']);
                $table->index($columnNames['team_foreign_key'], 'model_has_permissions_team_foreign_key_index');

                $table->primary([$columnNames['team_foreign_key'], $pivotPermission, $columnNames['model_morph_key'], 'model_type'],
                    'model_has_permissions_permission_model_type_primary');
            } else {
                $table->primary([$pivotPermission, $columnNames['model_morph_key'], 'model_type'],
                    'model_has_permissions_permission_model_type_primary');
            }

        });

        Schema::create($tableNames['model_has_roles'], static function (Blueprint $table) use ($tableNames, $columnNames, $pivotRole, $teams) {
            $table->unsignedBigInteger($pivotRole);

            $table->string('model_type');
            $table->unsignedBigInteger($columnNames['model_morph_key']);
            $table->index([$columnNames['model_morph_key'], 'model_type'], 'model_has_roles_model_id_model_type_index');

            $table->foreign($pivotRole)
                ->references('id') // role id
                ->on($tableNames['roles'])
                ->onDelete('cascade');
            if ($teams) {
                $table->unsignedBigInteger($columnNames['team_foreign_key']);
                $table->index($columnNames['team_foreign_key'], 'model_has_roles_team_foreign_key_index');

                $table->primary([$columnNames['team_foreign_key'], $pivotRole, $columnNames['model_morph_key'], 'model_type'],
                    'model_has_roles_role_model_type_primary');
            } else {
                $table->primary([$pivotRole, $columnNames['model_morph_key'], 'model_type'],
                    'model_has_roles_role_model_type_primary');
            }
        });

        Schema::create($tableNames['role_has_permissions'], static function (Blueprint $table) use ($tableNames, $pivotRole, $pivotPermission) {
            $table->unsignedBigInteger($pivotPermission);
            $table->unsignedBigInteger($pivotRole);

            $table->foreign($pivotPermission)
                ->references('id') // permission id
                ->on($tableNames['permissions'])
                ->onDelete('cascade');

            $table->foreign($pivotRole)
                ->references('id') // role id
                ->on($tableNames['roles'])
                ->onDelete('cascade');

            $table->primary([$pivotPermission, $pivotRole], 'role_has_permissions_permission_id_role_id_primary');
        });

        app('cache')
            ->store(config('permission.cache.store') != 'default' ? config('permission.cache.store') : null)
            ->forget(config('permission.cache.key'));
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        $tableNames = config('permission.table_names');

        if (empty($tableNames)) {
            throw new \Exception('Error: config/permission.php not found and defaults could not be merged. Please publish the package configuration before proceeding, or drop the tables manually.');
        }

        Schema::drop($tableNames['role_has_permissions']);
        Schema::drop($tableNames['model_has_roles']);
        Schema::drop($tableNames['model_has_permissions']);
        Schema::drop($tableNames['roles']);
        Schema::drop($tableNames['permissions']);
    }
};
----
--database/migrations/2025_09_30_043447_create_categories_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('categories', function (Blueprint $table) {
            $table->id();
            $table->string('name')->uniqiue()->notNullable();
            $table->text('description')->nullable();  //  add this line
            $table->timestamps();
            $table->softDeletes();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('categories');
    }
};
----
--database/migrations/2025_09_30_043448_create_workflowtemplates_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('workflow_templates', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->text('description')->nullable();
            $table->foreignId('creator_id')->constrained('users');
            $table->boolean('is_public')->default(false);
            $table->timestamps();
            $table->softDeletes();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::table('workflow_templates', function (Blueprint $table) {
            //
        });
    }
};
----
--database/migrations/2025_09_30_043449_create_services_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('services', function (Blueprint $table) {
            $table->id('id');
            $table->foreignId('creator_id')->constrained('users');
            $table->string('title');
            $table->string('description');
            $table->decimal('price', 10, 2);
            $table->foreignId('address_id')->constrained('addresses');
            $table->foreignId('category_id')->constrained();
            $table->boolean('pay_first')->default(true);
            $table->foreignId('workflow_template_id')->constrained();
            $table->timestamps();
            $table->softDeletes();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::table('services', function (Blueprint $table) {
            //
        });
    }
};
----
--database/migrations/2025_10_02_045910_create_open_offers_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('open_offers', function (Blueprint $table) {
            // 'title', 'description', 'budget', 'pay_first', 'category_id', 'creator_id', 'workflow_template_id', 'address_id'
            $table->id();
            $table->string('title');
            $table->string('description');
            $table->decimal('budget', 10, 2);
            $table->boolean('pay_first');
            $table->boolean('fulfilled');
            $table->foreignId('address_id')->constrained('addresses');
            $table->foreignId('category_id')->constrained();
            $table->foreignId('creator_id')->constrained('users');
            $table->foreignId('workflow_template_id')->constrained()->nullable();
            $table->softDeletes();
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('open_offers');
    }
};
----
--database/migrations/2025_10_08_003332_create_listing_reviews_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('listing_reviews', function (Blueprint $table) {
            $table->id();
            // morphic table
            $table->morphs('listing');
            $table->foreignId('reviewer_id')->constrained('users');
            // $table->foreignId('order_id')->constrained('orders');
            $table->integer('rating');
            $table->string('comment');
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('listing_reviews');
    }
};
----
--database/migrations/2025_10_08_004730_create_open_offer_bids_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('open_offer_bids', function (Blueprint $table) {
            $table->id();
            // open offer id, bidder id, service id, proposed price..
            $table->foreignId('open_offer_id')->constrained('open_offers');
            $table->foreignId('bidder_id')->constrained('users');
            $table->foreignId('service_id')->constrained('services');
            $table->decimal('proposed_price', 10, 2);
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('open_offer_bids');
    }
};
----
--database/migrations/2025_10_26_174121_create_user_addresses_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('user_addresses', function (Blueprint $table) {
            $table->foreignId('user_id')->constrained()->onDelete('cascade');
            $table->foreignId('address_id')->constrained()->onDelete('cascade');
            $table->boolean('is_primary')->default(false);
            $table->timestamps();
            $table->primary(['user_id', 'address_id']);
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('user_addresses');
    }
};
----
--database/migrations/2025_10_29_000831_create_work_catalogs_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('work_catalogs', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->text('description')->nullable();
            $table->json('config')->nullable();
            $table->timestamps();
        });
    }


    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('work_catalogs');
    }
};
----
--database/migrations/2025_10_29_001010_create_work_templates_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('work_templates', function (Blueprint $table) {
            $table->id();
            $table->foreignId('workflow_template_id')
                ->constrained()
                ->onDelete('cascade');
            $table->foreignId('work_catalog_id')->nullable()->constrained()->onDelete('set null');
            $table->string('name');
            $table->text('description')->nullable();
            $table->decimal('price', 8, 2)->nullable();
            $table->unsignedInteger('duration_minutes')->nullable();
            $table->unsignedInteger('order')->default(0);
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('work_templates');
    }
};
----
--database/migrations/2025_10_29_010147_create_images_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('images', function (Blueprint $table) {
            $table->id();

            // Polymorphic relation fields
            $table->morphs('imageable'); // creates imageable_id & imageable_type columns
            $table->string('collection_name')->nullable()->default('default'); // For grouping images (e.g., 'gallery', 'avatar')

            // Image attributes
            $table->string('path');             // e.g., storage path or S3 URL
            $table->string('thumbnail_path')->nullable(); // optional thumbnail
            $table->string('alt_text')->nullable();
            $table->unsignedInteger('order_index')->default(0); // for sorting images
            $table->boolean('is_primary')->default(false);

            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('images');
    }
};
----
--database/migrations/2025_11_08_134640_create_user_verifications_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('user_verifications', function (Blueprint $table) {
            $table->id();
            $table->foreignId('user_id')->constrained()->onDelete('cascade');
            $table->string('id_type');
            $table->string('status')->default('pending');
            $table->text('rejection_reason')->nullable();
            $table->foreignId('reviewed_by')->nullable()->constrained('users')->onDelete('set null');
            $table->timestamp('reviewed_at')->nullable();
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('user_verifications');
    }
};
----
--database/migrations/2025_11_11_124627_create_mediable_tables.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
use Plank\Mediable\Media;

return new class extends Migration {
    /**
     * Run the migrations.
     *
     * @return void
     */
    public function up(): void
    {
        if (!Schema::hasTable('media')) {
            Schema::create(
                'media',
                function (Blueprint $table) {
                    $table->id();
                    $table->string('disk', 32);
                    $table->string('directory');
                    $table->string('filename');
                    $table->string('extension', 32);
                    $table->string('mime_type', 128);
                    $table->string('aggregate_type', 32)->index();
                    $table->unsignedInteger('size');
                    $table->timestamps();
                    $table->unique(['disk', 'directory', 'filename', 'extension']);
                }
            );
        }

        if (!Schema::hasTable('mediables')) {
            Schema::create(
                'mediables',
                function (Blueprint $table) {
                    $table->foreignIdFor(Media::class)->constrained('media')->cascadeOnDelete();
                    $table->morphs('mediable');
                    $table->string('tag')->index();
                    $table->unsignedInteger('order')->index();
                    $table->primary(['media_id', 'mediable_type', 'mediable_id', 'tag']);
                    $table->index(['mediable_id', 'mediable_type']);
                }
            );
        }
    }

    /**
     * Reverse the migrations.
     *
     * @return void
     */
    public function down(): void
    {
        Schema::dropIfExists('mediables');
        Schema::dropIfExists('media');
    }

    /**
     * {@inheritdoc}
     */
    public function getConnection()
    {
        return config('mediable.connection_name', parent::getConnection());
    }
};
----
--database/migrations/2025_11_11_124628_add_variants_to_media.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Schema;
use Plank\Mediable\Media;

return new class extends Migration {
    /**
     * Run the migrations.
     *
     * @return void
     */
    public function up(): void
    {
        Schema::whenTableDoesntHaveColumn(
            'media',
            'variant_name',
            function (Blueprint $table) {
                $table->string('variant_name', 255)
                    ->after('size')
                    ->nullable();
            }
        );
        Schema::whenTableDoesntHaveColumn(
            'media',
            'original_media_id',
            function (Blueprint $table) {
                $table->foreignIdFor(Media::class, 'original_media_id')
                    ->nullable()
                    ->after('variant_name')
                    ->constrained('media')
                    ->nullOnDelete();
            }
        );
    }

    /**
     * Reverse the migrations.
     *
     * @return void
     */
    public function down(): void
    {
        Schema::whenTableHasColumn(
            'media',
            'original_media_id',
            function (Blueprint $table) {
                // SQLite does not support dropping foreign keys or columns with constraints
                // skip removing this column, the `whenTableDoesntHaveColumn`
                // method should make this safe to play back
                if (DB::getDriverName() !== 'sqlite') {
                    $table->dropConstrainedForeignIdFor(Media::class, 'original_media_id');
                }
            }
        );
        Schema::whenTableHasColumn(
            'media',
            'variant_name',
            function (Blueprint $table) {
                $table->dropColumn('variant_name');
            }
        );
    }

    /**
     * {@inheritdoc}
     */
    public function getConnection()
    {
        return config('mediable.connection_name', parent::getConnection());
    }
};
----
--database/migrations/2025_11_11_124629_add_alt_to_media.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Schema;
use Plank\Mediable\Media;

return new class extends Migration {
    /**
     * Run the migrations.
     *
     * @return void
     */
    public function up():void
    {
        Schema::whenTableDoesntHaveColumn(
            'media',
            'alt',
            function (Blueprint $table) {
                $table->text('alt')->nullable();
            }
        );
    }

    /**
     * Reverse the migrations.
     *
     * @return void
     */
    public function down():void
    {
        Schema::whenTableHasColumn(
            'media',
            'alt',
            function (Blueprint $table) {
                $table->dropColumn('alt');
            }
        );
    }

    /**
     * {@inheritdoc}
     */
    public function getConnection()
    {
        return config('mediable.connection_name', parent::getConnection());
    }
};
----
--database/migrations/2025_11_17_160341_create_work_instances_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('work_instances', function (Blueprint $table) {
            $table->id();
            $table->foreignId('order_id')->constrained('orders');
            $table->foreignId('workflow_template_id')->constrained('workflow_templates');
            $table->integer('current_step_index')->default(0);
            $table->string('status');
            $table->timestamp('started_at')->nullable();
            $table->timestamp('completed_at')->nullable();
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('work_instances');
    }
};
----
--database/migrations/2025_11_17_160547_create_work_instance_steps_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('work_instance_steps', function (Blueprint $table) {
            $table->id();
            $table->foreignId('work_instance_id')->constrained('work_instances');
            $table->foreignId('work_template_id')->constrained('work_templates');
            $table->integer('step_index');
            $table->string('status');
            $table->timestamp('started_at')->nullable();
            $table->timestamp('completed_at')->nullable();
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('work_instance_steps');
    }
};
----
--database/migrations/2025_11_17_161329_create_activity_threads_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('activity_threads', function (Blueprint $table) {
            $table->id();
            $table->foreignId('work_instance_step_id')->constrained('work_instance_steps');
            $table->string('title');
            $table->text('description')->nullable();
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('activity_threads');
    }
};
----
--database/migrations/2025_11_17_161340_create_activity_messages_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('activity_messages', function (Blueprint $table) {
            $table->id();
            $table->foreignId('activity_thread_id')->constrained('activity_threads');
            $table->foreignId('user_id')->constrained('users');
            $table->text('content');
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('activity_messages');
    }
};
----
--database/migrations/2025_11_17_162308_create_activity_attachments_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('activity_attachments', function (Blueprint $table) {
            $table->id();
            $table->foreignId('activity_message_id')->constrained('activity_messages');
            $table->string('file_path');
            $table->string('file_type');
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('activity_attachments');
    }
};
----
--database/migrations/2025_11_22_045041_create_payments_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('payments', function (Blueprint $table) {
            $table->id();
            $table->foreignId('order_id')->constrained()->onDelete('cascade');
            $table->foreignId('user_id')->constrained()->onDelete('cascade');
            $table->decimal('amount', 10, 2);
            $table->decimal('platform_fee', 10, 2)->default(0);
            $table->decimal('total_amount', 10, 2);
            $table->string('payment_method')->nullable();
            $table->string('provider_reference')->nullable();
            $table->string('status')->default('pending');
            $table->timestamp('paid_at')->nullable();
            $table->json('metadata')->nullable();
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('payments');
    }
};
----
--database/migrations/2025_11_22_160059_create_orders_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('orders', function (Blueprint $table) {
            $table->id();
            $table->foreignId('buyer_id')->constrained('users');
            $table->foreignId('seller_id')->constrained('users');
            $table->foreignId('service_id')->constrained('services');
            $table->foreignId('open_offer_id')->nullable()->constrained('open_offers');
            $table->foreignId('open_offer_bid_id')->nullable()->constrained('open_offer_bids');
            $table->decimal('price', 10, 2);
            $table->decimal('platform_fee', 10, 2);
            $table->decimal('total_amount', 10, 2);
            $table->string('status')->default('pending');
            $table->string('payment_status')->default('pending');
            $table->timestamp('cancelled_at')->nullable();
            $table->text('cancellation_reason')->nullable();
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('orders');
    }
};
----
--database/migrations/2025_11_22_164426_create_message_threads_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('message_threads', function (Blueprint $table) {
            $table->id();
            $table->foreignId('creator_id')->constrained('users');
            $table->string('title')->nullable();
            $table->string('parent_type');
            $table->unsignedBigInteger('parent_id');
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('message_threads');
    }
};
----
--database/migrations/2025_11_22_164521_create_messages_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('messages', function (Blueprint $table) {
            $table->id();
            $table->foreignId('thread_id')->constrained('message_threads')->onDelete('cascade');
            $table->foreignId('sender_id')->constrained('users')->onDelete('cascade');
            $table->text('content');
            $table->timestamp('read_at')->nullable();
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('messages');
    }
};
----
--database/migrations/2025_11_22_164539_create_message_attachments_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('message_attachments', function (Blueprint $table) {
            $table->id();
            $table->foreignId('message_id')->constrained('messages')->onDelete('cascade');
            $table->string('file_path');
            $table->string('file_type')->nullable();
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('message_attachments');
    }
};
----
--database/migrations/2025_11_23_152609_create_activity_log_table.php
<?php

use Illuminate\Support\Facades\Schema;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Database\Migrations\Migration;

class CreateActivityLogTable extends Migration
{
    public function up()
    {
        Schema::connection(config('activitylog.database_connection'))->create(config('activitylog.table_name'), function (Blueprint $table) {
            $table->bigIncrements('id');
            $table->string('log_name')->nullable();
            $table->text('description');
            $table->nullableMorphs('subject', 'subject');
            $table->nullableMorphs('causer', 'causer');
            $table->json('properties')->nullable();
            $table->timestamps();
            $table->index('log_name');
        });
    }

    public function down()
    {
        Schema::connection(config('activitylog.database_connection'))->dropIfExists(config('activitylog.table_name'));
    }
}
----
--database/migrations/2025_11_23_152610_add_event_column_to_activity_log_table.php
<?php

use Illuminate\Support\Facades\Schema;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Database\Migrations\Migration;

class AddEventColumnToActivityLogTable extends Migration
{
    public function up()
    {
        Schema::connection(config('activitylog.database_connection'))->table(config('activitylog.table_name'), function (Blueprint $table) {
            $table->string('event')->nullable()->after('subject_type');
        });
    }

    public function down()
    {
        Schema::connection(config('activitylog.database_connection'))->table(config('activitylog.table_name'), function (Blueprint $table) {
            $table->dropColumn('event');
        });
    }
}
----
--database/migrations/2025_11_23_152611_add_batch_uuid_column_to_activity_log_table.php
<?php

use Illuminate\Support\Facades\Schema;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Database\Migrations\Migration;

class AddBatchUuidColumnToActivityLogTable extends Migration
{
    public function up()
    {
        Schema::connection(config('activitylog.database_connection'))->table(config('activitylog.table_name'), function (Blueprint $table) {
            $table->uuid('batch_uuid')->nullable()->after('properties');
        });
    }

    public function down()
    {
        Schema::connection(config('activitylog.database_connection'))->table(config('activitylog.table_name'), function (Blueprint $table) {
            $table->dropColumn('batch_uuid');
        });
    }
}
----
--database/migrations/2025_11_24_122117_make_open_offer_fields_nullable_in_orders_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::table('orders', function (Blueprint $table) {
            //
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::table('orders', function (Blueprint $table) {
            //
        });
    }
};
----
--database/seeders/AddressSeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Domains\Common\Models\Address;
use App\Domains\Common\Models\UserAddress;
use App\Domains\Users\Models\User;

class AddressSeeder extends Seeder
{
    public function run(): void
    {
        $addresses = [
            [
                'house_no' => '123',
                'street' => 'Main Street',
                'barangay' => 'Poblacion',
                'town' => 'Tagudin',
                'province' => 'Ilocos Sur',
                'country' => 'Philippines',
                'lat' => 17.0833,
                'lng' => 120.4500,
            ],
            [
                'house_no' => '456',
                'street' => 'Rizal Avenue',
                'barangay' => 'San Juan',
                'town' => 'Sta. Cruz',
                'province' => 'Ilocos Sur',
                'country' => 'Philippines',
                'lat' => 17.1667,
                'lng' => 120.4833,
            ],
            [
                'house_no' => '789',
                'street' => 'Del Pilar Street',
                'barangay' => 'Centro',
                'town' => 'Candon',
                'province' => 'Ilocos Sur',
                'country' => 'Philippines',
                'lat' => 17.1903,
                'lng' => 120.4472,
            ],
            [
                'house_no' => '321',
                'street' => 'Luna Avenue',
                'barangay' => 'Poblacion East',
                'town' => 'Luna',
                'province' => 'La Union',
                'country' => 'Philippines',
                'lat' => 16.8389,
                'lng' => 120.3833,
            ],
            [
                'house_no' => '654',
                'street' => 'Bonifacio Street',
                'barangay' => 'San Nicolas',
                'town' => 'Vigan',
                'province' => 'Ilocos Sur',
                'country' => 'Philippines',
                'lat' => 17.5747,
                'lng' => 120.3869,
            ],
        ];

        foreach ($addresses as $addressData) {
            Address::create($addressData);
        }

        // Assign addresses to users
        $users = User::all();
        $allAddresses = Address::all();

        foreach ($users as $index => $user) {
            // Each user gets 1-2 addresses
            $numAddresses = rand(1, 2);
            $userAddresses = $allAddresses->random(min($numAddresses, $allAddresses->count()));

            foreach ($userAddresses as $addressIndex => $address) {
                UserAddress::create([
                    'user_id' => $user->id,
                    'address_id' => $address->id,
                    'is_primary' => $addressIndex === 0, // First address is primary
                ]);
            }
        }
    }
}
----
--database/seeders/CategorySeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Domains\Listings\Models\Category;

class CategorySeeder extends Seeder
{
    public function run(): void
    {
        $categories = [
            'Event Decorating Service',
            'Catering Service',
            'Home Repair & Maintenance',
            'Construction Service',
            'Programming & Tech',
            'Graphics & Design',
            'Digital Marketing',
            'Writing & Translation',
            'Video & Animation',
            'AI Services',
            'Music & Audio',
            'Business Consulting',
            'Photography',
            'Automotive Repair',
            'Landscaping & Gardening',
            'Cleaning Services',
            'Pet Care',
            'Tutoring & Education',
            'Health & Fitness',
            'Beauty Services',
        ];

        foreach ($categories as $categoryName) {
            Category::firstOrCreate(['name' => $categoryName]);
        }
    }
}
----
--database/seeders/DatabaseSeeder.php
<?php

namespace Database\Seeders;

// use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
    /**
     * Seed the application's database.
     */
    public function run(): void
    {
        $this->call([
            // 1. Create roles first
            RolesSeeder::class,
            
            // 2. Create users (they need roles)
            UserSeeder::class,
            
            // 3. Create addresses and link to users
            AddressSeeder::class,
            
            // 4. Create categories
            CategorySeeder::class,
            
            // 5. Create work catalogs (building blocks for workflows)
            WorkCatalogSeeder::class,
            
            // 6. Create workflow templates and work templates
            WorkflowAndWorkTemplateSeeder::class,
            
            // 7. Create services and open offers (need all previous data)
            ListingsSeeder::class,
            
            // 8. Optional: Create some bids on open offers
            // OpenOfferBidSeeder::class,
        ]);
    }
}
----
--database/seeders/ListingsSeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Domains\Listings\Models\Service;
use App\Domains\Listings\Models\OpenOffer;
use App\Domains\Listings\Models\Category;
use App\Domains\Listings\Models\WorkflowTemplate;
use App\Domains\Common\Models\Address;
use App\Domains\Users\Models\User;

class ListingsSeeder extends Seeder
{
    public function run(): void
    {
        $users = User::all();
        $categories = Category::all();
        $workflows = WorkflowTemplate::where('is_public', true)->get();
        $addresses = Address::all();

        // Create Services
        $services = [
            [
                'title' => 'Arnel\'s Professional Plumbing',
                'description' => 'Expert plumbing services for all your needs. Leak repairs, pipe installations, and drain cleaning.',
                'price' => 200.00,
                'pay_first' => false,
                'category' => 'Home Repair & Maintenance',
                'workflow' => 'Basic Plumbing Service',
            ],
            [
                'title' => 'Quality House Painting',
                'description' => 'Professional interior and exterior painting. Color consultation included.',
                'price' => 150.00,
                'pay_first' => false,
                'category' => 'Home Repair & Maintenance',
                'workflow' => 'House Painting Service',
            ],
            [
                'title' => 'Maria\'s Catering Services',
                'description' => 'Delicious Filipino cuisine for all occasions. Birthday parties, weddings, and corporate events.',
                'price' => 250.00,
                'pay_first' => true,
                'category' => 'Catering Service',
                'workflow' => 'Event Catering Service',
            ],
            [
                'title' => 'Elite Event Decorations',
                'description' => 'Beautiful event setups for weddings, birthdays, and special occasions.',
                'price' => 3500.00,
                'pay_first' => true,
                'category' => 'Event Decorating Service',
                'workflow' => 'Event Decoration Service',
            ],
            [
                'title' => 'Quick Fix Electrical Services',
                'description' => 'Licensed electrician for repairs, installations, and troubleshooting.',
                'price' => 180.00,
                'pay_first' => false,
                'category' => 'Home Repair & Maintenance',
                'workflow' => 'Electrical Repair Service',
            ],
            [
                'title' => 'Reliable Construction Services',
                'description' => 'Small to medium construction projects. Renovations, extensions, and repairs.',
                'price' => 500.00,
                'pay_first' => true,
                'category' => 'Construction Service',
                'workflow' => 'Small Construction Project',
            ],
            [
                'title' => 'Budget-Friendly Catering',
                'description' => 'Affordable catering for small gatherings. Minimum 20 guests.',
                'price' => 150.00,
                'pay_first' => true,
                'category' => 'Catering Service',
                'workflow' => 'Event Catering Service',
            ],
            [
                'title' => 'Expert Tile Installation',
                'description' => 'Professional tile work for bathrooms, kitchens, and floors.',
                'price' => 220.00,
                'pay_first' => false,
                'category' => 'Construction Service',
                'workflow' => 'Small Construction Project',
            ],
        ];

        foreach ($services as $serviceData) {
            $category = $categories->firstWhere('name', $serviceData['category']);
            $workflow = $workflows->firstWhere('name', $serviceData['workflow']);
            $user = $users->random();
            $address = $addresses->random();

            if ($workflow) {
                Service::create([
                    'title' => $serviceData['title'],
                    'description' => $serviceData['description'],
                    'price' => $serviceData['price'],
                    'pay_first' => $serviceData['pay_first'],
                    'category_id' => $category->id,
                    'creator_id' => $user->id,
                    'workflow_template_id' => $workflow->id,
                    'address_id' => $address->id,
                ]);
            }
        }

        // Create Open Offers
        $openOffers = [
            [
                'title' => 'Looking for Catering Service',
                'description' => 'Need catering for 50 guests at a birthday party. Filipino cuisine preferred.',
                'budget' => 5000.00,
                'category' => 'Catering Service',
                'workflow' => 'Event Catering Service',
                'fulfilled' => false,
            ],
            [
                'title' => 'Need House Painting',
                'description' => '2-story house needs exterior painting. Labor only, we will provide materials.',
                'budget' => 12000.00,
                'category' => 'Home Repair & Maintenance',
                'workflow' => 'House Painting Service',
                'fulfilled' => false,
            ],
            [
                'title' => 'Event Decoration Needed',
                'description' => 'Wedding decoration for outdoor venue. Rustic theme, 100 guests.',
                'budget' => 15000.00,
                'category' => 'Event Decorating Service',
                'workflow' => 'Event Decoration Service',
                'fulfilled' => false,
            ],
            [
                'title' => 'Plumbing Repair Urgent',
                'description' => 'Major leak in bathroom. Need immediate repair.',
                'budget' => 3000.00,
                'category' => 'Home Repair & Maintenance',
                'workflow' => 'Basic Plumbing Service',
                'fulfilled' => false,
            ],
            [
                'title' => 'Small Bathroom Renovation',
                'description' => 'Looking for contractor to renovate small bathroom. Tiles and fixtures replacement.',
                'budget' => 25000.00,
                'category' => 'Construction Service',
                'workflow' => 'Small Construction Project',
                'fulfilled' => false,
            ],
            [
                'title' => 'Electrical Wiring Installation',
                'description' => 'New room needs complete electrical wiring. Licensed electrician required.',
                'budget' => 8000.00,
                'category' => 'Home Repair & Maintenance',
                'workflow' => 'Electrical Repair Service',
                'fulfilled' => false,
            ],
            [
                'title' => 'Birthday Party Catering',
                'description' => 'Simple menu for 30 people. Kids birthday party.',
                'budget' => 4000.00,
                'category' => 'Catering Service',
                'workflow' => 'Event Catering Service',
                'fulfilled' => true,
            ],
        ];

        foreach ($openOffers as $offerData) {
            $category = $categories->firstWhere('name', $offerData['category']);
            $workflow = $workflows->firstWhere('name', $offerData['workflow']);
            $user = $users->random();
            $address = $addresses->random();

            if ($workflow) {
                OpenOffer::create([
                    'title' => $offerData['title'],
                    'description' => $offerData['description'],
                    'budget' => $offerData['budget'],
                    'pay_first' => true,
                    'fulfilled' => $offerData['fulfilled'],
                    'category_id' => $category->id,
                    'creator_id' => $user->id,
                    'workflow_template_id' => $workflow->id,
                    'address_id' => $address->id,
                ]);
            }
        }
    }
}
----
--database/seeders/OpenOfferBidSeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Domains\Listings\Models\OpenOfferBid;
use App\Domains\Listings\Models\OpenOffer;
use App\Domains\Listings\Models\Service;
use App\Domains\Users\Models\User;

class OpenOfferBidSeeder extends Seeder
{
    public function run(): void
    {
        // Get unfulfilled open offers
        $openOffers = OpenOffer::where('fulfilled', false)->get();
        
        foreach ($openOffers as $offer) {
            // Each open offer gets 2-4 bids
            $numBids = rand(2, 4);
            
            // Get services in the same category
            $relevantServices = Service::where('category_id', $offer->category_id)
                ->inRandomOrder()
                ->take($numBids)
                ->get();
            
            foreach ($relevantServices as $service) {
                // Calculate proposed price (80%-120% of offer budget)
                $minPrice = $offer->budget * 0.8;
                $maxPrice = $offer->budget * 1.2;
                $proposedPrice = rand($minPrice * 100, $maxPrice * 100) / 100;
                
                // Create bid
                OpenOfferBid::create([
                    'open_offer_id' => $offer->id,
                    'bidder_id' => $service->creator_id,
                    'service_id' => $service->id,
                    'proposed_price' => $proposedPrice,
                ]);
            }
        }
        
        $this->command->info('Created bids for ' . $openOffers->count() . ' open offers');
    }
}
----
--database/seeders/RolesSeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use Spatie\Permission\Models\Role;

class RolesSeeder extends Seeder
{
    public function run(): void
    {
        Role::firstOrCreate(['name' => 'user', 'guard_name' => 'web']);
        Role::firstOrCreate(['name' => 'moderator', 'guard_name' => 'web']);
        Role::firstOrCreate(['name' => 'admin', 'guard_name' => 'web']);
    }
}
----
--database/seeders/UserSeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Domains\Users\Models\User;


class UserSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        // collection acnt be assigned role so have each function
        
        User::create([
            'firstname' => 'First',
            'lastname' => 'User',
            'password' => bcrypt('password123'),
            'email' => 'user@localhost',
        ])->assignRole('user');

        User::create([
            'firstname' => 'Moderator',
            'lastname' => 'User',
            'password' => bcrypt('password123'),
            'email' => 'moderator@localhost',
        ])->assignRole('moderator');

        User::create([
            'firstname' => 'Admin',
            'lastname' => 'User',
            'password' => bcrypt('password123'),
            'email' => 'admin@localhost',
        ])->assignRole('admin');
    }
}
----
--database/seeders/WorkCatalogSeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Domains\Listings\Models\WorkCatalog;

class WorkCatalogSeeder extends Seeder
{
    public function run(): void
    {
        $workCatalogs = [
            [
                'name' => 'Initial Consultation',
                'description' => 'Meet with client to discuss requirements and expectations',
                'config' => [
                    'estimated_duration' => '1-2 hours',
                    'location' => 'client_location',
                    'requirements' => ['notepad', 'measuring_tools']
                ]
            ],
            [
                'name' => 'Site Inspection',
                'description' => 'Visit and assess the work location',
                'config' => [
                    'estimated_duration' => '30 minutes - 1 hour',
                    'requirements' => ['camera', 'measuring_tape']
                ]
            ],
            [
                'name' => 'Material Purchase',
                'description' => 'Acquire necessary materials and supplies',
                'config' => [
                    'estimated_duration' => '2-4 hours',
                    'payment_type' => 'client_advance'
                ]
            ],
            [
                'name' => 'On-site Work',
                'description' => 'Perform the actual service work',
                'config' => [
                    'estimated_duration' => 'varies',
                    'location' => 'client_location'
                ]
            ],
            [
                'name' => 'Quality Check',
                'description' => 'Review completed work for quality assurance',
                'config' => [
                    'estimated_duration' => '30 minutes',
                    'requires_client' => true
                ]
            ],
            [
                'name' => 'Final Cleanup',
                'description' => 'Clean up work area and remove debris',
                'config' => [
                    'estimated_duration' => '30 minutes - 1 hour',
                ]
            ],
            [
                'name' => 'Client Walkthrough',
                'description' => 'Present finished work to client for approval',
                'config' => [
                    'estimated_duration' => '15-30 minutes',
                    'requires_client' => true
                ]
            ],
            [
                'name' => 'Payment Collection',
                'description' => 'Collect payment from client',
                'config' => [
                    'payment_methods' => ['cash', 'gcash', 'bank_transfer']
                ]
            ],
            [
                'name' => 'Documentation',
                'description' => 'Take photos and document completed work',
                'config' => [
                    'estimated_duration' => '15 minutes',
                    'requirements' => ['camera', 'smartphone']
                ]
            ],
            [
                'name' => 'Follow-up Visit',
                'description' => 'Return to check on completed work',
                'config' => [
                    'estimated_duration' => '30 minutes',
                    'typical_timeframe' => '1-2 weeks after completion'
                ]
            ],
        ];

        foreach ($workCatalogs as $catalog) {
            $catalog['config'] = json_encode($catalog['config']);
            WorkCatalog::create($catalog);
        }
    }
}
----
--database/seeders/WorkflowAndWorkTemplateSeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Domains\Listings\Models\WorkflowTemplate;
use App\Domains\Listings\Models\WorkTemplate;
use App\Domains\Listings\Models\WorkCatalog;
use App\Domains\Users\Models\User;

class WorkflowAndWorkTemplateSeeder extends Seeder
{
    public function run(): void
    {
        $users = User::all();
        if ($users->isEmpty()) {
            $users = User::factory(5)->create();
        }
        
        $workCatalogs = WorkCatalog::all();
        if ($workCatalogs->isEmpty()) {
            $this->call(WorkCatalogSeeder::class);
            $workCatalogs = WorkCatalog::all();
        }

        // Plumbing Workflow
        $plumbingWorkflow = WorkflowTemplate::create([
            'name' => 'Basic Plumbing Service',
            'description' => 'Standard workflow for plumbing repairs and installations',
            'creator_id' => $users->random()->id,
            'is_public' => true,
        ]);

        $this->createWorkTemplates($plumbingWorkflow, $workCatalogs, [
            'Initial Consultation',
            'Site Inspection',
            'Material Purchase',
            'On-site Work',
            'Quality Check',
            'Final Cleanup',
            'Payment Collection',
        ]);

        // House Painting Workflow
        $paintingWorkflow = WorkflowTemplate::create([
            'name' => 'House Painting Service',
            'description' => 'Complete house painting workflow from prep to finish',
            'creator_id' => $users->random()->id,
            'is_public' => true,
        ]);

        $this->createWorkTemplates($paintingWorkflow, $workCatalogs, [
            'Initial Consultation',
            'Site Inspection',
            'Material Purchase',
            'On-site Work',
            'Quality Check',
            'Final Cleanup',
            'Client Walkthrough',
            'Payment Collection',
            'Documentation',
        ]);

        // Catering Workflow
        $cateringWorkflow = WorkflowTemplate::create([
            'name' => 'Event Catering Service',
            'description' => 'Full-service catering workflow for events',
            'creator_id' => $users->random()->id,
            'is_public' => true,
        ]);

        $this->createWorkTemplates($cateringWorkflow, $workCatalogs, [
            'Initial Consultation',
            'Material Purchase',
            'On-site Work',
            'Final Cleanup',
            'Client Walkthrough',
            'Payment Collection',
        ]);

        // Construction Workflow
        $constructionWorkflow = WorkflowTemplate::create([
            'name' => 'Small Construction Project',
            'description' => 'Workflow for minor construction and renovation work',
            'creator_id' => $users->random()->id,
            'is_public' => true,
        ]);

        $this->createWorkTemplates($constructionWorkflow, $workCatalogs, [
            'Initial Consultation',
            'Site Inspection',
            'Material Purchase',
            'On-site Work',
            'Quality Check',
            'Final Cleanup',
            'Client Walkthrough',
            'Payment Collection',
            'Documentation',
            'Follow-up Visit',
        ]);

        // Electrical Repair Workflow
        $electricalWorkflow = WorkflowTemplate::create([
            'name' => 'Electrical Repair Service',
            'description' => 'Standard workflow for electrical repairs and installations',
            'creator_id' => $users->random()->id,
            'is_public' => true,
        ]);

        $this->createWorkTemplates($electricalWorkflow, $workCatalogs, [
            'Initial Consultation',
            'Site Inspection',
            'Material Purchase',
            'On-site Work',
            'Quality Check',
            'Payment Collection',
            'Follow-up Visit',
        ]);

        // Event Decoration Workflow
        $decorationWorkflow = WorkflowTemplate::create([
            'name' => 'Event Decoration Service',
            'description' => 'Complete event decoration setup workflow',
            'creator_id' => $users->random()->id,
            'is_public' => true,
        ]);

        $this->createWorkTemplates($decorationWorkflow, $workCatalogs, [
            'Initial Consultation',
            'Site Inspection',
            'Material Purchase',
            'On-site Work',
            'Client Walkthrough',
            'Final Cleanup',
            'Payment Collection',
            'Documentation',
        ]);

        // Create some private workflows
        $privateWorkflow = WorkflowTemplate::create([
            'name' => 'Custom Client Workflow',
            'description' => 'Private workflow for specific client requirements',
            'creator_id' => $users->random()->id,
            'is_public' => false,
        ]);

        $this->createWorkTemplates($privateWorkflow, $workCatalogs, [
            'Initial Consultation',
            'On-site Work',
            'Payment Collection',
        ]);
    }

    private function createWorkTemplates($workflow, $workCatalogs, $catalogNames)
    {
        foreach ($catalogNames as $index => $catalogName) {
            $catalog = $workCatalogs->firstWhere('name', $catalogName);
            
            if ($catalog) {
                WorkTemplate::create([
                    'workflow_template_id' => $workflow->id,
                    'work_catalog_id' => $catalog->id,
                    'name' => $catalog->name,
                    'description' => $catalog->description,
                    'order' => $index,
                ]);
            }
        }
    }
}
----
--resources/css/app.css
@import './navbar.css';
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer components {
  /* Button Component */
  .btn {
    @apply rounded-md font-semibold transition duration-200 px-4 py-2;
  }

  .btn-primary {
    @apply bg-brand text-white hover:bg-brand-dark focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-2 dark:focus:ring-offset-secondary-dark;
  }

  .btn-secondary {
    @apply border border-secondary-dark text-secondary hover:bg-secondary-dark hover:text-white focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-2 dark:focus:ring-offset-secondary-dark;
  }

  .btn-outline-white {
    @apply px-4 py-2 border border-white text-white rounded-lg bg-transparent 
           hover:bg-white hover:text-black transition;
  }

  .btn-danger {
    @apply bg-error text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-error focus:ring-offset-2 dark:focus:ring-offset-secondary-dark;
  }


  /* Dropdown Component */
  .dropdown-link {
    @apply block w-full px-4 py-2 text-sm leading-5 text-left font-body;
  }

  .dropdown-active {
    @apply text-brand bg-background-secondary dark:text-brand dark:bg-secondary-dark;
  }
  .dropdown-active:hover {
    @apply bg-brand/10 dark:bg-brand-dark/10;
  }

  .dropdown-inactive {
    @apply text-text-secondary dark:text-text;
  }
  .dropdown-inactive:hover {
    @apply bg-background-secondary text-text dark:bg-secondary-dark dark:text-text-secondary;
  }

  /* Status Component */
  .status-message {
    @apply font-medium text-sm font-body;
  }

  .status-success {
    @apply text-brand dark:text-brand-dark;
  }

/* ================================
  FORM LAYOUT WRAPPERS
  ================================ */

  /* Listing Card Component */
  .listing-card {
    @apply bg-white rounded-xl shadow hover:shadow-md transition p-5 flex flex-col;
  }

  /* Card top row (badge + right info) */
  .card-top {
    @apply flex items-center justify-between mb-3;
  }

  /* Badges */
  .badge-service {
    @apply px-2 py-1 text-xs bg-green-100 text-green-700 rounded;
  }
  .badge-offer {
    @apply px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded;
  }

  /* Card Titles & Description */
  .card-desc {
    @apply text-gray-500 text-sm mb-2;
  }
  .card-meta {
    @apply text-gray-600 text-sm;
  }

  /* Card Footer */
  .card-footer {
    @apply mt-3 flex justify-between items-center;
  }
  .card-footer span {
    @apply text-xs text-gray-500;
  }

  /* Avatar/Icon inside card */
  .card-avatar {
    @apply w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center;
  }

  /* Card Titles & Description */
  .card-title {
    @apply text-lg font-bold;
  }

  /* ================================
     FORM LAYOUT WRAPPERS
     ================================ */
  .form-wrapper {
    @apply flex items-center min-h-screen bg-gradient-to-br from-green-50 via-white to-gray-100;
  }

  .form-wrapper-centered {
    @apply justify-center;
  }

  .form-wrapper-left {
    @apply justify-start;
  }

  .form-wrapper-right {
    @apply justify-end;
  }

  /* ================================
     FORM CARD CONTAINER
     ================================ */
  .form-container {
    @apply bg-white shadow-2xl rounded-3xl p-10 w-full max-w-md border border-gray-100;
  }

  /* Card variants for dashboard use */
  .form-container-neutral {
    @apply bg-background shadow-md rounded-md p-6 w-full border border-secondary dark:bg-secondary-dark dark:border-secondary-dark;
  }

  /* ================================
     FORM HEADERS
     ================================ */
  .form-header {
    @apply flex flex-col items-center mb-8;
  }

  .form-icon {
    @apply bg-green-100 rounded-full p-3 mb-3;
  }

  .form-title {
    @apply text-xl font-bold text-gray-800;
  }

  .form-subtitle {
    @apply text-gray-500 text-sm mt-1 text-center;
  }

  /* ================================
     LABELS, INPUTS, AND ERRORS
     ================================ */
  .form-label {
    @apply block font-medium text-sm text-gray-700 mb-2 font-body;
  }

  .form-input {
    @apply w-full px-4 py-3 border border-gray-200 rounded-lg bg-white 
           focus:outline-none focus:ring-2 focus:ring-green-400 transition;
  }

  .form-error {
    @apply text-error dark:text-error/80 text-sm mt-1 font-body;
  }

  /* ================================
     BUTTONS
     ================================ */
  .form-button {
    @apply w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-lg 
           font-semibold shadow hover:from-green-600 hover:to-green-700 transition;
  }

  .form-button-danger {
    @apply w-full bg-red-600 text-white py-3 rounded-lg font-semibold shadow 
           hover:bg-red-700 transition;
  }

  .form-alt-button {
    @apply w-full flex items-center justify-center gap-2 border border-gray-300 py-2 rounded-lg 
           hover:bg-gray-50 transition;
  }

  /* ================================
     DIVIDERS AND FOOTERS
     ================================ */
  .form-divider {
    @apply flex items-center my-6;
  }

  .form-divider-line {
    @apply flex-grow border-t border-gray-200;
  }

  .form-divider-text {
    @apply mx-3 text-gray-400 text-xs;
  }

  .form-footer {
    @apply text-center text-gray-600 mt-6 text-sm;
  }

  /* Modal Component */
  /* ================================
   MODAL EXTENSIONS
   ================================ */

  /* Modal header */
  .modal-header {
    @apply flex items-center justify-between mb-6 pb-4 border-b border-secondary dark:border-secondary-dark;
  }

  .modal-title {
    @apply text-xl font-bold text-text dark:text-text-secondary;
  }

  .modal-close {
    @apply text-text-secondary hover:text-text dark:text-text dark:hover:text-text-secondary transition;
  }

  /* Modal body */
  .modal-body {
    @apply space-y-4;
  }

  /* Modal footer */
  .modal-footer {
    @apply flex items-center justify-end gap-3 mt-6 pt-4 border-t border-secondary dark:border-secondary-dark;
  }

  /* Delete confirmation modal variant */
  .modal-danger {
    @apply text-center;
  }

  .modal-danger-icon {
    @apply w-12 h-12 mx-auto mb-4 text-error;
  }

  .modal-danger-title {
    @apply text-lg font-semibold mb-2 text-text dark:text-text-secondary;
  }

  .modal-danger-text {
    @apply text-text-secondary dark:text-text mb-6;
  }

  /* Loading skeleton */
  .skeleton-item {
    @apply h-10 bg-secondary dark:bg-secondary-dark rounded animate-pulse;
  }

  /* Status Component */
  .status-message {
    @apply font-medium text-sm font-body;
  }

  .status-success {
    @apply text-brand dark:text-brand-dark;
  }

  /* ===== Modal Core Styles ===== */
  .modal-overlay {
      @apply fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50;
  }

  .modal-content {
      @apply bg-white dark:bg-gray-800 rounded-xl shadow-xl p-6 sm:p-8 w-full max-w-md transform transition-all duration-300;
  }

  .modal-enter {
      @apply opacity-0 scale-95;
  }
  .modal-enter-active {
      @apply opacity-100 scale-100;
  }
  .modal-leave {
      @apply opacity-100 scale-100;
  }
  .modal-leave-active {
      @apply opacity-0 scale-95;
  }

}

@layer utilities {
  /* hide scrollbar (Chrome/Safari/Edge/Opera + Firefox + IE/Edge) */
  .scrollbar-hide {
    -ms-overflow-style: none; /* IE and Edge */
    scrollbar-width: none; /* Firefox */
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none; /* WebKit */
  }

  /* optional: smooth touch scrolling on iOS */
  .touch-scroll {
    -webkit-overflow-scrolling: touch;
  }
}

[x-cloak] {
    display: none !important;
}
----
--resources/css/browse.css
@import './app.css';
@layer components {
  /* =======================
    Browse Section & Cards
    ======================= */

  /* Section wrapper */
  .browse-section {
    @apply py-12 px-6 bg-gray-50;
  }

  /* Inner container */
  .browse-inner {
    @apply max-w-6xl mx-auto;
  }

  /* Header Row */
  .browse-header {
    @apply flex flex-col lg:flex-row md:items-center md:justify-between mb-8;
  }

  .browse-title {
    @apply text-3xl font-bold;
  }

  /* Filters */
  .browse-filters {
    @apply flex flex-wrap gap-3 mt-4;
  }

  /* Buttons */
  .filter-btn {
    @apply px-2 p-1 md:px-4 md:py-2 rounded-lg border text-xs md:text-sm transition;
  }
  .filter-btn-primary {
    @apply bg-green-600 text-white hover:bg-green-700 text-base md:text-sm;
  }
  .filter-btn-outline {
    @apply bg-white border hover:bg-gray-200 text-gray-700;
  }

  /* Selects */
  .filter-select {
    @apply px-3 py-2 border rounded-lg text-xs md:text-sm;
  }

  /* Card Grid */
  .browse-grid {
    @apply grid gap-6 sm:grid-cols-2 lg:grid-cols-3;
  }

  /* Single Card */
  .browse-card {
    @apply bg-white rounded-xl shadow hover:shadow-md transition p-5 flex flex-col;
  }

  /* Card top row (badge + right info) */
  .card-top {
    @apply flex items-center justify-between mb-3;
  }

  /* Badges */
  .badge-service {
    @apply px-2 py-1 text-xs bg-green-100 text-green-700 rounded;
  }
  .badge-offer {
    @apply px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded;
  }

  /* Card Titles & Description */
  .card-title {
    @apply text-lg font-bold;
  }
  .card-desc {
    @apply text-gray-500 text-sm mb-2;
  }
  .card-meta {
    @apply text-gray-600 text-sm;
  }

  /* Card Footer */
  .card-footer {
    @apply mt-3 flex justify-between items-center;
  }
  .card-footer span {
    @apply text-xs text-gray-500;
  }

  /* Avatar/Icon inside card */
  .card-avatar {
    @apply w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center;
  }

  /* "View More" Button */
  .browse-viewmore {
    @apply px-6 py-3 bg-green-600 text-white rounded-lg font-semibold shadow hover:bg-green-700 transition;
  }
}
----
--resources/css/home.css
@import './app.css';
@import "swiper/css";
@import "swiper/css/navigation";
@import "swiper/css/pagination";

@layer components {

    /* Hero search input */
  .hero-search {
    @apply px-4 py-3 sm:w-[300px] md:w-[450px] w-[200px] text-sm rounded-l-lg text-black 
           focus:outline-none focus:ring-2 focus:ring-brand
           placeholder-gray-400 ; 
  }

  /* Transparent white outline button */
  .btn-outline-white {
    @apply px-4 py-2 rounded-lg border border-white text-white 
           bg-transparent hover:bg-white hover:text-black 
           transition duration-300;
  }

  /* Swiper arrows */
  .swiper-button-next,
  .swiper-button-prev {
    @apply w-12 h-12 flex items-center justify-center rounded-full !text-white transition duration-300;
  }

  /* Swiper pagination dots */
  .swiper-pagination-bullet {
    @apply w-3 h-3 bg-white opacity-60;
  }
  .swiper-pagination-bullet-active {
    @apply bg-white opacity-100;
  }

  /* Explore Categories Section */
  .section-categories {
    @apply py-12 px-6 bg-background;
  }

  .section-categories-title {
    @apply text-3xl font-bold text-center mb-8 font-display text-text;
  }

  .categories-scroll {
    @apply flex space-x-4 overflow-x-auto px-4 scrollbar-hide;
  }

  .category-card {
    @apply flex-shrink-0 w-48 bg-background-secondary shadow-sm p-6 rounded-lg text-center 
           hover:shadow-md transition cursor-pointer;
  }

  .category-icon {
    @apply text-3xl;
  }

  .category-label {
    @apply mt-2 font-medium text-text;
  }


    /* =======================
    Create Section
    ======================= */

    /* Section Wrapper */
    .create-section {
    @apply py-16 px-6 bg-gray-50;
    }

    /* Section Container */
    .create-container {
    @apply max-w-4xl mx-auto text-center;
    }

    .create-container h2 {
    @apply text-3xl font-bold mb-6;
    }

    .create-container p {
    @apply text-gray-600 mb-10;
    }

    /* Grid Layout */
    .create-grid {
    @apply grid md:grid-cols-2 gap-6;
    }

    /* Card */
    .create-card {
    @apply bg-white rounded-xl shadow hover:shadow-md transition p-6 flex flex-col;
    }

    .create-card h3 {
    @apply text-lg font-semibold mb-4;
    }

    /* Textarea */
    .create-card textarea {
    @apply w-full border px-4 py-3 rounded-lg mb-4 text-sm focus:outline-none focus:ring-2 focus:ring-green-600;
    }

    /* Button */
    .create-card button {
    @apply w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition;
    }

        /* =======================
    Featured Workflows Section
    ======================= */

    /* Section */
    .workflows-section {
    @apply py-12 px-6 bg-white;
    }

    /* Container */
    .workflows-container {
    @apply max-w-6xl mx-auto text-center;
    }

    .workflows-container h2 {
    @apply text-3xl font-bold mb-8;
    }

    .workflows-container p {
    @apply text-gray-600 mb-10;
    }

    /* Grid */
    .workflows-grid {
    @apply grid gap-6 sm:grid-cols-2 lg:grid-cols-3;
    }

    /* Card */
    .workflow-card {
    @apply bg-gray-50 rounded-xl shadow hover:shadow-md transition p-5 flex flex-col text-left;
    }

    .workflow-card h3 {
    @apply text-lg font-bold mb-2;
    }

    .workflow-card p {
    @apply text-gray-600 text-sm mb-4;
    }

    /* Card Footer */
    .workflow-actions {
    @apply flex justify-end mt-auto gap-2;
    }

    /* Buttons */
    .workflow-actions .btn-service {
    @apply px-3 py-1 bg-green-600 text-white text-xs rounded-lg hover:bg-green-700;
    }

    .workflow-actions .btn-offer {
    @apply px-3 py-1 border text-xs rounded-lg hover:bg-gray-200;
    }


}
----
--resources/css/navbar.css
@layer components {
  /* Navbar container */
  .navbar {
    @apply sticky top-0 z-50 bg-background shadow;
  }

  .navbar-inner {
    @apply max-w-7xl mx-auto flex justify-between items-center px-6 py-4;
  }

  /* Brand */
  .navbar-brand {
    @apply text-2xl font-bold flex items-center hover:opacity-50;
  }
  .navbar-brand-text {
    @apply text-text;
  }
  .navbar-brand-accent {
    @apply text-brand;
  }

  /* Desktop nav links */
  .navbar-nav {
    @apply hidden md:flex items-center space-x-6 text-text-secondary;
  }
  .navbar-link {
    @apply hover:text-brand transition;
  }

  /* Auth section */
  .navbar-auth {
    @apply flex items-center space-x-4 pl-7;
  }
  .navbar-auth-link {
    @apply hover:text-brand transition;
  }
  .navbar-auth-button {
    @apply px-4 py-1 border border-text rounded hover:bg-text hover:text-background transition;
  }

  /* Mobile hamburger */
  .navbar-toggle {
    @apply md:hidden text-text focus:outline-none;
  }

  /* Mobile menu */
  .navbar-mobile {
    @apply md:hidden px-6 py-4 space-y-3 absolute w-full text-text-secondary bg-background border-t;
  }
  .navbar-mobile-link {
    @apply block hover:text-brand transition;
  }
  .navbar-mobile-auth {
    @apply pt-3 border-t;
  }
  .navbar-mobile-button {
    @apply  w-full mt-2 px-4 py-2 border border-text rounded hover:bg-text hover:text-background transition;
  }

  /* hide until Alpine is ready */
  [x-cloak] { display: none !important; }

  /* Profile trigger */
  .navbar-profile-trigger {
    @apply flex items-center justify-center w-10 h-10 rounded-full hover:opacity-80 transition;
  }

  /* Profile image */
  .navbar-profile-img {
    @apply w-10 h-10 rounded-full object-cover;
  }

  /* Profile fallback */
  .navbar-profile-fallback {
    @apply flex items-center justify-center w-10 h-10 rounded-full bg-black;
  }

  /* Dropdown menu */
  .navbar-profile-dropdown {
    @apply absolute right-0 top-12 mt-2 w-48 bg-background shadow-lg rounded-lg border border-gray-200 z-50;
  }

  /* Dropdown item */
  .navbar-profile-item {
    @apply block px-4 py-2 text-sm text-text hover:bg-gray-100 transition;
  }

  /* Creator button */
  .navbar-creator-btn {
    @apply px-4 py-1 rounded bg-brand text-background font-semibold hover:opacity-90 transition;
  }

  /* Mobile button override (if needed) */
  .navbar-mobile-button { @apply mt-2 px-4 py-2 border border-text rounded hover:bg-text hover:text-background transition; }



  /* Active  */
  .navbar-link.active,
    .navbar-auth-link.active, 
      .navbar-mobile-link.active {
          @apply font-bold text-green-600;
      }
}
----
--resources/js/app.js
// resources/js/app.js
import './bootstrap';

// Import Alpine core and plugins
import Alpine from 'alpinejs'
import focus from '@alpinejs/focus'

// Import Livewire 4 sortable (replaces old livewire-sortablejs)
import '@nextapps-be/livewire-sortablejs'

// Register Alpine plugins
Alpine.plugin(focus)

// Start Alpine after everything is imported
Alpine.start()
----
--resources/js/bootstrap.js
import axios from 'axios';
window.axios = axios;

window.axios.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';
----
--resources/js/home.js
import Swiper from 'swiper';
import { Navigation, Pagination, Autoplay, Keyboard } from 'swiper/modules';

import 'swiper/css';
import 'swiper/css/navigation';
import 'swiper/css/pagination';

document.addEventListener("DOMContentLoaded", () => {
    const swiper = new Swiper('.heroSwiper', {
        modules: [Navigation, Pagination, Autoplay, Keyboard],
        loop: true,
        autoplay: { 
            delay: 5000, 
            disableOnInteraction: false 
        },
        pagination: { 
            el: '.swiper-pagination', 
            clickable: true 
        },
        navigation: { 
            nextEl: '.swiper-button-next', 
            prevEl: '.swiper-button-prev' 
        },
        keyboard: { enabled: true },
        touchEventsTarget: 'container',
        simulateTouch: true,
        grabCursor: true,
        effect: 'slide',
        speed: 600,
    });
});
----
--resources/js/swiper-listings.js
import Swiper from 'swiper';
import { Navigation, Pagination, Autoplay } from 'swiper/modules';

import 'swiper/css';
import 'swiper/css/navigation';
import 'swiper/css/pagination';

document.addEventListener('DOMContentLoaded', function () {
    new Swiper('.serviceSwiper', {
        modules: [Navigation, Pagination, Autoplay],
        loop: true,
        pagination: {
            el: '.swiper-pagination',
            clickable: true,
        },
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
        },
        autoplay: {
            delay: 5000,
            disableOnInteraction: false,
        },
    });
});
----
--resources/views/browse.blade.php
<x-app-layout title="Browse Services" cssFiles="browse.css">
  <div class="max-w-7xl mx-auto px-6 py-10 space-y-8">
    <!-- Sticky Search + Filters -->
    <div x-data="filterManager()"
         class="sticky top-20 bg-gray-50 z-40 p-4 rounded-b-xl shadow-md flex flex-col md:flex-row gap-4">
      
      <!-- Top Row: Search + Filter Toggle (Mobile) -->
      <div class="flex-grow flex items-center justify-between">
        <!-- Search Bar -->
        <div class="flex-grow flex items-center">
          <input type="text" placeholder="Search services or offers..."
            class="w-full border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-600 md:text-base text-xs" />
        </div>

        <!-- Filter Toggle (Mobile only) -->
        <button @click="openFilters = !openFilters"
                class="sm:hidden ml-3 bg-green-600 text-white p-2 rounded-lg hover:bg-green-700 transition">
          <x-icons.filter class="w-5 h-5" />
        </button>
      </div>

      <!-- Scrollable Filters -->
      <div class="hidden sm:flex gap-2 overflow-x-auto scrollbar-hide text-xs md:text-base">
        <button @click="filterByType('all')" :class="currentType === 'all' ? 'filter-btn-primary' : 'filter-btn-outline'" class="filter-btn flex-shrink-0">All</button>
        <button @click="filterByType('service')" :class="currentType === 'service' ? 'filter-btn-primary' : 'filter-btn-outline'" class="filter-btn flex-shrink-0">Services</button>
        <button @click="filterByType('offer')" :class="currentType === 'offer' ? 'filter-btn-primary' : 'filter-btn-outline'" class="filter-btn flex-shrink-0">Open Offers</button>

        <select @change="filterByCategory" x-model="currentCategory" class="filter-select flex-shrink-0">
            <option value="">All Categories</option>
            @foreach($categories as $category)
                <option value="{{ $category->id }}">{{ $category->name }}</option>
            @endforeach
        </select>

        <select class="filter-select flex-shrink-0">
          <option>All Locations</option>
          <option>Tagudin</option>
          <option>Sta. Cruz</option>
          <option>Candon</option>
        </select>
      </div>

      <!-- Mobile Dropdown Filters -->
      <div x-show="openFilters"
           x-transition
           @click.away="openFilters = false"
           class="sm:hidden absolute top-full left-0 w-full bg-white border-t border-gray-200 shadow-lg mt-2 rounded-b-xl z-50 p-4 space-y-3">
        <button @click="filterByType('all')" :class="currentType === 'all' ? 'filter-btn-primary' : 'filter-btn-outline'" class="filter-btn w-full">All</button>
        <button @click="filterByType('service')" :class="currentType === 'service' ? 'filter-btn-primary' : 'filter-btn-outline'" class="filter-btn w-full">Services</button>
        <button @click="filterByType('offer')" :class="currentType === 'offer' ? 'filter-btn-primary' : 'filter-btn-outline'" class="filter-btn w-full">Open Offers</button>

        <select @change="filterByCategory" x-model="currentCategory" class="filter-select w-full">
            <option value="">All Categories</option>
            @foreach($categories as $category)
                <option value="{{ $category->id }}">{{ $category->name }}</option>
            @endforeach
        </select>

        <select class="filter-select w-full">
          <option>All Locations</option>
          <option>Tagudin</option>
          <option>Sta. Cruz</option>
          <option>Candon</option>
        </select>
      </div>
    </div>

    <script>
        function filterManager() {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                openFilters: false,
                currentCategory: urlParams.get('category') || '',
                currentType: urlParams.get('type') || 'all',
                filterByCategory(event) {
                    const categoryId = event.target.value;
                    urlParams.set('page', '1'); // Reset to page 1 when filter changes
                    if (categoryId) {
                        urlParams.set('category', categoryId);
                    } else {
                        urlParams.delete('category');
                    }
                    window.location.search = urlParams.toString();
                },
                filterByType(type) {
                    urlParams.set('page', '1'); // Reset to page 1 when filter changes
                    if (type === 'all') {
                        urlParams.delete('type');
                    } else {
                        urlParams.set('type', type);
                    }
                    window.location.search = urlParams.toString();
                }
            }
        }
    </script>

    <!-- Card Grid -->
    <div class="browse-grid">
        @forelse($listings as $listing)
            @if($listing instanceof \App\Domains\Listings\Models\Service)
                @include('listings.partials.service-card', ['service' => $listing])
            @elseif($listing instanceof \App\Domains\Listings\Models\OpenOffer)
                @include('listings.partials.offer-card', ['offer' => $listing])
            @endif
        @empty
            <p class="text-center text-gray-500 col-span-full">No listings found at the moment.</p>
        @endforelse
    </div>

    <!-- Pagination -->
    <div class="mt-8">
        {{ $listings->links() }}
    </div>
  </div>
</x-app-layout>
----
--resources/views/dashboard.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight">
            {{ __('dashboard') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 text-gray-900 dark:text-gray-100">
                    {{ __("You're logged in!") }}

                    <div class="mt-4">
                        @if (Auth::user()->is_verified)
                            <span class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">
                                Verified
                            </span>
                        @else
                            <span class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">
                                Not Verified
                            </span>
                            <a href="{{ route('verification.create') }}" class="ml-4 text-sm text-indigo-600 hover:text-indigo-900">Get Verified Now</a>
                        @endif
                        <div class="mt-4">
                            <a href="{{ route('orders.index') }}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                My Orders
                            </a>
                            <a href="{{ route('creator.work-dashboard') }}" class="ml-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
                                Seller Work Dashboard
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/home.blade.php
<x-app-layout header="Welcome to Serbizyu" :cssFiles='["home.css", "browse.css"]' :jsFiles="['app.js', 'home.js']">
    <!-- Single Hero Section Container with Swiper -->
    <section class="hero-section relative">
    <!-- Swiper Container -->
    <div class="swiper heroSwiper h-[80vh]">
        <div class="swiper-wrapper">
        
        <!-- Slide 1: Services Hero -->
        <div class="swiper-slide">
            <div class="relative h-[80vh] bg-cover bg-center flex items-center justify-center"
            style="background-image: url('https://images.unsplash.com/photo-1614289941451-60f7ce249549?auto=format&fit=crop&w=1350&q=80');">
            <div class="absolute inset-0 bg-black bg-opacity-60"></div>
            <div class="relative z-10 text-center max-w-2xl px-4 text-white">
                <h1 class="text-4xl md:text-6xl font-bold mb-5">
                Kami na ang bahala sa inyong mga pangangailangan.
                </h1>
                
                <!-- Search Bar -->
                <div class="flex justify-center mb-6">
                <input type="text" placeholder="Search for any service..."
                    class="hero-search">
                <x-primary-button class="rounded-l-none rounded-r-lg">
                    <x-icons.search />
                </x-primary-button>
                </div>

                <!-- Categories -->
                <div class="flex flex-wrap justify-center gap-3  text-sm ">
                <x-outline-button>Event Decorating Service</x-outline-button>
                <x-outline-button>Catering Service</x-outline-button>
                <x-outline-button>Home Repair & Maintenance</x-outline-button>
                <x-outline-button>Construction Service</x-outline-button>
                </div>
            </div>
            </div>
        </div>
        
        <!-- Slide 2: Open Offers Hero -->
        <div class="swiper-slide">
            <div class="relative h-[80vh] bg-cover bg-center flex items-center justify-center"
            style="background-image: url('https://images.unsplash.com/photo-1503387762-592deb58ef4e?auto=format&fit=crop&w=1350&q=80');">
            <div class="absolute inset-0 bg-black bg-opacity-60"></div>
            <div class="relative z-10 text-center max-w-2xl px-4 text-white">
                <h1 class="text-4xl md:text-6xl font-bold mb-5">
                Tuklasin ang mga bukas na alok at simulan nang kumita.
                </h1>

                <!-- Search Bar -->
                <div class="flex justify-center mb-6">
                <input type="text" placeholder="Search open offers..."
                    class="hero-search">
                <x-primary-button class="rounded-l-none rounded-r-lg">
                    <x-icons.search />
                </x-primary-button>
                </div>

                <!-- Categories -->
                <div class="flex flex-wrap justify-center gap-3">
                <x-outline-button>Looking for Catering</x-outline-button>
                <x-outline-button>Need Home Repair</x-outline-button>
                <x-outline-button>Event Decoration Needed</x-outline-button>
                <x-outline-button>Small Construction Project</x-outline-button>
                </div>
            </div>
            </div>
        </div>
        </div>
        
        <!-- Swiper Navigation -->
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
        
        <!-- Swiper Pagination -->
        <div class="swiper-pagination"></div>
    </div>
    </section>


    <!-- Explore Categories -->
    <section class="section-categories">
    <h2 class="section-categories-title">Explore categories</h2>

    <!-- Horizontal scroll -->
    <div class="categories-scroll">
        
        <div class="category-card">
        <p class="category-icon"></p>
        <p class="category-label">Programming & Tech</p>
        </div>

        <div class="category-card">
        <p class="category-icon"></p>
        <p class="category-label">Graphics & Design</p>
        </div>

        <div class="category-card">
        <p class="category-icon"></p>
        <p class="category-label">Digital Marketing</p>
        </div>

        <div class="category-card">
        <p class="category-icon"></p>
        <p class="category-label">Writing & Translation</p>
        </div>

        <div class="category-card">
        <p class="category-icon"></p>
        <p class="category-label">Video & Animation</p>
        </div>

        <div class="category-card">
        <p class="category-icon"></p>
        <p class="category-label">AI Services</p>
        </div>

        <div class="category-card">
        <p class="category-icon"></p>
        <p class="category-label">Music & Audio</p>
        </div>

        <div class="category-card">
        <p class="category-icon"></p>
        <p class="category-label">Business</p>
        </div>

        <div class="category-card">
        <p class="category-icon"></p>
        <p class="category-label">Consulting</p>
        </div>
        
    </div>
    </section>

    <!-- Browse Section -->
    <section class="py-12 px-6 bg-gray-50">
    <div class="browse-inner">
        <div class="browse-header">
        <h2 class="text-3xl font-bold">Browse Offers & Services</h2>

        <!-- Filters -->
        <div class="browse-filters">
            <button class="filter-btn filter-btn-primary">All</button>
            <button class="filter-btn filter-btn-outline">Services</button>
            <button class="filter-btn filter-btn-outline">Open Offers</button>

            <select class="filter-select">
            <option>All Categories</option>
            <option>Catering</option>
            <option>Construction</option>
            <option>Repair</option>
            </select>

            <select class="filter-select">
            <option>All Locations</option>
            <option>Tagudin</option>
            <option>Sta. Cruz</option>
            <option>Candon</option>
            </select>
        </div>
        </div>

        <!-- Card Grid -->
        <div class="browse-grid">

        <!-- Service Card -->
        <article class="listing-card">
            <div class="card-top">
            <span class="badge-service">Service</span>
            <span class="rating"></span>
            </div>
            <h3 class="card-title">Arnels Plumbing</h3>
            <p class="card-desc">Diagnose &gt; Buy materials &gt; On field &gt; Finish</p>
            <p class="card-meta">Rate: 200/hr</p>
            <p class="card-meta">Location: Tagudin, Ilocos Sur</p>
            <div class="card-footer">
            <span class="text-xs text-text-secondary">Verified Servicer</span>
            <div class="card-avatar"></div>
            </div>
        </article>

        <!-- Open Offer Card -->
        <article class="listing-card">
            <div class="card-top">
            <span class="badge-offer">Open Offer</span>
            <span class="text-sm text-text-secondary">Budget: 5,000</span>
            </div>
            <h3 class="card-title">Looking for Catering Service</h3>
            <p class="card-desc">Event for 50 guests</p>
            <p class="card-meta">Sta. Cruz, Ilocos Sur</p>
            <div class="card-footer">
            <span class="text-xs text-text-secondary">Posted 2h ago</span>
            <div class="card-avatar"></div>
            </div>
        </article>

        <!-- Service Card -->
        <article class="listing-card">
            <div class="card-top">
            <span class="badge-service">Service</span>
            <span class="rating"></span>
            </div>
            <h3 class="card-title">General Home Repairs</h3>
            <p class="card-desc">Diagnose &gt; Buy materials &gt; On field &gt; Finish</p>
            <p class="card-meta">Rate: 150/hr</p>
            <p class="card-meta">Candon, Ilocos Sur</p>
            <div class="card-footer">
            <span class="text-xs text-text-secondary">Trusted Local</span>
            <div class="card-avatar"></div>
            </div>
        </article>

        <!-- Open Offer Card -->
        <article class="listing-card">
            <div class="card-top">
            <span class="badge-offer">Open Offer</span>
            <span class="text-sm text-text-secondary">Budget: 12,000</span>
            </div>
            <h3 class="card-title">Need House Painting</h3>
            <p class="card-desc">2-story house, labor only</p>
            <p class="card-meta">Luna, La Union</p>
            <div class="card-footer">
            <span class="text-xs text-text-secondary">Posted 1d ago</span>
            <div class="card-avatar"></div>
            </div>
        </article>

        </div>
    </div>

    <div class="w-full text-center mt-6">
        <a href="/browse" class="browse-viewmore">View More</a>
    </div>
    </section>


    <!-- Create Section -->
    <section class="create-section">
    <div class="create-container">
        <h2>Start Creating</h2>
        <p>Quickly draft an open offer or service idea and continue to the full creator page.</p>

        <div class="create-grid">

        <!-- Create Service -->
        <div class="create-card">
            <h3>Create a Service</h3>
            <textarea placeholder="Describe the service you want to offer..." rows="4"></textarea>
            <button>Continue</button>
        </div>

        <!-- Create Open Offer -->
        <div class="create-card">
            <h3>Create an Open Offer</h3>
            <textarea placeholder="Describe what you are looking for..." rows="4"></textarea>
            <button>Continue</button>
        </div>

        </div>
    </div>
    </section>

    <!-- Featured Workflows -->
    <section class="workflows-section">
    <div class="workflows-container">
        <h2>Featured Workflows</h2>
        <p>Explore workflow templates that can guide you in creating a service or responding to an open offer.</p>

        <!-- Workflow Grid -->
        <div class="workflows-grid">

        <!-- Workflow Card -->
        <div class="workflow-card">
            <h3>Wedding Video Production</h3>
            <p><strong>Steps:</strong> Import Footage  Edit Clips  Color Grade  Export</p>
            <div class="workflow-actions">
            <button class="btn-service">Create Service</button>
            <button class="btn-offer">Create Offer</button>
            </div>
        </div>

        <!-- Workflow Card -->
        <div class="workflow-card">
            <h3>House Painting</h3>
            <p><strong>Steps:</strong> Inspect  Prepare Surface  Apply Paint  Finish</p>
            <div class="workflow-actions">
            <button class="btn-service">Create Service</button>
            <button class="btn-offer">Create Offer</button>
            </div>
        </div>

        <!-- Workflow Card -->
        <div class="workflow-card">
            <h3>Birthday Catering</h3>
            <p><strong>Steps:</strong> Menu Planning  Cook  Serve  Clean Up</p>
            <div class="workflow-actions">
            <button class="btn-service">Create Service</button>
            <button class="btn-offer">Create Offer</button>
            </div>
        </div>

        </div>
    </div>
    </section>

</x-app-layout>
----
--resources/views/admin/dashboard.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Admin Dashboard') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 gap-6 mb-6 md:grid-cols-2 lg:grid-cols-3">
                <!-- Total Users Card -->
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6 bg-white border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Total Users</h3>
                        <p class="mt-2 text-3xl font-bold text-gray-900">{{ $stats['total_users'] }}</p>
                    </div>
                </div>

                <!-- Total Orders Card -->
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6 bg-white border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Total Orders</h3>
                        <p class="mt-2 text-3xl font-bold text-gray-900">{{ $stats['total_orders'] }}</p>
                    </div>
                </div>

                <!-- Total Revenue Card -->
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6 bg-white border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Total Revenue</h3>
                        <p class="mt-2 text-3xl font-bold text-gray-900">${{ number_format($stats['total_revenue'], 2) }}</p>
                    </div>
                </div>
            </div>

            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    <canvas id="analyticsChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    @push('scripts')
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctx = document.getElementById('analyticsChart').getContext('2d');
        const chartData = @json($chartData);

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: chartData.labels,
                datasets: chartData.datasets
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
    @endpush
</x-app-layout>
----
--resources/views/admin/activity-logs/index.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Activity Logs') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Log
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    User
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Timestamp
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            @foreach ($activities as $activity)
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900">{{ $activity->description }}</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900">{{ optional($activity->causer)->name }}</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900">{{ $activity->created_at->format('Y-m-d H:i:s') }}</div>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>

                    <div class="mt-4">
                        {{ $activities->links() }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/admin/listings/edit.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Edit Listing') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    <form action="{{ route('admin.listings.update', $service) }}" method="POST">
                        @csrf
                        @method('PUT')

                        <div>
                            <label for="title" class="block font-medium text-sm text-gray-700">Title</label>
                            <input type="text" name="title" id="title" value="{{ old('title', $service->title) }}" class="block mt-1 w-full rounded-md shadow-sm border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                        </div>

                        <div class="mt-4">
                            <label for="description" class="block font-medium text-sm text-gray-700">Description</label>
                            <textarea name="description" id="description" rows="4" class="block mt-1 w-full rounded-md shadow-sm border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">{{ old('description', $service->description) }}</textarea>
                        </div>

                        <div class="flex items-center justify-end mt-4">
                            <button type="submit" class="ml-4 inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 active:bg-gray-900 focus:outline-none focus:border-gray-900 focus:ring ring-gray-300 disabled:opacity-25 transition ease-in-out duration-150">
                                {{ __('Update') }}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/admin/listings/index.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Listing Management') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Title
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Creator
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Price
                                </th>
                                <th scope="col" class="relative px-6 py-3">
                                    <span class="sr-only">Edit</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            @foreach ($services as $service)
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900">{{ $service->title }}</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900">{{ $service->creator->name }}</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900">${{ number_format($service->price, 2) }}</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                        <a href="{{ route('admin.listings.edit', $service) }}" class="text-indigo-600 hover:text-indigo-900">Edit</a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>

                    <div class="mt-4">
                        {{ $services->links() }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/admin/settings/index.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Platform Settings') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    <form action="{{ route('admin.settings.update') }}" method="POST">
                        @csrf
                        @method('PUT')

                        <div>
                            <label for="platform_fee" class="block font-medium text-sm text-gray-700">Platform Fee (%)</label>
                            <input type="number" name="platform_fee" id="platform_fee" value="{{ old('platform_fee', config('serbizyu.platform_fee', 5)) }}" class="block mt-1 w-full rounded-md shadow-sm border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                        </div>

                        <div class="flex items-center justify-end mt-4">
                            <button type="submit" class="ml-4 inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 active:bg-gray-900 focus:outline-none focus:border-gray-900 focus:ring ring-gray-300 disabled:opacity-25 transition ease-in-out duration-150">
                                {{ __('Update Settings') }}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/admin/users/edit.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Edit User') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    <form action="{{ route('admin.users.update', $user) }}" method="POST">
                        @csrf
                        @method('PUT')

                        <div>
                            <label for="name" class="block font-medium text-sm text-gray-700">Name</label>
                            <input type="text" name="name" id="name" value="{{ old('name', $user->name) }}" class="block mt-1 w-full rounded-md shadow-sm border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                        </div>

                        <div class="mt-4">
                            <label for="email" class="block font-medium text-sm text-gray-700">Email</label>
                            <input type="email" name="email" id="email" value="{{ old('email', $user->email) }}" class="block mt-1 w-full rounded-md shadow-sm border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                        </div>

                        <div class="flex items-center justify-end mt-4">
                            <button type="submit" class="ml-4 inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 active:bg-gray-900 focus:outline-none focus:border-gray-900 focus:ring ring-gray-300 disabled:opacity-25 transition ease-in-out duration-150">
                                {{ __('Update') }}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/admin/users/index.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('User Management') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Name
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Email
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Role
                                </th>
                                <th scope="col" class="relative px-6 py-3">
                                    <span class="sr-only">Edit</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            @foreach ($users as $user)
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900">{{ $user->name }}</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900">{{ $user->email }}</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        @foreach ($user->getRoleNames() as $role)
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                                {{ $role }}
                                            </span>
                                        @endforeach
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                        <a href="{{ route('admin.users.edit', $user) }}" class="text-indigo-600 hover:text-indigo-900">Edit</a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>

                    <div class="mt-4">
                        {{ $users->links() }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/admin/verifications/index.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Pending Verifications') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    @if (session('success'))
                        <div class="mb-4 font-medium text-sm text-green-600">
                            {{ session('success') }}
                        </div>
                    @endif

                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID Type</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Submitted At</th>
                                <th scope="col" class="relative px-6 py-3">
                                    <span class="sr-only">View</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            @forelse ($verifications as $verification)
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ $verification->user->firstname }} {{ $verification->user->lastname }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ $verification->id_type }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ $verification->created_at->format('Y-m-d H:i') }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                        <a href="{{ route('admin.verifications.show', $verification) }}" class="text-indigo-600 hover:text-indigo-900">View</a>
                                    </td>
                                </tr>
                            @empty
                                <tr>
                                    <td colspan="4" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">No pending verifications.</td>
                                </tr>
                            @endforelse
                        </tbody>
                    </table>

                    <div class="mt-4">
                        {{ $verifications->links() }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/admin/verifications/show.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            Review Verification for {{ $verification->user->firstname }} {{ $verification->user->lastname }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-bold">User Details</h3>
                            <p><strong>Name:</strong> {{ $verification->user->firstname }} {{ $verification->user->lastname }}</p>
                            <p><strong>Email:</strong> {{ $verification->user->email }}</p>
                            <p><strong>ID Type:</strong> {{ $verification->id_type }}</p>
                            <p><strong>Submitted At:</strong> {{ $verification->created_at->format('Y-m-d H:i') }}</p>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold">Actions</h3>
                            <div class="mt-4 flex space-x-4">
                                <!-- Approve Form -->
                                <form method="POST" action="{{ route('admin.verifications.approve', $verification) }}">
                                    @csrf
                                    <x-primary-button>Approve</x-primary-button>
                                </form>

                                <!-- Reject Form -->
                                <form method="POST" action="{{ route('admin.verifications.reject', $verification) }}" x-data="{ showRejectReason: false }">
                                    @csrf
                                    <x-danger-button @click.prevent="showRejectReason = !showRejectReason">Reject</x-danger-button>

                                    <div x-show="showRejectReason" class="mt-4">
                                        <x-input-label for="rejection_reason" :value="__('Reason for Rejection')" />
                                        <textarea id="rejection_reason" name="rejection_reason" rows="3" class="block mt-1 w-full rounded-md shadow-sm border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" required></textarea>
                                        @error('rejection_reason')
                                            <p class="text-sm text-red-600 mt-1">{{ $message }}</p>
                                        @enderror
                                        <x-primary-button class="mt-2">Confirm Rejection</x-primary-button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8">
                        <h3 class="text-lg font-bold">Submitted Documents</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                            <div>
                                <h4 class="font-semibold">Front of ID</h4>
                                @if ($idFrontMedia)
                                    <img src="{{ route('media.serve', ['payload' => \Illuminate\Support\Facades\Crypt::encryptString(json_encode(['media_id' => $idFrontMedia->id]))]) }}" alt="Front of ID" class="mt-2 border rounded-md">
                                @else
                                    <p>No image uploaded.</p>
                                @endif
                            </div>
                            <div>
                                <h4 class="font-semibold">Back of ID</h4>
                                @if ($idBackMedia)
                                    <img src="{{ route('media.serve', ['payload' => \Illuminate\Support\Facades\Crypt::encryptString(json_encode(['media_id' => $idBackMedia->id]))]) }}" alt="Back of ID" class="mt-2 border rounded-md">
                                @else
                                    <p>No image uploaded.</p>
                                @endif
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/auth/confirm-password.blade.php
<x-app-layout cssFile="auth.css" title="Confirm Password">
  <section class="form-section">
    <div class="form-card">
      <div class="form-header">
        <div class="form-icon">
          <x-icons.lock class="w-8 h-8 text-green-500" />
        </div>
        <h2 class="form-title">Confirm your password</h2>
        <p class="form-subtitle">For your security, please confirm your password to continue.</p>
      </div>

      <form method="POST" action="{{ route('password.confirm') }}">
        @csrf
        <div class="mb-5">
          <label for="password" class="form-label">Password</label>
          <input id="password" name="password" type="password" class="form-input" required autocomplete="current-password">
          <x-input-error :messages="$errors->get('password')" class="mt-2" />
        </div>

        <button type="submit" class="form-button">Confirm</button>
      </form>

      <p class="form-footer">
        <a href="{{ route('auth.signin') }}" class="text-green-500 hover:underline font-medium">Back to Sign In</a>
      </p>
    </div>
  </section>
</x-app-layout>
----
--resources/views/auth/forgot-password.blade.php
<x-app-layout title="Forgot Password">
  <section class=" flex items-center justify-center min-h-screen bg-gradient-to-br from-green-100 via-white to-gray-100">
    <div class="my-5 bg-white shadow-2xl rounded-3xl p-10 w-full max-w-md border border-gray-100">
      <div class="form-header">
        <div class="form-icon">
          <x-icons.mail class="w-8 h-8 text-green-500" />
        </div>
        <h2 class="form-title">Forgot your password?</h2>
        <p class="form-subtitle">No worries  well send you a reset link.</p>
      </div>

      @if (session('status'))
        <div class="mb-4 text-sm text-green-600 dark:text-green-400">
          {{ session('status') }}
        </div>
      @endif

      <form method="POST" action="{{ route('password.email') }}">
        @csrf
        <div class="mb-5">
          <label for="email" class="form-label">Email address</label>
          <input type="email" id="email" name="email" class="form-input" placeholder="you@email.com" required autofocus>
          <x-input-error :messages="$errors->get('email')" class="mt-2" />
        </div>
        <button type="submit" class="form-button">Send Reset Link</button>
      </form>

      <p class="form-footer">
        <a href="{{ route('auth.signin') }}" class="text-green-500 hover:underline font-medium">Back to Sign In</a>
      </p>
    </div>
  </section>
</x-app-layout>
----
--resources/views/auth/join.blade.php
<x-app-layout title="Join">
  <section class=" flex items-center justify-center min-h-screen bg-gradient-to-br from-green-100 via-white to-gray-100">
    <div class="my-5 bg-white shadow-2xl rounded-3xl p-10 w-full max-w-md border border-gray-100">
      <!-- Header -->
      <div class="form-header">
        <div class="form-icon">
          <x-icons.profile class="w-8 h-8 text-green-500" />
        </div>
        <h2 class="form-title">Create a new account</h2>
        <p class="form-subtitle">Sign up to get started!</p>
      </div>

      <!-- Form -->
      <form method="POST" action="{{ route('auth.join') }}">
        @csrf
        <div class="mb-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label for="firstname" class="form-label">First Name</label>
            <input type="text" id="firstname" name="firstname" placeholder="First name" required class="form-input">
            <x-input-error :messages="$errors->get('firstname')" class="mt-2" />
          </div>
          <div>
            <label for="lastname" class="form-label">Last Name</label>
            <input type="text" id="lastname" name="lastname" placeholder="Last name" required class="form-input">
            <x-input-error :messages="$errors->get('lastname')" class="mt-2" />
          </div>
        </div>

        <div class="mb-4">
          <label for="email" class="form-label">Email</label>
          <input type="email" id="email" name="email" placeholder="you@email.com" required class="form-input">
          <x-input-error :messages="$errors->get('email')" class="mt-2" />
        </div>

        <div class="mb-4">
          <label for="password" class="form-label">Password</label>
          <input type="password" id="password" name="password" placeholder="Create a password" required class="form-input">
          <x-input-error :messages="$errors->get('password')" class="mt-2" />
        </div>

        <div class="mb-6">
          <label for="password_confirmation" class="form-label">Confirm Password</label>
          <input type="password" id="password_confirmation" name="password_confirmation" placeholder="Confirm your password" required class="form-input">
          <x-input-error :messages="$errors->get('password_confirmation')" class="mt-2" />
        </div>

        <button type="submit" class="form-button">Sign Up</button>
      </form>

      <!-- Divider -->
      <div class="form-divider">
        <div class="form-divider-line"></div>
        <span class="form-divider-text">or</span>
        <div class="form-divider-line"></div>
      </div>

      <!-- Google Sign Up -->
      <button class="form-alt-button">
        <img src="https://www.svgrepo.com/show/475656/google-color.svg" alt="Google" class="w-5 h-5">
        <span class="text-gray-700 font-medium">Sign up with Google</span>
      </button>

      <!-- Footer -->
      <p class="form-footer">
        Already have an account?
        <a href="{{ route('auth.signin') }}" class="text-green-500 hover:underline font-medium">Sign In</a>
      </p>
    </div>
  </section>

</x-app-layout>
----
--resources/views/auth/reset-password.blade.php
<x-app-layout title="Reset Password">
  <section class=" flex items-center justify-center min-h-screen bg-gradient-to-br from-green-100 via-white to-gray-100">
    <div class="my-5 bg-white shadow-2xl rounded-3xl p-10 w-full max-w-md border border-gray-100">
      <div class="form-header">
        <div class="form-icon">
          <x-icons.lock class="w-8 h-8 text-green-500" />
        </div>
        <h2 class="form-title">Reset your password</h2>
        <p class="form-subtitle">Enter your new password below.</p>
      </div>

      <form method="POST" action="{{ route('password.store') }}">
        @csrf
        <input type="hidden" name="token" value="{{ $request->route('token') }}">

        <div class="mb-4">
          <label for="email" class="form-label">Email</label>
          <input id="email" name="email" type="email" class="form-input" value="{{ old('email', $request->email) }}" required autofocus>
          <x-input-error :messages="$errors->get('email')" class="mt-2" />
        </div>

        <div class="mb-4">
          <label for="password" class="form-label">New Password</label>
          <input id="password" name="password" type="password" class="form-input" required>
          <x-input-error :messages="$errors->get('password')" class="mt-2" />
        </div>

        <div class="mb-6">
          <label for="password_confirmation" class="form-label">Confirm Password</label>
          <input id="password_confirmation" name="password_confirmation" type="password" class="form-input" required>
          <x-input-error :messages="$errors->get('password_confirmation')" class="mt-2" />
        </div>

        <button type="submit" class="form-button">Reset Password</button>
      </form>

      <p class="form-footer">
        <a href="{{ route('auth.signin') }}" class="text-green-500 hover:underline font-medium">Back to Sign In</a>
      </p>
    </div>
  </section>
</x-app-layout>
----
--resources/views/auth/signin.blade.php
<x-app-layout title="Sign In" >
    <section class=" flex items-center justify-center min-h-screen bg-gradient-to-br from-green-100 via-white to-gray-100">
        <div class="my-5 bg-white shadow-2xl rounded-3xl p-10 w-full max-w-md border border-gray-100">
            <div class="form-header">
            <div class="form-icon">
                <x-icons.profile></x-icons.profile>
            </div>
            <h2 class="form-title">Sign In</h2>
            <p class="form-subtitle">Welcome back! Please login in below.</p>
            </div>

            <form method="POST" action="{{ route('auth.signin') }}">
                @csrf
                <div class="mb-5">
                    <label class="form-label" for="email">Email</label>
                    <input class="form-input" name="email" type="email" id="email" placeholder="you@email.com" required>
                    <x-input-error :messages="$errors->get('email')" class="mt-2" />
                </div>
                <div class="mb-4">
                    <label class="form-label" for="password">Password</label>
                    <input class="form-input" name="password" type="password" id="password" placeholder="Enter your password" required  autocomplete="current-password" >
                    <x-input-error :messages="$errors->get('password')" class="mt-2" />
                </div>

                <div class="flex items-center justify-between mb-6">
                    <label class="flex items-center text-sm text-gray-600">
                    <input type="checkbox" class="mr-2 accent-green-500"> Remember me
                    </label>
                    <a href="{{ route('password.request') }}" class="text-green-500 hover:underline text-sm">Forgot password?</a>
                </div>

                <button type="submit" class="form-button">Sign In</button>
            </form>

            <div class="form-divider">
            <div class="form-divider-line"></div>
            <span class="form-divider-text">or</span>
            <div class="form-divider-line"></div>
            </div>

            <button class="form-alt-button">
            <img src="https://www.svgrepo.com/show/475656/google-color.svg" alt="Google" class="w-5 h-5">
            <span class="text-gray-700 font-medium">Sign in with Google</span>
            </button>

            <p class="form-footer">
            Don't have an account?
            <a href="{{route('auth.join')}}" class="text-green-500 hover:underline font-medium">Sign Up</a>
            </p>
        </div>
    </section>
</x-app-layout>
----
--resources/views/auth/verify-email.blade.php
<x-app-layout title="Verify Email">
  <section class=" flex items-center justify-center min-h-screen bg-gradient-to-br from-green-100 via-white to-gray-100">
    <div class="my-5 bg-white shadow-2xl rounded-3xl p-10 w-full max-w-md border border-gray-100">
      <div class="form-header">
        <div class="form-icon">
          <x-icons.mail-check class="w-8 h-8 text-green-500" />
        </div>
        <h2 class="form-title">Verify your email</h2>
        <p class="form-subtitle">Before continuing, please check your inbox for a verification link.</p>
      </div>

      @if (session('status') == 'verification-link-sent')
        <div class="mb-4 text-sm text-green-600 dark:text-green-400">
          A new verification link has been sent to your email address.
        </div>
      @endif

      <div class="flex flex-col gap-3">
        <form method="POST" action="{{ route('verification.send') }}">
          @csrf
          <button type="submit" class="form-button w-full">Resend Verification Email</button>
        </form>

        <form method="POST" action="{{ route('logout') }}">
          @csrf
          <button type="submit" class="form-alt-button text-gray-700 font-medium">Log Out</button>
        </form>
      </div>
    </div>
  </section>
</x-app-layout>
----
--resources/views/bids/show.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Bid Details') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 text-gray-900">
                    <h3 class="text-lg font-medium text-gray-900">Bid #{{ $bidId }}</h3>
                    <p class="mt-1 text-sm text-gray-600">
                        This is a placeholder for bid details.
                    </p>

                    <div class="mt-6">
                        <form action="{{ route('orders.fromBid', ['bid' => $bidId]) }}" method="POST">
                            @csrf
                            <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                Accept Bid and Create Order
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/components/application-logo.blade.php
@props(['align' => 'left'])

<div class="flex items-center {{ $align === 'center' ? 'justify-center' : 'justify-start' }}">
    <a href="{{ route('home') }}" class="text-2xl font-bold hover:opacity-50 transition-opacity">
        <span class="text-text dark:text-text-secondary">Serbizyu</span><span class="text-brand">.</span>
    </a>
</div>
----
--resources/views/components/auth-session-status.blade.php
@props(['status'])

@if ($status)
    <div {{ $attributes->merge(['class' => 'status-message status-success']) }}>
        {{ $status }}
    </div>
@endif
----
--resources/views/components/danger-button.blade.php
@props(['disabled' => false])

<button {{ $attributes->merge(['type' => 'submit', 'class' => 'btn btn-danger', 'disabled' => $disabled]) }}>
    {{ $slot }}
</button>
----
--resources/views/components/dropdown-link.blade.php
@props(['active' => false])

<a {{ $attributes->merge(['class' => "dropdown-link {{ $active ? 'dropdown-active' : 'dropdown-inactive' }}"]) }}>
    {{ $slot }}
</a>
----
--resources/views/components/dropdown.blade.php
@props(['align' => 'right', 'width' => '48', 'contentClasses' => 'py-1 bg-background dark:bg-secondary-dark'])

@php
$alignmentClasses = match ($align) {
    'left' => 'ltr:origin-top-left rtl:origin-top-right start-0',
    'top' => 'origin-top',
    default => 'ltr:origin-top-right rtl:origin-top-left end-0',
};

$width = match ($width) {
    '48' => 'w-48',
    default => $width,
};
@endphp

<div class="relative" x-data="{ open: false }" @click.outside="open = false" @close.stop="open = false">
    <div @click="open = ! open">
        {{ $trigger }}
    </div>

    <div x-show="open"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-75"
            x-transition:leave-start="opacity-100 scale-100"
            x-transition:leave-end="opacity-0 scale-95"
            class="absolute z-modal mt-2 {{ $width }} rounded-md shadow-md {{ $alignmentClasses }}"
            style="display: none;"
            @click="open = false">
        <div class="rounded-md ring-1 ring-secondary-dark ring-opacity-5 {{ $contentClasses }}">
            {{ $content }}
        </div>
    </div>
</div>
----
--resources/views/components/form.blade.php
@props(['align' => 'center', 'maxWidth' => 'md'])

@php
$alignment = match ($align) {
    'left' => 'form-wrapper-left',
    'right' => 'form-wrapper-right',
    default => 'form-wrapper-centered',
};

$maxW = match ($maxWidth) {
    'sm' => 'sm:max-w-sm',
    'md' => 'sm:max-w-md',
    'lg' => 'sm:max-w-lg',
    default => 'sm:max-w-md',
};
@endphp

<div class="form-wrapper {{ $alignment }}">
    <div class="form-container {{ $maxW }}">
        {{ $header ?? '' }}
        <form class="space-y-2">
            {{ $slot }}
        </form>
        {{ $footer ?? '' }}
    </div>
</div>
----
--resources/views/components/input-error.blade.php
@props(['messages'])

@if ($messages)
    <ul {{ $attributes->merge(['class' => 'form-error']) }}>
        @foreach ((array) $messages as $message)
            <li>{{ $message }}</li>
        @endforeach
    </ul>
@endif
----
--resources/views/components/input-label.blade.php
@props(['value'])

<label {{ $attributes->merge(['class' => 'form-label']) }}>
    {{ $value ?? $slot }}
</label>
----
--resources/views/components/modal.blade.php
@props([
    'name',
    'show' => false,
    'maxWidth' => '2xl'
])

@php
$maxWidth = [
    'sm' => 'sm:max-w-sm',
    'md' => 'sm:max-w-md',
    'lg' => 'sm:max-w-lg',
    'xl' => 'sm:max-w-xl',
    '2xl' => 'sm:max-w-2xl',
][$maxWidth];
@endphp

<div
    x-data="{ show: false }"
    x-on:open-modal.window="if ($event.detail === '{{ $name }}') { show = true; }"
    x-on:close-modal.window="if ($event.detail === '{{ $name }}') { show = false; }"
    x-on:keydown.escape.window="if (show) { show = false; }"
    x-show="show"
    x-cloak
    class="fixed inset-0 z-50 overflow-y-auto"
    style="display: none;"
>
    {{-- Backdrop --}}
    <div 
        x-show="show"
        x-transition.opacity
        class="fixed inset-0 bg-black/50"
        @click="show = false"
    ></div>

    {{-- Modal Panel --}}
    <div 
        x-show="show"
        x-transition.scale.origin.center
        @click.stop
        class="relative min-h-screen flex items-center justify-center p-4"
    >
        <div class="modal-content {{ $maxWidth }} bg-background dark:bg-secondary-dark rounded-xl shadow-xl">
            {{ $slot }}
        </div>
    </div>
</div>
----
--resources/views/components/order-status-badge.blade.php
@props(['status', 'type' => 'status'])

@php
    $statusColors = [
        'status' => [
            'pending' => 'bg-yellow-100 text-yellow-800',
            'in_progress' => 'bg-blue-100 text-blue-800',
            'completed' => 'bg-green-100 text-green-800',
            'cancelled' => 'bg-red-100 text-red-800',
            'disputed' => 'bg-orange-100 text-orange-800',
        ],
        'payment' => [
            'pending' => 'bg-yellow-100 text-yellow-800',
            'paid' => 'bg-green-100 text-green-800',
            'failed' => 'bg-red-100 text-red-800',
            'refunded' => 'bg-gray-100 text-gray-800',
        ]
    ];
    
    $colors = $statusColors[$type][$status] ?? 'bg-gray-100 text-gray-800';
    $label = ucfirst(str_replace('_', ' ', $status));
@endphp

<span {{ $attributes->merge(['class' => "px-3 py-1 rounded-full text-sm font-medium $colors"]) }}>
    {{ $label }}
</span>
----
--resources/views/components/order-timeline.blade.php
@props(['order'])

<div class="flow-root">
    <ul role="list" class="-mb-8">
        @foreach (['pending', 'in_progress', 'completed', 'cancelled', 'disputed'] as $status)
            @php
                $isCurrent = $order->status === $status;
                $isCompleted = array_search($status, ['pending', 'in_progress', 'completed', 'cancelled', 'disputed']) < array_search($order->status, ['pending', 'in_progress', 'completed', 'cancelled', 'disputed']);
            @endphp
            <li>
                <div class="relative pb-8">
                    @if (!$loop->last)
                        <span class="absolute left-4 top-4 -ml-px h-full w-0.5 bg-gray-200" aria-hidden="true"></span>
                    @endif
                    <div class="relative flex space-x-3">
                        <div>
                            @if ($isCompleted)
                                <span class="h-8 w-8 rounded-full bg-green-500 flex items-center justify-center ring-8 ring-white">
                                    <svg class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                        <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" />
                                    </svg>
                                </span>
                            @elseif ($isCurrent)
                                <span class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center ring-8 ring-white">
                                    <svg class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13.25a.75.75 0 00-1.5 0V9.5a.75.75 0 00.75.75h3.25a.75.75 0 000-1.5h-2.5V4.75z" clip-rule="evenodd" />
                                    </svg>
                                </span>
                            @else
                                <span class="h-8 w-8 rounded-full bg-gray-400 flex items-center justify-center ring-8 ring-white">
                                    <svg class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94l-1.72-1.72z" clip-rule="evenodd" />
                                    </svg>
                                </span>
                            @endif
                        </div>
                        <div class="flex min-w-0 flex-1 justify-between pt-1.5">
                            <div>
                                <p class="text-sm text-gray-500">
                                    <a href="#" class="font-medium text-gray-900">{{ ucfirst($status) }}</a>
                                </p>
                            </div>
                            <div class="whitespace-nowrap text-right text-sm text-gray-500">
                                @if ($isCurrent)
                                    <time datetime="2023-01-23T10:32">Current</time>
                                @endif
                            </div>
                        </div>
                    </div>
                </div>
            </li>
        @endforeach
    </ul>
</div>
----
--resources/views/components/outline-button.blade.php
@props(['disabled' => false])

<button {{ $attributes->merge(['type' => 'button', 'class' => 'btn btn-outline-white', 'disabled' => $disabled]) }}>
    {{ $slot }}
</button>
----
--resources/views/components/primary-button.blade.php
@props(['disabled' => false])

<button {{ $attributes->merge(['type' => 'submit', 'class' => 'btn btn-primary ms-4', 'disabled' => $disabled]) }}>
    {{ $slot }}
</button>
----
--resources/views/components/progress-bar.blade.php
@props([
    'percentage' => 0,
    'height' => 'h-3',
    'barColor' => 'bg-blue-600',
])

<div class="w-full bg-gray-200 rounded-full {{ $height }} overflow-hidden">
    <div class="{{ $barColor }} {{ $height }} rounded-full transition-all duration-500" 
         @style("width: {$percentage}%")>
    </div>
</div>
----
--resources/views/components/secondary-button.blade.php
@props(['disabled' => false])

<button {{ $attributes->merge(['type' => 'button', 'class' => 'btn btn-secondary', 'disabled' => $disabled]) }}>
    {{ $slot }}
</button>
----
--resources/views/components/text-input.blade.php
@props(['disabled' => false])

<input @disabled($disabled) {{ $attributes->merge(['class' => 'form-input']) }}>
----
--resources/views/components/admin/category-manager.blade.php
<x-app-layout title="Category Management">
    <div class="max-w-7xl mx-auto px-6 py-10">
        
        {{-- Success/Error Messages --}}
        @if(session('success'))
            <div class="mb-6 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg">
                {{ session('success') }}
            </div>
        @endif

        @if(session('error'))
            <div class="mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg">
                {{ session('error') }}
            </div>
        @endif

        {{-- Header --}}
        <div class="flex items-center justify-between mb-6">
            <div>
                <h2 class="text-2xl font-bold text-text dark:text-text-secondary">Category Management</h2>
                <p class="text-sm text-text-secondary dark:text-text mt-1">Manage service and listing categories</p>
            </div>
            <button 
                @click="$dispatch('open-modal', 'create-category')"
                class="btn btn-primary inline-flex items-center gap-2">
                <x-icons.plus class="w-5 h-5" />
                <span>Add Category</span>
            </button>
        </div>

        {{-- Category List --}}
        <div class="bg-background dark:bg-secondary-dark shadow-sm rounded-xl p-6 border border-secondary dark:border-secondary-dark">
            <h3 class="text-lg font-semibold text-text dark:text-text-secondary mb-4">Existing Categories</h3>

            @if($categories->isEmpty())
                <div class="text-center py-12">
                    <svg class="w-16 h-16 mx-auto text-text-secondary dark:text-text mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" 
                              d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                    </svg>
                    <p class="text-text-secondary dark:text-text">No categories found.</p>
                    <button @click="$dispatch('open-modal', 'create-category')" class="mt-4 text-brand hover:text-brand-dark font-medium text-sm">
                        Add your first category
                    </button>
                </div>
            @else
                <ul class="divide-y divide-secondary dark:divide-secondary-dark">
                    @foreach($categories as $category)
                        <li class="flex items-center justify-between py-4 hover:bg-background-secondary dark:hover:bg-secondary -mx-6 px-6 transition">
                            <div class="flex-1">
                                <p class="font-medium text-text dark:text-text-secondary">{{ $category->name }}</p>
                                <p class="text-sm text-text-secondary dark:text-text mt-0.5">
                                    {{ $category->description ?? 'No description' }}
                                </p>
                            </div>
                            <div class="flex items-center gap-2">
                                <button 
                                    @click="$dispatch('open-modal', 'edit-category-{{ $category->id }}')"
                                    class="px-3 py-1.5 text-sm bg-background-secondary dark:bg-secondary text-text-secondary dark:text-text hover:bg-secondary dark:hover:bg-secondary-dark rounded-md transition">
                                    Edit
                                </button>
                                <button 
                                    @click="$dispatch('open-modal', 'delete-category-{{ $category->id }}')"
                                    class="px-3 py-1.5 text-sm bg-red-50 dark:bg-red-900/20 text-error hover:bg-red-100 dark:hover:bg-red-900/30 rounded-md transition">
                                    Delete
                                </button>
                            </div>
                        </li>
                    @endforeach
                </ul>
            @endif
        </div>

        {{-- Create Modal --}}
        <x-modal name="create-category" maxWidth="lg">
            <div class="p-6">
                <h3 class="text-xl font-bold text-text dark:text-text-secondary mb-4">Add Category</h3>
                
                <form method="POST" action="{{ route('creator.categories.store') }}">
                    @csrf
                    <div class="space-y-4">
                        <div>
                            <label class="form-label">Category Name</label>
                            <input 
                                type="text" 
                                name="name" 
                                value="{{ old('name') }}"
                                class="form-input" 
                                placeholder="e.g., Home Repair, Catering"
                                required>
                            @error('name')
                                <p class="form-error">{{ $message }}</p>
                            @enderror
                        </div>
                        <div>
                            <label class="form-label">Description (Optional)</label>
                            <textarea 
                                name="description" 
                                rows="3" 
                                class="form-input"
                                placeholder="Brief description of this category">{{ old('description') }}</textarea>
                            @error('description')
                                <p class="form-error">{{ $message }}</p>
                            @enderror
                        </div>
                    </div>
                    <div class="flex justify-end gap-3 pt-4 border-t border-secondary dark:border-secondary-dark mt-6">
                        <button type="button" @click="$dispatch('close-modal', 'create-category')" class="btn btn-secondary">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            Create Category
                        </button>
                    </div>
                </form>
            </div>
        </x-modal>

        {{-- Edit Modals (one per category) --}}
        @foreach($categories as $category)
            <x-modal name="edit-category-{{ $category->id }}" maxWidth="lg">
                <div class="p-6">
                    <h3 class="text-xl font-bold text-text dark:text-text-secondary mb-4">Edit Category</h3>
                    
                    <form method="POST" action="{{ route('creator.categories.update', $category) }}">
                        @csrf
                        @method('PUT')
                        <div class="space-y-4">
                            <div>
                                <label class="form-label">Category Name</label>
                                <input 
                                    type="text" 
                                    name="name" 
                                    value="{{ old('name', $category->name) }}"
                                    class="form-input" 
                                    required>
                                @error('name')
                                    <p class="form-error">{{ $message }}</p>
                                @enderror
                            </div>
                            <div>
                                <label class="form-label">Description</label>
                                <textarea 
                                    name="description" 
                                    rows="3" 
                                    class="form-input">{{ old('description', $category->description) }}</textarea>
                                @error('description')
                                    <p class="form-error">{{ $message }}</p>
                                @enderror
                            </div>
                        </div>
                        <div class="flex justify-end gap-3 pt-4 border-t border-secondary dark:border-secondary-dark mt-6">
                            <button type="button" @click="$dispatch('close-modal', 'edit-category-{{ $category->id }}')" class="btn btn-secondary">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                Update Category
                            </button>
                        </div>
                    </form>
                </div>
            </x-modal>

            {{-- Delete Modal --}}
            <x-modal name="delete-category-{{ $category->id }}" maxWidth="md">
                <div class="p-6 text-center">
                    <x-icons.exclamation class="w-12 h-12 text-error mx-auto mb-4" />
                    
                    <h3 class="text-lg font-semibold mb-2 text-text dark:text-text-secondary">Delete Category</h3>
                    <p class="text-text-secondary dark:text-text mb-6">
                        Are you sure you want to delete <span class="font-medium">{{ $category->name }}</span>? 
                        This action cannot be undone.
                    </p>
                    
                    <form method="POST" action="{{ route('creator.categories.destroy', $category) }}">
                        @csrf
                        @method('DELETE')
                        <div class="flex justify-center gap-3">
                            <button type="button" @click="$dispatch('close-modal', 'delete-category-{{ $category->id }}')" class="btn btn-secondary">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-danger">
                                Delete Category
                            </button>
                        </div>
                    </form>
                </div>
            </x-modal>
        @endforeach
    </div>
</x-app-layout>
----
--resources/views/components/icons/exclamation.blade.php
<svg xmlns="http://www.w3.org/2000/svg" 
     {{ $attributes->merge(['class' => 'w-12 h-12']) }} 
     fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" 
        d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
</svg>
----
--resources/views/components/icons/filter.blade.php
<svg xmlns="http://www.w3.org/2000/svg" 
     {{ $attributes->merge(['class' => 'w-6 h-6']) }} 
     fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
  <path stroke-linecap="round" stroke-linejoin="round" 
        d="M3 4h18M4 9h16M6 14h12M10 19h4" />
</svg>
----
--resources/views/components/icons/lock.blade.php
<svg xmlns="http://www.w3.org/2000/svg"
     {{ $attributes->merge(['class' => 'w-10 h-10']) }}
     viewBox="0 0 24 24"
     fill="currentColor">
  <path fill-rule="evenodd" 
        d="M12 1.5a5.25 5.25 0 00-5.25 5.25v3H5.25A2.25 2.25 0 003 12v7.5A2.25 2.25 0 005.25 21.75h13.5A2.25 2.25 0 0021 19.5V12a2.25 2.25 0 00-2.25-2.25H17.25v-3A5.25 5.25 0 0012 1.5zM9.75 6.75a2.25 2.25 0 114.5 0v3h-4.5v-3z" 
        clip-rule="evenodd" />
</svg>
----
--resources/views/components/icons/mail-check.blade.php
<svg xmlns="http://www.w3.org/2000/svg"
     {{ $attributes->merge(['class' => 'w-10 h-10']) }}
     viewBox="0 0 24 24"
     fill="currentColor">
  <path d="M1.5 6.75A2.25 2.25 0 013.75 4.5h16.5A2.25 2.25 0 0122.5 6.75v10.5A2.25 2.25 0 0120.25 19.5H3.75A2.25 2.25 0 011.5 17.25V6.75zM3.75 6l7.815 6.187a.75.75 0 00.87 0L20.25 6H3.75zm9.03 6.97l3.22 3.22a.75.75 0 001.06-1.06l-3.72-3.72a.75.75 0 00-1.06 0l-1.97 1.97a.75.75 0 101.06 1.06l1.41-1.41z" />
</svg>
----
--resources/views/components/icons/mail.blade.php
<svg xmlns="http://www.w3.org/2000/svg"
     {{ $attributes->merge(['class' => 'w-10 h-10']) }}
     viewBox="0 0 24 24"
     fill="currentColor">
  <path d="M1.5 6.75A2.25 2.25 0 013.75 4.5h16.5A2.25 2.25 0 0122.5 6.75v10.5A2.25 2.25 0 0120.25 19.5H3.75A2.25 2.25 0 011.5 17.25V6.75zM3.75 6l7.815 6.187a.75.75 0 00.87 0L20.25 6H3.75z" />
</svg>
----
--resources/views/components/icons/plus.blade.php
<svg xmlns="http://www.w3.org/2000/svg" 
     {{ $attributes->merge(['class' => 'w-5 h-5']) }} 
     fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
</svg>
----
--resources/views/components/icons/profile.blade.php
<svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
  <circle cx="12" cy="8" r="4" stroke-linecap="round" stroke-linejoin="round"/>
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 21c0-4 4-7 8-7s8 3 8 7"/>
</svg>
----
--resources/views/components/icons/search.blade.php
<svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10"viewBox="0 0 20 20" fill="currentColor">
    <path fill-rule="evenodd" d="M12.9 14.32a8 8 0 111.414-1.414l4.387 4.387a1 1 0 01-1.414 1.414l-4.387-4.387zM8 14a6 6 0 100-12 6 6 0 000 12z" clip-rule="evenodd"/>
</svg>
----
--resources/views/components/listings/openoffer.blade.php
<?php 
  @props(['openoffer']);
  $budget = $openoffer->budget ?? 'N/A';
  
?>

<!-- Open Offer Card -->
<article class="listing-card">
  <div class="card-top">
    <span class="badge-offer">Open Offer</span>
    <span class="text-sm text-text-secondary">Budget: {{$openoffer->budget}}</span>
  </div>
  <h3 class="card-title">Looking for Catering Service</h3>
  <p class="card-desc">Event for 50 guests</p>
  <p class="card-meta">Sta. Cruz, Ilocos Sur</p>
  <div class="card-footer">
    <span class="text-xs text-text-secondary">Posted 2h ago</span>
    <div class="card-avatar"></div>
  </div>
</article>
----
--resources/views/components/listings/service.blade.php
<?php 
  /**
   * Service Card Component
   * 
   * @props ['service'] - Service model instance with relationships loaded
   * Expected relationships: category, creator, workflow, address
   */
  
  // Format price with peso sign
  $formattedPrice = "" . number_format($service->price ?? 0, 2);
  
  // Get pay_first label
  $paymentType = $service->pay_first ? 'Pay First' : 'Pay After';
  
  // Get workflow steps (shortened for display) order them by workTemplate->order_index
    $workflowSteps = '';
    if ($service->workflowTemplate && $service->workflowTemplate->workTemplates) {
        $steps = $service->workflowTemplate->workTemplates
            ->sortBy('order_index')
            ->pluck('title')
            ->toArray();
        $workflowSteps = implode('  ', $steps);
    }
  
  // Get location from address
  $location = $service->address ? 
    ($service->address->city ?? '') . ($service->address->province ? ', ' . $service->address->province : '') : 
    'Location not specified';
  
  // Get creator info
  $creatorName = $service->creator->name ?? 'Unknown';
  $creatorInitial = strtoupper(substr($creatorName, 0, 1)); // initials for now
  
  // Placeholder rating (you'll want to implement actual ratings later)
  $rating = '';
?>

<article class="listing-card">
    <div class="card-top">
        <span class="badge-service">Service</span>
        <span class="rating">{{ $rating }}</span>
    </div>
    
    <h3 class="card-title">{{ $service->title }}</h3>
    
    <p class="card-desc">{{ Str::limit($service->description, 80) }}</p>
    
    @if($service->workflow)
        <p class="card-desc text-xs italic">{{ $workflowSteps }}</p>
    @endif
    
    <p class="card-meta">Price: {{ $formattedPrice }}{{ $service->pay_first ? '/hr' : '' }}</p>
    
    <p class="card-meta"> {{ $location }}</p>
    
    @if($service->category)
        <p class="card-meta text-xs">
            <span class="text-gray-400">Category:</span> {{ $service->category->name }}
        </p>
    @endif
    
    <div class="card-footer">
        <span class="text-xs text-text-secondary">
            {{ $paymentType }}  {{ $service->created_at->diffForHumans() }}
        </span>
        <div class="card-avatar" title="{{ $creatorName }}">
            {{ $creatorInitial }}
        </div>
    </div>
</article>
----
--resources/views/components/nav/profile-dropdown.blade.php
@props(['authProfileData'])

<div x-data="{ open: false }" class="relative">
  {{-- Desktop trigger + dropdown (visible on md and up) --}}
  <div class="hidden md:flex items-center">
    <button @click="open = !open" class="navbar-profile-trigger" aria-expanded="false">
      @if($authProfileData && $authProfileData['img_path'])
        <img src="{{ asset($authProfileData['img_path']) }}" alt="Profile" class="navbar-profile-img" />
      @else
          <div class="bg-brand-100">
            <x-icons.profile class="w-8 h-8 text-green-500" />
        </div>
      @endif
    </button>

    {{-- dropdown (desktop) --}}
    <div 
      x-show="open" 
      @click.away="open = false"
      x-cloak
      x-transition
      class="navbar-profile-dropdown"
      style="display: none;"
    >
      <div class="px-4 py-2 border-b">
        <span class="font-semibold text-sm">{{ $authProfileData['greeting'] ?? 'Hi, User!' }}</span>
        @if($authProfileData['email'])
          <div class="text-xs text-text-secondary truncate">{{ $authProfileData['email'] }}</div>
        @endif
      </div>

      <a href="{{ route('profile.edit') }}" class="navbar-profile-item">Profile</a>
      <a href="{{ route('creator.dashboard') }}" class="navbar-profile-item">Creator Space</a>

      <form method="POST" action="{{ route('logout') }}">
        @csrf
        <button type="submit" class="navbar-profile-item w-full text-left">Logout</button>
      </form>
    </div>
  </div>

  {{-- Mobile stacked UI (visible under md) --}}
  <div class="md:hidden">
    <div class="flex flex-col items-center space-y-3">
      {{-- profile icon --}}
      <div>
        @if($authProfileData && $authProfileData['img_path'])
          <img src="{{ asset($authProfileData['img_path']) }}" alt="Profile" class="navbar-profile-img" />
        @else
            <a class="p-5 bg-brand-100" href="{{ route('profile.edit') }}" class="w-full">
                <x-icons.profile class="w-6 h-6 text-green-500" />
            </a>
        @endif
      </div>

    

      <a href="{{ route('creator.dashboard') }}" class="w-full">
        <button class="navbar-creator-btn w-full">Creator Space</button>
      </a>

      <form method="POST" action="{{ route('logout') }}" class="w-full">
        @csrf
        <button type="submit" class="navbar-mobile-button w-full">Logout</button>
      </form>
    </div>
  </div>
</div>
----
--resources/views/creator/work-dashboard.blade.php
<x-app-layout>
    <x-slot name="header">
        <div>
            <h2 class="font-semibold text-xl text-gray-800 leading-tight">
                {{ __('Seller Work Dashboard') }}
            </h2>
            <p class="mt-1 text-sm text-gray-600">
                Manage your ongoing work and orders
            </p>
        </div>
    </x-slot>

    <div class="py-12">
        <div class="max-w-6xl mx-auto sm:px-6 lg:px-8">
            <!-- Stats Overview -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="bg-white overflow-hidden shadow-sm rounded-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 font-medium">Total Orders</p>
                            <p class="text-3xl font-bold text-gray-900">{{ $workInstances->count() }}</p>
                        </div>
                        <div class="p-3 bg-blue-100 rounded-lg">
                            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2v-9a2 2 0 012-2z" />
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-white overflow-hidden shadow-sm rounded-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 font-medium">In Progress</p>
                            <p class="text-3xl font-bold text-blue-600">{{ $workInstances->where('status', 'in_progress')->count() }}</p>
                        </div>
                        <div class="p-3 bg-blue-100 rounded-lg">
                            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-white overflow-hidden shadow-sm rounded-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 font-medium">Completed</p>
                            <p class="text-3xl font-bold text-green-600">{{ $workInstances->where('status', 'completed')->count() }}</p>
                        </div>
                        <div class="p-3 bg-green-100 rounded-lg">
                            <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-white overflow-hidden shadow-sm rounded-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 font-medium">Not Started</p>
                            <p class="text-3xl font-bold text-yellow-600">{{ $workInstances->where('status', 'pending')->count() }}</p>
                        </div>
                        <div class="p-3 bg-yellow-100 rounded-lg">
                            <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Work Instances List -->
            <div class="bg-white overflow-hidden shadow-sm rounded-lg">
                <div class="p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-6">Your Work Orders</h3>

                    @if ($workInstances->isEmpty())
                        <div class="text-center py-12">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                            </svg>
                            <h3 class="mt-2 text-lg font-medium text-gray-900">No work orders yet</h3>
                            <p class="mt-1 text-sm text-gray-500">You don't have any active work orders at the moment.</p>
                        </div>
                    @else
                        <div class="space-y-4">
                            @foreach ($workInstances as $workInstance)
                                <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
                                    <div class="flex justify-between items-start mb-3">
                                        <div class="flex-1">
                                            <div class="flex items-center gap-3 mb-1">
                                                <h4 class="font-semibold text-gray-900">
                                                    {{ $workInstance->order->service?->title ?? 'Service' }}
                                                </h4>
                                                <span class="px-2 py-1 text-xs font-medium rounded {{ $workInstance->status === 'completed' ? 'bg-green-100 text-green-800' : ($workInstance->status === 'in_progress' ? 'bg-blue-100 text-blue-800' : 'bg-yellow-100 text-yellow-800') }}">
                                                    {{ ucfirst(str_replace('_', ' ', $workInstance->status)) }}
                                                </span>
                                            </div>
                                            <p class="text-sm text-gray-600">
                                                Order #{{ $workInstance->order->id }}  Buyer: {{ $workInstance->order->buyer->name }}
                                            </p>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-lg font-bold text-gray-900">{{ number_format($workInstance->order->service?->price ?? 0, 2) }}</p>
                                            <p class="text-xs text-gray-500">{{ $workInstance->started_at?->format('M d, Y') ?? 'Not started' }}</p>
                                        </div>
                                    </div>

                                    <!-- Progress Bar -->
                                    <div class="mb-3">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="text-xs font-medium text-gray-600">Progress</span>
                                            <span class="text-xs font-semibold text-gray-900">{{ $workInstance->getProgressPercentage() }}%</span>
                                        </div>
                                        <x-progress-bar :percentage="$workInstance->getProgressPercentage()" height="h-2" barColor="bg-green-500" />
                                    </div>

                                    <!-- Current Step -->
                                    @if($currentStep = $workInstance->getCurrentStep())
                                        <div class="mb-3 p-2 bg-blue-50 rounded border border-blue-200">
                                            <p class="text-xs font-medium text-blue-900">
                                                Current: {{ $currentStep->workTemplate?->name ?? 'Step ' . ($currentStep->step_index + 1) }}
                                            </p>
                                            <div class="flex gap-2 mt-2">
                                                @if(!$currentStep->isInProgress())
                                                    <form action="{{ route('work-instances.steps.start', [$workInstance, $currentStep]) }}" method="POST" class="inline">
                                                        @csrf
                                                        <button type="submit" class="px-2 py-1 text-xs bg-blue-600 text-white font-medium rounded hover:bg-blue-700 transition">
                                                            Start
                                                        </button>
                                                    </form>
                                                @endif
                                                @if($currentStep->isInProgress())
                                                    <form action="{{ route('work-instances.steps.complete', [$workInstance, $currentStep]) }}" method="POST" class="inline">
                                                        @csrf
                                                        <button type="submit" class="px-2 py-1 text-xs bg-green-600 text-white font-medium rounded hover:bg-green-700 transition">
                                                            Complete
                                                        </button>
                                                    </form>
                                                @endif
                                            </div>
                                        </div>
                                    @elseif($workInstance->isCompleted())
                                        <div class="mb-3 p-2 bg-green-50 rounded border border-green-200">
                                            <p class="text-xs font-medium text-green-900"> All steps completed</p>
                                        </div>
                                    @endif

                                    <!-- Step Summary -->
                                    <div class="flex justify-between text-xs text-gray-600 mb-3 pb-3 border-b border-gray-100">
                                        <span>{{ $workInstance->workInstanceSteps()->count() }} total steps</span>
                                        <span>{{ $workInstance->getCompletedSteps()->count() }} completed</span>
                                        <span>{{ $workInstance->workInstanceSteps()->where('status', '!=', 'completed')->count() }} remaining</span>
                                    </div>

                                    <!-- Action Button -->
                                    <a href="{{ route('work-instances.show', $workInstance) }}" class="inline-flex items-center px-3 py-1 text-sm font-medium text-blue-600 hover:text-blue-700 hover:underline transition">
                                        View Full Details 
                                    </a>
                                </div>
                            @endforeach
                        </div>
                    @endif
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/creator/categories/edit.blade.php
<x-app-layout title="Edit Category">
    <div class="max-w-7xl mx-auto px-6 py-10">
        <div class="flex items-center justify-between mb-6">
            <div>
                <h2 class="text-2xl font-bold text-text dark:text-text-secondary">Edit Category</h2>
            </div>
        </div>

        <div class="bg-white dark:bg-secondary-dark shadow-sm rounded-xl p-6 border border-secondary dark:border-secondary-dark">
            <form method="POST" action="{{ route('creator.categories.update', $category) }}">
                @csrf
                @method('PUT')
                <div class="space-y-4">
                    <div>
                        <label class="form-label">Category Name</label>
                        <input 
                            type="text" 
                            name="name" 
                            value="{{ old('name', $category->name) }}"
                            class="form-input" 
                            required>
                        @error('name')
                            <p class="form-error">{{ $message }}</p>
                        @enderror
                    </div>
                    <div>
                        <label class="form-label">Description</label>
                        <textarea 
                            name="description" 
                            rows="3" 
                            class="form-input">{{ old('description', $category->description) }}</textarea>
                        @error('description')
                            <p class="form-error">{{ $message }}</p>
                        @enderror
                    </div>
                </div>
                <div class="flex justify-end gap-3 pt-4 border-t border-secondary dark:border-secondary-dark mt-6">
                    <a href="{{ route('creator.categories.index') }}" class="btn btn-secondary">
                        Cancel
                    </a>
                    <button type="submit" class="btn btn-primary">
                        Update Category
                    </button>
                </div>
            </form>
        </div>
    </div>
</x-app-layout>
----
--resources/views/creator/categories/index.blade.php
<x-app-layout title="Category Management">
    <div class="max-w-7xl mx-auto px-6 py-10">
        
        {{-- Success/Error Messages --}}
        @if(session('success'))
            <div class="mb-6 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg">
                {{ session('success') }}
            </div>
        @endif

        @if(session('error'))
            <div class="mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg">
                {{ session('error') }}
            </div>
        @endif

        {{-- Header --}}
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4">
            <div>
                <h2 class="text-2xl font-bold text-text dark:text-text-secondary">Category Management</h2>
                <p class="text-sm text-text-secondary dark:text-text mt-1">Manage service and listing categories</p>
            </div>
            <button 
                x-data
                @click.prevent="$dispatch('open-modal', 'create-category')"
                type="button"
                class="btn btn-primary inline-flex items-center gap-2">
                <x-icons.plus class="w-5 h-5" />
                <span>Add Category</span>
            </button>
        </div>

        {{-- Filters Section --}}
        <div class="bg-background dark:bg-secondary-dark shadow-sm rounded-xl p-4 mb-6 border border-secondary dark:border-secondary-dark">
            <form method="GET" action="{{ route('creator.categories.index') }}" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    {{-- Search --}}
                    <div>
                        <label class="form-label text-xs">Search</label>
                        <input 
                            type="text" 
                            name="search" 
                            value="{{ request('search') }}"
                            class="form-input text-sm" 
                            placeholder="Search categories...">
                    </div>

                    {{-- Status Filter --}}
                    <div>
                        <label class="form-label text-xs">Status</label>
                        <input type="hidden" name="status" value="{{ request('status', 'all') }}">
                        <select name="status" class="form-input text-sm">
                            <option value="all" {{ old('status', request('status')) === 'all' ? 'selected' : '' }}>All</option>
                            <option value="active" {{ old('status', request('status')) === 'active' ? 'selected' : '' }}>Active Only</option>
                            <option value="deleted" {{ old('status', request('status')) === 'deleted' ? 'selected' : '' }}>Deleted Only</option>
                        </select>
                    </div>

                    {{-- Per Page --}}
                    <div>
                        <label class="form-label text-xs">Items per page</label>
                        <select name="per_page" class="form-input text-sm">
                            <option value="10" {{ request('per_page') == 10 ? 'selected' : '' }}>10</option>
                            <option value="15" {{ request('per_page', 15) == 15 ? 'selected' : '' }}>15</option>
                            <option value="25" {{ request('per_page') == 25 ? 'selected' : '' }}>25</option>
                            <option value="50" {{ request('per_page') == 50 ? 'selected' : '' }}>50</option>
                        </select>
                    </div>

                    {{-- Actions --}}
                    <div class="flex items-end gap-2">
                        <button type="submit" class="btn btn-primary text-sm flex-1">
                            Apply
                        </button>
                        <a href="{{ route('creator.categories.index') }}" class="btn btn-secondary text-sm">
                            Reset
                        </a>
                    </div>
                </div>
            </form>
        </div>

        {{-- Category List --}}
        <div class="bg-background dark:bg-secondary-dark shadow-sm rounded-xl p-6 border border-secondary dark:border-secondary-dark">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-text dark:text-text-secondary">
                    Categories 
                    <span class="text-sm text-text-secondary">
                        ({{ $categories->total() }} total)
                    </span>
                </h3>
            </div>

            @if($categories->isEmpty())
                <div class="text-center py-12">
                    <svg class="w-16 h-16 mx-auto text-text-secondary dark:text-text mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" 
                              d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                    </svg>
                    <p class="text-text-secondary dark:text-text mb-2">No categories found.</p>
                    @if(request()->hasAny(['search', 'status']))
                        <a href="{{ route('creator.categories.index') }}" class="text-brand hover:text-brand-dark font-medium text-sm">
                            Clear filters
                        </a>
                    @else
                        <button 
                            x-data
                            @click.prevent="$dispatch('open-modal', 'create-category')"
                            type="button" 
                            class="mt-4 text-brand hover:text-brand-dark font-medium text-sm">
                            Add your first category
                        </button>
                    @endif
                </div>
            @else
                <ul class="divide-y divide-secondary dark:divide-secondary-dark">
                    @foreach($categories as $category)
                        <li class="flex items-center justify-between py-4 hover:bg-background-secondary dark:hover:bg-secondary -mx-6 px-6 transition
                            {{ $category->trashed() ? 'opacity-60' : '' }}">
                            <div class="flex-1">
                                <div class="flex items-center gap-2">
                                    <p class="font-medium text-text dark:text-text-secondary">
                                        {{ $category->name }}
                                    </p>
                                    @if($category->trashed())
                                        <span class="px-2 py-0.5 text-xs bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400 rounded">
                                            Deleted
                                        </span>
                                    @endif
                                </div>
                                <p class="text-sm text-text-secondary dark:text-text mt-0.5">
                                    {{ $category->description ?? 'No description' }}
                                </p>
                                @if($category->trashed())
                                    <p class="text-xs text-text-secondary dark:text-text mt-1">
                                        Deleted {{ $category->deleted_at->diffForHumans() }}
                                    </p>
                                @endif
                            </div>
                            <div class="flex items-center gap-2" x-data>
                                @if($category->trashed())
                                    {{-- Restore Button --}}
                                    <form method="POST" action="{{ route('creator.categories.restore', $category) }}" class="inline">
                                        @csrf
                                        @method('PATCH')
                                        <button 
                                            type="submit"
                                            class="px-3 py-1.5 text-sm bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400 hover:bg-green-100 dark:hover:bg-green-900/30 rounded-md transition">
                                            Restore
                                        </button>
                                    </form>
                                    {{-- Permanent Delete --}}
                                    <button 
                                        @click.prevent="$dispatch('open-modal', 'force-delete-category-{{ $category->id }}')"
                                        type="button"
                                        class="px-3 py-1.5 text-sm bg-red-100 dark:bg-red-900/40 text-red-800 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-900/60 rounded-md transition">
                                        Delete Forever
                                    </button>
                                @else
                                    {{-- Edit Button --}}
                                    <button 
                                        @click.prevent="$dispatch('open-modal', 'edit-category-{{ $category->id }}')"
                                        type="button"
                                        class="px-3 py-1.5 text-sm bg-background-secondary dark:bg-secondary text-text-secondary dark:text-text hover:bg-secondary dark:hover:bg-secondary-dark rounded-md transition">
                                        Edit
                                    </button>
                                    {{-- Delete Button --}}
                                    <button 
                                        @click.prevent="$dispatch('open-modal', 'delete-category-{{ $category->id }}')"
                                        type="button"
                                        class="px-3 py-1.5 text-sm bg-red-50 dark:bg-red-900/20 text-error hover:bg-red-100 dark:hover:bg-red-900/30 rounded-md transition">
                                        Delete
                                    </button>
                                @endif
                            </div>
                        </li>
                    @endforeach
                </ul>

                {{-- Pagination --}}
                <div class="mt-6">
                    {{ $categories->links() }}
                </div>
            @endif
        </div>

        {{-- Create Modal --}}
        <x-modal name="create-category" maxWidth="lg">
            <div class="p-6">
                <h3 class="text-xl font-bold text-text dark:text-text-secondary mb-4">Add Category</h3>
                
                <form method="POST" action="{{ route('creator.categories.store') }}">
                    @csrf
                    <div class="space-y-4">
                        <div>
                            <label class="form-label">Category Name</label>
                            <input 
                                type="text" 
                                name="name" 
                                value="{{ old('name') }}"
                                class="form-input" 
                                placeholder="e.g., Home Repair, Catering"
                                required>
                            @error('name')
                                <p class="form-error">{{ $message }}</p>
                            @enderror
                        </div>
                        <div>
                            <label class="form-label">Description (Optional)</label>
                            <textarea 
                                name="description" 
                                rows="3" 
                                class="form-input"
                                placeholder="Brief description of this category">{{ old('description') }}</textarea>
                            @error('description')
                                <p class="form-error">{{ $message }}</p>
                            @enderror
                        </div>
                    </div>
                    <div class="flex justify-end gap-3 pt-4 border-t border-secondary dark:border-secondary-dark mt-6">
                        <button 
                            type="button" 
                            x-data
                            @click.prevent="$dispatch('close-modal', 'create-category')" 
                            class="btn btn-secondary">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            Create Category
                        </button>
                    </div>
                </form>
            </div>
        </x-modal>

        {{-- Edit & Delete Modals --}}
        @foreach($categories as $category)
            {{-- Edit Modal --}}
            @if(!$category->trashed())
                <x-modal name="edit-category-{{ $category->id }}" maxWidth="lg">
                    <div class="p-6">
                        <h3 class="text-xl font-bold text-text dark:text-text-secondary mb-4">Edit Category</h3>
                        
                        <form method="POST" action="{{ route('creator.categories.update', $category) }}">
                            @csrf
                            @method('PUT')
                            <div class="space-y-4">
                                <div>
                                    <label class="form-label">Category Name</label>
                                    <input 
                                        type="text" 
                                        name="name" 
                                        value="{{ old('name', $category->name) }}"
                                        class="form-input" 
                                        required>
                                    @error('name')
                                        <p class="form-error">{{ $message }}</p>
                                    @enderror
                                </div>
                                <div>
                                    <label class="form-label">Description</label>
                                    <textarea 
                                        name="description" 
                                        rows="3" 
                                        class="form-input">{{ old('description', $category->description) }}</textarea>
                                    @error('description')
                                        <p class="form-error">{{ $message }}</p>
                                    @enderror
                                </div>
                            </div>
                            <div class="flex justify-end gap-3 pt-4 border-t border-secondary dark:border-secondary-dark mt-6">
                                <button 
                                    type="button" 
                                    x-data
                                    @click.prevent="$dispatch('close-modal', 'edit-category-{{ $category->id }}')" 
                                    class="btn btn-secondary">
                                    Cancel
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    Update Category
                                </button>
                            </div>
                        </form>
                    </div>
                </x-modal>

                {{-- Soft Delete Modal --}}
                <x-modal name="delete-category-{{ $category->id }}" maxWidth="md">
                    <div class="p-6">
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0">
                                <x-icons.exclamation class="w-12 h-12 text-error" />
                            </div>
                            <div class="flex-1">
                                <h3 class="text-lg font-semibold mb-2 text-text dark:text-text-secondary">
                                    Delete Category
                                </h3>
                                <p class="text-text-secondary dark:text-text mb-4">
                                    Are you sure you want to delete <span class="font-medium">{{ $category->name }}</span>?
                                </p>
                                
                                <div class="bg-background-secondary dark:bg-secondary p-3 rounded-lg mb-4">
                                    <p class="text-sm text-text-secondary dark:text-text">
                                        <strong>Soft Delete:</strong> The category will be hidden but can be restored later.
                                    </p>
                                </div>

                                <form method="POST" action="{{ route('creator.categories.destroy', $category) }}">
                                    @csrf
                                    @method('DELETE')
                                    <input type="hidden" name="delete_type" value="soft">
                                    
                                    <div class="flex justify-end gap-3">
                                        <button 
                                            type="button" 
                                            x-data
                                            @click.prevent="$dispatch('close-modal', 'delete-category-{{ $category->id }}')" 
                                            class="btn btn-secondary">
                                            Cancel
                                        </button>
                                        <button type="submit" class="btn btn-danger">
                                            Delete Category
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </x-modal>
            @endif

            {{-- Force Delete Modal (for already soft-deleted items) --}}
            @if($category->trashed())
                <x-modal name="force-delete-category-{{ $category->id }}" maxWidth="md">
                    <div class="p-6">
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center">
                                    <svg class="w-6 h-6 text-error" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                              d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                    </svg>
                                </div>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-lg font-semibold mb-2 text-error">
                                    Permanent Delete
                                </h3>
                                <p class="text-text-secondary dark:text-text mb-4">
                                    Are you sure you want to <strong>permanently delete</strong> <span class="font-medium">{{ $category->name }}</span>?
                                </p>
                                
                                <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-900/40 p-3 rounded-lg mb-4">
                                    <p class="text-sm text-red-800 dark:text-red-300">
                                        <strong> Warning:</strong> This action cannot be undone. All data associated with this category will be permanently removed.
                                    </p>
                                </div>

                                <form method="POST" action="{{ route('creator.categories.destroy', $category) }}">
                                    @csrf
                                    @method('DELETE')
                                    <input type="hidden" name="delete_type" value="force">
                                    
                                    <div class="flex justify-end gap-3">
                                        <button 
                                            type="button" 
                                            x-data
                                            @click.prevent="$dispatch('close-modal', 'force-delete-category-{{ $category->id }}')" 
                                            class="btn btn-secondary">
                                            Cancel
                                        </button>
                                        <button type="submit" class="btn btn-danger">
                                            Delete Forever
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </x-modal>
            @endif
        @endforeach
    </div>
</x-app-layout>
----
--resources/views/creator/offers/create.blade.php
{{-- resources/views/creator/offers/create.blade.php --}}
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800">
            Create Open Offer
        </h2>
    </x-slot>

    <div class="py-6">
        <div class="max-w-4xl mx-auto">
            <livewire:open-offer-form />
        </div>
    </div>
</x-app-layout>
----
--resources/views/creator/offers/edit.blade.php
{{-- resources/views/creator/offers/edit.blade.php --}}
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800">
            Edit Open Offer
        </h2>
    </x-slot>

    <div class="py-6">
        <div class="max-w-4xl mx-auto">
            <livewire:open-offer-form :offer="$offer" />
        </div>
    </div>
</x-app-layout>
----
--resources/views/creator/offers/index.blade.php
{{-- resources/views/creator/offers/index.blade.php --}}
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800">
            Open Offers
        </h2>
    </x-slot>

    <div class="py-6">
        <a href="{{ route('creator.offers.create') }}" class="btn-primary">
            Create Open Offer
        </a>

        <div class="mt-4">
            @if ($offers->count() === 0)
                <p>No open offers yet.</p>
            @else
                <table class="table-auto w-full border">
                    <thead>
                        <tr>
                            <th class="px-4 py-2 border">Title</th>
                            <th class="px-4 py-2 border">Budget</th>
                            <th class="px-4 py-2 border">Category</th>
                            <th class="px-4 py-2 border">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach ($offers as $offer)
                            <tr>
                                <td class="border px-4 py-2">{{ $offer->title }}</td>
                                <td class="border px-4 py-2">{{ number_format($offer->budget, 2) }}</td>
                                <td class="border px-4 py-2">{{ $offer->category?->name }}</td>
                                <td class="border px-4 py-2">
                                    <a href="{{ route('creator.offers.show', $offer) }}" class="text-blue-600">View</a>
                                    |
                                    <a href="{{ route('creator.offers.edit', $offer) }}" class="text-yellow-600">Edit</a>
                                    |
                                    <form method="POST" action="{{ route('creator.offers.destroy', $offer) }}" class="inline">
                                        @csrf
                                        @method('DELETE')
                                        <button onclick="return confirm('Delete this offer?')" class="text-red-600">
                                            Delete
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        @endforeach
                    </tbody>
                </table>

                <div class="mt-4">
                    {{ $offers->links() }}
                </div>

            @endif
        </div>
    </div>
</x-app-layout>
----
--resources/views/creator/offers/show.blade.php
{{-- resources/views/creator/offers/show.blade.php --}}
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800">
            {{ $offer->title }}
        </h2>
    </x-slot>

    <div class="py-6 max-w-4xl mx-auto">

        <div class="mb-4">
            <strong>Budget:</strong> {{ number_format($offer->budget, 2) }}
        </div>

        <div class="mb-4">
            <strong>Category:</strong> {{ $offer->category?->name }}
        </div>

        @if ($offer->workflow_template_id)
            <div class="mb-4">
                <strong>Workflow:</strong> {{ $offer->workflowTemplate->name }}
            </div>
        @endif

        @if ($offer->address_id)
            <div class="mb-4">
                <strong>Address:</strong> ID {{ $offer->address_id }}
            </div>
        @endif

        <div class="mb-4">
            <strong>Description:</strong>
            <p>{{ $offer->description }}</p>
        </div>

        <div class="mb-4">
            <strong>Images:</strong>
            <div class="flex flex-wrap gap-3 mt-2">
                @foreach ($offer->getMedia('gallery') as $media)
                    <img src="{{ route('media.serve', ['payload' => encrypt(json_encode(['media_id' => $media->id]))]) }}"
                         class="w-32 h-32 object-cover border rounded" />
                @endforeach
            </div>
        </div>

        {{-- Placeholder for future bidding modal --}}
        <div class="mt-6">
            <p class="text-gray-500 italic">Bidding features will appear here</p>
        </div>

    </div>
</x-app-layout>
----
--resources/views/creator/services/create.blade.php
<x-app-layout>
    <div class="py-6">
        <div class="max-w-lg mx-auto px-4 sm:px-6 lg:px-8">
            <livewire:service-form 
                :categories="$categories"
                :workflowTemplates="$workflowTemplates"
                :addresses="$addresses"
                :key="'service-form-create'"
            />
        </div>
    </div>
</x-app-layout>
----
--resources/views/creator/services/edit.blade.php
<x-app-layout>
    <div class="py-6">
        <div class="max-w-lg mx-auto px-4 sm:px-6 lg:px-8">
            <livewire:service-form 
                :service="$service"
                :categories="$categories"
                :workflowTemplates="$workflowTemplates"
                :addresses="$addresses"
                :key="'service-form-'.$service->id"
            />
        </div>
    </div>
</x-app-layout>
----
--resources/views/creator/services/index.blade.php
<x-app-layout>
    <x-slot name="header">
        <div class="flex justify-between items-center">
            <h2 class="font-semibold text-xl text-gray-800 leading-tight">
                {{ __('My Services') }}
            </h2>
            <a href="{{ route('creator.services.create') }}" 
                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition shadow-md flex items-center space-x-2">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                <span>Add New Service</span>
            </a>
        </div>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <!-- Session Messages -->
            @if (session('success'))
                <div class="mb-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg relative" role="alert">
                    <span class="block sm:inline">{{ session('success') }}</span>
                </div>
            @endif
            @if (session('error'))
                <div class="mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative" role="alert">
                    <span class="block sm:inline">{{ session('error') }}</span>
                </div>
            @endif

            <!-- Filtering and Sorting Form -->
            <div class="mb-6 bg-white p-6 rounded-lg shadow-md">
                <form action="{{ route('creator.services.index') }}" method="GET" class="space-y-4 md:space-y-0 md:flex md:gap-4 items-end">
                    <div class="flex-1">
                        <label for="search" class="block text-sm font-medium text-gray-700">Search</label>
                        <input type="text" name="search" id="search" value="{{ request('search') }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                               placeholder="Search services...">
                    </div>

                    <div>
                        <label for="category" class="block text-sm font-medium text-gray-700">Category</label>
                        <select name="category" id="category"
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <option value="">All Categories</option>
                            @foreach($categories as $category)
                                <option value="{{ $category->id }}" @selected(request('category') == $category->id)>
                                    {{ $category->name }}
                                </option>
                            @endforeach
                        </select>
                    </div>

                    <div>
                        <label for="sort_by" class="block text-sm font-medium text-gray-700">Sort By</label>
                        <select name="sort_by" id="sort_by"
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <option value="created_at" @selected(request('sort_by', 'created_at') == 'created_at')>Created At</option>
                            <option value="price" @selected(request('sort_by') == 'price')>Price</option>
                            <option value="title" @selected(request('sort_by') == 'title')>Title</option>
                        </select>
                    </div>

                    <div>
                        <label for="sort_direction" class="block text-sm font-medium text-gray-700">Direction</label>
                        <select name="sort_direction" id="sort_direction"
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <option value="desc" @selected(request('sort_direction', 'desc') == 'desc')>Descending</option>
                            <option value="asc" @selected(request('sort_direction') == 'asc')>Ascending</option>
                        </select>
                    </div>

                    <div>
                        <button type="submit"
                                class="w-full md:w-auto px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                            Apply Filters
                        </button>
                    </div>
                </form>
            </div>

            @if ($services->isNotEmpty())
                <!-- Card Grid Layout (Mobile First) -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    @foreach($services as $service)
                        <div class="bg-white rounded-2xl border border-gray-300 shadow-md overflow-hidden hover:shadow-xl transition-shadow">
                            <!-- Service Image -->
                            <div class="relative h-48 bg-gray-200">
                                @if($service->media->isNotEmpty())
                                    <img src="{{ $service->media->first()->getUrl() }}" 
                                        alt="{{ $service->title }}" 
                                        class="w-full h-full object-cover">
                                @else
                                    <div class="flex items-center justify-center h-full">
                                        <svg class="h-16 w-16 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                        </svg>
                                    </div>
                                @endif

                                <!-- Status Badge -->
                                <div class="absolute top-2 right-2">
                                    <span class="px-3 py-1 text-xs font-semibold rounded-full shadow {{ $service->is_active ? 'bg-green-500 text-white' : 'bg-gray-500 text-white' }}">
                                        {{ $service->is_active ? 'Active' : 'Inactive' }}
                                    </span>
                                </div>
                            </div>

                            <!-- Service Details -->
                            <div class="p-4 space-y-3">
                                <h3 class="text-lg font-bold text-gray-800 line-clamp-2">{{ $service->title }}</h3>
                                
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-600">{{ $service->category->name ?? 'N/A' }}</span>
                                    <span class="font-bold text-gray-800">${{ number_format($service->price, 2) }}</span>
                                </div>

                                <!-- Quick Stats -->
                                <div class="grid grid-cols-3 gap-2 pt-2 border-t text-center">
                                    <div>
                                        <p class="text-xs text-gray-500">Orders</p>
                                        <p class="text-lg font-semibold">0</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500">Views</p>
                                        <p class="text-lg font-semibold">0</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500">Rating</p>
                                        <p class="text-lg font-semibold">-</p>
                                    </div>
                                </div>

                                <!-- Action Buttons -->
                                <div class="flex space-x-2 pt-3 border-t">
                                    <a href="{{ route('creator.services.manage', $service) }}" 
                                        class="flex-1 bg-gray-100 hover:bg-gray-200 text-center py-2 rounded-lg text-sm font-medium transition">
                                        Manage
                                    </a>
                                    <a href="{{ route('creator.services.edit', $service) }}" 
                                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white text-center py-2 rounded-lg text-sm font-medium transition">
                                        Edit
                                    </a>
                                    <form action="{{ route('creator.services.destroy', $service) }}" method="POST" class="flex-1" 
                                        onsubmit="return confirm('Are you sure you want to delete this service?');">
                                        @csrf
                                        @method('DELETE')
                                        <button type="submit" 
                                            class="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg text-sm font-medium transition">
                                            Delete
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    @endforeach
                </div>
            @else
                <div class="bg-white rounded-2xl border border-gray-300 shadow-md p-12 text-center">
                    <svg class="mx-auto h-16 w-16 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                    </svg>
                    <p class="text-gray-500 text-lg mb-4">No services found.</p>
                    <a href="{{ route('creator.services.create') }}" 
                        class="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition shadow-md">
                        <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                        Create your first service
                    </a>
                </div>
            @endif

            <!-- Pagination -->
            @if($services->hasPages())
                <div class="mt-8">
                    {{ $services->links() }}
                </div>
            @endif
        </div>
    </div>
</x-app-layout>

----
--resources/views/creator/services/show.blade.php
<x-app-layout>
    <div class="container mx-auto px-4 py-6 max-w-lg md:max-w-4xl">
        <div class="bg-white rounded-2xl border border-gray-300 shadow-md overflow-hidden">
            <!-- Header -->
            <header class="flex justify-between items-center p-4 border-b">
                <h1 class="text-lg font-semibold">My Service</h1>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </header>

            <!-- Status and Actions -->
            <nav class="p-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 text-sm font-medium text-gray-600 border-b bg-gray-50">
                <div class="flex items-center space-x-2">
                    @if($service->is_flagged ?? false)
                        <span class="flex items-center text-orange-600">
                            <span class="h-2 w-2 bg-orange-500 rounded-full mr-2"></span>Flagged
                        </span>
                    @else
                        <span class="flex items-center text-green-600">
                            <span class="h-2 w-2 bg-green-500 rounded-full mr-2"></span>Active
                        </span>
                    @endif
                </div>
                <div class="flex space-x-4">
                    <a href="{{ route('creator.services.edit', $service) }}" 
                        class="hover:text-gray-900 transition">Edit</a>
                    <form action="{{ route('creator.services.destroy', $service) }}" method="POST" class="inline" 
                        onsubmit="return confirm('Are you sure you want to delete this service?');">
                        @csrf
                        @method('DELETE')
                        <button type="submit" class="text-red-600 hover:text-red-900 transition">Delete</button>
                    </form>
                </div>
            </nav>

            <!-- Analytics Chart Placeholder -->
            <div class="p-4 space-y-4">
                <div class="h-32 bg-gray-100 rounded-lg flex items-center justify-center border">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                </div>

                <!-- Stats Grid -->
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div>
                        <p class="text-xs text-gray-500">Total revenue</p>
                        <p class="text-2xl font-bold text-gray-800">
                            ${{ number_format($analytics['total_revenue'] ?? 0, 2) }}
                        </p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Today</p>
                        <p class="text-2xl font-bold text-gray-800">{{ $analytics['today_clicks'] ?? 0 }}</p>
                        <p class="text-xs text-gray-500">Clicks</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Total</p>
                        <p class="text-2xl font-bold text-gray-800">{{ $analytics['wishlist_count'] ?? 0 }}</p>
                        <p class="text-xs text-gray-500">Wishlist adds</p>
                    </div>
                </div>
            </div>

            <!-- Tabs Section -->
            <div class="px-4" x-data="{ activeTab: 'orders' }">
                <div class="flex border-b">
                    <button @click="activeTab = 'orders'" 
                        :class="activeTab === 'orders' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-500'"
                        class="flex-1 py-3 text-center font-medium transition">
                        Orders
                    </button>
                    <button @click="activeTab = 'reviews'" 
                        :class="activeTab === 'reviews' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-500'"
                        class="flex-1 py-3 text-center font-medium transition">
                        Reviews
                    </button>
                </div>

                <!-- Orders Tab -->
                <div x-show="activeTab === 'orders'" class="py-4 space-y-3">
                    @forelse($orders ?? [] as $order)
                        <div class="border rounded-lg p-3 hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <p class="font-semibold text-sm">Order #{{ $order->id }}</p>
                                    <p class="text-xs text-gray-500">{{ $order->created_at->format('M d, Y') }}</p>
                                </div>
                                <span class="px-2 py-1 text-xs rounded-full {{ $order->status_color ?? 'bg-blue-100 text-blue-800' }}">
                                    {{ ucfirst($order->status ?? 'pending') }}
                                </span>
                            </div>
                            <p class="text-sm text-gray-600">{{ $order->customer_name ?? 'Customer' }}</p>
                            <p class="text-sm font-semibold text-gray-800">${{ number_format($order->amount ?? 0, 2) }}</p>
                        </div>
                    @empty
                        <div class="text-center py-8">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                            </svg>
                            <p class="text-sm text-gray-500 mt-2">No orders yet</p>
                        </div>
                    @endforelse
                </div>

                <!-- Reviews Tab -->
                <div x-show="activeTab === 'reviews'" x-cloak class="py-4 space-y-3">
                    @forelse($reviews ?? [] as $review)
                        <div class="border rounded-lg p-3 bg-gray-50">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-semibold text-sm">{{ $review->reviewer_name }}</span>
                                <span class="text-yellow-400 text-sm">{{ str_repeat('', $review->rating) }}</span>
                            </div>
                            <p class="text-sm text-gray-600">{{ $review->comment }}</p>
                            <p class="text-xs text-gray-400 mt-1">{{ $review->created_at->diffForHumans() }}</p>
                        </div>
                    @empty
                        <div class="text-center py-8">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                            </svg>
                            <p class="text-sm text-gray-500 mt-2">No reviews yet</p>
                        </div>
                    @endforelse
                </div>
            </div>

            <!-- Preview Section -->
            <div class="p-4 border-t">
                <a href="{{ route('services.show', $service) }}" 
                    class="block w-full bg-gray-100 hover:bg-gray-200 text-center py-3 rounded-lg font-medium text-gray-700 transition">
                    Preview as Customer
                </a>
            </div>
        </div>
    </div>

    <style>
        [x-cloak] {
            display: none !important;
        }
    </style>
</x-app-layout>
----
--resources/views/creator/services/partials/_workflow-selector-modal.blade.php
<div 
    x-show="showWorkflowModal"
    @keydown.escape.window="showWorkflowModal = false"
    class="fixed inset-0 z-50 overflow-y-auto flex items-center justify-center"
    aria-labelledby="modal-title"
    role="dialog"
    aria-modal="true"
    style="display: none;"
>
    <!-- Modal backdrop -->
    <div 
        x-show="showWorkflowModal"
        x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 bg-gray-800 bg-opacity-75 transition-opacity"
        @click="showWorkflowModal = false"
    ></div>

    <!-- Modal -->
    <div 
        x-show="showWorkflowModal"
        x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
        x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
        x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
        x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
        class="relative inline-block bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col transform transition-all sm:my-8 sm:align-middle"
    >
        <div class="p-4 border-b flex justify-between items-center">
            <h3 class="text-lg font-semibold" id="modal-title">Select a Workflow</h3>
            <button @click="showWorkflowModal = false" class="text-gray-500 hover:text-gray-700">&times;</button>
        </div>
        <div class="p-4 overflow-y-auto">
            <div class="space-y-4">
                @forelse ($workflowTemplates as $template)
                    <div 
                        @click="$wire.set('workflow_template_id', {{ $template->id }}); showWorkflowModal = false;"
                        class="p-4 border rounded-lg cursor-pointer hover:bg-gray-100 hover:border-blue-500 {{ $selectedWorkflowId == $template->id ? 'bg-blue-50 border-blue-500' : '' }}"
                    >
                        <h4 class="font-bold text-lg">{{ $template->name }}</h4>
                        <p class="text-sm text-gray-600">{{ $template->description }}</p>
                        @if ($template->workTemplates->count() > 0)
                            <div class="mt-2">
                                <span class="text-xs font-semibold text-gray-700">Steps:</span>
                                <ul class="list-disc list-inside text-sm text-gray-600">
                                    @foreach ($template->workTemplates as $work)
                                        <li>{{ $work->name }}</li>
                                    @endforeach
                                </ul>
                            </div>
                        @else
                            <p class="text-sm text-gray-500 mt-2">No steps defined for this workflow.</p>
                        @endif
                    </div>
                @empty
                    <div class="text-center py-8">
                        <p class="text-gray-500">You haven't created any workflow templates yet.</p>
                        <a href="{{ route('creator.workflows.create') }}" class="mt-2 inline-block text-blue-500 hover:underline">Create one now</a>
                    </div>
                @endforelse
            </div>
        </div>
        <div class="p-4 border-t bg-gray-50 rounded-b-lg text-right">
            <a href="{{ route('creator.workflows.create') }}" target="_blank" class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600">
                Create New Workflow
            </a>
        </div>
    </div>
</div>
----
--resources/views/creator/workflows/builder.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Workflow Builder') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <livewire:workflow-builder :workflowTemplate="$workflowTemplate" />
        </div>
    </div>
</x-app-layout>
----
--resources/views/creator/workflows/index.blade.php
<x-app-layout>
    <x-slot name="header">
        <div class="flex justify-between items-center">
            <h2 class="font-semibold text-xl text-gray-800 leading-tight">
                {{ __('My Workflows') }}
            </h2>
            <a href="{{ route('creator.workflows.create') }}" 
               class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Create New Workflow
            </a>
        </div>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <!-- Session Messages -->
            @if (session('success'))
                <div class="mb-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative" role="alert">
                    <span class="block sm:inline">{{ session('success') }}</span>
                </div>
            @endif
            @if (session('error'))
                <div class="mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
                    <span class="block sm:inline">{{ session('error') }}</span>
                </div>
            @endif

            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Name
                                    </th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Description
                                    </th>
                                    <th scope="col" class="relative px-6 py-3">
                                        <span class="sr-only">Actions</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                @forelse ($workflowTemplates as $workflow)
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900">{{ $workflow->name }}</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm text-gray-900">{{ $workflow->description }}</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                            <a href="{{ route('creator.workflows.edit', $workflow) }}" class="text-indigo-600 hover:text-indigo-900">Edit</a>
                                            <form action="{{ route('creator.workflows.duplicate', $workflow) }}" method="POST" class="inline-block ml-4">
                                                @csrf
                                                <button type="submit" class="text-blue-600 hover:text-blue-900">Duplicate</button>
                                            </form>
                                            <form action="{{ route('creator.workflows.destroy', $workflow) }}" method="POST" class="inline-block ml-4" onsubmit="return confirm('Are you sure you want to delete this workflow?');">
                                                @csrf
                                                @method('DELETE')
                                                <button type="submit" class="text-red-600 hover:text-red-900">Delete</button>
                                            </form>
                                        </td>
                                    </tr>
                                @empty
                                    <tr>
                                        <td colspan="3" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">
                                            No workflows found.
                                            <a href="{{ route('creator.workflows.create') }}" class="text-indigo-600 hover:text-indigo-900 underline">Create one now</a>
                                        </td>
                                    </tr>
                                @endforelse
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/emails/orders/created.blade.php
<!DOCTYPE html>
<html>
<head>
    <title>Order Created</title>
</head>
<body>
    <h1>Order Created!</h1>
    <p>Dear {{ $order->buyer->name }},</p>
    <p>Your order #{{ $order->id }} has been successfully created.</p>
    <p>Details:</p>
    <ul>
        <li>Service: {{ $order->service->title }}</li>
        <li>Price: {{ $order->price }}</li>
        <li>Status: {{ $order->status }}</li>
    </ul>
    <p>Thank you for your purchase!</p>
</body>
</html>
----
--resources/views/layouts/app.blade.php
@props([
    'title' => config('app.name', 'Serbizyu'),
    'cssFiles' => [],   // accepts array or string
    'jsFiles' => [],    // accepts array or string
])

@php
    // Backward compatibility (if someone passes single string)
    $cssFiles = is_array($cssFiles) ? $cssFiles : [$cssFiles];
    $jsFiles = is_array($jsFiles) ? $jsFiles : [$jsFiles];

    // Default to app.css / app.js if none provided
    if (empty($cssFiles)) $cssFiles = ['app.css'];
    if (empty($jsFiles)) $jsFiles = ['app.js'];
@endphp

<!DOCTYPE html>
<html lang="{{ str_replace('_', '-', app()->getLocale()) }}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="csrf-token" content="{{ csrf_token() }}">

    <title>{{ $title }}</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.bunny.net">
    <link href="https://fonts.bunny.net/css?family=poppins:400,500,600|inter:400,500,600&display=swap" rel="stylesheet" />

    <!-- Styles & Scripts -->
    @foreach ($cssFiles as $css)
        @vite("resources/css/{$css}")
    @endforeach

    </head>

<body>
    <div class="min-h-screen">
        <x-navbar />

        @isset($header)
            <header class="shadow" style="background-color: var(--color-background);">
                <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
                    {{ $header }}
                </div>
            </header>
        @endisset

        <main>
            {{ $slot }}
        </main>

        @include('layouts.footer')
    </div>
    @livewireScripts
    @foreach ($jsFiles as $js)
        @vite("resources/js/{$js}")
    @endforeach
    @stack('scripts')
</body>
</html>
----
--resources/views/layouts/footer.blade.php
<footer class="mt-[--spacing-3]" style="background-color: var(--color-background); border-top: 1px solid var(--color-secondary-dark);">
    <div class="max-w-7xl mx-auto px-[--spacing-3] py-[--spacing-3] flex flex-col md:flex-row justify-between items-center">
        <div class="text-lg font-bold text-[--color-text] mb-[--spacing-2] md:mb-0" style="font-family: var(--font-display);">
            Serbizyu<span style="color: var(--color-primary);">.</span>
        </div>
        <div class="flex space-x-[--spacing-3] text-[--color-text-secondary] mb-[--spacing-2] md:mb-0">
            {{-- <x-nav-link href="{{ route('about') }}">About</x-nav-link> --}}
            {{-- <x-nav-link href="{{ route('categories') }}">Categories</x-nav-link> --}}
        </div>
        <div class="text-[--color-text-secondary]" style="font-size: 0.875rem;">&copy; {{ date('Y') }} Serbizyu. All rights reserved.</div>
    </div>
</footer>
----
--resources/views/layouts/livewire-form.blade.php
<!-- resources/views/layouts/livewire-form.blade.php -->

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ $header ?? 'Form' }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    {{ $slot }}
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/layouts/navbar.blade.php
@props([
  'navItems' => [
    ['label' => 'Home', 'route' => 'home'],
    ['label' => 'Browse', 'route' => 'browse'],
    ['label' => 'FAQ', 'route' => 'faq'],
    ['label' => 'About', 'route' => 'about']
  ]
])

<header class="navbar" x-data="{ open: false }">
  <div class="navbar-inner">
    
    <!-- Brand -->
    <a href="{{ route('home') }}" class="navbar-brand">
      <span class="navbar-brand-text">Serbizyu</span>
      <span class="navbar-brand-accent">.</span>
    </a>

    <!-- Desktop Nav -->
    <nav class="navbar-nav">
      @foreach($navItems as $item)
        @php $route = $item['route']; @endphp
        <a 
          href="{{ $route ? route($route) : '#' }}" 
          class="navbar-link {{ request()->routeIs($route) ? 'active' : '' }}"
        >
          {{ $item['label'] }}
        </a>
      @endforeach

      {{-- show only when on auth check else show profile bar with logout button --}}
      <div class="navbar-auth">
        @guest
            <a href="{{ route('auth.signin') }}" 
              class="navbar-auth-link {{ request()->routeIs('auth.signin') ? 'active' : '' }}">
                Sign In
            </a>
            <a href="{{ route('auth.join') }}">
                <button class="navbar-auth-button">Join</button>
            </a>
        @endguest

       @auth
            <x-nav.profile-dropdown :authProfileData="$authProfileData" />
        @endauth


      </div>
    </nav>

    <!-- Mobile Hamburger -->
    <button @click="open = !open" class="navbar-toggle text-2xl">
      <span x-show="!open"></span>
      <span x-show="open"></span>
    </button>
  </div>

  <!-- Mobile Menu -->
  <div
    x-show="open"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="opacity-0 -translate-y-full"
    x-transition:enter-end="opacity-100 translate-y-0"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="opacity-100 translate-y-0"
    x-transition:leave-end="opacity-0 -translate-y-full"
    class="navbar-mobile"
  >
    <nav class="flex flex-col space-y-2">
      @foreach($navItems as $item)
        @php $route = $item['route']; @endphp
        <a 
          href="{{ $route ? route($route) : '#' }}" 
          class="navbar-mobile-link {{ request()->routeIs($route) ? 'active' : '' }}"
        >
          {{ $item['label'] }}
        </a>
      @endforeach

      <div class="navbar-mobile-auth">
        @guest
            <a href="{{ route('auth.signin') }}" 
              class="block text-center navbar-mobile-link {{ request()->routeIs('auth.signin') ? 'active' : '' }}">
                Sign In
            </a>
            <a href="{{ route('auth.join') }}">
                <button class="navbar-mobile-button">Join</button>
            </a>
        @endguest

       @auth
          <x-nav.profile-dropdown :authProfileData="$authProfileData"/>
      @endauth
      </div>
    </nav>
  </div>
</header>
----
--resources/views/listings/categories/index.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Category Management') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    @auth
                        @if(auth()->user()->hasRole('admin'))
                            <x-admin.category-manager />
                        @else
                            <p>You are not authorized to manage categories.</p>
                        @endif
                    @endauth
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/listings/partials/offer-card.blade.php
@props(['offer'])

<article class="listing-card">
    {{-- Top Thumbnail --}}
    @if($offer->media->isNotEmpty())
        @php
            $thumbnail = $offer->media->where('tag', 'thumbnail')->first();
        @endphp
        @if($thumbnail)
            <img src="{{ route('media.serve', ['encryptedPath' => Crypt::encryptString(json_encode(['media_id' => $thumbnail->id]))]) }}"
                alt="{{ $offer->title }} Thumbnail"
                class="w-full h-48 object-cover rounded-lg mb-2">
        @endif
    @endif


    <div class="card-top flex justify-between items-center">
        <span class="badge-offer">Open Offer</span>
        <span class="text-sm text-text-secondary">Budget: {{ number_format($offer->budget, 2) }}</span>
    </div>

    <h3 class="card-title">{{ $offer->title }}</h3>
    <p class="card-desc">{{ Str::limit($offer->description, 80) }}</p>

    <p class="card-meta">
        Location: {{ $offer->address?->city ?? 'N/A' }}, {{ $offer->address?->province ?? 'N/A' }}
    </p>

    <div class="card-footer flex justify-between items-center mt-2">
        <span class="text-xs text-text-secondary">Posted {{ $offer->created_at->diffForHumans() }}</span>

        <div class="card-avatar w-8 h-8 rounded-full overflow-hidden">
            <img src="{{ $offer->creator?->profile_image?->getUrl() ?? 'fallback.png' }}"
                alt="{{ $offer->creator?->name ?? 'User' }}"
                class="w-full h-full object-cover">
        </div>
    </div>
</article>
----
--resources/views/listings/partials/service-card.blade.php
{{-- resources/views/listings/partials/service-card.blade.php --}}
<a href="{{ route('services.show', $service) }}" 
    class="block bg-white rounded-2xl border border-gray-300 shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300">
    
    <!-- Service Image -->
    <div class="relative h-48 bg-gray-200 overflow-hidden">
        @if($service->media->isNotEmpty())
            <img src="{{ $service->media->first()->getUrl() }}" 
                alt="{{ $service->title }}" 
                class="w-full h-full object-cover">
        @else
            <div class="flex items-center justify-center h-full">
                <svg class="h-16 w-16 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
            </div>
        @endif
        
        <!-- Category Badge -->
        <div class="absolute top-2 left-2">
            <span class="px-3 py-1 bg-blue-600 text-white text-xs font-semibold rounded-full shadow">
                {{ $service->category->name ?? 'Service' }}
            </span>
        </div>

        <!-- Pay First Badge -->
        @if($service->pay_first)
            <div class="absolute top-2 right-2">
                <span class="px-3 py-1 bg-green-600 text-white text-xs font-semibold rounded-full shadow">
                    Pay First
                </span>
            </div>
        @endif
    </div>

    <!-- Service Details -->
    <div class="p-4 space-y-2">
        <h3 class="text-lg font-bold text-gray-800 line-clamp-2">{{ $service->title }}</h3>
        
        <!-- Rating -->
        <div class="flex items-center space-x-2">
            <span class="text-yellow-400 text-sm"></span>
            <span class="text-xs text-gray-500">(0)</span>
        </div>

        <!-- Creator Info -->
        <div class="flex items-center space-x-2 pt-1">
            <img src="{{ $service->creator->profile_photo_url }}" 
                alt="{{ $service->creator->name }}" 
                class="w-8 h-8 rounded-full">
            <div class="flex-1 min-w-0">
                <p class="text-sm font-medium text-gray-700 truncate">{{ $service->creator->name }}</p>
            </div>
        </div>

        <!-- Location -->
        <div class="flex items-center text-sm text-gray-600">
            <svg class="w-4 h-4 mr-1 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <span class="truncate">{{ $service->address->town }}, {{ $service->address->province }}</span>
        </div>

        <!-- Price -->
        <div class="pt-2 border-t flex justify-between items-center">
            <div>
                <span class="text-xs text-gray-500">Starting at</span>
                <p class="text-xl font-bold text-gray-800">${{ number_format($service->price, 2) }}</p>
            </div>
            <button type="button" 
                onclick="event.preventDefault(); event.stopPropagation(); addToWishlist({{ $service->id }})"
                class="p-2 hover:bg-gray-100 rounded-full transition">
                <svg class="w-6 h-6 text-gray-400 hover:text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
            </button>
        </div>
    </div>
</a>

@once
@push('scripts')
<script>
    function addToWishlist(serviceId) {
        // Implement wishlist functionality
        console.log('Adding service', serviceId, 'to wishlist');
        // You can make an AJAX call here
    }
</script>
@endpush
@endonce
----
--resources/views/listings/services/show.blade.php
<x-app-layout :jsFiles="['app.js', 'swiper-listings.js']">
    <div class="container mx-auto px-4 py-6 max-w-lg md:max-w-4xl">
        <div class="bg-white rounded-2xl border border-gray-300 shadow-md overflow-hidden">
            <!-- Header (Mobile Only) -->
            <header class="flex justify-between items-center p-4 border-b md:hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </header>

            <!-- Image Carousel -->
            <div class="relative h-48 md:h-80 bg-gray-200">
                @if($service->media->isNotEmpty())
                    <div class="swiper serviceSwiper h-full">
                        <div class="swiper-wrapper">
                            @foreach($service->media as $media)
                                <div class="swiper-slide">
                                    <img src="{{ $media->getUrl() }}" alt="{{ $service->title }}" 
                                        class="w-full h-full object-cover">
                                </div>
                            @endforeach
                        </div>
                        <!-- Navigation arrows -->
                        <div class="swiper-button-prev text-white"></div>
                        <div class="swiper-button-next text-white"></div>
                        <!-- Pagination -->
                        <div class="swiper-pagination"></div>
                    </div>
                @else
                    <div class="flex items-center justify-center h-full">
                        <span class="text-gray-400 text-lg">No images available</span>
                    </div>
                @endif
            </div>

            <!-- Service Details -->
            <div class="p-4 space-y-3">
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800">{{ $service->title }}</h2>
                
                <!-- Rating -->
                <div class="flex items-center space-x-2">
                    <span class="text-yellow-400 text-lg"></span>
                    <span class="text-sm text-gray-600">(0 reviews)</span>
                </div>

                <!-- Service Info -->
                <div class="text-sm md:text-base text-gray-700 space-y-2">
                    <p><strong>Rate:</strong> ${{ number_format($service->price, 2) }}/hr</p>
                    <p><strong>Location:</strong> {{ $service->address->town }}, {{ $service->address->province }}</p>
                    
                    <!-- Workflow - Collapsible -->
                    <div x-data="{ expanded: false }">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <strong>Schedule:</strong>
                                <span x-show="!expanded" class="ml-1">
                                    {{ $service->workflowTemplate->workTemplates->pluck('name')->implode(' > ') }}
                                </span>
                            </div>
                            @if($service->workflowTemplate->workTemplates->count() > 3)
                                <button @click="expanded = !expanded" class="text-blue-600 text-xs ml-2 flex-shrink-0">
                                    <span x-show="!expanded">Show more</span>
                                    <span x-show="expanded" x-cloak>Show less</span>
                                </button>
                            @endif
                        </div>
                        
                        <!-- Expanded list view -->
                        <div x-show="expanded" x-cloak class="mt-2 space-y-1 pl-4">
                            @foreach($service->workflowTemplate->workTemplates as $index => $step)
                                <p class="text-sm">{{ $index + 1 }}. {{ $step->name }}</p>
                            @endforeach
                        </div>
                    </div>
                </div>

                <!-- Description -->
                @if($service->description)
                    <div class="pt-3 border-t">
                        <h3 class="font-semibold text-gray-800 mb-2">About this service</h3>
                        <p class="text-sm text-gray-600 leading-relaxed">{{ $service->description }}</p>
                    </div>
                @endif

                <!-- Creator Info -->
                <div class="pt-3 border-t">
                    <h3 class="font-semibold text-gray-800 mb-3">Service by</h3>
                    <div class="flex items-center space-x-3">
                        <img src="{{ $service->creator->profile_photo_url }}" 
                            alt="{{ $service->creator->name }}" 
                            class="w-12 h-12 rounded-full">
                        <div>
                            <h4 class="font-semibold text-gray-800">{{ $service->creator->name }}</h4>
                            <p class="text-xs text-gray-500">Member since {{ $service->creator->created_at->format('M Y') }}</p>
                        </div>
                    </div>
                </div>

                <!-- Reviews Section -->
                <div class="pt-3 border-t">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">Reviews</h3>
                    <div class="space-y-3">
                        <!-- Example review -->
                        <div class="border rounded-lg p-3 bg-gray-50">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-semibold text-sm text-gray-800">David Datu Sarmiento</span>
                                <span class="text-yellow-400 text-xs"></span>
                            </div>
                            <p class="text-sm text-gray-600">
                                I found that transacting with serbisyo makes my work easier
                            </p>
                        </div>
                        
                        <!-- No reviews state -->
                        <p class="text-sm text-gray-500 text-center py-4">No reviews yet. Be the first to review!</p>
                    </div>
                </div>
            </div>

            {{-- change this actions if its the owner --}}
            
            <!-- Footer Actions -->
            <footer class="flex flex-col sm:flex-row justify-between items-center gap-3 p-4 border-t bg-gray-50">
                @can('update', $service)
                    <a href="{{ route('creator.services.manage', $service) }}" class="w-full sm:w-auto text-blue-600 font-medium hover:text-blue-700 transition order-2 sm:order-1">
                        Go to Manage
                    </a>
                @else
                    <button type="button" 
                        class="w-full sm:w-auto text-blue-600 font-medium hover:text-blue-700 transition order-2 sm:order-1">
                        Add to wishlist
                    </button>
                    <form action="{{ route('orders.store') }}" method="POST" class="w-full sm:w-auto order-1 sm:order-2">
                        @csrf
                        <input type="hidden" name="service_id" value="{{ $service->id }}">
                        <button type="submit" 
                            class="w-full sm:w-auto bg-blue-600 text-white rounded-lg px-6 py-3 font-semibold hover:bg-blue-700 transition shadow-md">
                            Proceed to Order
                        </button>
                    </form>
                @endcan
              
            </footer>
        </div>
    </div>
</x-app-layout>
----
--resources/views/livewire/activity-thread.blade.php
<div>
    <div class="flex flex-col space-y-4">
        @foreach ($this->messages as $message)
            <div class="flex items-start space-x-4">
                <div class="flex-shrink-0">
                    <img class="h-8 w-8 rounded-full" src="https://ui-avatars.com/api/?name={{ urlencode($message->user->name) }}" alt="{{ $message->user->name }}">
                </div>
                <div class="min-w-0 flex-1">
                    <p class="text-sm font-medium text-gray-900">{{ $message->user->name }}</p>
                    <p class="text-sm text-gray-500">{{ $message->content }}</p>
                    <p class="mt-1 text-xs text-gray-400">{{ $message->created_at->diffForHumans() }}</p>
                </div>
            </div>
        @endforeach
    </div>

    <form wire:submit.prevent="sendMessage" class="mt-6">
        <label for="newMessage" class="sr-only">Your message</label>
        <textarea wire:model="newMessage" id="newMessage" rows="3" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="Type your message..."></textarea>
        <div class="mt-3 flex items-center justify-between">
            <input type="file" wire:model="attachments" multiple class="block w-full text-sm text-gray-500
              file:mr-4 file:py-2 file:px-4
              file:rounded-md file:border-0
              file:text-sm file:font-semibold
              file:bg-indigo-50 file:text-indigo-700
              hover:file:bg-indigo-100"/>
            <button type="submit" class="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Send Message
            </button>
        </div>
    </form>
</div>
----
--resources/views/livewire/address-manager.blade.php
<div>
    <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-medium text-gray-900">Your Addresses</h3>
        <button wire:click="addAddress()" type="button" class="inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 active:bg-gray-900 focus:outline-none focus:border-gray-900 focus:ring ring-gray-300 disabled:opacity-25 transition ease-in-out duration-150">
            Add New Address
        </button>
    </div>

    <!-- Address List -->
    <div class="space-y-4">
        @forelse ($addresses as $address)
            <div class="p-4 border rounded-lg flex justify-between items-center">
                <div>
                    <p class="font-semibold">{{ $address->house_no }} {{ $address->street }}, {{ $address->barangay }}</p>
                    <p class="text-sm text-gray-600">{{ $address->town }}, {{ $address->province }}, {{ $address->country }}</p>
                    @if ($address->pivot && $address->pivot->is_primary)
                        <span class="text-xs font-semibold text-green-600 bg-green-100 px-2 py-1 rounded-full">Primary</span>
                    @endif
                </div>
                <div class="flex space-x-2">
                    <button wire:click="edit({{ $address->id }})" type="button" class="text-sm font-medium text-indigo-600 hover:text-indigo-900">Edit</button>
                    <button wire:click="confirmDelete({{ $address->id }})" type="button" class="text-sm font-medium text-red-600 hover:text-red-900">Delete</button>
                    @if (!$address->pivot || !$address->pivot->is_primary)
                        <button wire:click="setPrimary({{ $address->id }})" type="button" class="text-sm font-medium text-gray-600 hover:text-gray-900">Set as Primary</button>
                    @endif
                </div>
            </div>
        @empty
            <p class="text-gray-500">You have no saved addresses.</p>
        @endforelse
    </div>

    <!-- Add/Edit Modal -->
    @if ($isOpen)
        <div class="fixed z-10 inset-0 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
            <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                    <form wire:submit.prevent="save">
                        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                                {{ $addressId ? 'Edit Address' : 'Add New Address' }}
                            </h3>
                            <div class="mt-4 space-y-4">
                                <!-- Form Fields -->
                                <div>
                                    <label for="house_no" class="block text-sm font-medium text-gray-700">House/Unit/Building No.</label>
                                    <input type="text" wire:model.defer="house_no" id="house_no" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                    @error('house_no') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                                </div>
                                <div>
                                    <label for="street" class="block text-sm font-medium text-gray-700">Street</label>
                                    <input type="text" wire:model.defer="street" id="street" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                    @error('street') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                                </div>
                                <div>
                                    <label for="barangay" class="block text-sm font-medium text-gray-700">Barangay</label>
                                    <input type="text" wire:model.defer="barangay" id="barangay" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                    @error('barangay') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                                </div>
                                <div>
                                    <label for="town" class="block text-sm font-medium text-gray-700">Town/City</label>
                                    <input type="text" wire:model.defer="town" id="town" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                    @error('town') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                                </div>
                                <div>
                                    <label for="province" class="block text-sm font-medium text-gray-700">Province</label>
                                    <input type="text" wire:model.defer="province" id="province" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                    @error('province') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                                </div>
                                <div>
                                    <label for="country" class="block text-sm font-medium text-gray-700">Country</label>
                                    <input type="text" wire:model.defer="country" id="country" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                    @error('country') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" wire:model.defer="is_primary" id="is_primary" class="h-4 w-4 text-indigo-600 border-gray-300 rounded">
                                    <label for="is_primary" class="ml-2 block text-sm text-gray-900">Set as primary address</label>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                            <button type="submit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 sm:ml-3 sm:w-auto sm:text-sm">
                                Save
                            </button>
                            <button wire:click="closeModal()" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    @endif

    <!-- Delete Confirmation Modal -->
    @if ($isDeleteModalOpen)
        <div class="fixed z-10 inset-0 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
            <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Delete Address</h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500">Are you sure you want to delete this address? This action cannot be undone.</p>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button wire:click="delete()" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 sm:ml-3 sm:w-auto sm:text-sm">
                            Delete
                        </button>
                        <button wire:click="closeDeleteModal()" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    @endif
</div>
----
--resources/views/livewire/chat-interface.blade.php
<div>
    <div class="flex flex-col h-full bg-gray-100 rounded-lg shadow-md p-4">
        {{-- Messages Display --}}
        <div class="flex-1 overflow-y-auto mb-4 p-2 bg-white rounded-md">
            @forelse ($messages as $message)
                <div class="mb-2 {{ $message->sender_id === auth()->id() ? 'text-right' : 'text-left' }}">
                    <span class="text-xs text-gray-500">{{ $message->sender->name }} - {{ $message->created_at->format('M d, H:i') }}</span>
                    <div class="p-2 rounded-lg inline-block {{ $message->sender_id === auth()->id() ? 'bg-blue-500 text-white' : 'bg-gray-300 text-gray-800' }}">
                        {{ $message->content }}
                    </div>
                    @if ($message->attachments->count() > 0)
                        <div class="mt-1 text-xs text-gray-600">
                            Attachments:
                            @foreach ($message->attachments as $attachment)
                                <a href="{{ Storage::url($attachment->file_path) }}" target="_blank" class="text-blue-400 hover:underline">{{ $attachment->file_type }}</a>
                            @endforeach
                        </div>
                    @endif
                </div>
            @empty
                <p class="text-center text-gray-500">No messages yet.</p>
            @endforelse
        </div>

        {{-- Message Input --}}
        <form wire:submit.prevent="sendMessage" enctype="multipart/form-data" class="flex items-center space-x-2">
            <input type="text" wire:model.lazy="newMessage" placeholder="Type your message..." class="flex-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
            <input type="file" wire:model="attachments" multiple class="block w-full text-sm text-gray-500
                file:mr-4 file:py-2 file:px-4
                file:rounded-md file:border-0
                file:text-sm file:font-semibold
                file:bg-blue-50 file:text-blue-700
                hover:file:bg-blue-100"
            >
            <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                Send
            </button>
        </form>
    </div>
</div>
----
--resources/views/livewire/image-uploader.blade.php
<div>
    {{-- Upload Section --}}
    <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700">Service Images</label>

        <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
            <div class="space-y-1 text-center">
                <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>

                <div class="flex text-sm text-gray-600 justify-center">
                    <label for="newFiles" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500">
                        <span>Upload files</span>
                        <input id="newFiles" type="file" class="sr-only" wire:model="newFiles" multiple>
                    </label>
                    <p class="pl-1">or drag and drop</p>
                </div>

                <p class="text-xs text-gray-500">PNG, JPG, GIF up to 2MB</p>

                @error('newFiles.*')
                    <span class="text-red-500 text-sm">{{ $message }}</span>
                @enderror
            </div>
        </div>
    </div>

    {{-- Existing Images --}}
    @if(!empty($existingImages))
        <div class="mb-4">
            <h4 class="text-sm font-medium text-gray-700 mb-2">Current Images</h4>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                @foreach ($existingImages as $img)
                    <div class="relative group">
                        <img src="{{ $img['url'] }}" class="w-full h-32 object-cover rounded border border-gray-200">
                        <button type="button"
                                wire:click="removeExistingImage({{ $img['id'] }})"
                                class="absolute top-1 right-1 bg-red-600 hover:bg-red-700 text-white px-2 py-1 text-xs rounded shadow-md">
                            
                        </button>
                    </div>
                @endforeach
            </div>
        </div>
    @endif

    {{-- New Files Preview --}}
    @if(!empty($newFiles))
        <div class="mb-4">
            <h4 class="text-sm font-medium text-gray-700 mb-2">New Images (Not Yet Saved)</h4>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                @foreach ($newFiles as $i => $file)
                    <div class="relative group">
                        <img src="{{ $file->temporaryUrl() }}" class="w-full h-32 object-cover rounded border border-green-200">
                        <button type="button"
                                wire:click="removeNewFile({{ $i }})"
                                class="absolute top-1 right-1 bg-red-600 hover:bg-red-700 text-white px-2 py-1 text-xs rounded shadow-md">
                            
                        </button>
                        <span class="absolute bottom-1 left-1 bg-green-600 text-white px-2 py-0.5 text-xs rounded">New</span>
                    </div>
                @endforeach
            </div>
        </div>
    @endif
</div>
----
--resources/views/livewire/open-offer-form.blade.php
<div>
    @if ($errors->has('save'))
        <div class="text-red-600">{{ $errors->first('save') }}</div>
    @endif

    <form wire:submit.prevent="save">
        <div>
            <label for="title">Title</label>
            <input id="title" wire:model.defer="title" type="text" />
            @error('title') <div class="text-red-600">{{ $message }}</div> @enderror
        </div>

        <div>
            <label for="description">Description</label>
            <textarea id="description" wire:model.defer="description"></textarea>
            @error('description') <div class="text-red-600">{{ $message }}</div> @enderror
        </div>

        <div>
            <label for="budget">Budget</label>
            <input id="budget" wire:model.defer="budget" type="number" step="0.01" />
            @error('budget') <div class="text-red-600">{{ $message }}</div> @enderror
        </div>

        <div>
            <label for="category_id">Category</label>
            <select id="category_id" wire:model.defer="category_id">
                <option value="">-- select --</option>
                @foreach($categories as $c)
                    <option value="{{ $c['id'] }}">{{ $c['name'] }}</option>
                @endforeach
            </select>
            @error('category_id') <div class="text-red-600">{{ $message }}</div> @enderror
        </div>

        <div>
            <label for="workflow_template_id">Workflow (optional)</label>
            <select id="workflow_template_id" wire:model.defer="workflow_template_id">
                <option value="">-- none --</option>
                @foreach($workflowTemplates as $w)
                    <option value="{{ $w['id'] }}">{{ $w['name'] }}</option>
                @endforeach
            </select>
            @error('workflow_template_id') <div class="text-red-600">{{ $message }}</div> @enderror
        </div>

        <div>
            <label>
                <input type="checkbox" wire:model.defer="pay_first" />
                Pay first
            </label>
        </div>

        <div>
            <label for="address_id">Address (optional)</label>
            <input id="address_id" wire:model.defer="address_id" type="number" />
            @error('address_id') <div class="text-red-600">{{ $message }}</div> @enderror
        </div>

        {{-- existing images (edit mode) --}}
        @if ($offer)
            <div>
                <h4>Existing images</h4>
                @foreach($offer->getMedia('gallery') ?? [] as $media)
                    <div style="display:inline-block;margin:4px">
                        <img src="{{ route('media.serve', ['payload' => encrypt(json_encode(['media_id' => $media->id]))]) }}" alt="" style="width:96px;height:96px;object-fit:cover" />
                        <button type="button" wire:click="removeExistingMedia({{ $media->id }})">Remove</button>
                    </div>
                @endforeach
            </div>
        @endif

        
        {{-- Media Upload Section --}}
        @include('livewire.partials.media-upload', [
            'newFiles' => $newFiles,
            'existingImages' => $existingImages
        ])

        <div>
            <button type="submit">{{ $offer ? 'Update Offer' : 'Create Offer' }}</button>
        </div>
    </form>
</div>
----
--resources/views/livewire/service-form.blade.php
<div>
    <header class="flex justify-between items-center p-4 border-b">
        <h1 class="text-lg font-semibold">{{ $service->exists ? 'Edit Service' : 'Create a Service' }}</h1>
    </header>

    <form wire:submit.prevent="save" class="p-4 space-y-4">
        
        <!-- Global Error Display -->
        @if ($errors->any())
            <div class="bg-red-50 border border-red-200 rounded-md p-4 mb-4">
                <h3 class="text-red-800 font-semibold mb-2">Validation Errors:</h3>
                <ul class="list-disc list-inside text-red-700 text-sm">
                    @foreach ($errors->all() as $error)
                        <li>{{ $error }}</li>
                    @endforeach
                </ul>
            </div>
        @endif

        <!-- Title -->
        <div>
            <label for="title" class="block text-sm font-medium text-gray-700">Title</label>
            <input type="text" wire:model.defer="title" id="title" 
                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            @error('title') <span class="text-red-500 text-xs mt-1">{{ $message }}</span> @enderror
        </div>

        <!-- Price and Pay First -->
        <div class="flex space-x-4">
            <div class="w-1/2">
                <label for="price" class="block text-sm font-medium text-gray-700">Price</label>
                <input type="number" wire:model.defer="price" id="price" step="0.01"
                    class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                @error('price') <span class="text-red-500 text-xs mt-1">{{ $message }}</span> @enderror
            </div>
            <div class="w-1/2">
                <label for="pay-first" class="block text-sm font-medium text-gray-700">Pay First</label>
                <select wire:model.defer="pay_first" id="pay-first" 
                    class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>
        </div>

        <!-- Category and Address -->
        <div class="flex space-x-4">
            <div class="w-1/2">
                <label for="category" class="block text-sm font-medium text-gray-700">Category</label>
                <select wire:model.defer="category_id" id="category"
                    class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="">Select...</option>
                    @foreach ($categories as $cat)
                        <option value="{{ $cat->id }}">{{ $cat->name }}</option>
                    @endforeach
                </select>
                @error('category_id') <span class="text-red-500 text-xs mt-1">{{ $message }}</span> @enderror
            </div>
            <div class="w-1/2">
                <label for="address" class="block text-sm font-medium text-gray-700">Address</label>
                <select wire:model="address_id" id="address"
                    class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="">Select...</option>
                    @foreach($addresses as $address)
                        <option value="{{ $address->id }}">
                            {{ $address->street }}, {{ $address->city }}
                            @if($address->is_primary) (Primary) @endif
                        </option>
                    @endforeach
                </select>
                @error('address_id') <span class="text-red-500 text-xs mt-1">{{ $message }}</span> @enderror
                <a href="{{ route('profile.edit') }}" class="text-xs text-blue-600 hover:text-blue-700 mt-1 inline-block">+ Add new address</a>
            </div>
        </div>

        <!-- Description -->
        <div>
            <label for="description" class="block text-sm font-medium text-gray-700">Description</label>
            <textarea wire:model.defer="description" id="description" rows="4" 
                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
            @error('description') <span class="text-red-500 text-xs mt-1">{{ $message }}</span> @enderror
        </div>

        <!-- Workflow Section - Simple wire:model approach -->
        <div>
            <label for="workflow_template_id" class="block text-sm font-medium text-gray-700 mb-1">Workflow</label>
            <select wire:model.live="workflow_template_id" id="workflow_template_id"
                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <option value="">Select a workflow...</option>
                @foreach ($workflowTemplates as $template)
                    <option value="{{ $template->id }}">{{ $template->name }}</option>
                @endforeach
            </select>
            @error('workflow_template_id') <span class="text-red-500 text-xs mt-1">{{ $message }}</span> @enderror
            
            @if($workflow_template_id)
                @php
                    $selectedWorkflow = $workflowTemplates->firstWhere('id', $workflow_template_id);
                @endphp
                @if($selectedWorkflow)
                    <div class="mt-2 p-3 bg-blue-50 border border-blue-200 rounded-md">
                        <p class="text-sm text-gray-700"><strong>{{ $selectedWorkflow->name }}</strong></p>
                        <p class="text-xs text-gray-600 mt-1">{{ $selectedWorkflow->description }}</p>
                        @if ($selectedWorkflow->workTemplates->count() > 0)
                            <div class="mt-2">
                                <span class="text-xs font-semibold text-gray-700">Steps:</span>
                                <ul class="list-disc list-inside text-xs text-gray-600">
                                    @foreach ($selectedWorkflow->workTemplates as $work)
                                        <li>{{ $work->name }}</li>
                                    @endforeach
                                </ul>
                            </div>
                        @endif
                    </div>
                @endif
            @endif
            
            <div class="mt-2 text-right">
                <a href="{{ route('creator.workflows.create') }}" target="_blank" class="text-xs text-gray-600 hover:text-blue-700">
                    + Create New Workflow
                </a>
            </div>
        </div>

        @include('livewire.partials.media-uploader')

        <!-- Action Buttons -->
        <div class="flex justify-end space-x-3 pt-4 border-t mt-6">
            <a href="{{ route('creator.services.index') }}" 
                class="bg-gray-100 border border-gray-300 rounded-md px-4 py-2 text-sm hover:bg-gray-200 transition">
                Cancel
            </a>
            <button 
                type="submit"
                class="bg-blue-600 text-white rounded-md px-4 py-2 text-sm hover:bg-blue-700 transition">
                {{ $service->exists ? 'Update' : 'Publish' }}
            </button>
        </div>
    </form>
</div>
----
--resources/views/livewire/work-progress.blade.php
<div>
    <ul role="list" class="divide-y divide-gray-100">
        @foreach ($workInstance->workInstanceSteps as $step)
            <li class="flex justify-between gap-x-6 py-5">
                <div class="flex min-w-0 gap-x-4">
                    <div class="min-w-0 flex-auto">
                        <p class="text-sm font-semibold leading-6 text-gray-900">Step {{ $step->step_index + 1 }}: {{ $step->workTemplate->name ?? 'N/A' }}</p>
                        <p class="mt-1 truncate text-xs leading-5 text-gray-500">Status: {{ $step->status }}</p>
                    </div>
                </div>
                <div class="hidden shrink-0 sm:flex sm:flex-col sm:items-end">
                    @if ($step->status === 'pending')
                        <button wire:click="startStep({{ $step->id }})" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            Start Step
                        </button>
                    @elseif ($step->status === 'in_progress')
                        <button wire:click="completeStep({{ $step->id }})" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                            Complete Step
                        </button>
                    @endif
                </div>
            </li>
        @endforeach
    </ul>
</div>
----
--resources/views/livewire/workflow-builder.blade.php
<div>
    <!-- Workflow Details Section -->
    <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
        <div class="p-6 bg-white border-b border-gray-200">
            <h3 class="text-lg font-semibold mb-4">Workflow Details</h3>

            <div class="space-y-4">
                <div>
                    <label for="workflow_name" class="block text-sm font-medium text-gray-700">Workflow Name</label>
                    <input
                        type="text"
                        id="workflow_name"
                        wire:model.defer="name"
                        wire:change="$set('hasSavedChanges', false)"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm
                        focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                </div>

                <div>
                    <label for="workflow_description" class="block text-sm font-medium text-gray-700">Description</label>
                    <textarea
                        id="workflow_description"
                        wire:model.defer="description"
                        wire:change="$set('hasSavedChanges', false)"
                        rows="3"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm
                        focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"></textarea>
                </div>

                <div class="flex items-center justify-between">
                    <label for="is_public" class="flex items-center">
                        <input 
                            id="is_public" 
                            type="checkbox" 
                            wire:model.defer="is_public"
                            wire:change="$set('hasSavedChanges', false)"
                            class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                        <span class="ml-2 text-sm text-gray-600">Make Public</span>
                    </label>
                    <button
                        wire:click="save"
                        class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                        Save Workflow
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Workflow Steps Section -->
    <div class="mt-8 bg-white overflow-hidden shadow-sm sm:rounded-lg">
        <div class="p-6 bg-white border-b border-gray-200">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Workflow Steps</h3>
                <div>
                    <button
                        wire:click="addStep"
                        class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
                        Add New Step
                    </button>
                    <button
                        wire:click="openCatalog"
                        class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 ml-2">
                        Add From Catalog
                    </button>
                </div>
            </div>

            <!-- SORTABLE LIST - Corrected for Livewire 4 -->
            <ul wire:sortable="updateStepOrder" class="space-y-4">
                @forelse ($workTemplates as $workTemplate)
                    <li
                        wire:sortable.item="{{ $workTemplate['id'] }}"
                        wire:key="step-{{ $workTemplate['id'] }}"
                        class="p-4 bg-gray-50 rounded-lg shadow-sm flex justify-between items-center hover:shadow-md transition-shadow">
                        <div class="flex items-center flex-1">
                            <span wire:sortable.handle class="cursor-grab active:cursor-grabbing text-gray-400 mr-4 text-lg font-bold">
                                
                            </span>
                            <div>
                                <p class="font-semibold">{{ $workTemplate['name'] }}</p>
                                <p class="text-sm text-gray-600">{{ $workTemplate['description'] }}</p>
                            </div>
                        </div>
                        <div class="flex space-x-4">
                            <button
                                wire:click="editStep({{ $workTemplate['id'] }})"
                                class="text-indigo-600 hover:text-indigo-900 font-medium">
                                Edit
                            </button>
                            <button
                                wire:click="deleteStep({{ $workTemplate['id'] }})"
                                class="text-red-600 hover:text-red-900 font-medium">
                                Delete
                            </button>
                        </div>
                    </li>
                @empty
                    <li class="text-center text-gray-500 py-8">
                        No steps yet. Add one to get started.
                    </li>
                @endforelse
            </ul>
        </div>
    </div>

    <!-- Work Catalog Modal -->
    @if($showCatalogModal)
        <div class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold">Add Step From Catalog</h3>
                </div>
                <div class="p-6 max-h-96 overflow-y-auto">
                    <ul class="space-y-4">
                        @forelse ($workCatalogs as $catalog)
                            <li class="p-4 bg-gray-50 rounded-lg shadow-sm flex justify-between items-center">
                                <div>
                                    <p class="font-semibold">{{ $catalog->name }}</p>
                                    <p class="text-sm text-gray-600">{{ $catalog->description }}</p>
                                </div>
                                <div>
                                    <button
                                        wire:click="addStepFromCatalog({{ $catalog->id }})"
                                        class="px-3 py-1 bg-indigo-600 text-white text-sm rounded-md hover:bg-indigo-700">
                                        Add
                                    </button>
                                </div>
                            </li>
                        @empty
                            <li class="text-center text-gray-500 py-4">
                                No items in catalog.
                            </li>
                        @endforelse
                    </ul>
                </div>
                <div class="p-4 bg-gray-50 border-t flex justify-end">
                    <button
                        wire:click="closeCatalog"
                        class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700">
                        Close
                    </button>
                </div>
            </div>
        </div>
    @endif

    <!-- Edit Step Modal -->
    @if($showEditStepModal)
        <div class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold">Edit Step</h3>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label for="editing_step_name" class="block text-sm font-medium text-gray-700">Name</label>
                        <input
                            type="text"
                            id="editing_step_name"
                            wire:model.defer="editingStep.name"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div>
                        <label for="editing_step_description" class="block text-sm font-medium text-gray-700">Description</label>
                        <textarea
                            id="editing_step_description"
                            wire:model.defer="editingStep.description"
                            rows="3"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
                    </div>
                </div>
                <div class="p-4 bg-gray-50 border-t flex justify-end space-x-2">
                    <button
                        wire:click="closeEditStepModal"
                        class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700">
                        Cancel
                    </button>
                    <button
                        wire:click="updateStep"
                        class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    @endif

    <!-- Navigation Guard Script -->
    <script>
        let hasUnsavedChanges = !@json($hasSavedChanges);

        // Listen for changes to reset saved state
        document.addEventListener('livewire:init', () => {
            Livewire.on('workflowSaved', () => {
                hasUnsavedChanges = false;
            });
        });

        // Track form changes
        document.addEventListener('input', (e) => {
            if (e.target.matches('input, textarea, select')) {
                hasUnsavedChanges = true;
            }
        });

        // Prevent navigation if there are unsaved changes
        window.addEventListener('beforeunload', (e) => {
            if (hasUnsavedChanges) {
                e.preventDefault();
                e.returnValue = ''; // Chrome requires returnValue to be set
                return 'You have unsaved changes. Are you sure you want to leave?';
            }
        });

        // Handle in-app navigation (for SPAs or Livewire navigation)
        document.addEventListener('livewire:navigating', (e) => {
            if (hasUnsavedChanges) {
                if (!confirm('You have unsaved changes. Are you sure you want to leave?')) {
                    e.preventDefault();
                }
            }
        });

        // Handle regular link clicks
        document.addEventListener('click', (e) => {
            const link = e.target.closest('a[href]');
            if (link && hasUnsavedChanges && !link.getAttribute('href').startsWith('#')) {
                if (!confirm('You have unsaved changes. Are you sure you want to leave?')) {
                    e.preventDefault();
                }
            }
        });
    </script>
</div>
----
--resources/views/livewire/partials/media-upload.blade.php
<div class="mb-4">
    <label class="block text-sm font-medium text-gray-700">Service Images</label>

    <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
        <div class="space-y-1 text-center">
            <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>

            <div class="flex text-sm text-gray-600">
                <label class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500">
                    <span>Upload files</span>
                    <input type="file" wire:model="newFiles" multiple class="sr-only">
                </label>
                <p class="pl-1">or drag and drop</p>
            </div>

            <p class="text-xs text-gray-500">PNG, JPG, GIF up to 2MB</p>
        </div>
    </div>

    {{-- Existing Images --}}
    @if(count($existingImages) > 0)
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-3">
            @foreach($existingImages as $img)
                <div class="relative">
                    <img src="{{ $img['url'] }}" class="w-full h-32 object-cover rounded border border-gray-200">
                    <button type="button" wire:click="removeExistingImage({{ $img['id'] }})"
                        class="absolute top-1 right-1 bg-red-600 hover:bg-red-700 text-white px-2 py-1 text-xs rounded shadow-md">
                        
                    </button>
                </div>
            @endforeach
        </div>
    @endif

    {{-- New Files Preview --}}
    @if(count($newFiles) > 0)
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-3">
            @foreach($newFiles as $i => $file)
                <div class="relative">
                    <img src="{{ $file->temporaryUrl() }}" class="w-full h-32 object-cover rounded border border-green-200">
                    <button type="button" wire:click="removeNewFile({{ $i }})"
                        class="absolute top-1 right-1 bg-red-600 hover:bg-red-700 text-white px-2 py-1 text-xs rounded shadow-md">
                        
                    </button>
                    <span class="absolute bottom-1 left-1 bg-green-600 text-white px-2 py-0.5 text-xs rounded">
                        New
                    </span>
                </div>
            @endforeach
        </div>
    @endif
</div>
----
--resources/views/livewire/partials/media-uploader.blade.php
<!-- Featured Photos Section -->
<div class="border rounded-lg p-4">
    <div class="flex justify-between items-center mb-3">
        <h3 class="font-semibold text-sm">Featured photos</h3>
        @if(count($existingImages) > 0 || count($newFiles) > 0)
            <div class="flex space-x-3 text-sm">
                <button type="button" wire:click="selectAllImages" class="text-blue-600 hover:text-blue-700">
                    Select all
                </button>
                <button type="button" wire:click="deleteSelected" class="text-red-600 hover:text-red-700">
                    Delete
                </button>
            </div>
        @endif
    </div>

    @if(count($existingImages) > 0 || count($newFiles) > 0)
        <!-- Filled State: Horizontal scroll with images -->
        <div class="flex space-x-3 overflow-x-auto pb-2">
            <!-- Upload Button -->
            <div class="flex-shrink-0 flex items-center justify-center w-24 h-24 border-2 border-dashed border-gray-300 rounded-md hover:border-blue-400 transition cursor-pointer">
                <label for="file-upload" class="cursor-pointer">
                    <span class="text-4xl text-gray-400">+</span>
                    <input id="file-upload" type="file" wire:model="newFiles" multiple class="sr-only" accept="image/*">
                </label>
            </div>

            <!-- Existing Images -->
            @foreach($existingImages as $img)
                <div class="flex-shrink-0 w-24 h-24 relative group">
                    <img src="{{ $img['url'] }}" class="w-full h-full object-cover rounded-md border border-gray-200">
                    <button type="button" wire:click="removeExistingImage({{ $img['id'] }})"
                        class="absolute top-1 right-1 bg-red-600 hover:bg-red-700 text-white w-6 h-6 rounded-full text-xs opacity-0 group-hover:opacity-100 transition">
                        
                    </button>
                </div>
            @endforeach

            <!-- New Files Preview -->
            @foreach($newFiles as $i => $file)
                <div class="flex-shrink-0 w-24 h-24 relative group">
                    <img src="{{ $file->temporaryUrl() }}" class="w-full h-full object-cover rounded-md border-2 border-green-300">
                    <button type="button" wire:click="removeNewFile({{ $i }})"
                        class="absolute top-1 right-1 bg-red-600 hover:bg-red-700 text-white w-6 h-6 rounded-full text-xs opacity-0 group-hover:opacity-100 transition">
                        
                    </button>
                    <span class="absolute bottom-1 left-1 bg-green-600 text-white px-2 py-0.5 text-xs rounded">
                        New
                    </span>
                </div>
            @endforeach
        </div>
    @else
        <!-- Empty State: Large upload area -->
        <div class="mt-2 flex items-center justify-center w-full h-24 border-2 border-dashed border-gray-300 rounded-md hover:border-blue-400 transition cursor-pointer">
            <label for="file-upload-empty" class="cursor-pointer">
                <span class="text-4xl text-gray-400">+</span>
                <input id="file-upload-empty" type="file" wire:model="newFiles" multiple class="sr-only" accept="image/*">
            </label>
        </div>
    @endif

    @error('newFiles.*') <span class="text-red-500 text-xs mt-1">{{ $message }}</span> @enderror
    <p class="text-xs text-gray-500 mt-2">PNG, JPG, GIF up to 2MB</p>
</div>
----
--resources/views/messages/index.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Messages') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 text-gray-900">
                    <h3 class="text-lg font-medium text-gray-900">Your Message Threads</h3>
                    <p class="mt-1 text-sm text-gray-600">
                        Select a thread to view messages.
                    </p>

                    {{-- Placeholder for a list of message threads --}}
                    <div class="mt-6">
                        <p>No message threads yet.</p>
                        {{-- <ul class="divide-y divide-gray-200">
                            @foreach ($threads as $thread)
                                <li>
                                    <a href="{{ route('messages.show', $thread) }}" class="block hover:bg-gray-50">
                                        <div class="px-4 py-4 sm:px-6">
                                            <div class="flex items-center justify-between">
                                                <p class="text-sm font-medium text-indigo-600 truncate">{{ $thread->title ?? 'No Title' }}</p>
                                                <div class="ml-2 flex-shrink-0 flex">
                                                    <p class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                                        {{ $thread->updated_at->diffForHumans() }}
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="mt-2 sm:flex sm:justify-between">
                                                <div class="sm:flex">
                                                    <p class="flex items-center text-sm text-gray-500">
                                                        From: {{ $thread->creator->name }}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                            @endforeach
                        </ul> --}}
                    </div>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/messages/show.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Message Thread') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 text-gray-900">
                    <h3 class="text-lg font-medium text-gray-900">Thread: {{ $thread->title ?? 'No Title' }}</h3>
                    <p class="mt-1 text-sm text-gray-600">Created by: {{ $thread->creator->name }}</p>

                    <div class="mt-6">
                        <livewire:chat-interface :thread="$thread" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/orders/edit.blade.php
<x-app-layout>
    <div class="py-12">
        <div class="max-w-2xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    <h1 class="text-2xl font-bold text-gray-900 mb-6">Edit Order #{{ $order->id }}</h1>

                    <form action="{{ route('orders.update', $order) }}" method="POST" class="space-y-6">
                        @csrf
                        @method('PUT')

                        <!-- Order Details (Read-only) -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h2 class="text-lg font-semibold text-gray-900 mb-4">Order Details</h2>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-600">Order ID</p>
                                    <p class="font-medium text-gray-900">#{{ $order->id }}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Status</p>
                                    <p class="font-medium text-gray-900 capitalize">{{ $order->status }}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Total Amount</p>
                                    <p class="font-medium text-gray-900">${{ number_format($order->total_amount, 2) }}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Created</p>
                                    <p class="font-medium text-gray-900">{{ $order->created_at->format('M d, Y') }}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Cancellation Reason (only if applicable) -->
                        @if($order->status === 'pending' || $order->status === 'cancelled')
                            <div>
                                <label for="cancellation_reason" class="block text-sm font-medium text-gray-700 mb-2">
                                    Cancellation Reason
                                </label>
                                <textarea
                                    id="cancellation_reason"
                                    name="cancellation_reason"
                                    rows="4"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="Provide a reason for cancellation (if applicable)"
                                >{{ $order->cancellation_reason }}</textarea>
                                @error('cancellation_reason')
                                    <p class="text-red-600 text-sm mt-1">{{ $message }}</p>
                                @enderror
                            </div>
                        @endif

                        <!-- Actions -->
                        <div class="flex gap-4">
                            <a href="{{ route('orders.show', $order) }}" class="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition">
                                Cancel
                            </a>
                            <button type="submit" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition">
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/orders/index.blade.php
<x-app-layout>
    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    <h1 class="text-2xl font-semibold mb-6 text-gray-900">My Orders</h1>
                    
                    @if($orders->isEmpty())
                        <div class="text-center py-12">
                            <p class="text-gray-500 text-lg">No orders yet</p>
                            <a href="{{ route('browse') }}" class="mt-4 inline-block text-blue-600 hover:text-blue-800">Browse Services</a>
                        </div>
                    @else
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Order ID
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Service
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Party
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Status
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Payment
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Total
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Date
                                        </th>
                                        <th scope="col" class="relative px-6 py-3">
                                            <span class="sr-only">View</span>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    @foreach($orders as $order)
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                                #{{ $order->id }}
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                {{ $order->service->name }}
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                @if(Auth::user()->id === $order->buyer_id)
                                                    <span class="text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded">Buyer</span>
                                                @else
                                                    <span class="text-xs bg-green-50 text-green-700 px-2 py-1 rounded">Seller</span>
                                                @endif
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <x-order-status-badge :status="$order->status" type="status" />
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <x-order-status-badge :status="$order->payment_status" type="payment" />
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                                ${{ number_format($order->total_amount, 2) }}
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                {{ $order->created_at->format('M d, Y') }}
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                                <a href="{{ route('orders.show', $order) }}" class="text-indigo-600 hover:text-indigo-900">View</a>
                                            </td>
                                        </tr>
                                    @endforeach
                                </tbody>
                            </table>
                        </div>
                    @endif
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/orders/show.blade.php
<x-app-layout>
    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <!-- Header -->
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg mb-6">
                <div class="p-6 bg-white border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900">Order #{{ $order->id }}</h1>
                            <p class="text-gray-600 mt-1">{{ $order->created_at->format('F j, Y, g:i a') }}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-gray-600">Status</p>
                            <x-order-status-badge :status="$order->status" type="status" class="mt-1" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Main Content -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Service Details -->
                    <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                        <div class="p-6 bg-white border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-900 mb-4">Service Details</h2>
                            <div class="space-y-4">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-sm text-gray-600">Service</p>
                                        <p class="text-lg font-medium text-gray-900">{{ $order->service->name }}</p>
                                    </div>
                                    <p class="text-2xl font-bold text-gray-900">${{ number_format($order->price, 2) }}</p>
                                </div>
                                @if($order->service->description)
                                    <div>
                                        <p class="text-sm text-gray-600">Description</p>
                                        <p class="text-gray-700">{{ $order->service->description }}</p>
                                    </div>
                                @endif
                            </div>
                        </div>
                    </div>

                    <!-- Participants -->
                    <div class="grid grid-cols-2 gap-4">
                        <!-- Buyer -->
                        <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                            <div class="p-6 bg-white border-b border-gray-200">
                                <h3 class="text-sm font-semibold text-gray-600 uppercase mb-3">Buyer</h3>
                                <div class="space-y-2">
                                    <p class="font-medium text-gray-900">{{ $order->buyer->name }}</p>
                                    <p class="text-sm text-gray-600">{{ $order->buyer->email }}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Seller -->
                        <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                            <div class="p-6 bg-white border-b border-gray-200">
                                <h3 class="text-sm font-semibold text-gray-600 uppercase mb-3">Seller</h3>
                                <div class="space-y-2">
                                    <p class="font-medium text-gray-900">{{ $order->seller->name }}</p>
                                    <p class="text-sm text-gray-600">{{ $order->seller->email }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Work Progress -->
                    @if($order->workInstance)
                        <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                            <div class="p-6 bg-white border-b border-gray-200">
                                <h2 class="text-lg font-semibold text-gray-900 mb-4">Work Progress</h2>
                                <div class="space-y-3">
                                    <div>
                                        @php
                                            $totalSteps = $order->workInstance->workInstanceSteps->count();
                                            $currentStep = $order->workInstance->current_step_index + 1;
                                            $progress = ($currentStep / $totalSteps) * 100;
                                        @endphp
                                        <p class="text-sm text-gray-600 mb-2">
                                            Progress: <span class="font-medium text-gray-900">{{ $currentStep }} / {{ $totalSteps }}</span>
                                        </p>
                                    </div>
                                    <p class="text-sm text-gray-600">
                                        Current Status: <span class="font-medium text-gray-900 capitalize">{{ $order->workInstance->status }}</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    @endif
                </div>

                <!-- Sidebar -->
                <div class="space-y-6">
                    <!-- Payment Summary -->
                    <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                        <div class="p-6 bg-white">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Payment Summary</h3>
                            <div class="space-y-3 border-b border-gray-200 pb-4 mb-4">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Service Price</span>
                                    <span class="font-medium">${{ number_format($order->price, 2) }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Platform Fee (5%)</span>
                                    <span class="font-medium">${{ number_format($order->platform_fee, 2) }}</span>
                                </div>
                            </div>
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-lg font-semibold text-gray-900">Total</span>
                                <span class="text-2xl font-bold text-gray-900">${{ number_format($order->total_amount, 2) }}</span>
                            </div>
                            <div class="mb-4">
                                <p class="text-sm text-gray-600 mb-2">Payment Status</p>
                                <x-order-status-badge :status="$order->payment_status" type="payment" class="w-full text-center" />
                            </div>

                            @if($order->payment_status === 'pending' && $order->status === 'pending')
                                <a href="{{ route('payments.checkout', $order) }}" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition text-center block">
                                    Proceed to Payment
                                </a>
                            @endif
                        </div>
                    </div>

                    <!-- Actions -->
                    @if($order->status === 'pending' && Auth::user()->id === $order->buyer_id)
                        <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                            <div class="p-6 bg-white">
                                <h3 class="text-sm font-semibold text-gray-900 uppercase mb-3">Actions</h3>
                                <form action="{{ route('orders.cancel', $order) }}" method="POST">
                                    @csrf
                                    <button type="submit" class="w-full bg-red-50 hover:bg-red-100 text-red-700 font-medium py-2 px-4 rounded-lg transition" onclick="return confirm('Are you sure you want to cancel this order?')">
                                        Cancel Order
                                    </button>
                                </form>
                            </div>
                        </div>
                    @endif

                    <!-- Activity Log (if available) -->
                    @if(isset($order->activity))
                        <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                            <div class="p-6 bg-white border-b border-gray-200">
                                <h3 class="text-sm font-semibold text-gray-900 uppercase mb-3">Recent Activity</h3>
                                <div class="space-y-2 text-sm">
                                    <p class="text-gray-600">Order created</p>
                                    <p class="text-gray-600">{{ $order->created_at->format('M d, Y \a\t g:i a') }}</p>
                                </div>
                            </div>
                        </div>
                    @endif
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/payments/checkout.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Checkout') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    <h3 class="text-lg font-semibold">Order Summary</h3>
                    <div class="mt-4">
                        <p><strong>Order ID:</strong> {{ $order->id }}</p>
                        <p><strong>Total Amount:</strong> ${{ number_format($order->total_amount, 2) }}</p>
                    </div>

                    <form action="{{ route('payments.pay', $order) }}" method="POST" class="mt-6">
                        @csrf
                        <button type="submit" class="inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 active:bg-gray-900 focus:outline-none focus:border-gray-900 focus:ring ring-gray-300 disabled:opacity-25 transition ease-in-out duration-150">
                            Pay Now
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/payments/failed.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Payment Failed') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    <h3 class="text-lg font-semibold">Payment Failed</h3>
                    <p class="mt-4">There was an issue with your payment. Please try again.</p>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/payments/success.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Payment Successful') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    <h3 class="text-lg font-semibold">Payment Successful!</h3>
                    <p class="mt-4">Your payment has been processed successfully.</p>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/profile/edit.blade.php
<x-app-layout title="Account Settings">
  <section class="p-4 flex items-center justify-center min-h-screen bg-gradient-to-br from-green-100 via-white to-gray-100">
    <div class="w-full max-w-5xl mx-auto px-4 md:px-0">
      <h2 class="pt-4 text-2xl font-bold text-center mb-10 text-gray-800">Account Settings</h2>

      <div class="flex flex-col md:flex-row gap-8 items-start">
        {{-- Profile Information --}}
        <div class="w-full md:flex-1">
          @include('profile.partials.update-profile-information-form')
        </div>

        {{-- Update Password --}}
        <div class="w-full md:flex-1">
          @include('profile.partials.update-password-form')
        </div>
      </div>

      {{-- User Verification --}}
      <div class="mt-10">
        <div class="p-4 sm:p-8 bg-white shadow sm:rounded-lg">
          <div class="max-w-xl">
            <h2 class="text-lg font-medium text-gray-900">
              {{ __('User Verification') }}
            </h2>
            <p class="mt-1 text-sm text-gray-600">
              {{ __('Submit your documents to get your account verified.') }}
            </p>
            <a href="{{ route('verification.status') }}" class="mt-4 inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-500 active:bg-blue-700 focus:outline-none focus:border-blue-700 focus:ring ring-blue-300 disabled:opacity-25 transition ease-in-out duration-150">
              {{ __('Go to Verification') }}
            </a>
          </div>
        </div>
      </div>

      {{-- Address Management --}}
      <div class="mt-10">
        <div class="p-4 sm:p-8 bg-white shadow sm:rounded-lg">
            <livewire:address-manager />
        </div>
      </div>

      {{-- Delete Account --}}
      <div class="mt-10">
        @include('profile.partials.delete-user-form')
      </div>
    </div>
  </section>
</x-app-layout>
----
--resources/views/profile/partials/delete-user-form.blade.php
<div class="card bg-white border border-gray-200 rounded-2xl shadow p-8 flex flex-col">
  <h2 class="text-lg font-semibold mb-3 text-gray-800">Delete Account</h2>
  <p class="text-sm text-gray-500 mb-6 leading-relaxed">
    Once your account is deleted, all of its data will be permanently removed. Please confirm your password before continuing.
  </p>

  <form method="POST" action="{{ route('profile.destroy') }}" class="flex flex-col flex-1">
    @csrf
    @method('delete')

    <div class="flex-1 space-y-4">
      <div>
        <label for="password" class="form-label">Password</label>
        <input id="password" name="password" type="password" class="form-input" placeholder="Enter your password" required>
        @error('password')
          <p class="text-red-600 text-sm mt-1">{{ $message }}</p>
        @enderror
      </div>
    </div>

    <div class="flex justify-end mt-6">
      <button type="submit" class="btn btn-danger px-6 py-2">Delete Account</button>
    </div>
  </form>
</div>
----
--resources/views/profile/partials/update-password-form.blade.php
<div class="card bg-white border border-gray-200 rounded-2xl shadow p-8 flex flex-col">
  <h2 class="text-lg font-semibold mb-4 text-gray-800">Update Password</h2>
  <p class="text-sm text-gray-500 mb-6">Keep your account secure by setting a strong password.</p>

  <form method="POST" action="{{ route('password.update') }}" class="flex flex-col flex-1">
    @csrf
    @method('put')

    <div class="flex-1 space-y-4">
      <div>
        <label for="current_password" class="form-label">Current Password</label>
        <input id="current_password" name="current_password" type="password" class="form-input" autocomplete="current-password">
        @error('current_password', 'updatePassword')
          <p class="text-red-600 text-sm mt-1">{{ $message }}</p>
        @enderror
      </div>

      <div>
        <label for="password" class="form-label">New Password</label>
        <input id="password" name="password" type="password" class="form-input" autocomplete="new-password">
        @error('password', 'updatePassword')
          <p class="text-red-600 text-sm mt-1">{{ $message }}</p>
        @enderror
      </div>

      <div>
        <label for="password_confirmation" class="form-label">Confirm New Password</label>
        <input id="password_confirmation" name="password_confirmation" type="password" class="form-input" autocomplete="new-password">
        @error('password_confirmation', 'updatePassword')
          <p class="text-red-600 text-sm mt-1">{{ $message }}</p>
        @enderror
      </div>
    </div>

    <div class="flex justify-end mt-6">
      <button type="submit" class="btn btn-primary px-6 py-2">Update Password</button>
    </div>
  </form>
</div>
----
--resources/views/profile/partials/update-profile-information-form.blade.php
<div class="card bg-white border border-gray-200 rounded-2xl shadow p-8">
  <h2 class="text-lg font-semibold mb-4 text-gray-800">Profile Information</h2>

  <form method="POST" action="{{ route('profile.update') }}" enctype="multipart/form-data" class="space-y-4">
    @csrf
    @method('patch')

    {{-- first name and last name --}}
    <div>
        <label for="firstname" class="form-label">First Name</label>
        <input id="firstname" name="firstname" type="text" class="form-input" value="{{ old('firstname', $user->firstname) }}" required autofocus>
        @error('firstname')
          <p class="text-red-600 text-sm mt-1">{{ $message }}</p>
        @enderror
    </div>
    <div>
        <label for="lastname" class="form-label">Last Name</label>
        <input id="lastname" name="lastname" type="text" class="form-input" value="{{ old('lastname', $user->lastname) }}" required>
        @error('lastname')
          <p class="text-red-600 text-sm mt-1">{{ $message }}</p>
        @enderror
    </div>

    <div>
      <label for="email" class="form-label">Email</label>
      <input id="email" name="email" type="email" class="form-input" value="{{ old('email', $user->email) }}" required>
      @error('email')
        <p class="text-red-600 text-sm mt-1">{{ $message }}</p>
      @enderror
    </div>

    <div class="flex justify-end pt-2">
      <button type="submit" class="btn btn-primary px-6 py-2">Save Changes</button>
    </div>
  </form>
</div>
----
--resources/views/search/index.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Search Results') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    <form action="{{ route('search.index') }}" method="GET" class="mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div x-data="{ query: '{{ $query }}', suggestions: [], open: false }" @click.away="open = false">
    <input type="text" name="query" x-model="query" @input.debounce.300ms="
        fetch(`{{ route('search.suggestions') }}?query=${query}`)
            .then(response => response.json())
            .then(data => {
                suggestions = data;
                open = true;
            })
    " placeholder="Search for services..." class="md:col-span-2 rounded-md border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" autocomplete="off">
    <div x-show="open && suggestions.length > 0" class="absolute z-10 w-full bg-white border border-gray-300 rounded-md mt-1">
        <template x-for="suggestion in suggestions" :key="suggestion">
            <a @click.prevent="query = suggestion; open = false" href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" x-text="suggestion"></a>
        </template>
    </div>
</div>
                            
                            <select name="category_id" class="rounded-md border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                <option value="">All Categories</option>
                                @foreach ($categories as $category)
                                    <option value="{{ $category->id }}" @selected($categoryId == $category->id)>{{ $category->name }}</option>
                                @endforeach
                            </select>

                            <input type="text" name="address_id" value="{{ $addressId }}" placeholder="Address ID" class="rounded-md border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                            
                            <input type="number" name="min_price" value="{{ $minPrice }}" placeholder="Min Price" class="rounded-md border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                            
                            <input type="number" name="max_price" value="{{ $maxPrice }}" placeholder="Max Price" class="rounded-md border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">

                            <select name="sort_by" class="rounded-md border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                <option value="created_at" @selected($sortBy == 'created_at')>Date</option>
                                <option value="price" @selected($sortBy == 'price')>Price</option>
                                <option value="title" @selected($sortBy == 'title')>Title</option>
                            </select>

                            <select name="sort_direction" class="rounded-md border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                <option value="desc" @selected($sortDirection == 'desc')>Descending</option>
                                <option value="asc" @selected($sortDirection == 'asc')>Ascending</option>
                            </select>

                            <button type="submit" class="md:col-span-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Search</button>
                        </div>
                    </form>

                    @if ($services->count() > 0)
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            @foreach ($services as $service)
                                <div class="bg-white rounded-2xl border border-gray-300 shadow-md overflow-hidden hover:shadow-xl transition-shadow">
                                    <!-- Service Image -->
                                    <div class="relative h-48 bg-gray-200">
                                        @if($service->media->isNotEmpty())
                                            <img src="{{ $service->media->first()->getUrl() }}" 
                                                alt="{{ $service->title }}" 
                                                class="w-full h-full object-cover">
                                        @else
                                            <div class="flex items-center justify-center h-full">
                                                <svg class="h-16 w-16 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                                </svg>
                                            </div>
                                        @endif
                                    </div>

                                    <!-- Service Details -->
                                    <div class="p-4 space-y-3">
                                        <h3 class="text-lg font-bold text-gray-800 line-clamp-2">{{ $service->title }}</h3>
                                        
                                        <div class="flex items-center justify-between text-sm">
                                            <span class="text-gray-600">{{ $service->category->name ?? 'N/A' }}</span>
                                            <span class="font-bold text-gray-800">${{ number_format($service->price, 2) }}</span>
                                        </div>
                                    </div>
                                </div>
                            @endforeach
                        </div>

                        <div class="mt-8">
                            {{ $services->links() }}
                        </div>
                    @else
                        <p>No services found for your search query.</p>
                    @endif
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/verification/status.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Verification Status') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">

                    <!-- Session Status -->
                    @if (session('success'))
                        <div class="mb-4 font-medium text-sm text-green-600">
                            {{ session('success') }}
                        </div>
                    @endif

                    @if (session('error'))
                        <div class="mb-4 font-medium text-sm text-red-600">
                            {{ session('error') }}
                        </div>
                    @endif

                    @if ($verification)
                        <h3 class="text-lg font-bold">
                            Your submission status is:
                            <span class="capitalize text-blue-600">{{ $verification->status }}</span>
                        </h3>

                        {{-- PENDING --}}
                        @if ($verification->status == 'pending')
                            <p class="mt-2">Your documents are currently under review. We will notify you once the process is complete.</p>

                        {{-- APPROVED --}}
                        @elseif ($verification->status == 'approved')
                            <p class="mt-2 text-green-600">Congratulations! Your identity has been verified.</p>

                        {{-- REJECTED --}}
                        @elseif ($verification->status == 'rejected')
                            <p class="mt-2 text-red-600">Your verification request was rejected.</p>

                            @if ($verification->rejection_reason)
                                <p class="mt-1"><strong>Reason:</strong> {{ $verification->rejection_reason }}</p>
                            @endif

                            <a href="{{ route('verification.create') }}"
                               class="mt-4 inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 active:bg-gray-900 focus:outline-none focus:border-gray-900 focus:ring ring-gray-300 disabled:opacity-25 transition ease-in-out duration-150">
                                {{ __('Submit Again') }}
                            </a>
                        @endif

                        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                                @if ($idFrontMedia)
                                    <div>
                                        <h4 class="font-semibold text-lg mb-2">ID Front:</h4>
                                        <img src="{{ route('media.serve', [
                                            'payload' => Crypt::encryptString(json_encode(['media_id' => $idFrontMedia->id]))
                                        ]) }}" 
                                            alt="ID Front" 
                                            class="max-w-full h-auto rounded-lg shadow-md">
                                    </div>
                                @endif

                                @if ($idBackMedia)
                                    <div>
                                        <h4 class="font-semibold text-lg mb-2">ID Back:</h4>
                                        <img src="{{ route('media.serve', [
                                            'payload' => Crypt::encryptString(json_encode(['media_id' => $idBackMedia->id]))
                                        ]) }}" 
                                            alt="ID Back" 
                                            class="max-w-full h-auto rounded-lg shadow-md">
                                    </div>
                                @endif
                            </div>
                        </div>

                    @else
                        <h3 class="text-lg font-bold">
                            {{ __("You haven't submitted any documents for verification yet.") }}
                        </h3>

                        <a href="{{ route('verification.create') }}"
                           class="mt-4 inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 active:bg-gray-900 focus:outline-none focus:border-gray-900 focus:ring ring-gray-300 disabled:opacity-25 transition ease-in-out duration-150">
                            {{ __('Get Verified Now') }}
                        </a>
                    @endif

                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/verification/submit.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Verify Your Identity') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                    <form method="POST" action="{{ route('verification.store') }}" enctype="multipart/form-data">
                        @csrf

                        <!-- ID Type -->
                        <div>
                            <x-input-label for="id_type" :value="__('ID Type')" />
                            <select id="id_type" name="id_type" class="block mt-1 w-full rounded-md shadow-sm border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                <option value="national_id">{{ __('National ID') }}</option>
                                <option value="drivers_license">{{ __("Driver's License") }}</option>
                                <option value="passport">{{ __('Passport') }}</option>
                            </select>
                        </div>

                        <!-- ID Front -->
                        <div class="mt-4">
                            <x-input-label for="id_front" :value="__('Front of ID')" />
                            <x-text-input id="id_front" class="block mt-1 w-full" type="file" name="id_front" required />
                        </div>

                        <!-- ID Back -->
                        <div class="mt-4">
                            <x-input-label for="id_back" :value="__('Back of ID')" />
                            <x-text-input id="id_back" class="block mt-1 w-full" type="file" name="id_back" required />
                        </div>

                        <div class="flex items-center justify-end mt-4">
                            <x-primary-button>
                                {{ __('Submit for Verification') }}
                            </x-primary-button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--resources/views/work/buyer-monitoring.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('My Work Purchases') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-6xl mx-auto sm:px-6 lg:px-8">
            <!-- Filters -->
            <div class="bg-white overflow-hidden shadow-sm rounded-lg mb-6">
                <div class="p-4 sm:p-6">
                    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                        <a href="?status=" class="inline-flex items-center px-4 py-2 rounded-lg text-sm font-medium {{ !request('status') ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' }}">
                            All Work
                        </a>
                        <a href="?status=in_progress" class="inline-flex items-center px-4 py-2 rounded-lg text-sm font-medium {{ request('status') === 'in_progress' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' }}">
                            In Progress
                        </a>
                        <a href="?status=completed" class="inline-flex items-center px-4 py-2 rounded-lg text-sm font-medium {{ request('status') === 'completed' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' }}">
                            Completed
                        </a>
                        <a href="?status=pending" class="inline-flex items-center px-4 py-2 rounded-lg text-sm font-medium {{ request('status') === 'pending' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' }}">
                            Not Started
                        </a>
                    </div>
                </div>
            </div>

            <!-- Work Instances List -->
            @forelse($workInstances as $work)
                <div class="bg-white overflow-hidden shadow-sm rounded-lg mb-4">
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <h3 class="text-lg font-semibold text-gray-900">
                                        {{ $work->order->service?->title ?? 'Service' }}
                                    </h3>
                                    <x-order-status-badge :status="$work->status" />
                                </div>
                                <p class="text-sm text-gray-600">
                                    Order #{{ $work->order->id }}  Started {{ $work->started_at?->format('M d, Y') ?? 'Not started' }}
                                </p>
                            </div>
                            <div class="text-right">
                                <p class="text-2xl font-bold text-gray-900">{{ number_format($work->order->service?->price ?? 0, 2) }}</p>
                                <p class="text-sm text-gray-600">Payment: <span class="font-medium">{{ ucfirst(str_replace('_', ' ', $work->order->payment_status)) }}</span></p>
                            </div>
                        </div>

                        <!-- Progress Bar -->
                        <div class="mb-4">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm font-medium text-gray-700">Progress</span>
                                <span class="text-sm font-semibold text-gray-900">{{ $work->getProgressPercentage() }}%</span>
                            </div>
                            <x-progress-bar :percentage="$work->getProgressPercentage()" height="h-2" barColor="bg-green-600" />
                        </div>

                        <!-- Step Summary -->
                        <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                            <div class="grid grid-cols-3 gap-4 text-center text-sm">
                                <div>
                                    <p class="text-xl font-bold text-blue-600">{{ $work->workInstanceSteps()->count() }}</p>
                                    <p class="text-gray-600">Total Steps</p>
                                </div>
                                <div>
                                    <p class="text-xl font-bold text-green-600">{{ $work->getCompletedSteps()->count() }}</p>
                                    <p class="text-gray-600">Completed</p>
                                </div>
                                <div>
                                    <p class="text-xl font-bold text-amber-600">{{ $work->workInstanceSteps()->where('status', '!=', 'completed')->count() }}</p>
                                    <p class="text-gray-600">Remaining</p>
                                </div>
                            </div>
                        </div>

                        <!-- Current Step Info -->
                        @if($currentStep = $work->getCurrentStep())
                            <div class="mb-4 p-3 border border-blue-200 bg-blue-50 rounded-lg">
                                <p class="text-sm font-medium text-blue-900">
                                    {{ $currentStep->workTemplate?->name ?? 'Step ' . ($currentStep->step_index + 1) }}
                                </p>
                                <p class="text-xs text-blue-700 mt-1">
                                    {{ $currentStep->workTemplate?->description ?? 'In progress' }}
                                </p>
                                <p class="text-xs text-blue-600 mt-2">
                                    Started: {{ $currentStep->started_at?->format('M d, H:i') ?? 'Just now' }}
                                </p>
                            </div>
                        @else
                            @if($work->isCompleted())
                                <div class="mb-4 p-3 border border-green-200 bg-green-50 rounded-lg">
                                    <p class="text-sm font-medium text-green-900">
                                         All steps completed
                                    </p>
                                    <p class="text-xs text-green-700 mt-1">
                                        Completed on {{ $work->completed_at?->format('M d, Y \a\t H:i') }}
                                    </p>
                                </div>
                            @endif
                        @endif

                        <!-- Seller Info -->
                        <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                            <p class="text-xs text-gray-600 font-medium mb-2">SERVICE PROVIDER</p>
                            <div class="flex items-center">
                                <img src="{{ $work->order->seller->avatar_url ?? 'https://ui-avatars.com/api/?name=' . urlencode($work->order->seller->name) }}" 
                                     alt="{{ $work->order->seller->name }}" 
                                     class="h-8 w-8 rounded-full mr-2">
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-gray-900">{{ $work->order->seller->name }}</p>
                                    <p class="text-xs text-gray-600">@{{ $work->order->seller->username }}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Action Button -->
                        <div class="flex gap-2">
                            <a href="{{ route('work-instances.show', $work) }}" class="flex-1 inline-flex justify-center items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition">
                                View Details
                            </a>
                            @if($work->order->payment_status === 'paid' && $work->status === 'completed')
                                <button class="flex-1 inline-flex justify-center items-center px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 transition">
                                    Leave Review
                                </button>
                            @endif
                        </div>
                    </div>
                </div>
            @empty
                <div class="bg-white rounded-lg shadow-sm p-12 text-center">
                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <h3 class="mt-2 text-lg font-medium text-gray-900">No work purchases yet</h3>
                    <p class="mt-1 text-sm text-gray-500">You haven't purchased any services yet.</p>
                    <div class="mt-6">
                        <a href="{{ route('services.index') }}" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition">
                            Browse Services
                        </a>
                    </div>
                </div>
            @endforelse
        </div>
    </div>
</x-app-layout>
----
--resources/views/work/show.blade.php
<x-app-layout>
    <x-slot name="header">
        <div class="flex justify-between items-center">
            <div>
                <h2 class="font-semibold text-xl text-gray-800 leading-tight">
                    {{ __('Work Instance #' . $workInstance->id) }}
                </h2>
                <p class="mt-1 text-sm text-gray-600">
                    Order #{{ $workInstance->order->id }}
                </p>
            </div>
            <span class="px-3 py-1 rounded-full text-sm font-medium {{ $workInstance->status === 'completed' ? 'bg-green-100 text-green-800' : ($workInstance->status === 'in_progress' ? 'bg-blue-100 text-blue-800' : 'bg-yellow-100 text-yellow-800') }}">
                {{ ucfirst(str_replace('_', ' ', $workInstance->status)) }}
            </span>
        </div>
    </x-slot>

    <div class="py-12">
        <div class="max-w-6xl mx-auto sm:px-6 lg:px-8">
            <!-- Progress Overview -->
            <div class="bg-white overflow-hidden shadow-sm rounded-lg mb-6">
                <div class="p-6 text-gray-900">
                    <h3 class="text-lg font-semibold mb-4">Overall Progress</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-gray-700">Progress</span>
                            <span class="text-sm font-semibold text-gray-900">{{ $workInstance->getProgressPercentage() }}%</span>
                        </div>
                        <x-progress-bar :percentage="$workInstance->getProgressPercentage()" height="h-3" barColor="bg-blue-600" />
                        <div class="grid grid-cols-3 gap-4 mt-6 pt-4 border-t border-gray-200">
                            <div class="text-center">
                                <p class="text-2xl font-bold text-blue-600">{{ $workInstance->workInstanceSteps()->count() }}</p>
                                <p class="text-sm text-gray-600">Total Steps</p>
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold text-green-600">{{ $workInstance->getCompletedSteps()->count() }}</p>
                                <p class="text-sm text-gray-600">Completed</p>
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold text-amber-600">{{ $workInstance->workInstanceSteps()->where('status', '!=', 'completed')->count() }}</p>
                                <p class="text-sm text-gray-600">Remaining</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Timeline View -->
            <div class="bg-white overflow-hidden shadow-sm rounded-lg mb-6">
                <div class="p-6">
                    <h3 class="text-lg font-semibold mb-6 text-gray-900">Work Steps Timeline</h3>
                    
                    <div class="relative">
                        @forelse($workInstance->workInstanceSteps as $step)
                            <div class="mb-8 relative pl-12">
                                <!-- Timeline connector -->
                                @if(!$loop->last)
                                    <div class="absolute left-4 top-10 w-1 h-full {{ $step->isCompleted() ? 'bg-green-400' : 'bg-gray-300' }}"></div>
                                @endif

                                <!-- Timeline dot -->
                                <div class="absolute left-0 top-1 w-8 h-8 rounded-full flex items-center justify-center {{ $step->isCompleted() ? 'bg-green-500' : ($step->isCurrent() ? 'bg-blue-500' : 'bg-gray-300') }} text-white font-semibold">
                                    @if($step->isCompleted())
                                        
                                    @else
                                        {{ $step->step_index + 1 }}
                                    @endif
                                </div>

                                <!-- Step Card -->
                                <div class="bg-gray-50 rounded-lg p-4 border {{ $step->isCurrent() ? 'border-blue-300 bg-blue-50' : ($step->isCompleted() ? 'border-green-300 bg-green-50' : 'border-gray-200') }}">
                                    <div class="flex justify-between items-start mb-3">
                                        <div>
                                            <h4 class="font-semibold text-gray-900">
                                                {{ $step->workTemplate?->name ?? 'Step ' . ($step->step_index + 1) }}
                                            </h4>
                                            @if($step->workTemplate?->description)
                                                <p class="text-sm text-gray-600 mt-1">{{ $step->workTemplate->description }}</p>
                                            @endif
                                        </div>
                                        <span class="px-2 py-1 text-xs font-medium rounded {{ $step->isCompleted() ? 'bg-green-200 text-green-800' : ($step->isCurrent() ? 'bg-blue-200 text-blue-800' : 'bg-gray-200 text-gray-800') }}">
                                            {{ ucfirst($step->status) }}
                                        </span>
                                    </div>

                                    <!-- Step Details -->
                                    <div class="grid grid-cols-3 gap-4 text-sm text-gray-600 mb-4 pb-4 border-b border-gray-200">
                                        <div>
                                            <span class="font-medium">Duration:</span>
                                            {{ $step->getDurationMinutes() }} min
                                        </div>
                                        <div>
                                            <span class="font-medium">Started:</span>
                                            {{ $step->started_at?->format('M d, H:i') ?? 'Not started' }}
                                        </div>
                                        <div>
                                            <span class="font-medium">Completed:</span>
                                            {{ $step->completed_at?->format('M d, H:i') ?? 'Pending' }}
                                        </div>
                                    </div>

                                    <!-- Activity Thread -->
                                    @if($step->activityThread)
                                        <div class="bg-white rounded border border-gray-200 p-3 mb-4">
                                            <div class="flex justify-between items-center mb-3">
                                                <h5 class="font-medium text-gray-900 text-sm">
                                                    {{ $step->activityThread->title ?? 'Step Discussion' }}
                                                </h5>
                                                <span class="text-xs font-medium text-gray-500 bg-gray-100 px-2 py-1 rounded">
                                                    {{ $step->activityThread->getMessageCount() }} message{{ $step->activityThread->getMessageCount() !== 1 ? 's' : '' }}
                                                </span>
                                            </div>
                                            
                                            @if($step->activityThread->description)
                                                <p class="text-xs text-gray-600 mb-2">{{ $step->activityThread->description }}</p>
                                            @endif

                                            @if($step->activityThread->getLatestMessage())
                                                <div class="text-xs text-gray-500 italic border-l-2 border-gray-300 pl-2">
                                                    <strong>Latest:</strong> {{ $step->activityThread->getLatestMessage()->user->name }} said "{{ Str::limit($step->activityThread->getLatestMessage()->content, 80) }}"
                                                    <span class="text-gray-400">{{ $step->activityThread->getLatestMessage()->created_at->diffForHumans() }}</span>
                                                </div>
                                            @endif
                                        </div>
                                    @else
                                        <div class="text-xs text-gray-400 italic">No activity thread yet</div>
                                    @endif

                                    <!-- Step Actions (for seller) -->
                                    @if(auth()->id() === $workInstance->order->seller_id && !$step->isCompleted())
                                        <div class="flex gap-2 pt-2">
                                            @if(!$step->isInProgress())
                                                <form action="{{ route('work-instances.steps.start', [$workInstance, $step]) }}" method="POST" class="inline">
                                                    @csrf
                                                    <button type="submit" class="inline-flex items-center px-3 py-1 bg-blue-600 text-white text-sm font-medium rounded hover:bg-blue-700 transition">
                                                        Start Step
                                                    </button>
                                                </form>
                                            @endif
                                            @if($step->isInProgress())
                                                <form action="{{ route('work-instances.steps.complete', [$workInstance, $step]) }}" method="POST" class="inline">
                                                    @csrf
                                                    <button type="submit" class="inline-flex items-center px-3 py-1 bg-green-600 text-white text-sm font-medium rounded hover:bg-green-700 transition">
                                                        Complete Step
                                                    </button>
                                                </form>
                                            @endif
                                        </div>
                                    @endif
                                </div>
                            </div>
                        @empty
                            <div class="text-center text-gray-500 py-8">
                                <p>No steps defined for this work instance</p>
                            </div>
                        @endforelse
                    </div>
                </div>
            </div>

            <!-- Order Info Card -->
            <div class="bg-white overflow-hidden shadow-sm rounded-lg mb-6">
                <div class="p-6">
                    <h3 class="text-lg font-semibold mb-4 text-gray-900">Order Details</h3>
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-medium text-gray-700 mb-4">Service</h4>
                            <p class="font-semibold text-gray-900">{{ $workInstance->order->service?->title ?? 'N/A' }}</p>
                            <p class="text-sm text-gray-600 mt-1">{{ Str::limit($workInstance->order->service?->description ?? 'N/A', 150) }}</p>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-700 mb-4">Price</h4>
                            <p class="text-2xl font-bold text-gray-900">{{ number_format($workInstance->order->service?->price ?? 0, 2) }}</p>
                            <p class="text-sm text-gray-600 mt-1">Payment: <x-order-status-badge :status="$workInstance->order->payment_status" /></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Participants Card -->
            <div class="bg-white overflow-hidden shadow-sm rounded-lg">
                <div class="p-6">
                    <h3 class="text-lg font-semibold mb-4 text-gray-900">Participants</h3>
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-medium text-gray-700 mb-2">Seller</h4>
                            <div class="flex items-center">
                                <img src="{{ $workInstance->order->seller->avatar_url ?? 'https://ui-avatars.com/api/?name=' . urlencode($workInstance->order->seller->name) }}" 
                                     alt="{{ $workInstance->order->seller->name }}" 
                                     class="h-10 w-10 rounded-full mr-3">
                                <div>
                                    <p class="font-medium text-gray-900">{{ $workInstance->order->seller->name }}</p>
                                    <p class="text-sm text-gray-600">@{{ $workInstance->order->seller->username }}</p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-700 mb-2">Buyer</h4>
                            <div class="flex items-center">
                                <img src="{{ $workInstance->order->buyer->avatar_url ?? 'https://ui-avatars.com/api/?name=' . urlencode($workInstance->order->buyer->name) }}" 
                                     alt="{{ $workInstance->order->buyer->name }}" 
                                     class="h-10 w-10 rounded-full mr-3">
                                <div>
                                    <p class="font-medium text-gray-900">{{ $workInstance->order->buyer->name }}</p>
                                    <p class="text-sm text-gray-600">@{{ $workInstance->order->buyer->username }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
----
--routes/api.php
<?php

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Route;
use App\Http\Middleware\ForceJsonResponse;

use App\Domains\Listings\Http\Controllers\Api\CategoryController;

/*
|--------------------------------------------------------------------------
| API Routes
|--------------------------------------------------------------------------
|
| Here is where you can register API routes for your application. These
| routes are loaded by the RouteServiceProvider within a group which
| is assigned the "api" middleware group. Enjoy building your API!
|
*/

/*
Route::middleware(['api', ForceJsonResponse::class])->group(function () {
    Route::middleware('auth')->get('/user', function (Request $request) {
        return $request->user();
    });
    
    Route::apiResource('categories', CategoryController::class);
});
*/
----
--routes/auth.php
<?php

use App\Domains\Users\Http\Controllers\Auth\AuthenticatedSessionController;
use App\Domains\Users\Http\Controllers\Auth\ConfirmablePasswordController;
use App\Domains\Users\Http\Controllers\Auth\EmailVerificationNotificationController;
use App\Domains\Users\Http\Controllers\Auth\EmailVerificationPromptController;
use App\Domains\Users\Http\Controllers\Auth\NewPasswordController;
use App\Domains\Users\Http\Controllers\Auth\PasswordController;
use App\Domains\Users\Http\Controllers\Auth\PasswordResetLinkController;
use App\Domains\Users\Http\Controllers\Auth\RegisteredUserController;
use App\Domains\Users\Http\Controllers\Auth\VerifyEmailController;
use Illuminate\Support\Facades\Route;

Route::middleware('guest')->group(function () {
    Route::get('join', [RegisteredUserController::class, 'create'])
        ->name('auth.join');

    Route::post('join', [RegisteredUserController::class, 'store']);

    Route::get('signin', [AuthenticatedSessionController::class, 'create'])
        ->name('auth.signin');

    Route::post('signin', [AuthenticatedSessionController::class, 'store']);

    Route::get('forgot-password', [PasswordResetLinkController::class, 'create'])
        ->name('password.request');

    Route::post('forgot-password', [PasswordResetLinkController::class, 'store'])
        ->name('password.email');

    Route::get('reset-password/{token}', [NewPasswordController::class, 'create'])
        ->name('password.reset');

    Route::post('reset-password', [NewPasswordController::class, 'store'])
        ->name('password.store');
});

Route::middleware('auth')->group(function () {
    Route::get('verify-email', EmailVerificationPromptController::class)
        ->name('verification.notice');

    Route::get('verify-email/{id}/{hash}', VerifyEmailController::class)
        ->middleware(['signed', 'throttle:6,1'])
        ->name('verification.verify');

    Route::post('email/verification-notification', [EmailVerificationNotificationController::class, 'store'])
        ->middleware('throttle:6,1')
        ->name('verification.send');

    Route::get('confirm-password', [ConfirmablePasswordController::class, 'show'])
        ->name('password.confirm');

    Route::post('confirm-password', [ConfirmablePasswordController::class, 'store']);

    Route::put('password', [PasswordController::class, 'update'])->name('password.update');

    Route::post('logout', [AuthenticatedSessionController::class, 'destroy'])
        ->name('logout');
});
----
--routes/channels.php
<?php

use Illuminate\Support\Facades\Broadcast;

Broadcast::channel('App.Models.User.{id}', function ($user, $id) {
    return (int) $user->id === (int) $id;
});
----
--routes/console.php
<?php

use Illuminate\Foundation\Inspiring;
use Illuminate\Support\Facades\Artisan;

Artisan::command('inspire', function () {
    $this->comment(Inspiring::quote());
})->purpose('Display an inspiring quote');
----
--routes/web.php
<?php
use Illuminate\Support\Facades\Route;
use App\Domains\Listings\Http\Controllers\ServiceController;
use App\Domains\Users\Http\Controllers\ProfileController;
use App\Domains\Users\Http\Controllers\UserVerificationController;
use App\Domains\Users\Http\Controllers\Admin\UserVerificationController as AdminUserVerificationController;
use App\Domains\Admin\Http\Controllers\DashboardController;
use App\Domains\Admin\Http\Controllers\ActivityLogController;
use App\Domains\Admin\Http\Controllers\UserManagementController;
use App\Domains\Admin\Http\Controllers\ListingManagementController;
use App\Domains\Admin\Http\Controllers\SettingsController;
use App\Domains\Listings\Http\Controllers\CategoryController;
use App\Domains\Common\Http\Controllers\MediaServeController;
use App\Domains\Listings\Http\Controllers\ListingController;
use App\Domains\Listings\Http\Controllers\WorkflowTemplateController;
use App\Domains\Orders\Http\Controllers\OrderController;
use App\Domains\Work\Http\Controllers\WorkInstanceController;
use App\Domains\Work\Http\Controllers\ActivityController;
use App\Domains\Payments\Http\Controllers\PaymentController;
use App\Domains\Payments\Http\Controllers\PaymentWebhookController;

// Authentication routes
require __DIR__.'/auth.php';

// Home and static pages
    Route::get('/', function () {
        return view('home');
    })->name('home');

    Route::get('browse', [ListingController::class, 'index'])->name('browse');

    Route::get('create', function () {
        return view('create');
    })->name('create');

    Route::get('about', function () {
        return view('about');
    })->name('about');

    Route::get('faq', function () {
        return view('faq');
    })->name('faq');

// Public-facing service page
Route::get('/services/{service}', [ServiceController::class, 'show'])->name('services.show');

// Creator space
Route::middleware(['auth'])->prefix('creator')->name('creator.')->group(function () {
    Route::get('/', function () {
        return view('dashboard');
    })->name('dashboard');

    // Service Management
    Route::resource('services', ServiceController::class);
    Route::get('services/{service}/manage', [ServiceController::class, 'manage'])->name('services.manage');

    // Category Management
    Route::resource('categories', CategoryController::class);

    // Workflow Management
    Route::get('workflows', [WorkflowTemplateController::class, 'index'])->name('workflows.index');
    Route::get('workflows/create', [WorkflowTemplateController::class, 'create'])->name('workflows.create');
    Route::get('workflows/{workflow}/edit', [WorkflowTemplateController::class, 'edit'])->name('workflows.edit');
    Route::patch('workflows/{workflow}', [WorkflowTemplateController::class, 'update'])->name('workflows.update');
    Route::delete('workflows/{workflow}', [WorkflowTemplateController::class, 'destroy'])->name('workflows.destroy');
    Route::post('workflows/{workflow}/duplicate', [WorkflowTemplateController::class, 'duplicate'])->name('workflows.duplicate');

    // Seller Work Dashboard
    Route::get('/work-dashboard', [WorkInstanceController::class, 'index'])->name('work-dashboard');
});

// User Verification
Route::middleware(['auth'])->prefix('verification')->name('verification.')->group(function () {
    Route::get('/submit', [UserVerificationController::class, 'create'])->name('create');
    Route::post('/', [UserVerificationController::class, 'store'])->name('store');
    Route::get('/status', [UserVerificationController::class, 'status'])->name('status');
});

// Profile editor
   Route::middleware(['auth'])->prefix('profile')->group(function () {
        Route::get('/', [ProfileController::class, 'edit'])
            ->name('profile.edit');

        Route::patch('/', [ProfileController::class, 'update'])
            ->name('profile.update');

        Route::delete('/', [ProfileController::class, 'destroy'])
            ->name('profile.destroy');
});

// Admin Routes
Route::middleware(['auth', 'admin'])->prefix('admin')->name('admin.')->group(function () {
    Route::get('/dashboard', [DashboardController::class, 'index'])->name('dashboard');
    Route::get('/verifications', [AdminUserVerificationController::class, 'index'])->name('verifications.index');
    Route::get('/verifications/{verification}', [AdminUserVerificationController::class, 'show'])->name('verifications.show');
    Route::post('/verifications/{verification}/approve', [AdminUserVerificationController::class, 'approve'])->name('verifications.approve');
    Route::post('/verifications/{verification}/reject', [AdminUserVerificationController::class, 'reject'])->name('verifications.reject');
    Route::resource('users', UserManagementController::class)->except(['create', 'store']);
    Route::resource('listings', ListingManagementController::class)->except(['create', 'store']);
    Route::get('settings', [SettingsController::class, 'index'])->name('settings.index');
    Route::put('settings', [SettingsController::class, 'update'])->name('settings.update');
    Route::get('activity-logs', [ActivityLogController::class, 'index'])->name('activity-logs.index');
});

Route::get('/media/serve/{payload}', [MediaServeController::class, '__invoke'])
    ->middleware('auth')
    ->name('media.serve');

Route::get('/bids/{bidId}', function ($bidId) {
    return view('bids.show', compact('bidId'));
})->name('bids.show');

Route::middleware(['auth'])->group(function () {
    Route::get('/messages/threads/{thread}', [App\Domains\Messaging\Http\Controllers\MessageController::class, 'show'])->name('messages.show');
    Route::post('/messages/threads', [App\Domains\Messaging\Http\Controllers\MessageController::class, 'createThread'])->name('messages.createThread');
    Route::post('/messages/threads/{thread}/messages', [App\Domains\Messaging\Http\Controllers\MessageController::class, 'sendMessage'])->name('messages.sendMessage');
    Route::post('/messages/threads/{thread}/read', [App\Domains\Messaging\Http\Controllers\MessageController::class, 'markAsRead'])->name('messages.markAsRead');
    Route::get('/messages/threads/{thread}/messages', [App\Domains\Messaging\Http\Controllers\MessageController::class, 'listMessages'])->name('messages.listMessages');
});

Route::middleware(['auth'])->prefix('orders')->name('orders.')->group(function () {
    Route::get('/', [OrderController::class, 'index'])->name('index');
    Route::get('/create', [OrderController::class, 'create'])->name('create');
    Route::post('/', [OrderController::class, 'store'])->name('store');
    Route::get('/{order}', [OrderController::class, 'show'])->name('show');
    Route::get('/{order}/edit', [OrderController::class, 'edit'])->name('edit');
    Route::put('/{order}', [OrderController::class, 'update'])->name('update');
    Route::delete('/{order}', [OrderController::class, 'destroy'])->name('destroy');
    Route::post('/from-bid/{bid}', [OrderController::class, 'createFromBid'])->name('fromBid');
    Route::post('/{order}/cancel', [OrderController::class, 'cancel'])->name('cancel');
});

Route::middleware(['auth'])->prefix('payments')->name('payments.')->group(function () {
    Route::get('/checkout/{order}', [PaymentController::class, 'checkout'])->name('checkout');
    Route::post('/pay/{order}', [PaymentController::class, 'pay'])->name('pay');
    Route::get('/success', [PaymentController::class, 'success'])->name('success');
    Route::get('/failed', [PaymentController::class, 'failed'])->name('failed');
});

// Work Instance Management
Route::middleware(['auth'])->prefix('work-instances')->name('work-instances.')->group(function () {
    Route::get('/{workInstance}', [WorkInstanceController::class, 'show'])->name('show');
    
    // Work Instance Step Management
    Route::post('/{workInstance}/steps/{workInstanceStep}/start', [WorkInstanceController::class, 'startStep'])->name('steps.start');
    Route::post('/{workInstance}/steps/{workInstanceStep}/complete', [WorkInstanceController::class, 'completeStep'])->name('steps.complete');

    // Activity Management
    Route::resource('/{workInstance}/steps/{workInstanceStep}/activities', ActivityController::class);
});

Route::post('/payments/webhook', [PaymentWebhookController::class, 'handle'])->name('payments.webhook');
----
--SUMMARY
Text:303 Binary:4 Skipped:0
